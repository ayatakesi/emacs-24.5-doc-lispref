<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Emacs Programming Tips</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Programming-Tips"/>Emacs Programming Tips</h1></div></div></div><a id="idm84626256" class="indexterm"/><p>以下の慣習にしたがうことにより実行時、あなたのプログラムがよりEmacsに適合するようになります。
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>プログラム内で<code class="literal">next-line</code>や<code class="literal">previous-line</code>を使用してはならない。ほとんど常に、<code class="literal">forward-line</code>のほうがより簡便で、より予測可能かつ堅牢である。<a class="link" href="ch30s02.html#Text-Lines" title="Motion by Text Lines">Text
Lines</a>を参照のこと。
</p></li><li class="listitem"><p>あなたのプログラム内で、マークのセットが意図した機能でないなら、マークをセットする関数を呼び出してはならない。マークはユーザーレベルの機能なので、ユーザーの益となる値を提供する場合を除き、マークの変更は間違っている。<a class="link" href="ch31s07.html" title="The Mark">The
Mark</a>を参照のこと。
</p><p>得に、以下の関数は使用しないこと:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">beginning-of-buffer</code>、<code class="literal">end-of-buffer</code>
</p></li><li class="listitem"><p><code class="literal">replace-string</code>、<code class="literal">replace-regexp</code>
</p></li><li class="listitem"><p><code class="literal">insert-file</code>、<code class="literal">insert-buffer</code>
</p></li></ul></div><p>インタラクティブなユーザーを意図した別の機能がないのにポイントの移動、特定の文字列の置換、またはファイルやバッファーのコンテンツを挿入したいだけなら、単純な1、2行のLispコードでそれらの関数を置き換えられる。
</p></li><li class="listitem"><p>ベクターを使用する特別な理由がある場合を除き、ベクターではなくリストを使用すること。Lispでは、ベクターよりリストを操作する機能のほうが多く、リストを処理するほうが通常は簡便である。
</p><p>要素の挿入や削除がなく(これはリストだけで可能)、ある程度のサイズがあって、(先頭か末尾から検索しない)ランダムアクセスがあるテーブルでは、ベクターが有利である。
</p></li><li class="listitem"><p>エコーエリア内にメッセージを表示する推奨方法は、<code class="literal">princ</code>ではなく<code class="literal">message</code>関数である。<a class="link" href="ch38s04.html" title="The Echo Area">The Echo
Area</a>を参照のこと。
</p></li><li class="listitem"><p>エラーコンディションに遭遇したときは、関数<code class="literal">error</code>(または<code class="literal">signal</code>)を呼び出すこと。関数<code class="literal">error</code>はリターンしない。<a class="link" href="ch11s05.html#Signaling-Errors" title="How to Signal an Error">Signaling
Errors</a>を参照のこと。
</p><p>エラーの報告に<code class="literal">message</code>、<code class="literal">throw</code>、<code class="literal">sleep-for</code>、<code class="literal">beep</code>を使用しないこと。
</p></li><li class="listitem"><p>エラーメッセージは大文字で始まり、ピリオドで終わらないこと。
</p></li><li class="listitem"><p>ミニバッファー内で<code class="literal">yes-or-no-p</code>か<code class="literal">y-or-n-p</code>で答えを求める質問を行う場合には、大文字で始めて‘<code class="literal">?
</code>’で終わること。
</p></li><li class="listitem"><p>ミニバッファーのプロンプトでデフォルト値を示すときは、カッコ内に単語‘<code class="literal">default</code>’を配すること。これは以下のようになる:
</p><pre class="screen">Enter the answer (default 42):
</pre></li><li class="listitem"><p><code class="literal">interactive</code>で引数リストを生成するLisp式を使用する場合には、リージョンまたはポジションの引数にたいして、“正しい”デフォルト値を生成しようと試みではならない。それらの引数が指定されていなければ、かわりに<code class="literal">nil</code>を提供して、引数が<code class="literal">nil</code>のときに関数のbodyでデフォルト値を計算すること。たとえば以下のように記述する:
</p><pre class="screen">(defun foo (pos)
  (interactive
   (list (if <em class="replaceable"><code>specified</code></em> <em class="replaceable"><code>specified-pos</code></em>)))
  (unless pos (setq pos <em class="replaceable"><code>default-pos</code></em>))
  ...)
</pre><p>以下のようにはしないよう:
</p><pre class="screen">(defun foo (pos)
  (interactive
   (list (if <em class="replaceable"><code>specified</code></em> <em class="replaceable"><code>specified-pos</code></em>
             <em class="replaceable"><code>default-pos</code></em>)))
  ...)
</pre><p>これは、そのコマンドを繰り返す場合に、そのときの状況にもとづいてデフォルト値が再計算されるからである。
</p><p>interactiveの‘<code class="literal">d</code>’、‘<code class="literal">m</code>’、‘<code class="literal">r</code>’指定を使用する際、これらはコマンドを繰り返すときの引数値の再計算にたいして特別な段取りを行うので、このような注意事項を採用する必要はない。
</p></li><li class="listitem"><p>実行に長時間を要する多くのコマンドは、開始時に‘<code class="literal">Operating...</code>’、完了時に‘<code class="literal">Operating...done</code>’のような、何らかのメッセージを表示すること。これらのメッセージのスタイルは、‘<code class="literal">...</code>’の周囲に<span class="emphasis"><em>スペース</em></span>を置かず、‘<code class="literal">done</code>’の後に<span class="emphasis"><em>ピリオド</em></span>を置かないよう、一定に保ってほしい。そのようなメッセージを生成する簡便な方法は、<a class="link" href="ch38s04.html#Progress" title="Reporting Operation Progress">Progress</a>を参照のこと。
</p></li><li class="listitem"><p>再帰編集の使用を避けること。かわりにRmailの<strong class="userinput"><code>e</code></strong>コマンドが行うように、元のローカルキーマップに戻るよう定義したコマンドを含む、新たなローカルキーマップを使用する。または単に別のバッファーにスイッチして、ユーザーが自身で戻れるようにすること。<a class="link" href="ch21s13.html" title="Recursive Editing">Recursive
Editing</a>を参照っされたい。
</p></li></ul></div></div></body></html>