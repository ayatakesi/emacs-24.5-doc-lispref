<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Modifying List Variables</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="List-Variables"/>Modifying List Variables</h1></div></div></div><a id="idm49564752" class="indexterm"/><a id="idm49563984" class="indexterm"/><p>これらの関数、および1つのマクロは、変数に格納されたリストを変更する便利な方法を提供します。
</p><pre class="synopsis"><a id="idm49562576" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">push</code> <em class="replaceable"><code>element</code></em> <em class="replaceable"><code>listname</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このマクロは、CARが<em class="replaceable"><code>element</code></em>で、CDRが<em class="replaceable"><code>listname</code></em>で指定されたリストであるような新しいリストを作成して、そのリストを<em class="replaceable"><code>listname</code></em>に保存します。単純なのは、<em class="replaceable"><code>listname</code></em>はリストに名前をつけるクォートされていないシンボルのときで、この場合マクロは<code class="literal">(setq
<em class="replaceable"><code>listname</code></em> (cons <em class="replaceable"><code>element</code></em> <em class="replaceable"><code>listname</code></em>))</code>と等価です。
</p><pre class="screen">(setq l '(a b))
     ⇒ (a b)
(push 'c l)
     ⇒ (c a b)
l
     ⇒ (c a b)
</pre><p>より一般的なのは、<code class="literal">listname</code>が汎変数の場合です。この場合、このマクロは<code class="literal">(setf <em class="replaceable"><code>listname</code></em>
(cons <em class="replaceable"><code>element</code></em> <em class="replaceable"><code>listname</code></em>))</code>と等価です。<a class="link" href="ch12s15.html" title="Generalized Variables">Generalized
Variables</a>を参照してください。
</p><p>リストから1番目の要素を取り出す<code class="literal">pop</code>マクロについては、<a class="link" href="ch06s03.html" title="Accessing Elements of Lists">List Elements</a>を参照してください。
</p></blockquote></div><p>以下の2つの関数は、変数の値であるリストを変更します。
</p><pre class="synopsis"><a id="idm49537744" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">add-to-list</code> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>element</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>append</code></em> <em class="replaceable"><code>compare-fn</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>element</code></em>が<em class="replaceable"><code>symbol</code></em>の値のメンバーでない場合は、<em class="replaceable"><code>symbol</code></em>に<em class="replaceable"><code>element</code></em>をコンスすることにより、変数<em class="replaceable"><code>symbol</code></em>をセットします。この関数は、リストが更新されているかに関わらず、結果のリストをreturnします<em class="replaceable"><code>symbol</code></em>の値は、呼び出し前にすでにリストであることが望ましいです。<em class="replaceable"><code>element</code></em>がリストの既存メンバーか比較するために、<code class="literal">add-to-list</code>は<em class="replaceable"><code>compare-fn</code></em>を使用します。<em class="replaceable"><code>compare-fn</code></em>が<code class="literal">nil</code>の場合は、<code class="literal">equal</code>を使用します。
</p><p><em class="replaceable"><code>element</code></em>が追加される場合は通常、<em class="replaceable"><code>symbol</code></em>の前に追加されますが、オプションの引数<em class="replaceable"><code>append</code></em>が非<code class="literal">nil</code>の場合は、最後に追加されます。
</p><p>引数<em class="replaceable"><code>symbol</code></em>は、暗黙にクォートされません。<code class="literal">setq</code>とは異なり、<code class="literal">add-to-list</code>は<code class="literal">set</code>のような通常の関数です。クォートしたい場合は自分で引数をクォートします。
</p></blockquote></div><p>以下は<code class="literal">add-to-list</code>を使用する方法をシナリオで示します:
</p><pre class="screen">(setq foo '(a b))
     ⇒ (a b)

(add-to-list 'foo 'c)     ;; <code class="literal">c</code>を追加。
     ⇒ (c a b)

(add-to-list 'foo 'b)     ;; 効果なし。
     ⇒ (c a b)

foo                       ;; <code class="literal">foo</code>が変更された。
     ⇒ (c a b)
</pre><p>以下は<code class="literal">(add-to-list '<em class="replaceable"><code>var</code></em> <em class="replaceable"><code>value</code></em>)</code>と等価な式です:
</p><pre class="screen">(or (member <em class="replaceable"><code>value</code></em> <em class="replaceable"><code>var</code></em>)
    (setq <em class="replaceable"><code>var</code></em> (cons <em class="replaceable"><code>value</code></em> <em class="replaceable"><code>var</code></em>)))
</pre><pre class="synopsis"><a id="idm49517264" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">add-to-ordered-list</code> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>element</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>order</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、古い値(リストでなければなりません)の<em class="replaceable"><code>order</code></em>で指定された位置に、<em class="replaceable"><code>element</code></em>を挿入することにより、変数<em class="replaceable"><code>symbol</code></em>をセットします。<em class="replaceable"><code>element</code></em>がすでにこのリストのメンバーである場合、リスト内の要素の位置は<em class="replaceable"><code>order</code></em>にしたがって調整されます。メンバーかどうかは、<code class="literal">eq</code>を使用してテストされます。この関数は、更新されているかどうかに関わらず、結果のリストをreturnします。
</p><p><em class="replaceable"><code>order</code></em>は通常、数字(正数か浮動小数)で、リストの要素は、その数字の昇順で並べられます。
</p><p><em class="replaceable"><code>order</code></em>を省略または<code class="literal">nil</code>にすることもできます。これにより、リストに<em class="replaceable"><code>element</code></em>がすでに存在する場合、<em class="replaceable"><code>element</code></em>の数字順序は変更されません。それ以外では、<em class="replaceable"><code>element</code></em>は数字順序をもちません。リストの数字順序をもたない要素は、リストの最後に配され、特別な順序はつきません。
</p><p><em class="replaceable"><code>order</code></em>に他の値を指定した場合、<em class="replaceable"><code>element</code></em>がすでに数字順序をもつときは数字順序が削除されます。それ以外は、<code class="literal">nil</code>と同じです。
</p><p>引数<em class="replaceable"><code>symbol</code></em>は、暗黙にクォートされません。<code class="literal">add-to-ordered-list</code>は、<code class="literal">setq</code>などとは異なり、<code class="literal">set</code>のような通常の関数です。必要な場合は引数を自分でクォートしてください。
</p><p>順序の情報は、<em class="replaceable"><code>symbol</code></em>の<code class="literal">list-order</code>プロパティーのハッシュテーブルに保存されます。
</p></blockquote></div><p>以下に<code class="literal">add-to-ordered-list</code>を使用する方法をシナリオで示します:
</p><pre class="screen">(setq foo '())
     ⇒ nil

(add-to-ordered-list 'foo 'a 1)     ;; <code class="literal">a</code>を追加。
     ⇒ (a)

(add-to-ordered-list 'foo 'c 3)     ;; <code class="literal">c</code>を追加。
     ⇒ (a c)

(add-to-ordered-list 'foo 'b 2)     ;; <code class="literal">b</code>を追加。
     ⇒ (a b c)

(add-to-ordered-list 'foo 'b 4)     ;; <code class="literal">b</code>を移動。
     ⇒ (a c b)

(add-to-ordered-list 'foo 'd)       ;; <code class="literal">d</code>を後に追加。
     ⇒ (a c b d)

(add-to-ordered-list 'foo 'e)       ;; <code class="literal">e</code>を追加。
     ⇒ (a c b e d)

foo                       ;; <code class="literal">foo</code>が変更された。
     ⇒ (a c b e d)
</pre></div></body></html>