<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. Sequences, Arrays, and Vectors</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Sequences-Arrays-Vectors"/>Chapter 6. Sequences, Arrays, and Vectors</h1></div></div></div><a id="idm48969424" class="indexterm"/><p><em class="firstterm">シーケンス(sequence)</em>型は、2つの異なるLisp型 — リストと配列 —
を結合した型です。他の言い方をすると、任意のリストはシーケンスであり、任意の配列はシーケンスです。すべてのシーケンスがもつ共通な属性は、それぞれが順序づけされた要素のコレクションであることです。
</p><p><em class="firstterm">配列(array)</em>は各スロットが要素である、固定長のオブジェクトです。すべての要素に一定時間でアクセスできます。配列の4つの型として、文字列、ベクター、文字テーブル、ブールベクターがあります。
</p><p>リストは要素のシーケンスですが、要素は単一の基本オブジェクトではありません。リストはコンスセルにより作られ、要素ごとに1つのセルをもちます。<em class="replaceable"><code>n</code></em>番目の要素を探すには、<em class="replaceable"><code>n</code></em>個のコンスセルを走査する必要があるので、先頭から離れた要素ほどアクセスに時間を要します。しかしリストは要素の追加や削除が可能です。
</p><p>以下の図は、これらの型の関連を表します:
</p><pre class="screen">          _____________________________________________
         |                                             |
         |          Sequence                           |
         |  ______   ________________________________  |
         | |      | |                                | |
         | | List | |             Array              | |
         | |      | |    ________       ________     | |
         | |______| |   |        |     |        |    | |
         |          |   | Vector |     | String |    | |
         |          |   |________|     |________|    | |
         |          |  ____________   _____________  | |
         |          | |            | |             | | |
         |          | | Char-table | | Bool-vector | | |
         |          | |____________| |_____________| | |
         |          |________________________________| |
         |_____________________________________________|
</pre><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Sequence-Functions"/>Sequences</h1></div></div></div><p>このセクションでは、任意の種類のシーケンスを許す関数を説明します。
</p><pre class="synopsis"><a id="idm48959696" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">sequencep</code> <em class="replaceable"><code>object</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>object</code></em>がリスト、ベクター、文字列、ブールベクター、文字テーブルの場合は<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をreturnします。
</p></blockquote></div><pre class="synopsis"><a id="idm48955088" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">length</code> <em class="replaceable"><code>sequence</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm48948432" class="indexterm"/><a id="idm48947664" class="indexterm"/><a id="idm48946896" class="indexterm"/><a id="idm48946128" class="indexterm"/><a id="idm48945360" class="indexterm"/><p>この関数は、<em class="replaceable"><code>sequence</code></em>内の要素の数をreturnします。<em class="replaceable"><code>sequence</code></em>がドットリストの場合、<code class="literal">wrong-type-argument</code>エラーがシグナルされます。循環リストは無限ループを引き起こします。文字テーブルでは、Emacsの最大文字コードより、常に1大きい値がreturnされます。
</p><p>関連する関数<code class="literal">safe-length</code>については、<a class="link" href="ch06s03.html#Definition-of-safe_002dlength">Definition of safe-length</a>を参照してください。
</p><pre class="screen">(length '(1 2 3))
    ⇒ 3
</pre><pre class="screen">(length ())
    ⇒ 0
</pre><pre class="screen">(length "foobar")
    ⇒ 6
</pre><pre class="screen">(length [1 2 3])
    ⇒ 3
</pre><pre class="screen">(length (make-bool-vector 5 nil))
    ⇒ 5
</pre></blockquote></div><p><a class="link" href="ch33.html#Text-Representations" title="Text Representations">Text Representations</a>の<code class="literal">string-bytes</code>も参照してください。
</p><p>ディスプレー上での文字列の幅を計算する必要がある場合、文字数だけを数えて各文字のディスプレー幅を計算しない<code class="literal">length</code>ではなく、<code class="literal">string-width</code>
(<a class="link" href="ch38s10.html" title="Size of Displayed Text">Size of Displayed Text</a>を参照してください)を使用するべきです。
</p><pre class="synopsis"><a id="idm48936016" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">elt</code> <em class="replaceable"><code>sequence</code></em> <em class="replaceable"><code>index</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm48933072" class="indexterm"/><p>この関数は、<em class="replaceable"><code>index</code></em>によりインデックスづけされた、<em class="replaceable"><code>sequence</code></em>の要素をreturnします。<em class="replaceable"><code>index</code></em>の値として妥当なのは、0から<em class="replaceable"><code>sequence</code></em>の長さより1小さい数までの範囲の整数です。<em class="replaceable"><code>sequence</code></em>がリストの場合、範囲外の値は<code class="literal">nth</code>と同じように振る舞います。<a class="link" href="ch06s03.html#Definition-of-nth">Definition
of nth</a>を参照してください。それ以外の場合、範囲外の値は<code class="literal">args-out-of-range</code>エラーを引き起こします。
</p><pre class="screen">(elt [1 2 3 4] 2)
     ⇒ 3
</pre><pre class="screen">(elt '(1 2 3 4) 2)
     ⇒ 3
</pre><pre class="screen">;; <code class="literal">elt</code>がどの文字をreturnするか明確にするために<code class="literal">string</code>を使用。
(string (elt "1234" 2))
     ⇒ "3"
</pre><pre class="screen">(elt [1 2 3 4] 4)
     error→ Args out of range: [1 2 3 4], 4
</pre><pre class="screen">(elt [1 2 3 4] -1)
     error→ Args out of range: [1 2 3 4], -1
</pre><p>この関数は、<code class="literal">aref</code> (<a class="link" href="ch07s03.html" title="Functions that Operate on Arrays">Array Functions</a>い)と<code class="literal">nth</code> (<a class="link" href="ch06s03.html#Definition-of-nth">Definition of
nth</a>を参照してください)を一般化したものです。
</p></blockquote></div><pre class="synopsis"><a id="idm48922704" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">copy-sequence</code> <em class="replaceable"><code>sequence</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm48920144" class="indexterm"/><p>この関数は、<em class="replaceable"><code>sequence</code></em>のコピーをreturnします。コピーは元のシーケンスと同じ型で、同じ要素が同じ順番でもちます。
</p><p>コピーに新しい要素を格納するのは、元の<em class="replaceable"><code>sequence</code></em>に影響を与えず、その逆も真です。しかし新しいシーケンス内の要素がコピーされたものでない場合は、元のシーケンスの要素と同一(<code class="literal">eq</code>)になります。したがって、コピーされたシーケンスを通じて見つかった要素を変更すると、この変更は元のシーケンスでも見ることができます。
</p><p>シーケンスがテキストプロパティーをともなう文字列の場合、コピー内のプロパティーリスト自身もコピーとなり、元のシーケンスのプロパティーリストと共有はされません。しかし、プロパティーリストの実際の値は共有されます。<a class="link" href="ch32s19.html" title="Text Properties">Text
Properties</a>を参照してください。
</p><p>この関数は、ドットリストでは機能しません。循環リストのコピーは、無限ループを起こすでしょう。
</p><p>シーケンスをコピーする別の方法は、<a class="link" href="ch06s04.html" title="Building Cons Cells and Lists">Building Lists</a>の<code class="literal">append</code>、<a class="link" href="ch05s03.html" title="Creating Strings">Creating
Strings</a>の<code class="literal">concat</code>、<a class="link" href="ch07s05.html" title="Functions for Vectors">Vector Functions</a>の<code class="literal">vconcat</code>も参照してください。
</p><pre class="screen">(setq bar '(1 2))
     ⇒ (1 2)
</pre><pre class="screen">(setq x (vector 'foo bar))
     ⇒ [foo (1 2)]
</pre><pre class="screen">(setq y (copy-sequence x))
     ⇒ [foo (1 2)]
</pre><pre class="screen">
</pre><pre class="screen">(eq x y)
     ⇒ nil
</pre><pre class="screen">(equal x y)
     ⇒ t
</pre><pre class="screen">(eq (elt x 1) (elt y 1))
     ⇒ t
</pre><pre class="screen">
</pre><pre class="screen">;; 一方のシーケンスの要素を置き換え。
(aset x 0 'quux)
x ⇒ [quux (1 2)]
y ⇒ [foo (1 2)]
</pre><pre class="screen">
</pre><pre class="screen">;; 共有された要素の内部を変更。
(setcar (aref x 1) 69)
x ⇒ [quux (69 2)]
y ⇒ [foo (69 2)]
</pre></blockquote></div></div></div></body></html>