<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>File Local Variables</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="File-Local-Variables"/>File Local Variables</h1></div></div></div><a id="idm54578512" class="indexterm"/><p>ファイルにローカル変数の値を指定できます。そのファイルをvisitしているバッファー内で、これらの変数にたいしてバッファーローカルなバインディングを作成するために、Emacsはこれらを使用します。ファイルローカル変数の基本的な情報については、section “Local Variables in Files” in <em class="citetitle">The GNU Emacs
Manual</em>を参照してください。このセクションはファイルローカル変数が処理される方法に影響する関数と変数を説明します。
</p><p>ファイルローカル変数が勝手に関数や、後で呼び出されるLisp式を指定できる場合、ファイルのvisitによりEmacsが乗っ取られてしまうかもしれません。Emacsは、指定された値が安全だと既知のファイルローカル変数だけを自動的にセットすることにより、この危険から保護します。これ以外のファイルローカル変数は、ユーザーが同意した場合のみセットされます。
</p><p>追加の安全策として、Emacsがファイルローカル変数を読み込むとき、一時的に<code class="literal">read-circle</code>が<code class="literal">nil</code>にバインドされます(<a class="link" href="ch19s03.html" title="Input Functions">Input
Functions</a>を参照してください)。これはLispリーダー循環および共有されたLisp構造(<a class="link" href="ch03s05.html" title="Read Syntax for Circular Objects">Circular
Objects</a>を参照してください)を認識することを防ぎます。
</p><pre class="synopsis"><a id="idm54561616" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">enable-local-variables</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数はファイルローカル変数を処理するかどうかを制御します。以下の値が利用できます:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">t</code>(デフォルト)
</span></dt><dd><p>安全な変数をセットして、安全でない変数については問い合わせます(1回)。
</p></dd><dt><span class="term"><code class="literal">:safe</code>
</span></dt><dd><p>安全な変数だけをセットして、問い合わせはしません。
</p></dd><dt><span class="term"><code class="literal">:all</code>
</span></dt><dd><p>問い合わせをせずに、すべての変数をセットします。
</p></dd><dt><span class="term"><code class="literal">nil</code>
</span></dt><dd><p>変数をセットしません。
</p></dd><dt><span class="term">その他
</span></dt><dd><p>すべての変数にたいして問い合わせます(1回)。
</p></dd></dl></div></blockquote></div><pre class="synopsis"><a id="idm54553296" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">inhibit-local-variables-regexps</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これは正規表現のリストです。ファイルがこのリストの要素にマッチする名前をもつ場合、任意のファイルローカル変数のフォームはスキャンされません。どんなときにこれを使いたいかの例は、See <a class="link" href="ch23s02.html#Auto-Major-Mode" title="How Emacs Chooses a Major Mode">Auto
Major Mode</a>を参照してください。
</p></blockquote></div><pre class="synopsis"><a id="idm54550096" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">hack-local-variables</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>mode-only</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーの内容により指定された任意のローカル変数として、必要に応じてバインドと評価を行います。変数<code class="literal">enable-local-variables</code>は、ここでも効果をもちます。しかし、この関数は‘<code class="literal">-*-</code>’行の、‘<code class="literal">mode:</code>’ローカル変数を探しません。<code class="literal">set-auto-mode</code>はこれを行い、<code class="literal">enable-local-variables</code>も考慮されます(<a class="link" href="ch23s02.html#Auto-Major-Mode" title="How Emacs Chooses a Major Mode">Auto
Major Mode</a>を参照してください)。
</p><p>この関数は、<code class="literal">file-local-variables-alist</code>内に格納されたalistを調べて、各ローカル変数を順に適用することにより機能します。この関数は、変数に適用する前(または後)に、<code class="literal">before-hack-local-variables-hook</code>(または<code class="literal">hack-local-variables-hook</code>)を呼び出します。alistが非<code class="literal">nil</code>の場合のみ、事前のフック(before-hook)を呼び出し、その他のフックは常に呼び出します。この関数は、そのバッファーがすでにもつメジャーモードと同じメジャーモードが指定された場合には、‘<code class="literal">mode</code>’要素を無視します。
</p><p>オプションの引数<em class="replaceable"><code>mode-only</code></em>が非<code class="literal">nil</code>の場合、この関数が行うのはメジャーモードを指定するシンボルをreturnするのがすべてで、‘<code class="literal">-*-</code>’行またはローカル変数リストがメジャーモードを指定していればそのモード、それ以外は<code class="literal">nil</code>をreturnします。この関数はモードや他のファイルローカル変数をセットしません。
</p></blockquote></div><pre class="synopsis"><a id="idm54537424" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">file-local-variables-alist</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このバッファーローカルな変数は、ファイルローカル変数のセッティングのalistを保持します。alistの各要素は<code class="literal">(<em class="replaceable"><code>var</code></em>
.
<em class="replaceable"><code>value</code></em>)</code>という形式で、<em class="replaceable"><code>var</code></em>はローカル変数のシンボル、<em class="replaceable"><code>value</code></em>はその値です。Emacsがファイルをvisitするとき、最初にすべてのファイルローカル変数をこのalistに収集して、その後に変数1つずつに関数<code class="literal">hack-local-variables</code>を適用します。
</p></blockquote></div><pre class="synopsis"><a id="idm54532048" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">before-hack-local-variables-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>Emacsは、<code class="literal">file-local-variables-alist</code>に格納されたファイルローカル変数を適用する直前に、このフックを呼び出します。
</p></blockquote></div><pre class="synopsis"><a id="idm54528720" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">hack-local-variables-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>Emacsは、<code class="literal">file-local-variables-alist</code>に格納されたファイルローカル変数を適用し終えた直後に、このフックを呼び出します。
</p></blockquote></div><a id="idm54525648" class="indexterm"/><p>ある変数にたいして<code class="literal">safe-local-variable</code>プロパティーにより、安全な値を指定できます。このプロパティーは引数を1つとる関数です。与えられた値にたいして、その関数が非<code class="literal">nil</code>をreturnした場合、その値は安全です。一般的に目にするファイル変数の多くは、<code class="literal">safe-local-variable</code>プロパティーをもちます。これらのファイル変数には、<code class="literal">fill-column</code>、<code class="literal">fill-prefix</code>、<code class="literal">indent-tabs-mode</code>が含まれます。ブーリーン値の変数にたいしては、プロパティーの値に<code class="literal">booleanp</code>を使用します。
</p><p><code class="literal">defcustom</code>を使用してユーザーオプションを定義するとき、<code class="literal">defcustom</code>に引数<code class="literal">:safe
<em class="replaceable"><code>function</code></em></code>を追加することにより、<code class="literal">safe-local-variable</code>プロパティーをセットできます(<a class="link" href="ch15s03.html" title="Defining Customization Variables">Variable
Definitions</a>を参照してください)。
</p><pre class="synopsis"><a id="idm54517584" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">safe-local-variable-values</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、ある変数の値が安全であることをマークする、別の方法を提供します。これはコンスセル<code class="literal">(<em class="replaceable"><code>var</code></em>
. <em class="replaceable"><code>val</code></em>)</code>のリストで、<em class="replaceable"><code>var</code></em>は変数名、<em class="replaceable"><code>val</code></em>はその変数にたいして安全な値です。
</p><p>Emacsが一連のファイルローカル変数にしたがうかどうかユーザーに尋ねるとき、ユーザーはそれらの変数が安全だとマークすることができます。安全だとマークすると<code class="literal">safe-local-variable-values</code>にこれらのvariable/valueペアーが追加され、ユーザーのカスタムファイルに保存します。
</p></blockquote></div><pre class="synopsis"><a id="idm54507728" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">safe-local-variable-p</code> <em class="replaceable"><code>sym</code></em> <em class="replaceable"><code>val</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、上記の条件に基づき、<em class="replaceable"><code>sym</code></em>に値<em class="replaceable"><code>val</code></em>を与えても安全な場合は、非<code class="literal">nil</code>をreturnします。
</p></blockquote></div><p>いくつかの変数は<em class="firstterm">危険(risky)</em>だと判断されます。ある変数が危険な場合、その変数が自動的に<code class="literal">safe-local-variable-values</code>に追加されることはありません。ユーザーが<code class="literal">safe-local-variable-values</code>を直接カスタマイズすることにより、明示的に値を許さない限り、危険な変数をセットする前にEmacsは常に確認を求めます。
</p><p>名前が非<code class="literal">nil</code>の<code class="literal">risky-local-variable</code>プロパティーをもつ任意の変数は、危険だと判断されます。<code class="literal">defcustom</code>を使用してユーザーオプションを定義するとき、<code class="literal">defcustom</code>に引数<code class="literal">:risky
<em class="replaceable"><code>value</code></em></code>を追加することにより、ユーザーオプションに<code class="literal">risky-local-variable</code>プロパティーをセットできます。それに加えて名前が‘<code class="literal">-command</code>’、‘<code class="literal">-frame-alist</code>’、‘<code class="literal">-function</code>’、‘<code class="literal">-functions</code>’、‘<code class="literal">-hook</code>’、‘<code class="literal">-hooks</code>’、‘<code class="literal">-form</code>’、‘<code class="literal">-forms</code>’、‘<code class="literal">-map</code>’、‘<code class="literal">-map-alist</code>’、‘<code class="literal">-mode-alist</code>’、‘<code class="literal">-program</code>’、‘<code class="literal">-predicate</code>’で終わる任意の変数は、自動的に危険だと判断されます。後に数字をともなう変数‘<code class="literal">font-lock-keywords</code>’および‘<code class="literal">font-lock-keywords</code>’、さらに‘<code class="literal">font-lock-syntactic-keywords</code>’も危険だと判断されます。
</p><pre class="synopsis"><a id="idm54476624" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">risky-local-variable-p</code> <em class="replaceable"><code>sym</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>sym</code></em>が上記の条件にもとづき危険な変数の場合は、非非<code class="literal">nil</code>をreturnします。
</p></blockquote></div><pre class="synopsis"><a id="idm54472528" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">ignored-local-variables</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数はファイルによりローカル値を与えられるべきではない変数のリストを保持します。これらの変数に指定された任意の値は、完全に無視されます。
</p></blockquote></div><p>‘<code class="literal">Eval:</code>’“変数”も抜け道になる可能性があるので、Emacsは通常、それを処理する前に確認を求めます。
</p><pre class="synopsis"><a id="idm54468944" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">enable-local-eval</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は‘<code class="literal">-*-</code>’行中、またはvisitされるファイル内のローカル変数リストの、‘<code class="literal">Eval:</code>’にたいする処理を制御します。値<code class="literal">t</code>は、無条件に実行することを意味します。<code class="literal">nil</code>は、それらを無視することを意味します。それ以外は、各ファイルにたいして何を行うか、ユーザーに確認を求めることを意味します。デフォルト値は、<code class="literal">maybe</code>です。
</p></blockquote></div><pre class="synopsis"><a id="idm54463696" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">safe-local-eval-forms</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、ファイルローカル変数リスト内の‘<code class="literal">Eval:</code>’“変数”の中、評価しても安全な式のリストを保持します。
</p></blockquote></div><p>その式が関数呼び出しで、その関数が<code class="literal">safe-local-eval-function</code>プロパティーをもつ場合、そのプロパティー値はその式の評価が安全かどうかを決定します。プロパティー値は、その式をテストするための述語(predicate)、そのような述語のリスト(成功した述語があれば安全)、または<code class="literal">t</code>(引数が定数である限り常に安全)を指定できます。
</p><p>テキストプロパティーは、それらの値に関数呼び出しを含めることができるので、抜け道になる可能性があります。したがって、Emacsはファイルローカル変数にたいして指定された文字列値から、テキストプロパティーを取り除きます。
</p></div></body></html>