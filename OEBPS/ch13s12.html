<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Inline Functions</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Inline-Functions"/>Inline Functions</h1></div></div></div><a id="idm53456720" class="indexterm"/><p><em class="firstterm">インライン関数(inline
function)</em>は関数と同様に機能しますが、1つ例外があります。その関数の呼び出しがバイトコンパイルされると(<a class="link" href="ch17.html" title="Chapter 16. Byte Compilation">Byte
Compilation</a>を参照してください)、その関数の定義が呼び出し元に展開されます。インライン関数を定義するには、<code class="literal">defun</code>のかわりに<code class="literal">defsubst</code>を使用します。
</p><pre class="synopsis"><a id="idm53453520" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">defsubst</code> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>args</code></em> [<em class="replaceable"><code>doc</code></em>] [<em class="replaceable"><code>declare</code></em>] [<em class="replaceable"><code>interactive</code></em>] <em class="replaceable"><code>body</code></em><em class="replaceable"><code>…</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このマクロはインライン関数を定義します。マクロの構文は<code class="literal">defun</code>とまったく同じです(<a class="link" href="ch13s04.html" title="Defining Functions">Defining
Functions</a>を参照してください)。
</p></blockquote></div><p>関数をインラインにすることにより、その関数の呼び出しが高速になる場合があります。しかし欠点もあります。1つは柔軟性の減少です。その関数の定義を変更した場合、すでにインライン化された呼び出しは、リコンパイルを行うまで古い定義を使用します。
</p><p>もう1つの欠点は、大きな関数をインライン化することにより、コンパイルされたコードのファイル上およびメモリー上のサイズが増大することです。スピード面でのインライン化の有利性は小さい関数にたいして顕著なので、一般的に大きな関数をインライン化するべきではありません。
</p><p>インライン関数は、デバッグ、トレース、アドバイス(<a class="link" href="ch13s10.html" title="Advising Emacs Lisp Functions">Advising
Functions</a>を参照してください)に際してうまく機能しません。デバッグの容易さと関数の再定義の柔軟さはEmacsの重要な機能なので、スピードがとても重要であり、<code class="literal">defun</code>の使用が実際に性能の面で問題となるのか検証するためにすでにコードをチューニングしたのでなければ、たとえその関数が小さくてもインライン化するべきでは
ありません。
</p><p>インライン関数が実行するのと同じコードに展開されるマクロ(<a class="link" href="ch14.html" title="Chapter 13. Macros">Macros</a>を参照してください)を定義することは可能です。しかし式内でのマクロの直接の使用には制限があります
—
<code class="literal">apply</code>、<code class="literal">mapcar</code>などでマクロを呼び出すことはできません。通常の関数からマクロへの変換には、そのための余分な作業が必要になります。通常の関数をインライン関数に変換するのは簡単です。<code class="literal">defun</code>を<code class="literal">defsubst</code>に置き換えるだけです。インライン関数の引数はそれぞれ正確に1回評価されるので、マクロのときのように、bodyで引数を何回使用するか心配する必要はありません。
</p><p>インライン関数を定義した後、そのインライン展開はマクロ同様、同じファイル内の後の部分で処理されます。
</p></div></body></html>