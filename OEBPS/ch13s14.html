<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Telling the Compiler that a Function is Defined</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Declaring-Functions"/>Telling the Compiler that a Function is Defined</h1></div></div></div><a id="idm53378128" class="indexterm"/><a id="idm53377360" class="indexterm"/><a id="idm53376592" class="indexterm"/><p>あるファイルをバイトコンパイルするとき、コンパイラーが知らない関数について警告が生成されるときがあります(<a class="link" href="ch17s06.html" title="Compiler Errors">Compiler
Errors</a>を参照してください)。実際に問題がある場合もありますが、問題となっている関数がそのコードの実行時にロードされる他のファイルで定義されている場合が通常です。たとえば以前は、<code class="filename">fortran.el</code>をバイトコンパイルすると、以下のような警告が出ていました:
</p><pre class="screen">In end of data:
fortran.el:2152:1:Warning: the function `gud-find-c-expr' is not
    known to be defined.
</pre><p>実際のところ、<code class="literal">gud-find-c-expr</code>は、Fortranモードが使用する<code class="literal">gud-find-expr-function</code>のローカル値(GUDからのコールバック)の中だけで使用されていて、呼びだされた場合はGUD関数がロードされます。そのような警告が実際には問題を示さないことを知っているときには、警告を抑制したほうがよいでしょう。そうすれば、実際に問題があることを示す新しい警告の識別性が良くなります。<code class="literal">declare-function</code>を使用して、これを行うことができます。
</p><p>必要なのは、問題となっている関数を最初に使用する前に<code class="literal">declare-function</code>命令を追加するだけです:
</p><pre class="screen">(declare-function gud-find-c-expr "gud.el" nil)
</pre><p>これは<code class="literal">gud-find-c-expr</code>が<code class="filename">gud.el</code>(‘<code class="literal">.el</code>’は省略可)の中で定義していることを告げます。コンパイラーは関数がそのファイルで実際に定義されているとみなし、チェックを行いません。
</p><p>3つ目の引数はオプションで、<code class="literal">gud-find-c-expr</code>の引数リストを指定します。この例では、引数はありません(<code class="literal">nil</code>と値を指定しないのは、異なります)。それ以外の場合は、<code class="literal">(file
&amp;optional
overwrite)</code>のようになります。引数リストを指定する必要はありませんが、指定すればコンパイラーはその呼び出しが宣言と合致するかチェックできます。
</p><pre class="synopsis"><a id="idm53366480" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">declare-function</code> <em class="replaceable"><code>function</code></em> <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arglist</code></em> <em class="replaceable"><code>fileonly</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>バイトコンパイラーにたいして、引数<em class="replaceable"><code>arglist</code></em>をとる<em class="replaceable"><code>function</code></em>が定義されていて、その定義は<em class="replaceable"><code>file</code></em>にあるとみなすように告げます。<em class="replaceable"><code>fileonly</code></em>が非<code class="literal">nil</code>の場合は、<em class="replaceable"><code>file</code></em>が存在することだけをチェックして、実際の<em class="replaceable"><code>function</code></em>の定義はチェックしないことを意味します。
</p></blockquote></div><p>これらの関数が<code class="literal">declare-function</code>が告げる場所で実際に宣言されているか検証するには、<code class="literal">check-declare-file</code>を使用して、1つのソースファイル中のすべての<code class="literal">declare-function</code>呼び出しをチェックするか、<code class="literal">check-declare-directory</code>を使用して、特定のディレクトリー配下のすべてのファイルをチェックします。
</p><p>これらのコマンドは、<code class="literal">locate-library</code>で使用する関数の定義を含むべきファイルを探します。ファイルが見つからない場合、これらのコマンドは<code class="literal">declare-function</code>の呼び出しを含むファイルをがあるディレクトリーからの相対ファイル名に、定義ファイル名を展開します。
</p><p>‘<code class="literal">.c</code>’や‘<code class="literal">.m</code>’で終わるファイル名を指定することにより、プリミティブ関数を指定することもできます。これが有用なのは、特定のシステムだけで定義されるプリミティブを呼び出す場合だけです。ほとんどのプリミティブは常に定義されているので、それらについて警告を受け取ることはありえないはずです。
</p><p>あるファイルがオプションとして外部のパッケージの関数を使う場合があります。<code class="literal">declare-function</code>命令内のファイル名のプレフィクスを‘<code class="literal">ext:</code>’にすると、そのファイルが見つかった場合はチェックして、見つからない場合はエラーとせずにスキップします。
</p><p>‘<code class="literal">check-declare</code>’が理解しない関数定義もいくつか存在します(たとえば<code class="literal">defstruct</code>や、その他いくつかのマクロ)。そのような場合、<code class="literal">declare-function</code>の<em class="replaceable"><code>fileonly</code></em>引数に、非<code class="literal">nil</code>を渡すことができます。これはファイルの存在だけをチェックして、その関数の実際の定義はチェックしないことを意味します。これを行う場合、引数リストを指定する必要はないのですが、<em class="replaceable"><code>arglist</code></em>引数には<code class="literal">t</code>をセットするべきだということに注意してください(なぜなら<code class="literal">nil</code>は、引数リストが指定されなかったという意味ではなく、空の引数リストを意味するからです)。
</p></div></body></html>