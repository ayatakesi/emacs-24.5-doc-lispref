<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Defining Macros</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Defining-Macros"/>Defining Macros</h1></div></div></div><a id="idm53223504" class="indexterm"/><a id="idm53222736" class="indexterm"/><p>Lispのマクロオブジェクトは、CARが<code class="literal">macro</code>で、CDRが関数のリストです。マクロの展開形は、マクロ呼び出しから、<span class="emphasis"><em>評価されていない</em></span>引数のリストに、(<code class="literal">apply</code>を使って)関数を適用することにより機能します。
</p><p>無名関数のように無名Lispマクロを使用することも可能ですが、無名マクロを<code class="literal">mapcar</code>のようなファンクショナルに渡すことに意味がないので、これが行われることはありません。実際のところ、すべてのLispマクロは名前をもち、ほとんど常に<code class="literal">defmacro</code>マクロで定義されます。
</p><pre class="synopsis"><a id="idm53218512" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">defmacro</code> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>args</code></em> [<em class="replaceable"><code>doc</code></em>] [<em class="replaceable"><code>declare</code></em>] <em class="replaceable"><code>body</code></em><em class="replaceable"><code>…</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><code class="literal">defmacro</code>はシンボル<em class="replaceable"><code>name</code></em>(クォートはしない)を、以下のようなマクロ押して定義します:
</p><pre class="screen">(macro lambda <em class="replaceable"><code>args</code></em> . <em class="replaceable"><code>body</code></em>)
</pre><p>(このリストのCDRはラムダ式であることに注意してください。)
このマクロオブジェクトは、<em class="replaceable"><code>name</code></em>の関数セルに格納されます。<em class="replaceable"><code>args</code></em>の意味は関数の場合と同じで、キーワード<code class="literal">&amp;rest</code>および<code class="literal">&amp;optional</code>が使用されることもあります(<a class="link" href="ch13s02.html#Argument-List" title="Other Features of Argument Lists">Argument
List</a>を参照してください)。<em class="replaceable"><code>name</code></em>と<em class="replaceable"><code>args</code></em>はどちらも、クォートされるべきではありません。<code class="literal">defmacro</code>のreturn値は未定義です。
</p><p><em class="replaceable"><code>doc</code></em>が与えられた場合、それはマクロのドキュメント文字列を指定する文字列です。<em class="replaceable"><code>declare</code></em>が与えられた場合、それはマクロのメタデータを指定する<code class="literal">declare</code>フォームです(<a class="link" href="ch13s13.html" title="The declare Form">Declare
Form</a>を参照してください)。マクロを対話的に呼び出すことはできないので、インタラクティブ宣言をもつことはできないことに注意してください。
</p></blockquote></div><p>マクロが、定数部と非定数部の混合体から構築される巨大なリスト構造を必要とする場合があります。これを簡単に行うためには、‘<code class="literal">`</code>’構文(<a class="link" href="ch10s04.html" title="Backquote">Backquote</a>を参照してください)を使用します。たとえば:
</p><pre class="screen">(defmacro t-becomes-nil (variable)
  `(if (eq ,variable t)
       (setq ,variable nil)))
</pre><pre class="screen">
</pre><pre class="screen">(t-becomes-nil foo)
     ≡ (if (eq foo t) (setq foo nil))
</pre><p>マクロ定義のbodyには、そのマクロに関する追加のプロパティーを指定する、<code class="literal">declare</code>フォームを含めることができます。<a class="link" href="ch13s13.html" title="The declare Form">Declare
Form</a>を参照してください。
</p></div></body></html>