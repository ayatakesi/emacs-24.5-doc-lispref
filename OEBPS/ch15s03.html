<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Defining Customization Variables</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Variable-Definitions"/>Defining Customization Variables</h1></div></div></div><a id="idm52947280" class="indexterm"/><a id="idm52946512" class="indexterm"/><a id="idm52933456" class="indexterm"/><p><em class="firstterm">カスタマイズ可能変数(customizable variable)</em>は<em class="firstterm">ユーザーオプション(user
option)</em>とも呼ばれ、これはCustomizeインターフェースを通じてセットできるグローなるなLisp変数です。<code class="literal">defvar</code>(<a class="link" href="ch12s05.html" title="Defining Global Variables">Defining
Variables</a>を参照してください)により定義される他のグローバル変数とは異なり、カスタマイズ可能変数は<code class="literal">defcustom</code>マクロを使用して定義されます。サブルーチンとして<code class="literal">defvar</code>を呼び出すことに加え、<code class="literal">defcustom</code>はCustomizeインターフェースでその変数が表示される方法や、その変数がとることができる値などを明示します。
</p><pre class="synopsis"><a id="idm52928720" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">defcustom</code> <em class="replaceable"><code>option</code></em> <em class="replaceable"><code>standard</code></em> <em class="replaceable"><code>doc</code></em> [<em class="replaceable"><code>keyword</code></em> <em class="replaceable"><code>value</code></em>]<em class="replaceable"><code>…</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このマクロはユーザーオプション(またはカスタマイズ可能変数)として<em class="replaceable"><code>option</code></em>を宣言します。<em class="replaceable"><code>option</code></em>はクォートするべきではありません。
</p><p>引数<em class="replaceable"><code>standard</code></em>は、<em class="replaceable"><code>option</code></em>の標準値を指定する式です。<code class="literal">defcustom</code>フォームの評価により、<em class="replaceable"><code>standard</code></em>が評価されますが、その値にオプションをバインドする必要はありません。<em class="replaceable"><code>option</code></em>がすでにデフォルト値をもつ場合、それは変更されずに残ります。ユーザーがすでに<em class="replaceable"><code>option</code></em>にたいするカスタマイズを保存している場合、ユーザーによりカスタマイズされた値がデフォルト値としてインストールされます。それ以外は、<em class="replaceable"><code>standard</code></em>を評価した結果がデフォルト値としてインストールされます。
</p><p><code class="literal">defvar</code>と同様、このマクロは<code class="literal">option</code>をスペシャル変数 — 常にダイナミックにバインドされるべきことを意味する
—
としてマークします。<em class="replaceable"><code>option</code></em>がすでにレキシカルバインドをもつ場合、そのレキシカルバインドはバインディング構造を抜けるまで効果をもちます。<a class="link" href="ch12s09.html" title="Scoping Rules for Variable Bindings">Variable
Scoping</a>を参照してください。
</p><p>式<em class="replaceable"><code>standard</code></em>は別の様々な機会にも — カスタマイズ機能が<em class="replaceable"><code>option</code></em>の標準値を知る必要があるときは常に —
評価される可能性があります。そのため任意回数評価しても安全な式を使用するように気をつけてください。
</p><p>引数<em class="replaceable"><code>doc</code></em>は、その変数にたいするドキュメント文字列を指定します。
</p><p><code class="literal">defcustom</code>が何も<code class="literal">:group</code>を指定しない場合、同じファイル内で<code class="literal">defgroup</code>により最後に定義されたグループが使用されます。この方法では、ほとんどの<code class="literal">defcustom</code>は明示的な<code class="literal">:group</code>が必要なくなります。
</p><p>Emacs
Lispモードで<strong class="userinput"><code>C-M-x</code></strong>(<code class="literal">eval-defun</code>)により<code class="literal">defcustom</code>フォームを評価するとき、<code class="literal">eval-defun</code>の特別な機能は、変数の値がvoidかどうかテストせず、無条件に変数をセットする段取りをします(同じ機能は<code class="literal">defvar</code>にも適用されます。<a class="link" href="ch12s05.html" title="Defining Global Variables">Defining
Variables</a>を参照してください)。すでに定義されたdefcustomで<code class="literal">eval-defun</code>を使用することにより、(もしあれば)<code class="literal">:set</code>関数が呼び出されます(以下参照)。
</p><p>事前ロード( pre-loaded)されたEmacs Lispファイル(<a class="link" href="ape.html#Building-Emacs" title="Building Emacs">Building
Emacs</a>を参照してください)に<code class="literal">defcustom</code>を配した場合、ダンプ時にインストールされた標準値は正しくない —
たとえば依存している他の変数は、まだ正しい値を割り当てられていない
—　かもしれません。この場合、Emacs起動後に標準値を再評価するために、以下で説明する<code class="literal">custom-reevaluate-setting</code>を使用します。
</p></blockquote></div><p><a class="link" href="ch15.html#Common-Keywords" title="Common Item Keywords">Common Keywords</a>にリストされたキーワードに加え、このマクロには以下のキーワードを指定できます:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:type <em class="replaceable"><code>type</code></em></code>
</span></dt><dd><p>このオプションのデータ型として、<em class="replaceable"><code>type</code></em>を使用します。これはどんな値が適正なのか、その値をどのように表示するかを指定します(<a class="link" href="ch15s04.html" title="Customization Types">Customization
Types</a>を参照してください)。
</p></dd><dt><span class="term"><code class="literal">:options <em class="replaceable"><code>value-list</code></em></code>
</span></dt><dd><a id="idm52893520" class="indexterm"/><p>このオプションに使用する適正な値のリストを指定します。ユーザーが使用できる値はこれらの値に限定されませんが、これらは便利な候補値を提示します。
</p><p>これは特定の型にたいしてだけ意味をもち、現在のところ<code class="literal">hook</code>、<code class="literal">plist</code>、<code class="literal">alist</code>が含まれます。<code class="literal">:options</code>の使用法の説明は、個別の型の定義を参照してください。
</p></dd><dt><span class="term"><code class="literal">:set <em class="replaceable"><code>setfunction</code></em></code>
</span></dt><dd><a id="idm52888272" class="indexterm"/><p>Customizeインターフェースを使用してこのオプションの値を変更する方法として、<em class="replaceable"><code>setfunction</code></em>を指定します。関数<em class="replaceable"><code>setfunction</code></em>は2つの引数
— シンボル(オプション名)と新しい値 —
をとり、このオプションにたいして正しく値を更新するために必要なことは何であれ行うべきです(これはおそらくLisp変数として単にオプションをセットすることを意味しないでしょう)。望ましくは、この関数は引数の値を破壊的に変更するべきではありません。<em class="replaceable"><code>setfunction</code></em>のデフォルトは、<code class="literal">set-default</code>です。
</p><p>このキーワードを指定した場合、その変数のドキュメント文字列には、手入力のLispコードで同じことを行う方法が記載されるべきです。
</p></dd><dt><span class="term"><code class="literal">:get <em class="replaceable"><code>getfunction</code></em></code>
</span></dt><dd><a id="idm52875216" class="indexterm"/><p>このオプションの値を抽出する方法として、<em class="replaceable"><code>getfunction</code></em>を指定します。関数<em class="replaceable"><code>getfunction</code></em>は1つの引数(シンボル)をとり、カスタマイズがそのシンボル(シンボルのLisp値である必要はない)にたいする“カレント値”としてそれを使うべきかreturnするべきです。デフォルトは<code class="literal">default-value</code>です。
</p><p><code class="literal">:get</code>を正しく使用するためには、Customの機能を真に理解する必要があります。これは変数としてCustom内で扱われる値のためのものですが、実際にはLisp変数に格納されません。実際にLisp変数に格納されている値に<em class="replaceable"><code>getfunction</code></em>を指定するのは、ほとんどは誤りです。
</p></dd><dt><span class="term"><code class="literal">:initialize <em class="replaceable"><code>function</code></em></code>
</span></dt><dd><a id="idm52849488" class="indexterm"/><p><em class="replaceable"><code>function</code></em>は、<code class="literal">defcustom</code>が評価されるときに変数を初期化するために使用される関数であるべきです。これは2つの引数
— オプション名(シンボル)と値をとります。この方法での使用のために事前定義された関数がいくつかあります:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">custom-initialize-set</code>
</span></dt><dd><p>変数の初期化に、その変数の<code class="literal">:set</code>関数を使用しますが、値がすでに非voidの場合、再処帰化を行いません。
</p></dd><dt><span class="term"><code class="literal">custom-initialize-default</code>
</span></dt><dd><p><code class="literal">custom-initialize-set</code>と同様ですが、その変数の<code class="literal">:set</code>のかわりに、関数<code class="literal">set-default</code>を使用して変数をセットします。これは変数の<code class="literal">:set</code>関数がマイナーモードを有効または無効にする場合の、通常の選択です。この選択により、変数の定義ではマイナーモード関数を呼び出しませんが、変数をカスタマイズしたときはマイナーモード関数を呼び出します。
</p></dd><dt><span class="term"><code class="literal">custom-initialize-reset</code>
</span></dt><dd><p>変数の初期化に、常に<code class="literal">:set</code>関数を使用します。変数がすでに非voidの場合、(<code class="literal">:get</code>メソッドでreturnされる)カレント値を使用して<code class="literal">:set</code>関数を呼び出して変数をリセットします。これはデフォルトの<code class="literal">:initialize</code>関数です。
</p></dd><dt><span class="term"><code class="literal">custom-initialize-changed</code>
</span></dt><dd><p>変数がすでにセットされている、またはカスタマイズされている場合は、変数の初期化のために<code class="literal">:set</code>関数を使用し、それ以外は単に<code class="literal">set-default</code>を使用します。
</p></dd><dt><span class="term"><code class="literal">custom-initialize-safe-set</code>
, </span><span class="term"><code class="literal">custom-initialize-safe-default</code>
</span></dt><dd><p>これらのn関数は<code class="literal">custom-initialize-set</code>、<code class="literal">custom-initialize-default</code>と同様に振る舞いますが、エラーをcatchします。初期化中にエラーが発生した場合は、<code class="literal">set-default</code>を使用して変数を<code class="literal">nil</code>にセットして、エラーをシグナルしません。
</p><p>これらの関数は事前ロードされたファイルで定義されたオプションのためのものです(requireされた変数または関数がまだ定義されていないため、<em class="replaceable"><code>standard</code></em>式はエラーをシグナルするかもしれない)。その値は通常、<code class="filename">startup.el</code>で更新され、<code class="literal">defcustom</code>により計算された値は無視されます。startup後に、その値をunsetして、<code class="literal">defcustom</code>を再評価すれば、エラーなしで<em class="replaceable"><code>standard</code></em>は評価されます。
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">:risky <em class="replaceable"><code>value</code></em></code>
</span></dt><dd><a id="idm52828368" class="indexterm"/><p>その変数の<code class="literal">risky-local-variable</code>プロパティーを<em class="replaceable"><code>value</code></em>にセットします(<a class="link" href="ch12s11.html" title="File Local Variables">File Local
Variables</a>を参照してください)。
</p></dd><dt><span class="term"><code class="literal">:safe <em class="replaceable"><code>function</code></em></code>
</span></dt><dd><a id="idm52824144" class="indexterm"/><p>その変数の<code class="literal">safe-local-variable</code>プロパティーを、<em class="replaceable"><code>function</code></em>にセットします(<a class="link" href="ch12s11.html" title="File Local Variables">File Local
Variables</a>を参照してください)。
</p></dd><dt><span class="term"><code class="literal">:set-after <em class="replaceable"><code>variables</code></em></code>
</span></dt><dd><a id="idm52819920" class="indexterm"/><p>保存されたカスタマイズに合わせて変数をセッティングするときは、その前に変数<em class="replaceable"><code>variables</code></em>確実にセット —
つまり、これら他のものが処理される後までセッティングを遅延 —
してください。これら他の変数が意図された値をもっていない場合に、この変数のセッティングが正しく機能しないときは、<code class="literal">:set-after</code>を使用してください。
</p></dd></dl></div><p>特定の機能を“オンに切り替える”オプションにたいしては、<code class="literal">:require</code>キーワードを指定すると便利です。これは、その機能がまだロードされていないときは、そのオプションがセットされるとEmacsがその機能をロードするようにします。<a class="link" href="ch15.html#Common-Keywords" title="Common Item Keywords">Common
Keywords</a>を参照してください。以下はライブラリー<code class="filename">saveplace.el</code>の例です:
</p><pre class="screen">(defcustom save-place nil
  "Non-nil means automatically save place in each file..."
  :type 'boolean
  :require 'saveplace
  :group 'save-place)
</pre><p>あるカスタマイズアイテムが、<code class="literal">:options</code>がサポートする<code class="literal">hook</code>や<code class="literal">alist</code>のような型をもつ場合は、<code class="literal">custom-add-frequent-value</code>を呼び出すことにより、<code class="literal">defcustom</code>宣言の外部から、別途値を追加できます。たとえば<code class="literal">emacs-lisp-mode-hook</code>から呼び出されることを意図した関数<code class="literal">my-lisp-mode-initialization</code>を定義する場合は、<code class="literal">emacs-lisp-mode-hook</code>にたいする正当な値として、その定義を編集することなく、その関数をリストに追加したいと思うかもしれません。これは以下のようにして行うことができます:
</p><pre class="screen">(custom-add-frequent-value 'emacs-lisp-mode-hook
   'my-lisp-mode-initialization)
</pre><pre class="synopsis"><a id="idm52772816" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">custom-add-frequent-value</code> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>value</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>カスタマイズオプション<em class="replaceable"><code>symbol</code></em>にたいして正当な値のリストに<em class="replaceable"><code>value</code></em>を追加します。
</p><p>追加による正確な効果は、<em class="replaceable"><code>symbol</code></em>のカスタマイズ型に依存します。
</p></blockquote></div><p>内部的には、<code class="literal">defcustom</code>は、標準値にたいする式を記録するためにシンボルプロパティー<code class="literal">standard-value</code>を、カスタマイズバッファーでユーザーによりセットされたが保存されていない値を記録するために<code class="literal">saved-value</code>を使用します。<a class="link" href="ch09s04.html" title="Symbol Properties">Symbol
Properties</a>を参照してください。これらのプロパティーは、carがその値を評価する式であるようなリストです。
</p><pre class="synopsis"><a id="idm52752976" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">custom-reevaluate-setting</code> <em class="replaceable"><code>symbol</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<code class="literal">defcustom</code>を通じて宣言されたユーザーオプション<em class="replaceable"><code>symbol</code></em>の標準値を再評価します。変数がカスタマイズされた場合、この関数はかわりに保存された値を再評価します。それからこの関数はユーザーオプションをその値に(もし定義されていればそのオプションの<code class="literal">:set</code>プロパティーを使用して)セットします。
</p><p>これは値が正しく計算される前に定義されたカスタマイズ可能オプションにたいして有用です。たとえばstartupの間、Emacsは事前ロードされたEmacs
Lispファイルで定義されたユーザーオプションにたいしてこの関数を呼び出しますが、これらの初期値は実行時だけ利用可能な情報に依存します。
</p></blockquote></div><pre class="synopsis"><a id="idm52747984" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">custom-variable-p</code> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>arg</code></em>がカスタマイズ可能変数の場合は、非<code class="literal">nil</code>をreturnします。カスタマイズ可能変数とは、<code class="literal">standard-value</code>か<code class="literal">custom-autoload</code>プロパティーをもつ(通常は<code class="literal">defcustom</code>で宣言されたことを意味する)変数、または別のカスタマイズ可能変数にたいするエイリアスのことです。
</p></blockquote></div></div></body></html>