<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Byte-Compilation Functions</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Compilation-Functions"/>Byte-Compilation Functions</h1></div></div></div><a id="idm55856208" class="indexterm"/><p><code class="literal">byte-compile</code>により、関数やマクロを個別にバイトコンパイルできます。<code class="literal">byte-compile-file</code>でファイル全体、<code class="literal">byte-recompile-directory</code>または<code class="literal">batch-byte-compile</code>で複数ファイルをコンパイルできます。
</p><p>バイトコンパイラーが警告、および/またはエラーメッセージを生成することもあります(詳細は<a class="link" href="ch17s06.html" title="Compiler Errors">Compiler
Errors</a>を参照)。これらのメッセージはCompilationモードが使用する<code class="filename">*Compile-Log*</code>と呼ばれるバッファーに記録されます。section “Compilation
Mode” in <em class="citetitle">The GNU Emacs Manual</em>を参照してください。
</p><a id="idm55839056" class="indexterm"/><p>バイトコンパイルを意図したファイル内にマクロ呼び出しを記述する際は、注意が必要です。マクロ呼び出しはコンパイル時に展開されるので、そのマクロはEmacsにロードされる必要があります(さもないとバイトコンパイラーは正しく処理しないでしょう)。これを処理する通常の方法は、必要なマクロ定義を含むファイルを<code class="literal">require</code>フォームで指定することです。バイトコンパイラーは通常、コンパイルするコードを評価しませんが、<code class="literal">require</code>フォームは指定されたライブラリーをロードすることにより特別に扱われます。誰かがコンパイルされたプログラムを<span class="emphasis"><em>実行</em></span>する際に、マクロ定義ファイルのロードを回避するには、<code class="literal">require</code>呼び出しの周囲に<code class="literal">eval-when-compile</code>を記述します(<a class="link" href="ch17s05.html" title="Evaluation During Compilation">Eval
During Compile</a>を参照)。詳細は<a class="link" href="ch14s03.html" title="Macros and Byte Compilation">Compiling Macros</a>を参照してください。
</p><p>インライン(<code class="literal">defsubst</code>)の関数は、これほど面倒ではありません。定義が判明する前にそのような関数呼び出しをコンパイルした場合でも、その呼び出しは低速になるだけで、正しく機能するでしょう。
</p><pre class="synopsis"><a id="idm55833296" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">byte-compile</code> <em class="replaceable"><code>symbol</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>symbol</code></em>の関数定義をバイトコンパイルして、以前の定義をコンパイルされた定義に置き換えます。<em class="replaceable"><code>symbol</code></em>の関数定義は、その関数にたいする実際のコードでなければなりません。<code class="literal">byte-compile</code>はインダイレクト関数を処理しません。リターン値は、<em class="replaceable"><code>symbol</code></em>のコンパイルされた定義であるバイトコード関数ブジェクトです(<a class="link" href="ch17s07.html" title="Byte-Code Function Objects">Byte-Code
Objects</a>を参照)。
</p><pre class="screen">(defun factorial (integer)
  "INTEGERの階乗を計算する。"
  (if (= 1 integer) 1
    (* integer (factorial (1- integer)))))
⇒ factorial
</pre><pre class="screen">
</pre><pre class="screen">(byte-compile 'factorial)
⇒
#[(integer)
  "^H\301U\203^H^@\301\207\302^H\303^HS!\"\207"
  [integer 1 * factorial]
  4 "Compute factorial of INTEGER."]
</pre><p><em class="replaceable"><code>symbol</code></em>の定義がバイトコード関数オブジェクトの場合、<code class="literal">byte-compile</code>は何も行わず<code class="literal">nil</code>をリターンします。そのシンボルの関数セル内の(コンパイルされていない)オリジナルのコードはすでにバイトコンパイルされたコードに置き換えられているので、“シンボルの定義の再コンパイル”はしません。
</p><p><code class="literal">byte-compile</code>の引数として<code class="literal">lambda</code>式も指定できます。この場合、関数は対応するコンパイル済みコードをリターンしますが、それはどこにも格納されません。
</p></blockquote></div><pre class="synopsis"><a id="idm55823568" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">compile-defun</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドはポイントを含むdefunを読み取りそれをコンパイルして、結果を評価します。実際に関数定義であるようなdefunでこれを使用した場合は、その関数のコンパイル済みバージョンをインストールする効果があります。
</p><p><code class="literal">compile-defun</code>は通常、評価した結果をエコーエリアに表示しますが、<em class="replaceable"><code>arg</code></em>が非<code class="literal">nil</code>の場合は、そのフォームをコンパイルした後にカレントバッファーに結果を挿入します。
</p></blockquote></div><pre class="synopsis"><a id="idm55818192" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">byte-compile-file</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>load</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>filename</code></em>という名前のLispコードファイルを、バイトコードのファイルにコンパイルします。出力となるファイルの名前は、サフィックス‘<code class="literal">.el</code>’を‘<code class="literal">.elc</code>’に変更することにより作成されます。<em class="replaceable"><code>filename</code></em>が‘<code class="literal">.el</code>’で終了しない場合は、‘<code class="literal">.elc</code>’を<em class="replaceable"><code>filename</code></em>の最後に付け足します。
</p><p>コンパイルは入力ファイルから1つのフォームを逐次読み取ることにより機能します。フォームが関数またはマクロの場合は、コンパイル済みの関数またはマクロが書き込まれます。それ以外のフォームはまとめられて、まとめられたものごとにコンパイルされ、そのファイルが読まれたとき実行されるようにコンパイルされたコードが書き込まれます。入力ファイルを読み取る際、すべてのコメントは無視されます。
</p><p>このコマンドはエラーのないときは<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をリターンします。インタラクティブに呼び出されたときは、ファイル名の入力をもとめます。
</p><p><em class="replaceable"><code>load</code></em>が非<code class="literal">nil</code>の場合、このコマンドはコンパイルした後にコンパイルされたファイルをロードします。インタラクティブに呼び出された場合、<em class="replaceable"><code>load</code></em>はプレフィクス引数です。
</p><pre class="screen">$ ls -l push*
-rw-r--r-- 1 lewis lewis 791 Oct  5 20:31 push.el
</pre><pre class="screen">
</pre><pre class="screen">(byte-compile-file "~/emacs/push.el")
     ⇒ t
</pre><pre class="screen">
</pre><pre class="screen">$ ls -l push*
-rw-r--r-- 1 lewis lewis 791 Oct  5 20:31 push.el
-rw-rw-rw- 1 lewis lewis 638 Oct  8 20:25 push.elc
</pre></blockquote></div><pre class="synopsis"><a id="idm55805520" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">byte-recompile-directory</code> <em class="replaceable"><code>directory</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>flag</code></em> <em class="replaceable"><code>force</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm55801808" class="indexterm"/><p>このコマンドは、<em class="replaceable"><code>directory</code></em>(またはそのサブディレクトリー)内の、リコンパイルを要するすべての‘<code class="literal">.el</code>’ファイルをリコンパイルします。‘<code class="literal">.elc</code>’ファイルが存在し、それが‘<code class="literal">.el</code>’より古いファイルは、リコンパイルが必要です。
</p><p>‘<code class="literal">.el</code>’ファイルに対応する‘<code class="literal">.elc</code>’ファイルが存在しない場合、何を行うかを<em class="replaceable"><code>flag</code></em>で指定します。<code class="literal">nil</code>の場合、このコマンドはこれらのファイルを無視します。<em class="replaceable"><code>flag</code></em>が0のときは、それらをコンパイルします。<code class="literal">nil</code>と0以外の場合は、それらのファイルをコンパイルするかユーザーに尋ね、同様にそれぞれのサブディレクトリーについても尋ねます。
</p><p>インタラクティブに呼び出された場合、<code class="literal">byte-recompile-directory</code>は<em class="replaceable"><code>directory</code></em>の入力を求め、<em class="replaceable"><code>flag</code></em>はプレフィクス引数になります。
</p><p><em class="replaceable"><code>force</code></em>が非<code class="literal">nil</code>の場合、このコマンドは‘<code class="literal">.elc</code>’ファイルのあるすべての‘<code class="literal">.el</code>’ファイルをリコンパイルします。
</p><p>リターン値は不定です。
</p></blockquote></div><pre class="synopsis"><a id="idm55790928" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">batch-byte-compile</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>noforce</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、コマンドラインで指定されたファイルにたいして、<code class="literal">byte-compile-file</code>を実行します。この関数は処理が完了するとEmacsをkillするので、Emacsのバッチ実行だけで使用しなければなりません。1つのファイルでエラーが発生しても、それにより後続のファイルにたいする処理が妨げられることはありませんが、そのファイルにたいする出力ファイルは生成されず、Emacsプロセスは0以外のステータスコードで終了します。
</p><p><em class="replaceable"><code>noforce</code></em>が非<code class="literal">nil</code>の場合、この関数は最新の‘<code class="literal">.elc</code>’ファイルがあるファイルをリコンパイルしません。
</p><pre class="screen">$ emacs -batch -f batch-byte-compile *.el
</pre></blockquote></div></div></body></html>