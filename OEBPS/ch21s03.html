<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Interactive Call</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Interactive-Call"/>Interactive Call</h1></div></div></div><a id="idm60783696" class="indexterm"/><p>コマンドループはキーシーケンスをコマンドに翻訳した後、関数<code class="literal">command-execute</code>を使用してその関数を呼び出します。そのコマンドが関数の場合、<code class="literal">command-execute</code>は引数を読み取りコマンドを呼び出す<code class="literal">call-interactively</code>を呼び出します。自分でこれらの関数を呼び出すこともできます。
</p><p>このコンテキストにおいて用語“command”はインタラクティブにコール可能な関数(または関数likeなオブジェクト)やキーボードマクロを指すことに注意してください。つまりコマンドを呼び出すキーシーケンスのことではありません(<a class="link" href="ch22.html" title="Chapter 21. Keymaps">Keymaps</a>を参照)。
</p><pre class="synopsis"><a id="idm60775760" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">commandp</code> <em class="replaceable"><code>object</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>for-call-interactively</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>object</code></em>がコマンドの場合は<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をリターンする。
</p><p>コマンドには文字列とベクター(キーボードマクロとして扱われる)、トップレベル<code class="literal">interactive</code>フォーム(<a class="link" href="ch21s02.html#Using-Interactive" title="Using interactive">Using
Interactive</a>を参照)を含むラムダ式、そのようなラムダ式から作成されたバイトコンパイル関数オブジェクト、interactiveとして宣言(<code class="literal">autoload</code>の4つ目の引数が非<code class="literal">nil</code>)されたautoloadオブジェクト、およびいくつかのプリミティブ関数が含まれる。<code class="literal">interactive-form</code>プロパティが非<code class="literal">nil</code>のシンボル、および関数定義が<code class="literal">commandp</code>を満足するシンボルもコマンドとされる。
</p><p><em class="replaceable"><code>for-call-interactively</code></em>が非<code class="literal">nil</code>の場合は、<code class="literal">call-interactively</code>が呼び出すことができるオブジェクトにたいしてのみ<code class="literal">commandp</code>は<code class="literal">t</code>をリターンする。したがってキーボードマクロは該当しなくなる。
</p><p><code class="literal">commandp</code>を使用する現実的な例は、<a class="link" href="ch24s02.html" title="Access to Documentation Strings">Accessing
Documentation</a>内の<code class="literal">documentation</code>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm60761936" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">call-interactively</code> <em class="replaceable"><code>command</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>record-flag</code></em> <em class="replaceable"><code>keys</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数はinteractive呼び出し仕様にしたがって引数を取得し、インタラクティブに呼び出し可能な関数<em class="replaceable"><code>command</code></em>を呼び出す。これは<em class="replaceable"><code>command</code></em>がリターンするものが何であれ、それをリターンする。
</p><p>たとえば、もし以下の署名をもつ関数がある場合:
</p><pre class="screen">(defun foo (begin end)
  (interactive "r")
  ...)
</pre><p>以下を行うと
</p><pre class="screen">(call-interactively 'foo)
</pre><p>これはリージョン(<code class="literal">point</code>と<code class="literal">mark</code>)を引数として<code class="literal">foo</code>を呼び出すだろう。
</p><p><em class="replaceable"><code>command</code></em>が関数でない、またはインタラクティブに呼び出せない(コマンドでない)場合は、エラーをシグナルする。たとえコマンドだとしても、キーボードマクロ(文字列かベクター)は、関数ではないので、許されないことに注意。<em class="replaceable"><code>command</code></em>がシンボルの場合、<code class="literal">call-interactively</code>はそれの関数定義を使用する。
</p><a id="idm60747728" class="indexterm"/><p><em class="replaceable"><code>record-flag</code></em>が非<code class="literal">nil</code>の場合は、このコマンドとコマンドの引数は無条件にリスト<code class="literal">command-history</code>に追加される。それ以外では、引数の読み取りにミニバッファーを使用した場合のみコマンドが追加される。<a class="link" href="ch21s15.html" title="Command History">Command
History</a>を参照のこと。
</p><p>引数<em class="replaceable"><code>keys</code></em>が与えられた場合、それはコマンドを呼び出すためにどのイベントを使用するかコマンドが問い合わせた場合に与えるべき、イベントシーケンスを指定するベクターである。<em class="replaceable"><code>keys</code></em>が<code class="literal">nil</code>、または省略された場合のデフォルトは、<code class="literal">this-command-keys-vector</code>のリターン値である。<a class="link" href="ch21s05.html#Definition-of-this_002dcommand_002dkeys_002dvector">Definition
of this-command-keys-vector</a>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm60741840" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">command-execute</code> <em class="replaceable"><code>command</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>record-flag</code></em> <em class="replaceable"><code>keys</code></em> <em class="replaceable"><code>special</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm60737744" class="indexterm"/><p>この関数は<em class="replaceable"><code>command</code></em>を実行する。引数<em class="replaceable"><code>command</code></em>は述語<code class="literal">commandp</code>を満足しなければならない。つまりインタラクティブに呼び出し可能な関数かキーボードマクロでなければならない。
</p><p><em class="replaceable"><code>command</code></em>が文字列かベクターの場合は、<code class="literal">execute-kbd-macro</code>により実行される。関数は<em class="replaceable"><code>record-flag</code></em>および<em class="replaceable"><code>keys</code></em>引数とともに<code class="literal">call-interactively</code>に渡される(上記参照)。
</p><p><em class="replaceable"><code>command</code></em>がシンボルの場合、その位置にシンボルの関数定義が使用される。<code class="literal">autoload</code>定義のあるシンボルは、インタラクティブに呼び出し可能な関数お意味するよう宣言されている場合は、コマンドとして判断される。そのような宣言は、指定されたライブラリーのロードと、シンボル定義の再チェックにより処理される。
</p><p>引数<em class="replaceable"><code>special</code></em>が与えられた場合、それはプレフィクス引数を無視して、それをクリアーしないという意味である。これはスペシャルイベント(<a class="link" href="ch21s09.html" title="Special Events">Special
Events</a>を参照)を実行する場合に使用される。
</p></blockquote></div><pre class="synopsis"><a id="idm60717904" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">execute-extended-command</code> <em class="replaceable"><code>prefix-argument</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm60715344" class="indexterm"/><p>この関数は<code class="literal">completing-read</code>(<a class="link" href="ch20s06.html" title="Completion">Completion</a>を参照)を使用して、ミニバッファーからコマンド名を読み取る。その後、指定されたコマンドを呼び出すために<code class="literal">command-execute</code>を使用する。そのコマンドがリターンするのが何であれ、それが<code class="literal">execute-extended-command</code>の値となる。
</p><a id="idm60712144" class="indexterm"/><p>そのコマンドがプレフィクス引数を求める場合は、<em class="replaceable"><code>prefix-argument</code></em>のの値を受け取る。<code class="literal">execute-extended-command</code>がインタラクティブに呼び出された場合は、カレントのrawプレフィクス引数が<em class="replaceable"><code>prefix-argument</code></em>に使用され、それが何であれ実行するコマンドに渡される。
</p><a id="idm60709456" class="indexterm"/><p>通常、<code class="literal">execute-extended-command</code>は<strong class="userinput"><code>M-x</code></strong>の定義なので、プロンプトとして文字列‘<code class="literal">M-x
</code>’を使用する(<code class="literal">execute-extended-command</code>を呼び出したイベントからプロンプトを受け取るほうが良いのだろうが、実装は骨が折れる)。プレフィクス引数の値の説明が、もしあれば、それもプロンプトの一部となる。
</p><pre class="screen">(execute-extended-command 3)
---------- Buffer: Minibuffer ----------
3 M-x forward-word RET
---------- Buffer: Minibuffer ----------
     ⇒ t
</pre></blockquote></div></div></body></html>