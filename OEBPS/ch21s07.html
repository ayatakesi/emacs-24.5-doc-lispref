<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Input Events</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Input-Events"/>Input Events</h1></div></div></div><a id="idm60555344" class="indexterm"/><a id="idm60554576" class="indexterm"/><p>Emacsコマンドループは<em class="firstterm">入力イベント(input
events)</em>のシーケンスを読み取ります。入力イベントとは、キーボードやマウスのアクティビティ、またはEmacsに送られるシステムイベントを表します。キーボードアクティビティにたいするイベントは文字、またはシンボルです。それ以外のイベントは、常にリストになります。このセクションでは、入力イベントの表現と意味について詳細を説明します。
</p><pre class="synopsis"><a id="idm60552784" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">eventp</code> <em class="replaceable"><code>object</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>object</code></em>が入力イベント、またはイベント型の場合は、非<code class="literal">nil</code>をリターンする。
</p><p>イベント、またはイベント型として任意のシンボルが使用されるかもしれないことに注意。<code class="literal">eventp</code>は、あるシンボルがLispコードによりイベントとして使用されることを意図しているか否か区別できない。そのかわりに、カレントEmacsセッション内で、そのシンボルが入力として読み取られたイベント内で実際に使用されているか否かを区別する。シンボルがまだそのように使用されていない場合、<code class="literal">eventp</code>は<code class="literal">nil</code>をリターンする。
</p></blockquote></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Keyboard-Events"/>Keyboard Events</h2></div></div></div><a id="idm60533712" class="indexterm"/><p>キーボードから取得できる入力には2つの種類があります。それは通常のキーとファンクションキーです。通常のキーは文字に対応し、それらが生成するイベントはLisp内では文字で表現されます。文字イベントのイベント型は文字自身(整数)です。<a class="link" href="ch21s07.html#Classifying-Events" title="Classifying Events">Classifying
Events</a>を参照してください。
</p><a id="idm60532048" class="indexterm"/><a id="idm60531280" class="indexterm"/><p>入力文字イベントは0から524287までの<em class="firstterm">基本コード(basic code)</em>に加えて、以下の<em class="firstterm">修飾ビット(modifier
bits)</em>の一部、またはすべてにより構成されます:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">meta
</span></dt><dd><p>文字コードのビット
2**27
はメタキーが押下された状態で文字がタイプされたことを示す。
</p></dd><dt><span class="term">control
</span></dt><dd><p>文字コードのビット
2**26
は非<acronym class="acronym">ASCII</acronym>コントロール文字を示す。
</p><p><strong class="userinput"><code>C-a</code></strong>のような非ASCIIコントロール文字は、自身が特別な基本コードをもつため、それらを示すためにEmacsは特別なビットを必要としない。つまり<strong class="userinput"><code>C-a</code></strong>のコードは単なる1である。
</p><p>しかし、<strong class="userinput"><code>%</code></strong>のような非<acronym class="acronym">ASCII</acronym>とコントロールを組み合わせてタイプした場合、取得される数値は<strong class="userinput"><code>%</code></strong>に
2**26
を加えた値となる(端末が非<acronym class="acronym">ASCII</acronym>コントロール文字をサポートすると仮定する)。
</p></dd><dt><span class="term">shift
</span></dt><dd><p>文字コードのビット
2**25
はシフトキーが押下された状態で<acronym class="acronym">ASCII</acronym>コントロール文字がタイプされたことを示す。
</p><p>アルファベット文字にたいしては、基本コード自身が大文字か小文字かを示す。数字と句読点文字にたいしてシフトキーは、異なる基本コードをもつ完全に違う文字を選択する。可能な限り<acronym class="acronym">ASCII</acronym>文字として保つために、Emacsはこれらの文字にたいしてビット
2**25
を使用しない。
</p><p>しかし、<acronym class="acronym">ASCII</acronym>は<strong class="userinput"><code>C-A</code></strong>と<strong class="userinput"><code>C-a</code></strong>を区別する方法を提供しないので、Emacsは<strong class="userinput"><code>C-A</code></strong>にたいしてビット
2**25
を使用し、<strong class="userinput"><code>C-a</code></strong>には使用しない。
</p></dd><dt><span class="term">hyper
</span></dt><dd><p>文字コードのビット
2**24
はハイパーキーが押下された状態で文字がタイプされたことを示す。
</p></dd><dt><span class="term">super
</span></dt><dd><p>文字コードのビット
2**23
はスーパーキーが押下された状態で文字がタイプされたことを示す。
</p></dd><dt><span class="term">alt
</span></dt><dd><p>文字コードのビット
2**22
はアルトキーが押下された状態で文字がタイプされたことを示す(ほとんどのキーボードで<span class="keycap"><strong>Alt</strong></span>とラベルされたキーは、実際にはアルトキーではなくメタキーとして扱われる)。
</p></dd></dl></div><p>プログラム内での特定のビット数値の記述は避けるのが最善の方法です。文字の修飾ビットをテストするためには、関数<code class="literal">event-modifiers</code>(<a class="link" href="ch21s07.html#Classifying-Events" title="Classifying Events">Classifying
Events</a>を参照)を使用してください。キーバインディングを作成するときは、修飾ビットつきの文字にたいする読み取り構文を使用できます(‘<code class="literal">\C-</code>’、‘<code class="literal">\M-</code>’、...など)。<code class="literal">define-key</code>でのキーバインディング作成では、文字を指定するために<code class="literal">(control
hyper ?x)</code>のようなリストを使用できます(<a class="link" href="ch22s12.html" title="Changing Key Bindings">Changing Key
Bindings</a>を参照)。関数<code class="literal">event-convert-list</code>は、そのようなリストをイベント型に変換します(<a class="link" href="ch21s07.html#Classifying-Events" title="Classifying Events">Classifying
Events</a>を参照)。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Function-Keys"/>Function Keys</h2></div></div></div><a id="idm60492880" class="indexterm"/><p>ほとんどのキーボードには<em class="firstterm">ファンクションキー(function
keys)</em>があります。これは名前、または文字以外のシンボルをもつキーです。Emacs
Lispではファンクションキーはシンボルとして表現されます。そのシンボル名はファンクションキーのラベルの小文字です。たとえば<span class="keycap"><strong>F1</strong></span>とラベルされたキーを押下すると、シンボル<code class="literal">f1</code>で表される入力イベントが生成されます。
</p><p>ファンクションキーのイベント型は、イベントシンボルそれ自身です。<a class="link" href="ch21s07.html#Classifying-Events" title="Classifying Events">Classifying Events</a>を参照してください。
</p><p>ファンクションキーにたいするシンボルネーミングの慣習には、以下のような特別なケースがいくつかあります:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">backspace</code>、<code class="literal">tab</code>、<code class="literal">newline</code>、<code class="literal">return</code>、<code class="literal">delete</code>
</span></dt><dd><p>これらのキーは、ほとんどのキーボードにおいて特別にキーをもつ、一般的な<acronym class="acronym">ASCII</acronym>コントロール文字に対応する。
</p><p><acronym class="acronym">ASCII</acronym>では<strong class="userinput"><code>C-i</code></strong>と<span class="keycap"><strong>TAB</strong></span>は同じ文字である。端末がこれらを区別できる場合、Emacsは前者を整数の9、後者をシンボル<code class="literal">tab</code>で表現することにより、Lispプログラムにこれらの違いを伝える。
</p><p>ほとんどの場合、これら2つを区別するのは役に立たない。そのため<code class="literal">local-function-key-map</code>(<a class="link" href="ch22s14.html" title="Keymaps for Translating Sequences of Events">Translation
Keymaps</a>を参照)は<code class="literal">tab</code>を9にマップするようセットアップされている。したがって文字コード9(文字<strong class="userinput"><code>C-i</code></strong>)へのキーバインディングは<code class="literal">tab</code>にも適用される。このグループ内の他のシンボルも同様である。関数<code class="literal">read-char</code>が、これらのイベントを文字に変換する場合も同様である。
</p><p><acronym class="acronym">ASCII</acronym>では、<span class="keycap"><strong>BS</strong></span>は実際は<strong class="userinput"><code>C-h</code></strong>である。しかし<code class="literal">backspace</code>は文字コード8(<span class="keycap"><strong>BS</strong></span>)ではなく、文字コード127(<span class="keycap"><strong>DEL</strong></span>)に変換される。ほとんどのユーザーにとって、これは好ましいだろう。
</p></dd><dt><span class="term"><code class="literal">left</code>、<code class="literal">up</code>、<code class="literal">right</code>、<code class="literal">down</code>
</span></dt><dd><p>矢印カーソルキー
</p></dd><dt><span class="term"><code class="literal">kp-add</code>、<code class="literal">kp-decimal</code>、<code class="literal">kp-divide</code>、…
</span></dt><dd><p>キーパッドキー(標準的なキーボードにおいては右側にある)。
</p></dd><dt><span class="term"><code class="literal">kp-0</code>、<code class="literal">kp-1</code>、…
</span></dt><dd><p>キーパッド数字キー。
</p></dd><dt><span class="term"><code class="literal">kp-f1</code>、<code class="literal">kp-f2</code>、<code class="literal">kp-f3</code>、<code class="literal">kp-f4</code>
</span></dt><dd><p>キーパッドPFキー。
</p></dd><dt><span class="term"><code class="literal">kp-home</code>、<code class="literal">kp-left</code>、<code class="literal">kp-up</code>、<code class="literal">kp-right</code>、<code class="literal">kp-down</code>
</span></dt><dd><p>キーパッド矢印キー。Emacsは通常これらを非キーパッドのキー<code class="literal">home</code>、<code class="literal">left</code>、…に変換する。
</p></dd><dt><span class="term"><code class="literal">kp-prior</code>、<code class="literal">kp-next</code>、<code class="literal">kp-end</code>、<code class="literal">kp-begin</code>、<code class="literal">kp-insert</code>、<code class="literal">kp-delete</code>
</span></dt><dd><p>通常は他の箇所にあるキーと重複するキーパッド追加キー。Emacsは通常これらを同じような名前の非キーパッドキーに変換する。
</p></dd></dl></div><p>ファンクションキーにたいしても修飾キー<span class="keycap"><strong>ALT</strong></span>、<span class="keycap"><strong>CTRL</strong></span>、<span class="keycap"><strong>HYPER</strong></span>、<span class="keycap"><strong>META</strong></span>、<span class="keycap"><strong>SHIFT</strong></span>、<span class="keycap"><strong>SUPER</strong></span>を使用できます。シンボル名のプレフィクスとしてこれらを表します:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">‘<code class="literal">A-</code>’
</span></dt><dd><p>アルト修飾。
</p></dd><dt><span class="term">‘<code class="literal">C-</code>’
</span></dt><dd><p>コントロール修飾。
</p></dd><dt><span class="term">‘<code class="literal">H-</code>’
</span></dt><dd><p>ハイパー修飾。
</p></dd><dt><span class="term">‘<code class="literal">M-</code>’
</span></dt><dd><p>メタ修飾。
</p></dd><dt><span class="term">‘<code class="literal">S-</code>’
</span></dt><dd><p>シフト修飾。
</p></dd><dt><span class="term">‘<code class="literal">s-</code>’
</span></dt><dd><p>スーパー修飾。
</p></dd></dl></div><p>したがって、<span class="keycap"><strong>META</strong></span>を押下した場合の<span class="keycap"><strong>F3</strong></span>キーにたいするシンボルは<code class="literal">M-f3</code>になります。複雑のプレフィクスを使用する場合は、アルファベット順に記述することを推奨します。とはいえ、キーバインディングが修飾されたファンクションキーを探す際、引数の順序は関係ありません。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Mouse-Events"/>Mouse Events</h2></div></div></div><p>Emacsは4つの種類のマウスイベントをサポートします。それはクリックイベント、ドラッグイベント、ボタンダウンイベント、モーションイベントです。すべてのマウスイベントはリストで表現されます。このリストのCARはイベント型です。イベント型はどのマウスボタンが関与するのか、それにたいしてどの修飾キーが使用されたかを示します。イベント型によりダブル、あるいはトリプルでボタンが押されたかを区別することもできます(<a class="link" href="ch21s07.html#Repeat-Events" title="Repeat Events">Repeat
Events</a>を参照)。残りのリスト要素は、位置と時間の情報を提供します。
</p><p>キーの照合においては、イベント型だけが問題になります。2つのイベントが同じコマンドを実行するためには、同じイベント型が必要です。実行されるコマンドはinteractiveのコード‘<code class="literal">e</code>’を使用して、これらのイベントの完全な値にアクセスできます。<a class="link" href="ch21s02.html#Interactive-Codes" title="Code Characters for interactive">Interactive
Codes</a>を参照してください。
</p><p>マウスイベントで開始されたキーシーケンスはカレントバッファーではなく、マウスのあったウィンドウ内のバッファーのキーマップを使用して読み取られます。これはウィンドウ内でクリックすることによりそのウィンドウやそのウィンドウのバッファーが選択されることを意味しません。つまり、それは完全にそのキーシーケンスのコマンドバインディングの制御下にあるのです。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Click-Events"/>Click Events</h2></div></div></div><a id="idm60420432" class="indexterm"/><a id="idm60419664" class="indexterm"/><p>ユーザーが同じ場所でマウスボタンを押してからリリース(release:
離す)すると、<em class="firstterm">click</em>イベントが生成されます。すべてのマウスクリックイベントは同じフォーマットを共有します:
</p><pre class="screen">(<em class="replaceable"><code>event-type</code></em> <em class="replaceable"><code>position</code></em> <em class="replaceable"><code>click-count</code></em>)
</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>event-type</code></em>
</span></dt><dd><p>これはマウスボタンが使用されたことを示す。これはシンボル<code class="literal">mouse-1</code>、<code class="literal">mouse-2</code>、…のうちのどれかで、マウスボタンは左から右に番号が付される。
</p><p>ファンクションキーにたいして行うのと同様にアルト、コントロール、ハイパー、メタ、シフト、スーパーの修飾にたいしてプレフィクス‘<code class="literal">A-</code>’、‘<code class="literal">C-</code>’、‘<code class="literal">H-</code>’、‘<code class="literal">M-</code>’、‘<code class="literal">S-</code>’、‘<code class="literal">s-</code>’も使用できる。
</p><p>このシンボルは、イベントのイベント型の役割りももつ。イベントのキーバインディングはこれらの型により示される。したがって、<code class="literal">mouse-1</code>にたいするキーバインディングが存在する場合、そのバインディングは<em class="replaceable"><code>event-type</code></em>が<code class="literal">mouse-1</code>であるようなすべてのイベントに適用されるだろう。
</p></dd><dt><span class="term"><em class="replaceable"><code>position</code></em>
</span></dt><dd><a id="idm60408144" class="indexterm"/><p>これはマウスクリックがどこで発生したかを表す<em class="firstterm">マウス位置リスト(mouse position list)</em>である。詳細は以下を参照のこと。
</p></dd><dt><span class="term"><em class="replaceable"><code>click-count</code></em>
</span></dt><dd><p>これは同じマウスボタンを素早く繰り返し押下したときの回数である。<a class="link" href="ch21s07.html#Repeat-Events" title="Repeat Events">Repeat Events</a>を参照のこと。
</p></dd></dl></div><p>クリックイベントの<em class="replaceable"><code>position</code></em>スロット内にあるマウス位置リストの内容にアクセスするためには、一般的には<a class="link" href="ch21s07.html#Accessing-Mouse" title="Accessing Mouse Events">Accessing
Mouse</a>にドキュメントされている関数を使用するべきです。このリストの明示的なフォーマットは、どこでクリックが発生したかに依存します。テキストエリア、モードライン、ヘッダーライン、フリンジ、マージンエリアでのクリックにたいして、マウス位置リストは以下のフォーマットをもちます
</p><pre class="screen">(<em class="replaceable"><code>window</code></em> <em class="replaceable"><code>pos-or-area</code></em> (<em class="replaceable"><code>x</code></em> . <em class="replaceable"><code>y</code></em>) <em class="replaceable"><code>timestamp</code></em>
 <em class="replaceable"><code>object</code></em> <em class="replaceable"><code>text-pos</code></em> (<em class="replaceable"><code>col</code></em> . <em class="replaceable"><code>row</code></em>)
 <em class="replaceable"><code>image</code></em> (<em class="replaceable"><code>dx</code></em> . <em class="replaceable"><code>dy</code></em>) (<em class="replaceable"><code>width</code></em> . <em class="replaceable"><code>height</code></em>))
</pre><p>以下はこれらのリスト要素がもつ意味です:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>window</code></em>
</span></dt><dd><p>クリックが発生したウィンドウ。
</p></dd><dt><span class="term"><em class="replaceable"><code>pos-or-area</code></em>
</span></dt><dd><p>テキストエリア内でクリックされた文字のバッファー位置。またはテキストエリア外がクリックされた場合は、クリックが発生したウィンドウエリア。これはシンボル<code class="literal">mode-line</code>、<code class="literal">header-line</code>、<code class="literal">vertical-line</code>、<code class="literal">left-margin</code>、<code class="literal">right-margin</code>、<code class="literal">left-fringe</code>、<code class="literal">right-fringe</code>のどれか。
</p><p>特別な場合の1つとして、<em class="replaceable"><code>pos-or-area</code></em>が単なるシンボルではなく、(上記シンボルのいずれか1つの)シンボルを含むリストの場合がある。これはEmacsにより登録されたイベントにたいする、イマジナリープレフィクスキー(imaginary
prefix key)の後に発生する。<a class="link" href="ch21s08.html#Key-Sequence-Input" title="Key Sequence Input">Key Sequence Input</a>を参照のこと。
</p></dd><dt><span class="term"><em class="replaceable"><code>x</code></em>, <em class="replaceable"><code>y</code></em>
</span></dt><dd><p>クリックの相対ピクセル座標(relative pixel
coordinates)。あるウィンドウのテキストエリア内でのクリックにたいする座標原点<code class="literal">(0
. 0)</code>は、テキストエリアの左上隅となる。<a class="link" href="ch28s03.html" title="Window Sizes">Window
Sizes</a>を参照のこと。モードラインまたはヘッダーライン内でのクリックにたいする座標原点は、そのウィンドウ自身の左上隅となる。フリンジ、マージン、垂直ボーダー(vertical
border)では、<em class="replaceable"><code>x</code></em>な有意なデータをもたない。フリンジ、マージンでは、<em class="replaceable"><code>y</code></em>はヘッダーラインの最下端からの相対位置である。すべてのケースにおいて<em class="replaceable"><code>x</code></em>および<em class="replaceable"><code>y</code></em>座標は右方向および下方向で増加する。
</p></dd><dt><span class="term"><em class="replaceable"><code>timestamp</code></em>
</span></dt><dd><p>そのイベントが発生した時刻を、システム依存の初期時刻(initial time)からの経過ミリ秒で表す整数。
</p></dd><dt><span class="term"><em class="replaceable"><code>object</code></em>
</span></dt><dd><p>クリック位置に文字列タイプのテキストプロパティが存在しない場合は<code class="literal">nil</code>、存在する場合は(<em class="replaceable"><code>string</code></em>
. <em class="replaceable"><code>string-pos</code></em>)形式のコンスセル:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>string</code></em>
</span></dt><dd><p>クリックされた文字列。すべてのテキストプロパティを含む。
</p></dd><dt><span class="term"><em class="replaceable"><code>string-pos</code></em>
</span></dt><dd><p>クリックが発生した文字列内の位置。
</p></dd></dl></div></dd><dt><span class="term"><em class="replaceable"><code>text-pos</code></em>
</span></dt><dd><p>マージンエリアまたはフリンジにたいするクリックでは、そのウィンドウ内の対応する行内の最初の可視な文字のバッファー位置となる。他のイベントにたいしては、そのウィンドウ内のカレントバッファーの位置となる。
</p></dd><dt><span class="term"><em class="replaceable"><code>col</code></em>, <em class="replaceable"><code>row</code></em>
</span></dt><dd><p>これらは<em class="replaceable"><code>x</code></em>、<em class="replaceable"><code>y</code></em>の位置にあるグリフ(gliph)の、実際の行と列の座標数値である。行<em class="replaceable"><code>x</code></em>がその行の実際のテキストの最後の列を超える場合、<em class="replaceable"><code>col</code></em>はデフォルトの文字幅をもつ仮想的な追加列数を加えた値が報告される。そのウィンドウがヘッダーラインをもつ場合、行0はヘッダーラインとなり、ヘッダーラインをもたない場合はテキストエリアの上端ラインが行0となる。ウィンドウのテキストエリアのクリックにたいしては、テキストエリアの左端列が列0となり、モードラインまたはヘッダーラインのクリックにたいしてはそのラインの左端が列0となる。フリンジまたは垂直ボーダーのクリックにたいしては、これらは有意なデータをもたない。マージンのクリックにたいしては、<em class="replaceable"><code>col</code></em>はマージンエリアの左端、<em class="replaceable"><code>row</code></em>はマージンエリアの上端から測られる。
</p></dd><dt><span class="term"><em class="replaceable"><code>image</code></em>
</span></dt><dd><p>これはクリックが発生した場所のイメージオブジェクトである。クリックされた場所にイメージが存在しない場合は<code class="literal">nil</code>、イメージがクリックされた場合は<code class="literal">find-image</code>によりリターンされるイメージオブジェクトである。
</p></dd><dt><span class="term"><em class="replaceable"><code>dx</code></em>, <em class="replaceable"><code>dy</code></em>
</span></dt><dd><p>これらは<em class="replaceable"><code>object</code></em>の左上隅<code class="literal">(0
. 0)</code>からの相対的ピクセル座標である。<em class="replaceable"><code>object</code></em>が<code class="literal">nil</code>の場合は、クリックされた文字グリフの左上隅からの相対座標である。
</p></dd><dt><span class="term"><em class="replaceable"><code>width</code></em>, <em class="replaceable"><code>height</code></em>
</span></dt><dd><p>これらは<em class="replaceable"><code>object</code></em>のピクセル幅とピクセル高さであり、<em class="replaceable"><code>object</code></em>が<code class="literal">nil</code>の場合はクリックされた文字グリフのピクセル幅とピクセル高さである。
</p></dd></dl></div><p>スクロールバーへのクリックにたいして、<em class="replaceable"><code>position</code></em>は以下の形式をもちます:
</p><pre class="screen">(<em class="replaceable"><code>window</code></em> <em class="replaceable"><code>area</code></em> (<em class="replaceable"><code>portion</code></em> . <em class="replaceable"><code>whole</code></em>) <em class="replaceable"><code>timestamp</code></em> <em class="replaceable"><code>part</code></em>)
</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>window</code></em>
</span></dt><dd><p>スクロールバーがクリックされたウィンドウ。
</p></dd><dt><span class="term"><em class="replaceable"><code>area</code></em>
</span></dt><dd><p>これはシンボル<code class="literal">vertical-scroll-bar</code>である。
</p></dd><dt><span class="term"><em class="replaceable"><code>portion</code></em>
</span></dt><dd><p>スクロールバーの上端からクリック位置までのピクセル数。GTK+を含むいくつかのツールキットでは、Emacsがこれらのデータを抽出できないので、値は常に<code class="literal">0</code>となる。
</p></dd><dt><span class="term"><em class="replaceable"><code>whole</code></em>
</span></dt><dd><p>スクロールバーの全長のピクセル数。GTK+を含むいくつかのツールキットでは、Emacsがこれらのデータを抽出できないので、値は常に<code class="literal">0</code>となる。
</p></dd><dt><span class="term"><em class="replaceable"><code>timestamp</code></em>
</span></dt><dd><p>イベントが発生したミリ秒時刻。GTK+を含むいくつかのツールキットでは、Emacsがこれらのデータを抽出できないので、値は常に<code class="literal">0</code>となる。
</p></dd><dt><span class="term"><em class="replaceable"><code>part</code></em>
</span></dt><dd><p>クリックが発生したスクロールバー部分。これはシンボル<code class="literal">handle</code>(スクロールバーのハンドル)、<code class="literal">above-handle</code>(ハンドルの上側エリア)、<code class="literal">below-handle</code>(ハンドルの下側エリア)、<code class="literal">up</code>(スクロールバー端の上矢印)、<code class="literal">down</code>(スクロールバー端の下矢印)のいずれかである。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Drag-Events"/>Drag Events</h2></div></div></div><a id="idm60317392" class="indexterm"/><a id="idm60316624" class="indexterm"/><p>Emacsでは、特別なことをしなくてもドラッグイベントを取得できます。<em class="firstterm">ドラッグイベント(drag
event)</em>は、ユーザーがマウスボタンを押下して、ボタンをリリースする前に、マウスを異なる文字位置に移動すると毎回発生します。すべてのマウスイベントと同じように、ドラッグイベントはLispではリストで表現されます。このリストは以下のように、開始マウス位置と最終位置ぼ両方を記録します:
</p><pre class="screen">(<em class="replaceable"><code>event-type</code></em>
 (<em class="replaceable"><code>window1</code></em> START-POSITION)
 (<em class="replaceable"><code>window2</code></em> END-POSITION))
</pre><p>ドラッグイベントにたいしては、シンボル<em class="replaceable"><code>event-type</code></em>の名前に、プレフィクス‘<code class="literal">drag-</code>’が含まれます。たとえば、ボタン2を押下したままマウスをドラッグすると、<code class="literal">drag-mouse-2</code>イベントが生成されます。このイベントの2つ目と3つ目の要素は、マウス位置リスト(<a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>を参照)としてドラッグの開始と終了の位置を与えます。任意のマウスイベントの2つ目の要素には、同じ方法でアクセスできます。しかし、ドラッグイベントは最初に選択されていたフレームの境界外で終了するかもしれません。この場合、3つ目の要素の位置リストに、ウィンドウのかわりにそのフレームが含まれます。
</p><p>‘<code class="literal">drag-</code>’プレフィクスは、その後に‘<code class="literal">C-</code>’や‘<code class="literal">M-</code>’のような修飾キープレフィクスが続きます。
</p><p><code class="literal">read-key-sequence</code>がキーバインディングをもたず、対応するクリックイベントにキーバインディングがあるようなドラッグイベントを受け取った場合、この関数はそのドラッグイベントをドラッグ開始位置でのクリックイベントに変更します。これは、もし望まなければクリックイベントとドラッグイベントを区別する必要がないことを意味します。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Button_002dDown-Events"/>Button-Down Events</h2></div></div></div><a id="idm60307280" class="indexterm"/><p>クリックイベントとドラッグイベントは、ユーザーがマウスボタンをリリースしたときに発生します。ボタンがリリースされるまでクリックとドラッグを区別することはできないので、リリース前にイベントが発生することはありません。
</p><p>ボタンが押下されたらすぐに何か処理したい場合は、<em class="firstterm">ボタンダウン(button-down)</em>イベントを処理する必要があります<a href="#ftn.idm60301392" class="footnote" id="idm60301392"><sup class="footnote">[11]</sup></a>。これらは<em class="replaceable"><code>event-type</code></em>のシンボル名に‘<code class="literal">down-</code>’が含まれることを除き、クリックイベントとまったく同じようなリストにより表現されます。‘<code class="literal">down-</code>’プレフィクスの後には、‘<code class="literal">C-</code>’や‘<code class="literal">M-</code>’のような修飾キープレフィクスが続きます。
</p><p>関数<code class="literal">read-key-sequence</code>は、コマンドバインディングをもたないボタンダウンイベントを無視します。したがって、Emacsコマンドループもこれらを無視します。これは、ボタンダウンイベントで何かしたい場合以外は、ボタンダウンイベントの定義について心配する必要がないことを意味します。ボタンダウンイベントを定義する通常の理由は、ボタンがリリースされるまで(モーションイベントを読み取ることにより)マウスモーションを追跡できるからです。<a class="link" href="ch21s07.html#Motion-Events" title="Motion Events">Motion
Events</a>を参照してください。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Repeat-Events"/>Repeat Events</h2></div></div></div><a id="idm60295888" class="indexterm"/><a id="idm60295120" class="indexterm"/><a id="idm60294352" class="indexterm"/><a id="idm60293584" class="indexterm"/><p>マウスを移動せずに同じマウスボタンを素早く2回以上連続して押下すると、Emacsは2回目とそれ以降の押下にたいして、特別な<em class="firstterm">リピート(repeat)</em>マウスイベントを生成します。
</p><p>もっとも一般的なリピートイベントは、<em class="firstterm">ダブルクリック(double-click)</em>イベントです。Emacsはボタンを2回クリックしたときに、ダブルクリックイベントを生成します。このイベントは、(すべてのクリックイベントが通常そうであるように)ボタンをリリースしたときに発生します。
</p><p>ダブルクリックイベントのイベント型には、プレフィクス‘<code class="literal">double-</code>’が含まれます。したがって、<span class="keycap"><strong>meta</strong></span>を押しながら2つ目のマウスボタンをダブルクリックすると、Lispプログラムには<code class="literal">M-double-mouse-2</code>が渡されます。ダブルクリックイベントがバインディングをもたない場合、対応する通常のクリックイベントのバインディングが実行に使用されます。したがって、実際に望んでいなければダブルクリック機能に注意を払う必要はありません。
</p><p>ユーザーがダブルクリックを行うとき、Emacsはまず通常のクリックイベントを生成し、その後ダブルクリックイベントを生成します。したがって、ダブルクリックイベントのコマンドバインディングは、すでにシングルクリックイベントが実行された想定でデザインしなければなりません。つまりシングルクリックの結果から開始して、ダブルクリックの望むべき結果を生成しなければならないのです。
</p><p>これはダブルクリックの意味合いが、シングルクリックの意味合いの何らかにもとづいて“構築”される場合は便利です。これはダブルクリックにたいするユーザーインターフェイスにおける推奨されるデザインプラクティスです。
</p><p>ボタンをクリックした後もう一度ボタンを押下して、そのままマウス一般的を開始した場合、最終的にボタンをリリースしたとき<em class="firstterm">ダブルドラッグ(double-drag)</em>イベントが取得されます。このイベント型には単なる‘<code class="literal">drag</code>’のかわりに‘<code class="literal">double-drag</code>’が含まれます。ダブルドラッグイベントがバインディングをもたない場合、それがあたかも通常のドラッグイベントだったかのようにEmacsはかわりのバインディングを探します。
</p><p>ダブルクリックまたはダブルドラッグイベントの前に、Emacsはユーザーが2回目にボタンを押したタイミングで<em class="firstterm">ダブルダウン(double-down)</em>イベントを生成します。このイベント型には、単なる‘<code class="literal">down</code>’のかわりに‘<code class="literal">double-down</code>’が含まれます。ダブルダウンイベントがバインディングをもたない場合、それがあたかも通常のボタンダウンイベントだったかのようにEmacsはかわりのバインディングを探します。どちらの方法でもバインディングが見つからなかった場合、ダブルダウンイベントは無視されます。
</p><p>要約すると、ボタンをクリックしてすぐにまた押したとき、Emacsは1回目のクリックにたいしてダウンイベントとクリックイベントを生成し、2回目に再度ボタンを押したときにダブルダウンイベント、そして最後にダブルクリックまたはダブルドラッグイベントを生成します。
</p><p>ボタンを2回クリックした後もう一度押したとき、それらすべてが素早く連続で行われた場合、Emacsは<em class="firstterm">トリプルダウン(triple-down)</em>イベントと、その後続の<em class="firstterm">トリプルクリック(triple-click)</em>または<em class="firstterm">トリプルドラッグ(triple-drag)</em>イベントを生成します。これらイベントのイベント型には、‘<code class="literal">double</code>’のかわりに‘<code class="literal">triple</code>’が含まれます。トリプルイベントがバインディングをもたない場合、Emacsは対応するダブルイベントに使用されるであろうバインディングを使用します。
</p><p>ボタンを3回以上クリックした後、再度ボタンを押した場合、3回を超える押下にたいするイベントはすべてトリプルイベントになります。Emacsはクワドループル(quadruple:
4連)、クインティプル(quintuple:
5連)、...等のイベントにたいして個別のイベント型をもちません。しかし、ボタンが何回押下されたかを正確に見つけるために、イベントリストを調べることができます。
</p><pre class="synopsis"><a id="idm60277328" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-click-count</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>event</code></em>を誘因した連続したボタン押下の回数をリターンする。<em class="replaceable"><code>event</code></em>がダブルダウン、ダブルクリック、ダブルドラッグの場合、値は2である。<em class="replaceable"><code>event</code></em>がトリプルイベントの場合、値は3以上になる。<em class="replaceable"><code>event</code></em>が(リピートイベントではない)通常のマウスイベントの場合、値は1である。
</p></blockquote></div><pre class="synopsis"><a id="idm60264400" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">double-click-fuzz</code></pre><div class="blockquote"><blockquote class="blockquote"><p>リピートイベントを生成するためには、ほぼ同じスクリーン位置で連続でマウスボタンを押下しなければならない。<code class="literal">double-click-fuzz</code>の値は、ダブルクリックを生成するために連続する2回のクリック間で、マウスが移動(水平および垂直)するかもしれない最大ピクセル数を指定する。
</p><p>この変数はドラッグとみなされるマウスモーションの閾値でもある。
</p></blockquote></div><pre class="synopsis"><a id="idm60260816" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">double-click-time</code></pre><div class="blockquote"><blockquote class="blockquote"><p>リピートイベントを生成するためには、連続するボタン押下のミリ秒間隔が、<code class="literal">double-click-time</code>の値より小さくなければならない。<code class="literal">double-click-time</code>を<code class="literal">nil</code>にセットすると、複数回クリック検知が完全に無効になる。<code class="literal">t</code>にセットすると、時間制限が取り除かれる。その場合、Emacsは位置だけで複数回クリックを検知する。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Motion-Events"/>Motion Events</h2></div></div></div><a id="idm60255312" class="indexterm"/><a id="idm60254544" class="indexterm"/><p>Emacsは、ボタンアクティビティが何もないマウスのモーション(motion: 動き)を記述する<em class="firstterm">マウスモーション(mouse
motion)</em>イベントを生成するときがあります。マウスモーションイベントは、以下のようなリストにより表現されます:
</p><pre class="screen">(mouse-movement POSITION)
</pre><p><em class="replaceable"><code>position</code></em>は、マウスカーソルのカレント位置を指定するマウス位置リスト(see <a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>)です。ドラッグイベントの終了位置のように、この位置リストは最初に選択されていた境界外の位置を表すかもしれず、その場合はそのフレーム内のその位置のウィンドウが含まれる。
</p><p>スペシャルフォーム<code class="literal">track-mouse</code>は、ボタン内でのモーションイベントの生成を有効にします。<code class="literal">track-mouse</code>フォームの外側では、Emacsはマウスの単なるモーションにたいするイベントは生成せず、これらのイベントは発生しません。<a class="link" href="ch29s13.html" title="Mouse Tracking">Mouse
Tracking</a>を参照してください。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Focus-Events"/>Focus Events</h2></div></div></div><a id="idm60248400" class="indexterm"/><p>ウィンドウシステムは、ユーザーにたいしてどのウィンドウがキーボード入力を受け取るか制御するための、一般的な方法を提供します。このウィンドウ選択は<em class="firstterm">フォーカス(focus)</em>と呼ばれます。Emacsのフレームを切り替えるためにユーザーが何かを行うと、それは<em class="firstterm">フォーカスイベント(focus
event)</em>を生成します。フォーカスイベントの通常の定義はグローバルキーマップ内にあり、ユーザーが期待するようにEmacsで新たなフレームを選択するためのものです。See <a class="link" href="ch29s09.html" title="Input Focus">Input
Focus</a>を参照してください。
</p><p>フォーカスイベントは、以下のようにLispのリストで表現されます:
</p><pre class="screen">(switch-frame <em class="replaceable"><code>new-frame</code></em>)
</pre><p>ここで<em class="replaceable"><code>new-frame</code></em>は切り替え先のフレームです。
</p><p>Xウィンドウマネージャーには、あるウィンドウにマウスを移動するだけで、そこにフォーカスされるようにセットアップするものがいくつかあります。通常は、他の種類の入力が到着するまで、Lispプログラムがフォーカスの変更を知る必要はありません。Emacsはユーザーが新たなフレーム内で実際にキーボードのキーをタイプするかマウスボタンを押下したときしか、フォーカスイベントを生成しません。つまりフレーム間でマウスを移動させても、フォーカスイベントは生成されません。
</p><p>キーシーケンスの途中におけるフォーカスイベントは、そのシーケンスを誤ったものにするかもしれません。そのため、Emacsは決してキーシーケンスの途中でフォーカスイベントを生成しません。ユーザーがキーシーケンスの途中(つまりプレフィクス引数の後)でフォーカスを変更した場合、複数イベントキーシーケンスの前か後にフォーカスイベントが到着するように、Emacsはフォーカスイベントを記録しておきます。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Misc-Events"/>Miscellaneous System Events</h2></div></div></div><p>他にもシステム内での出来事を表現するイベント型が少数あります。
</p><div class="variablelist"><a id="idm60241488" class="indexterm"/><dl class="variablelist"><dt><span class="term"><code class="literal">(delete-frame (<em class="replaceable"><code>frame</code></em>))</code>
</span></dt><dd><p>このイベントの種類は、ユーザーがウィンドウマネージャーに特定のウィンドウを削除するコマンドを与えたことを示し、Emacsのフレームにたいして発生する。
</p><p><code class="literal">フレーム削除(delete-frame)</code>イベントの標準的な定義は、<em class="replaceable"><code>frame</code></em>を削除する。
</p><a id="idm60225232" class="indexterm"/></dd><dt><span class="term"><code class="literal">(iconify-frame (<em class="replaceable"><code>frame</code></em>))</code>
</span></dt><dd><p>このイベントの種類は、ウィンドウマネージャーを使用してユーザーが<em class="replaceable"><code>frame</code></em>をアイコン化したことを示す。標準的な定義は<code class="literal">ignore</code>である。これは、そのフレームがすでにアイコン化されているので、Emacsが行う必要のことは何もないからである。このイベント型の目的は、望むならこのようなイベントの追跡を可能にしておくためである。
</p><a id="idm60221520" class="indexterm"/></dd><dt><span class="term"><code class="literal">(make-frame-visible (<em class="replaceable"><code>frame</code></em>))</code>
</span></dt><dd><p>このイベントの種類は、ウィンドウマネージャーを使用してユーザーが<em class="replaceable"><code>frame</code></em>を非アイコン化したことを示す。標準的な定義は<code class="literal">ignore</code>である。これは、そのフレームがすでに可視化されているので、Emacsが行う必要のことは何もないからである。
</p><a id="idm60217808" class="indexterm"/><a id="idm60216656" class="indexterm"/></dd><dt><span class="term"><code class="literal">(wheel-up <em class="replaceable"><code>position</code></em>)</code>
, </span><span class="term"><code class="literal">(wheel-down <em class="replaceable"><code>position</code></em>)</code>
</span></dt><dd><p>この種類のイベントは、マウスホイールを移動したことにより発生する。<em class="replaceable"><code>position</code></em>要素は、そのイベント発生時のマウスカーソル位置を指定するマウス位置リスト(<a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>を参照)である。
</p><a id="idm60211920" class="indexterm"/><a id="idm60211152" class="indexterm"/><p>この種類のイベントは、ある種のシステムでのみ発生する。いくつかのシステムでは、かわりに<code class="literal">mouse-4</code>と<code class="literal">mouse-5</code>が使用される。可搬性のあるコードとするためには、マウスホイールにたいしてどのイベント型が期待されるかを決定するために<code class="filename">mwheel.el</code>内で定義されている変数<code class="literal">mouse-wheel-up-event</code>および<code class="literal">mouse-wheel-down-event</code>を使用する。
</p><a id="idm60195152" class="indexterm"/></dd><dt><span class="term"><code class="literal">(drag-n-drop <em class="replaceable"><code>position</code></em> <em class="replaceable"><code>files</code></em>)</code>
</span></dt><dd><p>この種類のイベントは、Emacs外部アプリケーション内でファイルグループが選択され、それがEmacsフレーム内にドラッグアンドドロップされたときに発生する。
</p><p>要素<em class="replaceable"><code>position</code></em>は、そのイベント位置を記述しマウスクリックイベントで使用されるフォーマット(<a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>を参照)と同じである。要素<em class="replaceable"><code>files</code></em>はドラッグアンドドロップされたファイル名のリストである。通常は、それらのファイルをvisitすることにより、このイベントは処理される。
</p><p>この種類のイベントは、現在のところある種のシステムでのみ生成される。
</p><a id="idm60189776" class="indexterm"/></dd><dt><span class="term"><code class="literal">help-echo</code>
</span></dt><dd><p>この種類のイベントは、テキストプロパティ<code class="literal">help-echo</code>をもつバッファーテキスト部分上にマウスポインターが移動したときに生成される。生成されるイベントは以下の形式をもつ:
</p><pre class="screen">(help-echo <em class="replaceable"><code>frame</code></em> <em class="replaceable"><code>help</code></em> <em class="replaceable"><code>window</code></em> <em class="replaceable"><code>object</code></em> <em class="replaceable"><code>pos</code></em>)
</pre><p>イベントパラメーターの正確な意味と、ヘルプテキストを表示するためにこれらのパラメーターを使用する方法は、<a class="link" href="ch32s19.html#Text-help_002decho">Text
help-echo</a>で説明されているか
</p><a id="idm60183504" class="indexterm"/><a id="idm60182352" class="indexterm"/><a id="idm60181200" class="indexterm"/></dd><dt><span class="term"><code class="literal">sigusr1</code>
, </span><span class="term"><code class="literal">sigusr2</code>
</span></dt><dd><p>これらのイベントは、Emacsプロセスがシグナル<code class="literal">SIGUSR1</code>および<code class="literal">SIGUSR2</code>を受け取ったときに生成される。シグナルは追加情報を運搬しないので、追加データは含まれない。これらのシグナルはデバッグに有用である(<a class="link" href="ch18.html#Error-Debugging" title="Entering the Debugger on an Error">Error
Debugging</a>を参照)。
</p><p>ユーザーシグナルをcatchするためには、<code class="literal">special-event-map</code>(<a class="link" href="ch22s07.html" title="Active Keymaps">Active
Keymaps</a>を参照)内で対応するイベントにバインドする。そのコマンドは引数なしで呼び出され、<code class="literal">last-input-event</code>内の特定のシグナルイベントが利用できる。たとえば:
</p><pre class="screen">(defun sigusr-handler ()
  (interactive)
  (message "Caught signal %S" last-input-event))

(define-key special-event-map [sigusr1] 'sigusr-handler)
</pre><p>シグナルハンドラーをテストするために、自身でEmacsにシグナルを送信できる:
</p><pre class="screen">(signal-process (emacs-pid) 'sigusr1)
</pre><a id="idm60173520" class="indexterm"/></dd><dt><span class="term"><code class="literal">language-change</code>
</span></dt><dd><p>この種類のイベントは、MS-Windows上で入力言語が変更されたときに生成される。これは通常、キーボードキーが異なる言語の文字でEmacsに送られることを意味する。生成されるイベントは、以下の形式をもつ:
</p><pre class="screen">(language-change <em class="replaceable"><code>frame</code></em> <em class="replaceable"><code>codepage</code></em> <em class="replaceable"><code>language-id</code></em>)
</pre><p>ここで<em class="replaceable"><code>frame</code></em>は言語が変更されたときカレントだったフレームであり、<em class="replaceable"><code>codepage</code></em>は新たなコードページ番号(codepage
number)、<em class="replaceable"><code>language-id</code></em>は新たな入力言語の数値IDである。<em class="replaceable"><code>codepage</code></em>に対応するコーディングシステム(<a class="link" href="ch33s10.html" title="Coding Systems">Coding
Systems</a>を参照)は、<code class="literal">cp<em class="replaceable"><code>codepage</code></em></code>または<code class="literal">windows-<em class="replaceable"><code>codepage</code></em></code>である。<em class="replaceable"><code>language-id</code></em>を文字列に変更する(たとえば<code class="literal">set-language-environment</code>のようなさまざまな言語依存機能にたいしこれを使用する)には、以下のように<code class="literal">w32-get-locale-info</code>関数を使用する:
</p><pre class="screen">;; 英語にたいする"ENU"のような言語の省略形を取得する
(w32-get-locale-info language-id)
;; "English (United States)"のような
;; その言語の完全な英語名を取得する
(w32-get-locale-info language-id 4097)
;; その言語の完全なローカライズ名を取得する
(w32-get-locale-info language-id t)
</pre></dd></dl></div><p>キーシーケンスの途中、つまりプレフィクスキーの後にこれらのイベントの1つが到着した場合、複数イベントキー内ではなくその前または後にそのイベントが到着するように、Emacsはそのイベントを記録する。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Event-Examples"/>Event Examples</h2></div></div></div><p>ユーザーが同じ場所でマウス左ボタンを押して離した場合、それは以下のようなイベントシーケンスを生成します:
</p><pre class="screen">(down-mouse-1 (#&lt;window 18 on NEWS&gt; 2613 (0 . 38) -864320))
(mouse-1      (#&lt;window 18 on NEWS&gt; 2613 (0 . 38) -864180))
</pre><p>コントロールキーを押したままユーザーがマウス第2ボタンを押してマウスをある行から次の行へドラッグした場合、以下のような2つのイベントが生成されます:
</p><pre class="screen">(C-down-mouse-2 (#&lt;window 18 on NEWS&gt; 3440 (0 . 27) -731219))
(C-drag-mouse-2 (#&lt;window 18 on NEWS&gt; 3440 (0 . 27) -731219)
                (#&lt;window 18 on NEWS&gt; 3510 (0 . 28) -729648))
</pre><p>メタキーとシフトキーを押したままユーザーがそのウィンドウのモードライン上でマウス第2ボタンを押して他ウィンドウへマウスをドラッグした場合、以下のようなイベントのペアーが生成されます:
</p><pre class="screen">(M-S-down-mouse-2 (#&lt;window 18 on NEWS&gt; mode-line (33 . 31) -457844))
(M-S-drag-mouse-2 (#&lt;window 18 on NEWS&gt; mode-line (33 . 31) -457844)
                  (#&lt;window 20 on carlton-sanskrit.tex&gt; 161 (33 . 3)
                   -453816))
</pre><p>全画面表示されていないフレームに入力フォーカスがあり、ユーザーがマウスをそのフレームのスコープ外へマウスを移動した場合、スペシャルフォーム<code class="literal">track-mouse</code>内では以下のようなイベントが生成されます:
</p><pre class="screen">(mouse-movement (#&lt;frame *ielm* 0x102849a30&gt; nil (563 . 205) 532301936))
</pre><p>SIGUSR1シグナルを処理するためにはインタラクティブ関数を定義して、それを<code class="literal">signal usr1</code>イベントシーケンスにバインドします:
</p><pre class="screen">(defun usr1-handler ()
  (interactive)
  (message "Got USR1 signal"))
(global-set-key [signal usr1] 'usr1-handler)
</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Classifying-Events"/>Classifying Events</h2></div></div></div><a id="idm60151376" class="indexterm"/><a id="idm60150608" class="indexterm"/><p>すべてのイベントは<em class="firstterm">イベント型(event
type)</em>をもちます。イベント型はキーバインディング目的でイベントをクラス分けします。キーボードイベントにたいするイベント型はイベント値と等しく、したがって文字のイベント型は文字、ファンクションキーシンボルのイベント型はそのシンボル自身です。リストであるようなイベントのイベント型は、そのリストのCAR内のシンボルです。したがって、イベント型は常にシンボルか文字です。
</p><p>同じ型の２つのイベントはキーバインディングに関する限り同じです。したがって、それらは常に同じコマンドを実行します。これらが同じことを行う必要があるという意味ではありませんが、イベント全体を調べてから何を行うか決定するコマンドもいくつかあります。、たとえば、バッファー内でどこに作用するか決定するためにマウスイベントの場所を使用するコマンドもいくつかあります。
</p><p>広範なイベントのクラス分けが役に立つときもあります。たとえば、他の修飾キーやマウスボタンが使用されたかとは無関係に、<span class="keycap"><strong>META</strong></span>キーとともに呼び出されたイベントを尋ねたいと思うかもしれません。
</p><p>関数<code class="literal">event-modifiers</code>は<code class="literal">event-basic-type</code>は、そのような情報を手軽に取得するために提供されています。
</p><pre class="synopsis"><a id="idm60146128" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-modifiers</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>event</code></em>がもつ修飾子のリストをリターンする。この修飾子はシンボルであり<code class="literal">shift</code>、<code class="literal">control</code>、<code class="literal">meta</code>、<code class="literal">alt</code>、<code class="literal">hyper</code>、<code class="literal">super</code>が含まれる。さらにマウスイベントシンボルの修飾子リストには常に<code class="literal">click</code>、<code class="literal">drag</code>、<code class="literal">down</code>のいずれか1つが含まれる。ダブルイベントまたはトリプルイベントには<code class="literal">double</code>または<code class="literal">triple</code>も含まれる。
</p><p>引数<em class="replaceable"><code>event</code></em>はイベントオブジェクト全体、または単なるイベント型かもしれない。<em class="replaceable"><code>event</code></em>がカレントEmacsセッション内で入力として読み取られたイベント内で決して使用されないシンボルの場合は、実際に<em class="replaceable"><code>event</code></em>が変更されたときでも、<code class="literal">event-modifiers</code>は<code class="literal">nil</code>をリターンできる。
</p><p>いくつか例を挙げる:
</p><pre class="screen">(event-modifiers ?a)
     ⇒ nil
(event-modifiers ?A)
     ⇒ (shift)
(event-modifiers ?\C-a)
     ⇒ (control)
(event-modifiers ?\C-%)
     ⇒ (control)
(event-modifiers ?\C-\S-a)
     ⇒ (control shift)
(event-modifiers 'f5)
     ⇒ nil
(event-modifiers 's-f5)
     ⇒ (super)
(event-modifiers 'M-S-f5)
     ⇒ (meta shift)
(event-modifiers 'mouse-1)
     ⇒ (click)
(event-modifiers 'down-mouse-1)
     ⇒ (down)
</pre><p>クリックイベントにたいする修飾リストは明示的に<code class="literal">click</code>を含むが、イベントシンボル名自身は‘<code class="literal">click</code>’を含まない。
</p></blockquote></div><pre class="synopsis"><a id="idm60132048" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-basic-type</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>event</code></em>を記述するキー、またはマウスボタンをリターンする。<em class="replaceable"><code>event</code></em>引数は<code class="literal">event-modifiers</code>の場合と同様。たとえば:
</p><pre class="screen">(event-basic-type ?a)
     ⇒ 97
(event-basic-type ?A)
     ⇒ 97
(event-basic-type ?\C-a)
     ⇒ 97
(event-basic-type ?\C-\S-a)
     ⇒ 97
(event-basic-type 'f5)
     ⇒ f5
(event-basic-type 's-f5)
     ⇒ f5
(event-basic-type 'M-S-f5)
     ⇒ f5
(event-basic-type 'down-mouse-1)
     ⇒ mouse-1
</pre></blockquote></div><pre class="synopsis"><a id="idm60127056" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">mouse-movement-p</code> <em class="replaceable"><code>object</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>object</code></em>がマウス移動イベントの場合、この関数は非<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60123088" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-convert-list</code> <em class="replaceable"><code>list</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は修飾子名リストと基本イベント型(basic event
type)を、それらすべてを指定するイベント型に変換する。基本イベント型はそのリストの最後の要素でなければならない。たとえば、
</p><pre class="screen">(event-convert-list '(control ?a))
     ⇒ 1
(event-convert-list '(control meta ?a))
     ⇒ -134217727
(event-convert-list '(control super f1))
     ⇒ C-s-f1
</pre></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Accessing-Mouse"/>Accessing Mouse Events</h2></div></div></div><a id="idm60118608" class="indexterm"/><a id="idm60117840" class="indexterm"/><p>このセクションではマウスボタンやモーションイベント内のデータアクセスに役に立つ関数を説明します。同じ関数を使用してキーボードイベントデータにもアクセスできますが、キーボードイベントに不適切なデータ要素は0または<code class="literal">nil</code>になります。
</p><p>以下の2つの関数は、マウスイベントの位置を指定するマウス位置リスト(see <a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click Events</a>)をリターンします。
</p><pre class="synopsis"><a id="idm60115024" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-start</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>これは<em class="replaceable"><code>event</code></em>の開始位置をリターンする。
</p><p><em class="replaceable"><code>event</code></em>がクリックイベントまたはボタンダウンイベントの場合、この関数はそのイベントの位置をリターンする。<em class="replaceable"><code>event</code></em>がドラッグイベントの場合は、そのドラッグの開始位置をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60110416" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">event-end</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>これは<em class="replaceable"><code>event</code></em>の終了位置をリターンする。
</p><p><em class="replaceable"><code>event</code></em>がドラッグイベントの場合、この関数はユーザーがマウスボタンをリリースした位置をリターンする。<em class="replaceable"><code>event</code></em>がクリックイベントまたはボタンダウンイベントの場合、値はそのイベント固有の開始位置となる。
</p></blockquote></div><pre class="synopsis"><a id="idm60093520" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posnp</code> <em class="replaceable"><code>object</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>object</code></em>が(<a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>に記述されたいずれかのフォーマットの)マウス位置リストの場合は非<code class="literal">nil</code>、それ以外では<code class="literal">nil</code>をリターンする。
</p></blockquote></div><a id="idm60088656" class="indexterm"/><p>以下の関数は、引数にマウス位置リストをとり、そのリストのさまざまな部分をリターンします:
</p><pre class="synopsis"><a id="idm60087248" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-window</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>があったウィンドウをリターンする。<em class="replaceable"><code>position</code></em>が最初イベントがあったフレーム外の位置を表す場合は、かわりにそのフレームをリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60083408" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-area</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内に記録されたウィンドウエリアをリターンする。そのウィンドウのテキストエリアでイベントが発生したときは<code class="literal">nil</code>、それ以外ではイベントがどこで発生したかを識別するシンボルをリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60079312" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-point</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のバッファー位置をリターンする。ウィンドウのテキストエリア、マージンエリア、フリンジでイベントが発生したときは、バッファー位置を識別する整数値、それ以外では値は未定義である。
</p></blockquote></div><pre class="synopsis"><a id="idm60075856" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-x-y</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のピクセル単位のxy座標を、コンスセル<code class="literal">(<em class="replaceable"><code>x</code></em>
. <em class="replaceable"><code>y</code></em>)</code>でリターンする。これらは<code class="literal">posn-window</code>により与えられるウィンドウにたいする相対座標である。
</p><p>以下は、あるウィンドウのテキストエリア内のウィンドウ相対座標をフレーム相対座標に変換する方法を示す例である:
</p><pre class="screen">(defun frame-relative-coordinates (position)
  "POSITIONのフレーム相対座標をリターンする。
POSITIONはウィンドウのテキストエリアにあるものとする。"
  (let* ((x-y (posn-x-y position))
         (window (posn-window position))
         (edges (window-inside-pixel-edges window)))
    (cons (+ (car x-y) (car edges))
          (+ (cdr x-y) (cadr edges)))))
</pre></blockquote></div><pre class="synopsis"><a id="idm60069712" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-col-row</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>position</code></em>内のバッファー位置にたいして推定される列と行を含むコンスセル<code class="literal">(<em class="replaceable"><code>col</code></em>
.
<em class="replaceable"><code>row</code></em>)</code>をリターンする。リターン値は、<em class="replaceable"><code>position</code></em>にたいする<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>の値より計算され、そのフレームのデフォルト文字幅とデフォルト行高(行間スペースを含む)の単位で与えられる(そのため、実際の文字サイズが非デフォルト値の場合には、実際の行と列は、これらの計算された値とは異なるかもしれない)。
</p><p><em class="replaceable"><code>row</code></em>は、そのテキストエリアの上端から数えられることに注意すること。<em class="replaceable"><code>position</code></em>により与えられるウィンドウがヘッダーライン(see <a class="link" href="ch23s04.html#Header-Lines" title="Window Header Lines">Header
Lines</a>)をもつ場合、そのヘッダーラインは<em class="replaceable"><code>row</code></em>の数に<span class="emphasis"><em>含まない</em></span>。
</p></blockquote></div><pre class="synopsis"><a id="idm60061392" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-actual-col-row</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内の実際の行と列を、コンスセル<code class="literal">(<em class="replaceable"><code>col</code></em>
. <em class="replaceable"><code>row</code></em>)</code>でリターンする。値は<em class="replaceable"><code>position</code></em>与えられるウィンドウの実際の行と列である。<a class="link" href="ch21s07.html#Click-Events" title="Click Events">Click
Events</a>を参照のこと。<em class="replaceable"><code>position</code></em>が実際のポジション値を含まない場合、この関数は<code class="literal">nil</code>をリターンする。この場合、おおよその値を取得するために<code class="literal">posn-col-row</code>を使用できる。
</p><p>この関数は、タブ文字やイメージによるビジュアル列数のように、ディスプレイ上の文字のビジュアル幅を意味しない。標準的な文字単位の座標が必要ｎ場合は、かわりに<code class="literal">posn-col-row</code>を使用すること。
</p></blockquote></div><pre class="synopsis"><a id="idm60053456" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-string</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内の文字列オブジェクトをを<code class="literal">nil</code>、またはコンスセル<code class="literal">(<em class="replaceable"><code>string</code></em>
. <em class="replaceable"><code>string-pos</code></em>)</code>でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60044112" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-image</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のイメージオブジェクトを<code class="literal">nil</code>、または<code class="literal">(image ...)</code>でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60039632" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-object</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のイメージオブジェクト、または文字列オブジェクトを<code class="literal">nil</code>、イメージ<code class="literal">(image
...)</code>、またはコンスセル<code class="literal">(<em class="replaceable"><code>string</code></em> . <em class="replaceable"><code>string-pos</code></em>)</code>でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60033872" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-object-x-y</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のオブジェクトの左上隅からのピクセル単位のxy座標を、コンスセル<code class="literal">(<em class="replaceable"><code>dx</code></em>
.
<em class="replaceable"><code>dy</code></em>)</code>でリターンする。<em class="replaceable"><code>position</code></em>がバッファーテキストの場合は、その位置にもっとも近いバッファーテキストの相対位置をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60028752" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-object-width-height</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のオブジェクトのピクセル幅とピクセル高さを、コンスセル<code class="literal">(<em class="replaceable"><code>width</code></em>
. <em class="replaceable"><code>height</code></em>)</code>でリターンする。<em class="replaceable"><code>position</code></em>がバッファー位置の場合は、その位置の文字のサイズをリターンする。
</p></blockquote></div><a id="idm60023888" class="indexterm"/><pre class="synopsis"><a id="idm60022864" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-timestamp</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>position</code></em>内のタイムスタンプをリターンする。これはミリ秒で表されたイベント発生時刻である。
</p></blockquote></div><p>以下の関数は与えられた特定のバッファー、またはスクリーン位置により与えられる位置リストを計算します。上述の関数で、この位置リスト内のデータにアクセスできます。
</p><pre class="synopsis"><a id="idm60018896" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-at-point</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>pos</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は位置<em class="replaceable"><code>pos</code></em> in
<em class="replaceable"><code>window</code></em>にたいする位置リストをリターンする。<em class="replaceable"><code>pos</code></em>のデフォルトは<em class="replaceable"><code>window</code></em>内のポイントであり、<em class="replaceable"><code>window</code></em>のデフォルトは選択されたウィンドウである。
</p><p><em class="replaceable"><code>window</code></em>内で<em class="replaceable"><code>pos</code></em>が不可視の場合、<code class="literal">posn-at-point</code>は<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm60006864" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">posn-at-x-y</code> <em class="replaceable"><code>x</code></em> <em class="replaceable"><code>y</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>frame-or-window</code></em> <em class="replaceable"><code>whole</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、指定されたフレームまたはウィンドウ<em class="replaceable"><code>frame-or-window</code></em>(デフォルトは選択されたウィンドウ)内のピクセル座標<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>に対応する位置情報をリターンする。<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>は、使用されたフレームまたはウィンドウにたいする相対座標である。<em class="replaceable"><code>whole</code></em>が<code class="literal">nil</code>の場合、座標はウィンドウのテキストエリアにたいする相対座標であり、それ以外ではスクロールバー、マージン、フリンジを含むウィンドウエリア全体にたいする相対座標である。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Accessing-Scroll"/>Accessing Scroll Bar Events</h2></div></div></div><a id="idm59986256" class="indexterm"/><p>以下の関数は、スクロールバーイベントの解析に役立ちます。
</p><pre class="synopsis"><a id="idm59984848" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">scroll-bar-event-ratio</code> <em class="replaceable"><code>event</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数はスクロールバーで発生したスクロールバーイベントの位置の垂直位置割り合いをリターンする。値は位置の割り合いを表す2つの整数を含むコンスセル<code class="literal">(<em class="replaceable"><code>portion</code></em>
. <em class="replaceable"><code>whole</code></em>)</code>である。
</p></blockquote></div><pre class="synopsis"><a id="idm59980368" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">scroll-bar-scale</code> <em class="replaceable"><code>ratio</code></em> <em class="replaceable"><code>total</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、(実質的には)<em class="replaceable"><code>ratio</code></em>に<em class="replaceable"><code>total</code></em>を乗じて、結果を整数に丸める。引数<em class="replaceable"><code>ratio</code></em>は数字ではなく、<code class="literal">scroll-bar-event-ratio</code>によりリターンされる典型的な値ペアー<code class="literal">(<em class="replaceable"><code>num</code></em>
. <em class="replaceable"><code>denom</code></em>)</code>である。
</p><p>この関数はスクロールバー位置をバッファー位置にスケーリングするのに便利である。以下のようにこれを行う:
</p><pre class="screen">(+ (point-min)
   (scroll-bar-scale
      (posn-x-y (event-start event))
      (- (point-max) (point-min))))
</pre><p>スクロールバーイベントは、xy座標ペアーのかわりに割り合いを構成する2つの整数をもつことを思い出してほしい。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Strings-of-Events"/>Putting Keyboard Events in Strings</h2></div></div></div><a id="idm59971792" class="indexterm"/><a id="idm59971024" class="indexterm"/><p>文字列が使用される場所のほとんどにおいて、わたしたちはテキスト文字を含むもの、つまりバッファーやファイル内で見出すのと同種のものとして、文字列を概念化します。Lispプログラムはときおり、キーボード文字、たとえばキーシーケンスやキーボードマクロ定義かもしれないキーボード文字を概念的に含む文字列を使用します。しかし文字列内へのキーボード文字の格納は、歴史的な互換性の理由により複雑な問題であり、常に可能なわけではありません。
</p><p>新たに記述するプログラムでは文字列内にキーボードイベントを格納しないことにより、これらの複雑さを扱うことを避けるよう推奨します。以下はこれを行う方法です:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">lookup-key</code>および<code class="literal">define-key</code>の引数として使用するのでなければ、キーシーケンスにたいして文字列のかわりにベクターを使用する。たとえば、<code class="literal">read-key-sequence</code>のかわりに<code class="literal">read-key-sequence-vector</code>、<code class="literal">this-command-keys</code>のかわりに<code class="literal">this-command-keys-vector</code>を使用できる。
</p></li><li class="listitem"><p>メタ文字を含むキーシーケンス定数を記述する際は、たとえそれを直接<code class="literal">define-key</code>に渡す場合でもベクターを使用する。
</p></li><li class="listitem"><p>文字列かもしれないキーシーケンスの内容を調べる必要があるときは、それをリストに変換するために最初に<code class="literal">listify-key-sequence</code>(<a class="link" href="ch21s08.html#Event-Input-Misc" title="Miscellaneous Event Input Features">Event
Input Misc</a>を参照)を使用する。
</p></li></ul></div><p>複雑さはキーボード入力に含まれるかもしれない修飾ビットに起因します。メタ修飾以外の修飾ビットは文字列に含めることができず、メタ文字も特別な場合だけ許されます。
</p><p>GNU
Emacsの初期のバージョンでは、メタ文字を128から255のコードで表していました。その頃は基本文字コードの範囲は0から127だったので、すべてのキーボード文字を文字列内に適合させることができました。Lispプログラムの多くは、特に<code class="literal">define-key</code>やその種の関数の引数として文字列定数内にメタ文字を意味する‘<code class="literal">\M-</code>’を使用し、キーシーケンスとイベントシーケンスは常に文字列として表現されていました。
</p><p>127を超えるより大きい基本文字コードと追加の修飾ビットにたいするサポートを加えたとき、わたしたちはメタ文字の表現を変更する必要がありました。現在では文字のメタ修飾を表すフラグは
2**27
であり、そのような値は文字列内に含めることができません。
</p><p>プログラムで文字列定数内の‘<code class="literal">\M-</code>’をサポートするために、文字列内に特定のメタ文字を含めるための特別なルールがあります。以下は入力文字シーケンスとして文字列を解釈するためのルールです:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>キーボード文字の値の範囲が0から127の場合は、文字列を変更せずに含めることができる。
</p></li><li class="listitem"><p>これらの文字のコード
2**27
から
2**27+127,
までの範囲のメタ修飾された変種も文字列に含めることができるが、それらの数値を変更しなければならない。値が128から255の範囲となるように、ビット
2**7
のかわりにビット
2**27
をセットしなければならない。ユニバイト文字列だけがこれらの文字を含むことができる。
</p></li><li class="listitem"><p>265を超える非<acronym class="acronym">ASCII</acronym>文字はマルチバイト文字に含めることができる。
</p></li><li class="listitem"><p>その他のキーボード文字イベントは文字列に適合させられない。これには128から255の範囲のキーボードイベントが含まれる。
</p></li></ul></div><p>キーボード入力文字の文字列定数を構築する<code class="literal">read-key-sequence</code>のような関数は、イベントが文字列内に適合しないときは文字列のかわりにベクターを構築するというルールにしたがいます。
</p><p>文字列内で入力構文‘<code class="literal">\M-</code>’を使用すると、それは128から255の範囲のコード、つまり対応するキーボードイベントを文字列内に配すために変更するとき取得されるのと同じコードが生成されます。したがって文字列内のメタイベントは、それが文字列内にどのように配置されたかと無関係に一貫して機能します。
</p><p>しかし、ほとんどのプログラムはこのセクションの冒頭の推奨にしたがって、これらの問題を避けるほうがよいでしょう。
</p></div><div class="footnotes"><br/><hr/><div id="ftn.idm60301392" class="footnote"><p><a href="#idm60301392" class="para"><sup class="para">[11] </sup></a>ボタンダウン(button-down)はドラッグ(drag)の保守的なアンチテーゼです(訳注:
原文は“Button-down is the conservative antithesis of
drag.”。ボタンダウンを着るような人種と麻薬を対比させたジョークのような気がしますが、すいません、よく分からないので直訳します)。</p></div></div></div></body></html>