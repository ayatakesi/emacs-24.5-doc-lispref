<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Prefix Keys</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Prefix-Keys"/>Prefix Keys</h1></div></div></div><a id="idm59071568" class="indexterm"/><p><em class="firstterm">プレフィクスキー(prefix
key)</em>とは、バインディングがキーマップであるようなキーシーケンスです。このキーマップは、プレフィクスキーを拡張するキーシーケンスが何を行うか定義します。たとえば、<strong class="userinput"><code>C-x</code></strong>はプレフィクスキーであり、これはキーマップを使用し、そのキーマップは変数<code class="literal">ctl-x-map</code>にも格納されています。このキーマップは<strong class="userinput"><code>C-x</code></strong>で始まるキーシーケンスにたいするバインディングを定義します。
</p><p>標準的なEmacsのプレフィクスキーのいくつかは、Lisp変数でも見い出すことができるキーマップを使用していますl:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a id="idm59067984" class="indexterm"/><a id="idm59067216" class="indexterm"/><p><code class="literal">esc-map</code>は、プレフィクスキー<span class="keycap"><strong>ESC</strong></span>にたいするグローバルキーマップである。したがって、すべてのメタ文字にたいする定義は、このキーマップで見つけることができる。このマップは、<code class="literal">ESC-prefix</code>の関数定義でもある。
</p></li><li class="listitem"><a id="idm59052240" class="indexterm"/><p><code class="literal">help-map</code>は、プレフィクスキー<strong class="userinput"><code>C-h</code></strong>にたいするグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59049808" class="indexterm"/><a id="idm59048784" class="indexterm"/><p><code class="literal">mode-specific-map</code>は、プレフィクスキー<strong class="userinput"><code>C-c</code></strong>にたいするグローバルキーマップである。このマップは実際にはモード特有(mode-specific)ではなくグローバルであるが、このプレフィクスキーは主にモード特有なバインディングに使用されるので、<strong class="userinput"><code>C-h
b</code></strong>(<code class="literal">display-bindings</code>)の出力内の<strong class="userinput"><code>C-c</code></strong>に関する情報で、この名前は有意義な情報を提供する。
</p></li><li class="listitem"><a id="idm59045072" class="indexterm"/><a id="idm59044048" class="indexterm"/><a id="idm59043280" class="indexterm"/><p><code class="literal">ctl-x-map</code>は、プレフィクスキー<strong class="userinput"><code>C-x</code></strong>にたいして使用されるグローバルキーマップである。このマップは、シンボル<code class="literal">Control-X-prefix</code>の関数セルを通して見つけることができる。
</p></li><li class="listitem"><a id="idm59040592" class="indexterm"/><a id="idm59039184" class="indexterm"/><p><code class="literal">mule-keymap</code>は、プレフィクスキー<strong class="userinput"><code>C-x <span class="keycap"><strong>RET</strong></span></code></strong> にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59036624" class="indexterm"/><a id="idm59035600" class="indexterm"/><p><code class="literal">ctl-x-4-map</code>は、プレフィクスキー<strong class="userinput"><code>C-x 4</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59033424" class="indexterm"/><a id="idm59032400" class="indexterm"/><p><code class="literal">ctl-x-5-map</code>は、プレフィクスキー<strong class="userinput"><code>C-x 5</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59030224" class="indexterm"/><a id="idm59029200" class="indexterm"/><p><code class="literal">2C-mode-map</code>は、プレフィクスキー<strong class="userinput"><code>C-x 6</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59027024" class="indexterm"/><a id="idm59026000" class="indexterm"/><p><code class="literal">vc-prefix-map</code>は、プレフィクスキー<strong class="userinput"><code>C-x v</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59023824" class="indexterm"/><a id="idm59022800" class="indexterm"/><p><code class="literal">goto-map</code>は、プレフィクスキー<strong class="userinput"><code>M-g</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59020624" class="indexterm"/><a id="idm59019600" class="indexterm"/><p><code class="literal">search-map</code>は、プレフィクスキー<strong class="userinput"><code>M-s</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><a id="idm59017424" class="indexterm"/><a id="idm59016400" class="indexterm"/><p><code class="literal">facemenu-keymap</code>は、プレフィクスキー<strong class="userinput"><code>M-o</code></strong>にたいして使用されるグローバルキーマップである。
</p></li><li class="listitem"><p>Emacsの他のプレフィクスキーには<strong class="userinput"><code>C-x @</code></strong>、<strong class="userinput"><code>C-x a i</code></strong>、<strong class="userinput"><code>C-x
<span class="keycap"><strong>ESC</strong></span></code></strong>、<strong class="userinput"><code><span class="keycap"><strong>ESC</strong></span> <span class="keycap"><strong>ESC</strong></span></code></strong>がある。これらは、特別な名前をもたないキーマップを使用する。
</p></li></ul></div><p>プレフィクスキーのキーマップバインディングは、プレフィクスキーに続くイベントをルックアップするために使用されます。(これは、関数定義がキーマップであるようなシンボルかもしれません。効果は同じですが、シンボルはプレフィクスキーにたいする名前の役割を果たします。)
したがって、<strong class="userinput"><code>C-x</code></strong>のバインディングはシンボル<code class="literal">Control-X-prefix</code>であり、このシンボルの関数セルが<strong class="userinput"><code>C-x</code></strong>コマンドにたいするキーマップを保持します(<code class="literal">ctl-x-map</code>の値も同じキーマップです)。
</p><p>プレフィクスキー定義は、任意のアクティブなキーマップ内に置くことができます。プレフィクスキーとしての<strong class="userinput"><code>C-c</code></strong>、<strong class="userinput"><code>C-x</code></strong>、<strong class="userinput"><code>C-h</code></strong>、<span class="keycap"><strong>ESC</strong></span>の定義はグローバルマップ内にもあるので、これらのプレフィクスキーは常に使用できます。メジャーモードとマイナーモードは、ローカルマップやマイナーモードのマップ内にプレフィクスキー定義を置くことにより、キーをプレフィクスキーとして再定義できます。
<a class="link" href="ch22s07.html" title="Active Keymaps">Active Keymaps</a>を参照してください。
</p><p>あるキーが複数のアクティブなマップ内でプレフィクスキーとして定義されている場合、それぞれの定義がマージされて効果をもちます。まずマイナーモードキーマップ内で定義されたコマンド、次にローカルマップのプレフィクス定義されたコマンド、そしてグローバルマップのコマンドが続きます。
</p><p>以下の例では、ローカルキーマップ内で<strong class="userinput"><code>C-p</code></strong>を<strong class="userinput"><code>C-x</code></strong>と等価なプレフィクスキーにしています。すると、<strong class="userinput"><code>C-p
C-f</code></strong>にたいするバインディングは、<strong class="userinput"><code>C-x C-f</code></strong>と同様に関数<code class="literal">find-file</code>になります。キーシーケンス<strong class="userinput"><code>C-p
6</code></strong>は、すべてのアクティブなキーマップで見つけることができません。
</p><pre class="screen">(use-local-map (make-sparse-keymap))
    ⇒ nil
</pre><pre class="screen">(local-set-key "\C-p" ctl-x-map)
    ⇒ nil
</pre><pre class="screen">(key-binding "\C-p\C-f")
    ⇒ find-file
</pre><pre class="screen">
</pre><pre class="screen">(key-binding "\C-p6")
    ⇒ nil
</pre><pre class="synopsis"><a id="idm58999120" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">define-prefix-command</code> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>mapvar</code></em> <em class="replaceable"><code>prompt</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm58983120" class="indexterm"/><a id="Definition-of-define_002dprefix_002dcommand"/><p>この関数は、プレフィクスキーのバインディングとして使用するために、<em class="replaceable"><code>symbol</code></em>を用意する。これはsparseキーマップを作成して、それを<em class="replaceable"><code>symbol</code></em>の関数定義として格納する。その後は<em class="replaceable"><code>symbol</code></em>にキーシーケンスをバインディングすると、そのキーシーケンスはプレフィクスキーになるだろう。リターン値は<code class="literal">symbol</code>である。
</p><p>この関数は、値がそのキーマップであるような変数としても<em class="replaceable"><code>symbol</code></em>をセットする。しかし<em class="replaceable"><code>mapvar</code></em>が非<code class="literal">nil</code>の場合は、かわりに<em class="replaceable"><code>mapvar</code></em>を変数としてセットする。
</p><p><em class="replaceable"><code>prompt</code></em>が非<code class="literal">nil</code>の場合、これはそのキーマップにたいするoverallプロンプト文字列になる。プロンプト文字列はメニューキーマップにたいして与えられるべきである(<a class="link" href="ch22s17.html#Defining-Menus" title="Defining Menus">Defining
Menus</a>を参照)。
</p></blockquote></div></div></body></html>