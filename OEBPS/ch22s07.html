<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Active Keymaps</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Active-Keymaps"/>Active Keymaps</h1></div></div></div><a id="idm58975312" class="indexterm"/><p>Emacsは多くのキーマップを含んでいますが、常にいくつかのキーマップだけが<em class="firstterm">アクティブ</em>です。Emacsがユーザー入力を受け取ったとき、それは入力イベントに変換されて(<a class="link" href="ch22s14.html" title="Keymaps for Translating Sequences of Events">Translation
Keymaps</a>を参照)、アクティブなキーマップ内でキーバインディングが照合されます。
</p><p>アクティブなキーマップは通常、(1) <code class="literal">keymap</code>プロパティにより指定されるキーマップ、(2) 有効なマイナーモードのキーマップ、(3)
カレントバッファーのローカルキーマップ、(4)
グローバルキーマップの順です。Emacsは入力キーシーケンスそれぞれにたいして、これらすべてのキーマップ内を検索します。
</p><p>これらの“通常”のキーマップのうち最優先されるのは、もしあればポイント位置の<code class="literal">keymap</code>テキストにより指定されるキーマップ、またはoverallプロパティです。(マウス入力イベントにたいしては、Emacsはポイント位置のかわりにイベント位置を使用する。
<a class="link" href="ch22s08.html" title="Searching the Active Keymaps">Searching Keymaps</a>を参照のこと。)
</p><p>次に優先されるのは、有効なマイナーモードにより指定されるキーマップです。もしあれば、これらのキーマップは変数<code class="literal">emulation-mode-map-alists</code>、<code class="literal">minor-mode-overriding-map-alist</code>、<code class="literal">minor-mode-map-alist</code>により指定されます。<a class="link" href="ch22s09.html" title="Controlling the Active Keymaps">Controlling
Active Maps</a>を参照してください。
</p><a id="idm58968528" class="indexterm"/><p>次に優先されるのは、バッファーの<em class="firstterm">ローカルキーマップ(local
keymap)</em>で、これにはそのバッファー特有なキーバインディングが含まれます。ミニバッファーもローカルキーマップをもちます(<a class="link" href="ch20.html#Intro-to-Minibuffers" title="Introduction to Minibuffers">Intro to
Minibuffers</a>を参照)。ポイント位置に<code class="literal">local-map</code>テキスト、またはoverlayプロパティがある場合、それはバッファーのデフォルトローカルキーマップのかわりに使用するローカルキーマップを指定します。
</p><a id="idm58961872" class="indexterm"/><p>ローカルキーマップは通常はそのバッファーのメジャーモードによりセットされます。同じメジャーモードをもつすべてのバッファーは、同じローカルキーマップを共有します。したがって、あるバッファーでローカルキーマップを変更するために<code class="literal">local-set-key</code>(<a class="link" href="ch22s15.html" title="Commands for Binding Keys">Key
Binding Commands</a>を参照)を呼び出した場合、それは同じメジャーモードをもつ他のバッファーのローカルキーマップにも影響を与えます。
</p><a id="idm58959696" class="indexterm"/><p>最後は、<strong class="userinput"><code>C-f</code></strong>のようなカレントバッファーとは関係なく定義されるキーバインディングを含む、<em class="firstterm">グローバルキーマップ(global
keymap)</em>です。kこのキーマップは常にアクティブであり、変数<code class="literal">global-map</code>にバインドされています。
</p><p>これら“通常”のキーマップとは別に、Emacsはプログラムが他のキーマップをアクティブにするための特別な手段を提供します。1つ目は、グローバルキーマップ以外の通常アクティブなキーマップを置き換えるキーマップを指定する変数<code class="literal">overriding-local-map</code>です。2つ目は、他の<span class="emphasis"><em>すべて</em></span>のキーマップより優先されるキーマップを指定する、端末ローカル変数<code class="literal">overriding-terminal-local-map</code>です。この端末ローカル変数は通常、modal(訳注:
他のキーマップを選択できない状態)かつ一時的なキーバインディングに使用されます(ここの変数にたいして関数<code class="literal">set-transient-map</code>は便利なインターフェイスを提供する)。詳細は、<a class="link" href="ch22s09.html" title="Controlling the Active Keymaps">Controlling
Active Maps</a>を参照のこと。
</p><p>これらを使用するのがキーマップをアクティブにする唯一の方法ではありません。キーマップは、<code class="literal">read-key-sequence</code>によるイベントの変換のような、他の用途にも使用されます。<a class="link" href="ch22s14.html" title="Keymaps for Translating Sequences of Events">Translation
Keymaps</a>を参照してください。
</p><p>いくつかの標準的なキーマップのリストは、<a class="link" href="apg.html" title="Appendix G. Standard Keymaps">Standard Keymaps</a>を参照してください。
</p><pre class="synopsis"><a id="idm58947664" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">current-active-maps</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>olp</code></em> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>これは、カレントの状況下でコマンドループによりキーシーケンスをルックアップするために使用される、アクティブなキーマップのリストをリターンする。これは通常、<code class="literal">overriding-local-map</code>と<code class="literal">overriding-terminal-local-map</code>を無視するが、<em class="replaceable"><code>olp</code></em>が非<code class="literal">nil</code>の場合には、それらのキーマップにも注意を払う。オプションで<em class="replaceable"><code>position</code></em>に<code class="literal">event-start</code>によりリターンされるイベント位置、またはバッファー位置を指定でき、<code class="literal">key-binding</code>で説明されているようにキーマップを変更するかもしれない。
</p></blockquote></div><pre class="synopsis"><a id="idm58936272" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">key-binding</code> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>accept-defaults</code></em> <em class="replaceable"><code>no-remap</code></em> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントのアクティブキーマップで<em class="replaceable"><code>key</code></em>にたいするバインディングをリターンする。そのキーマップ内で<em class="replaceable"><code>key</code></em>が未定義の場合、結果は<code class="literal">nil</code>になる。
</p><p>引数<em class="replaceable"><code>accept-defaults</code></em>は、<code class="literal">lookup-key</code>(<a class="link" href="ch22s11.html" title="Functions for Key Lookup">Functions for Key
Lookup</a>を参照)のようにデフォルトバインディングをチェックするかを制御する。
</p><p>コマンドがリマップ(remap: 再マップ。<a class="link" href="ch22s13.html" title="Remapping Commands">Remapping
Commands</a>を参照)されたとき、<code class="literal">key-binding</code>は通常、実際に実行されるであろうリマップされたコマンドをリターンするように、コマンドのリマップを行う。しかし、<em class="replaceable"><code>no-remap</code></em>が非<code class="literal">nil</code>の場合、<code class="literal">key-binding</code>はリマップを無視して、<em class="replaceable"><code>key</code></em>にたいして直接指定されたバインディングをリターンする。
</p><p><em class="replaceable"><code>key</code></em>がマウスイベント(もしかしたらプレフィクスイベントが先行するかもしれない)で始まる場合、照合されるマップはそのイベントの位置を元に決定される。それ以外では、それらのマップはポイント値に基づき決定される。しかし、<em class="replaceable"><code>position</code></em>を指定することにより、これらをオーバーライドできる。<em class="replaceable"><code>position</code></em>が非<code class="literal">nil</code>の場合、それはバッファー位置か<code class="literal">event-start</code>の値のようなイベント位置のいずれかである。その場合、照合されるマップは<em class="replaceable"><code>position</code></em>に基づき決定される。
</p><p><em class="replaceable"><code>key</code></em>が文字列とベクターのいずれでもない場合、Emacsはエラーをシグナルする。
</p><pre class="screen">(key-binding "\C-x\C-f")
    ⇒ find-file
</pre></blockquote></div></div></body></html>