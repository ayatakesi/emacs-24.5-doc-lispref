<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Searching the Active Keymaps</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Searching-Keymaps"/>Searching the Active Keymaps</h1></div></div></div><a id="idm63045200" class="indexterm"/><p>以下は、macsがアクティブなキーマップを検索する方法を示す、Lisp処理概要です:
</p><pre class="programlisting">(or (if overriding-terminal-local-map
        (<em class="replaceable"><code>find-in</code></em> overriding-terminal-local-map))
    (if overriding-local-map
        (<em class="replaceable"><code>find-in</code></em> overriding-local-map)
      (or (<em class="replaceable"><code>find-in</code></em> (get-char-property (point) 'keymap))
          (<em class="replaceable"><code>find-in-any</code></em> emulation-mode-map-alists)
          (<em class="replaceable"><code>find-in-any</code></em> minor-mode-overriding-map-alist)
          (<em class="replaceable"><code>find-in-any</code></em> minor-mode-map-alist)
          (if (get-text-property (point) 'local-map)
              (<em class="replaceable"><code>find-in</code></em> (get-char-property (point) 'local-map))
            (<em class="replaceable"><code>find-in</code></em> (current-local-map)))))
    (<em class="replaceable"><code>find-in</code></em> (current-global-map)))
</pre><p>ここで、<em class="replaceable"><code>find-in</code></em>と<em class="replaceable"><code>find-in-any</code></em>はそれぞれ、1つのキーマップとキーマップのalistを検索する仮の関数です。関数<code class="literal">set-transient-map</code>が<code class="literal">overriding-terminal-local-map</code>(<a class="link" href="ch22s09.html" title="Controlling the Active Keymaps">Controlling
Active Maps</a>を参照)をセットすることにより機能する点に注意してください。
</p><p>上記の処理概要では、キーシーケンスがマウスイベント(<a class="link" href="ch21s07.html#Mouse-Events" title="Mouse Events">Mouse
Events</a>を参照)で始まる場合、ポイント位置のかわりにそのイベント位置、カレントバッファーのかわりにそのイベントのバッファーが使用されます。これは特に、プロパティ<code class="literal">keymap</code>および<code class="literal">local-map</code>をルックアップする方法に影響を与えます。<code class="literal">display</code>、<code class="literal">before-string</code>、<code class="literal">after-string</code>プロパティ(<a class="link" href="ch32s19.html#Special-Properties" title="Properties with Special Meanings">Special
Properties</a>を参照)が埋め込まれていて、<code class="literal">keymap</code>または<code class="literal">local-map</code>プロパティが非<code class="literal">nil</code>の文字列上でマウスイベントが発生した場合、それは基調となるバッファーテキストの対応するプロパティをオーバーライドします(バッファーテキストにより指定されたプロパティは無視される)。
</p><p>アクティブなキーマップの1つでキーバインディングが見つかり、そのバインディングがコマンドの場合、検索は終了し、そのコマンドが実行されます。しかし、そのバインディングが値をもつ変数、または文字列の場合、Emacsは入力キーシーケンスをその変数の値、または文字列で置き換えて、アクティブなキーマップの検索を再開します。
<a class="link" href="ch22s10.html" title="Key Lookup">Key Lookup</a>を参照してください。
</p><p>最終的に見つかったコマンドもリマップされるかもしれません。<a class="link" href="ch22s13.html" title="Remapping Commands">Remapping Commands</a>を参照してください。
</p></div></body></html>