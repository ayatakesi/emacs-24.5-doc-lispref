<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mode Line Format</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Mode-Line-Format"/>Mode Line Format</h1></div></div></div><a id="idm61213520" class="indexterm"/><p>Emacsの各ウィンドウ(ミニバッファーウィンドウを除く)には通常、最下部にモードラインがあり、そのウィンドウ内に表示されたバッファーについてステータス情報がモードラインに表示されます。モードラインには、バッファー名、関連するファイル、再帰編集の深さ、およびメジャーモードやマイナーモードなどのような、そのバッファーに関する情報が含まれています。ウィンドウは<em class="firstterm">ヘッダーライン(header
line)</em>をもつこともでき、これはモードラインによく似ていますが、ウィンドウの最上部に表示されます。
</p><p>このセクションでは、モードラインおよびヘッダーラインのコンテンツの制御の仕方について説明します。このチャプターにモードラインを含めた理由は、モードラインに表示される情報の多くが、有効化されたメジャーモードとマイナーモードに関係があるからです。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Mode-Line-Basics"/>Mode Line Basics</h2></div></div></div><p>それぞれのモードラインのコンテンツは、バッファーローカル変数<code class="literal">mode-line-format</code>により指定されます(<a class="link" href="ch23s04.html#Mode-Line-Top" title="The Top Level of Mode Line Control">Mode
Line Top</a>を参照)。この変数は<em class="firstterm">モードライン構成(mode line
construct)</em>を保持します。これは、そのバッファーのモードラインに何を表示するかを制御するテンプレートです。<code class="literal">header-line-format</code>の値は、同じ方法によりそのバッファーのヘッダーラインを指定します。同一のバッファーにたいするすべてのウィンドウは、同じ<code class="literal">mode-line-format</code>と<code class="literal">header-line-format</code>を使用します。
</p><p>効率的な理由により、Emacsは各ウィンドウのモードラインとヘッダーラインを、連続して再評価しません。たとえばウィンドウ設定(window
configuration)の変更、バッファーの切り替え、バッファーのナローイング(narrowing)またはワイドニング(widening)、スクロール、バッファーの変更等、それを呼び出す状況が出現したときに、Emacsは再評価を行います。<code class="literal">mode-line-format</code>や<code class="literal">header-line-format</code>(<a class="link" href="ch23s04.html#Mode-Line-Variables" title="Variables Used in the Mode Line">Mode
Line
Variables</a>を参照)により参照される任意の変数、またはテキストが表示される方法に影響を与えるデータ構造(<a class="link" href="ch38.html" title="Chapter 37. Emacs Display">Display</a>を参照)を変更した場合は、表示を更新するために関数<code class="literal">force-mode-line-update</code>を使用するべきです。
</p><pre class="synopsis"><a id="idm61191888" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">force-mode-line-update</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>all</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、次の再表示サイクルの間に、すべての関連する変数の最新の値にもとづき、カレントバッファーのモードラインとヘッダーラインの更新をEmacsに強制する。オプション引数<em class="replaceable"><code>all</code></em>が非<code class="literal">nil</code>の場合は、すべてのモードラインとヘッダーラインの更新を強制する。
</p><p>この関数は、メニューバーとフレームタイトルの更新も強制する。
</p></blockquote></div><p>選択されたウィンドウのモードラインは、通常はフェイス<code class="literal">mode-line</code>を使用して異なるカラーで表示されます。かわりに、他のウィンドウのモードラインは、フェイス<code class="literal">mode-line-inactive</code>で表示されます。<a class="link" href="ch38s12.html" title="Faces">Faces</a>を参照してください。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Mode-Line-Data"/>The Data Structure of the Mode Line</h2></div></div></div><a id="idm61184336" class="indexterm"/><p>モードラインのコンテンツは、<em class="firstterm">モードライン構成(mode line
construct)</em>と呼ばれるデータ構造により制御されます。モードライン構成はリスト、シンボル、数字を保持するバッファーローカル変数により構成されます。それぞれのデータ型は、以下で説明するようにモードラインの外見にたいして特別な意味をもちます。フレームタイトル(<a class="link" href="ch29s05.html" title="Frame Titles">Frame
Titles</a>を参照)とヘッダーライン(<a class="link" href="ch23s04.html#Header-Lines" title="Window Header Lines">Header Lines</a>を参照)にたいしても、同じデータ構造が使用されます。
</p><p>固定文字列のようにシンプルなモードライン構成の場合もありますが、通常はモードライン構成のテキストを構築するために、固定文字列と変数の値を組み合わせる方法を指定します。これらの変数の多くは、その変数自体がその値によりモードライン構成を定義する変数です。
</p><p>以下は、モードライン構成における、さまざまなデータ型の意味です:
</p><div class="variablelist"><a id="idm61180880" class="indexterm"/><dl class="variablelist"><dt><span class="term"><code class="literal"><em class="replaceable"><code>string</code></em></code>
</span></dt><dd><p>モードライン構成においての文字列は、文字列内に<em class="firstterm"><code class="literal">%</code>構成(<code class="literal">%</code>-constructs)</em>を含む以外は、そのまま表現される。これらは、他のデータによる置換を意味する。<a class="link" href="ch23s04.html#_0025_002dConstructs" title="%-Constructs in the Mode Line">%-Constructs</a>を参照のこと。
</p><p>文字列の一部が<code class="literal">face</code>プロパティをもつ場合は、バッファー内でそれらが表示されるときと同じように、テキスト表示を制御する。<code class="literal">face</code>プロパティをもたない文字は、デフォルトのフェイス<code class="literal">mode-line</code>、または<code class="literal">mode-line-inactive</code>で表示される(section “Standard
Faces” in <em class="citetitle">The GNU Emacs
Manual</em>を参照)。<em class="replaceable"><code>string</code></em>内の<code class="literal">help-echo</code>プロパティと<code class="literal">keymap</code>プロパティは、特別な意味をもつ。<a class="link" href="ch23s04.html#Properties-in-Mode" title="Properties in the Mode Line">Properties
in Mode</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal"><em class="replaceable"><code>symbol</code></em></code>
</span></dt><dd><p>モードライン構成においてのシンボルは、その値を意味する。モードライン構成としては、<em class="replaceable"><code>symbol</code></em>の値は<em class="replaceable"><code>symbol</code></em>の位置に使用される。しかし、シンボル<code class="literal">t</code>と<code class="literal">nil</code>は、値がvoidであるようなシンボルとして無視される。
</p><p>例外が1つある。<em class="replaceable"><code>symbol</code></em>の値が文字列の場合、それはそのまま表示され、<code class="literal">%</code>構成は認識されない。
</p><p><em class="replaceable"><code>symbol</code></em>が“危険”とマークされていない(非<code class="literal">nil</code>の<code class="literal">risky-local-variable</code>プロパティをもつ)場合は、<em class="replaceable"><code>symbol</code></em>の値中で指定されたテキストプロパティはすべて無視される。これには、<em class="replaceable"><code>symbol</code></em>の値中の文字列のテキストプロパティ、同様に文字列内の<code class="literal">:eval</code>フォームと<code class="literal">:propertize</code>フォームがすべて含まれる。(これはセキュリティー上の理由による。危険とマークされていない変数は、ユーザーへの問い合わせなしでファイル変数から自動的にセットされ得る。)
</p></dd><dt><span class="term"><code class="literal">(<em class="replaceable"><code>string</code></em> <em class="replaceable"><code>rest</code></em>…)</code>
, </span><span class="term"><code class="literal">(<em class="replaceable"><code>list</code></em> <em class="replaceable"><code>rest</code></em>…)</code>
</span></dt><dd><p>最初の要素が文字列またはリストであるようなリストは、すべての要素を再帰的に処理して、その結果を結合することを意味する。これは、モードライン構成において、もっとも一般的なフォームである。
</p></dd><dt><span class="term"><code class="literal">(:eval <em class="replaceable"><code>form</code></em>)</code>
</span></dt><dd><p>最初の要素がシンボル<code class="literal">:eval</code>であるようなリストは、<em class="replaceable"><code>form</code></em>を評価して、その結果を表示する文字列として使用するよう指示する。この評価がファイルをロードできないことを確認すること。ファイルをロードすると、無限再帰が発生するかもしれない。
</p></dd><dt><span class="term"><code class="literal">(:propertize <em class="replaceable"><code>elt</code></em> <em class="replaceable"><code>props</code></em>…)</code>
</span></dt><dd><p>最初の要素がシンボル<code class="literal">:propertize</code>であるようなリストは、モードライン構成<em class="replaceable"><code>elt</code></em>を再帰的に処理して、<em class="replaceable"><code>props</code></em>により指定されるテキストプロパティに結果を加えるよう指示する。引数<em class="replaceable"><code>props</code></em>は、0個以上の<em class="replaceable"><code>text-property</code></em>と<em class="replaceable"><code>value</code></em>のペアーで構成されるべきである。
</p></dd><dt><span class="term"><code class="literal">(<em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>then</code></em> <em class="replaceable"><code>else</code></em>)</code>
</span></dt><dd><p>最初の要素がキーワード以外のシンボルであるようなリストは、条件文を指定する。その意味は、<em class="replaceable"><code>symbol</code></em>の値に依存する。<em class="replaceable"><code>symbol</code></em>が非<code class="literal">nil</code>値をもつ場合は、モードライン構成として、2つ目の要素<em class="replaceable"><code>then</code></em>が再帰的に処理され、それ以外は3つ目の要素<em class="replaceable"><code>else</code></em>が再帰的に処理される。<em class="replaceable"><code>else</code></em>は省略でき、その場合<em class="replaceable"><code>symbol</code></em>の値が<code class="literal">nil</code>かvoidならば、モードライン構成は何も表示しない。
</p></dd><dt><span class="term"><code class="literal">(<em class="replaceable"><code>width</code></em> <em class="replaceable"><code>rest</code></em>…)</code>
</span></dt><dd><p>最初の要素が整数であるようなリストは、<em class="replaceable"><code>rest</code></em>の結果の切り詰め、またはパディングを指定する。残りの要素<em class="replaceable"><code>rest</code></em>は、モードライン構成として再帰的に処理され、互いに結合される。<em class="replaceable"><code>width</code></em>が正の場合、結果の幅が<em class="replaceable"><code>width</code></em>より少ないときは、右側にスペースがパディングされる。<em class="replaceable"><code>width</code></em>が負の場合、結果の幅が−<em class="replaceable"><code>width</code></em>より大きいときは、右側が切り詰められる。
</p><p>たとえば、ウィンドウ最上部からのバッファー位置をパーセント表示するには、<code class="literal">(-3 "%p")</code>のようなリストを使用すればよい。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Mode-Line-Top"/>The Top Level of Mode Line Control</h2></div></div></div><p>変数<code class="literal">mode-line-format</code>は、モードラインの全体的な制御を行います。
</p><pre class="synopsis"><a id="idm61136208" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">mode-line-format</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、モードラインのコンテンツを制御するモードライン構成である。これは、すべてのバッファーにおいて、常にバッファーローカルである。
</p><p>あるバッファー内でこの変数に<code class="literal">nil</code>をセットした場合、そのバッファーはモードラインをもたない(高さが1行しかないウィンドウも、モードラインを表示しない)。
</p></blockquote></div><p><code class="literal">mode-line-format</code>のデフォルト値は、<code class="literal">mode-line-position</code>や<code class="literal">mode-line-modes</code>(これは<code class="literal">mode-name</code>と<code class="literal">minor-mode-alist</code>の値を組み込む)のような、他の変数の値を使用するようデザインされています。<code class="literal">mode-line-format</code>自体を変更する必要があるモードは、ほとんどありません。ほとんどの用途にたいしては、<code class="literal">mode-line-format</code>が直接、または間接的に参照する、いくつかの変数を修正すれば十分です。
</p><p><code class="literal">mode-line-format</code>l自体の変更を行った場合、新たな値は他の様式でコンテンツを複製したり情報を表示するのではなく、デフォルト値(<a class="link" href="ch23s04.html#Mode-Line-Variables" title="Variables Used in the Mode Line">Mode
Line
Variables</a>を参照)に現れるのと同じ変数を使用するべきです。この方法を使用すれば、ユーザーや(<code class="literal">display-time</code>やメジャーモードのような)Lispプログラムにより行われたカスタマイズは、それらの変数への変更を通じて、効力を保ちます。
</p><p>以下は、Shellモードにたいして有用かもしれない、架空の<code class="literal">mode-line-format</code>の例です(実際には、Shellモードは<code class="literal">mode-line-format</code>をセットしない):
</p><pre class="screen">(setq mode-line-format
  (list "-"
   'mode-line-mule-info
   'mode-line-modified
   'mode-line-frame-identification
   "%b--"
</pre><pre class="screen">   ;; これはリスト作成中に評価されることに注意。
   ;; これは単なる文字列のモードライン構成を作成する。
   (getenv "HOST")
</pre><pre class="screen">   ":"
   'default-directory
   "   "
   'global-mode-string
   "   %[("
   '(:eval (mode-line-mode-name))
   'mode-line-process
   'minor-mode-alist
   "%n"
   ")%]--"
</pre><pre class="screen">   '(which-func-mode ("" which-func-format "--"))
   '(line-number-mode "L%l--")
   '(column-number-mode "C%c--")
   '(-3 "%p")))
</pre><p>(変数<code class="literal">line-number-mode</code>、<code class="literal">column-number-mode</code>、<code class="literal">which-func-mode</code>は特定のマイナーモードを有効にする。通例どおり、これらの変数名は、マイナーモードコマンド名でもある。)
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Mode-Line-Variables"/>Variables Used in the Mode Line</h2></div></div></div><p>このセクションでは、<code class="literal">mode-line-format</code>の標準的な値として、モードラインテキストに組み込まれる変数を説明します。これらの変数は、本質的には特別なものではありません。<code class="literal">mode-line-format</code>が使用する変数を他の変数に変更すれば、それらはモードライン上で同様の効果をもちます。しかし、Emacsのさまざまな部分は、それらの変数がモードラインを制御するという認識の元、それらの変数をセットします。したがって、事実上モードラインがそれらの変数を使用するのは必須なのです。
</p><pre class="synopsis"><a id="idm61119312" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-mule-info</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、言語環境(language environment)、バッファーコーディングシステム、カレント入力メソッド(current input
method)に関する情報のモードライン構成の値を保持する。<a class="link" href="ch33.html" title="Chapter 32. Non-ASCII Characters">Non-ASCII Characters</a>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm61116112" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-modified</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、カレントバッファーが変更されたかどうかを表示する、モードライン構成の値を保持する。デフォルト値ではバッファーが変更されていれば‘<code class="literal">**</code>’、バッファーが変更されていなければ‘<code class="literal">--</code>’、バッファーが読み取り専用なら‘<code class="literal">%%</code>’、読み取り専用だが変更されているときは‘<code class="literal">%*</code>’を表示する。
</p><p>この変数を変更しても、モードラインは強制的に更新されない。
</p></blockquote></div><pre class="synopsis"><a id="idm61106768" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-frame-identification</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、カレントフレームを識別する。デフォルト値では、複製フレームを表示可能なウィンドウシステムを使用している場合は<code class="literal">"
"</code>、一度に1つのフレームだけを表示する通常の端末では<code class="literal">"-%F "</code>を表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm61103056" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-buffer-identification</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、そのウィンドウ内で表示されているバッファーを識別する。デフォルト値では、少なくとも12列になるようスペースパディングされたバッファー名を表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm61100368" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">mode-line-position</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、バッファー内での位置を標示する。デフォルト値ではバッファーのパーセントを表示し、オプションでバッファーサイズ、行番号、列番号を表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm61097680" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">vc-mode</code></pre><div class="blockquote"><blockquote class="blockquote"><p>変数<code class="literal">vc-mode</code>は、各バッファーにたいしてバッファーローカルであり、そのバッファーがvisitしているファイルがバージョンコントロールで保守されているかどうかと、保守されている場合はバージョンコントロールシステムの種別を表示する。新しいモードラインに表示される文字列、バージョンコントロールされていない場合は<code class="literal">nil</code>である。
</p></blockquote></div><pre class="synopsis"><a id="idm61081680" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">mode-line-modes</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、そのバッファーのメジャーモードとマイナーモードを表示する。デフォルト値では再帰編集レベル(recursive editing
level)、プロセス状態の情報、ナローイング(narrowing)効果の有無を表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm61078992" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-remote</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、カレントバッファーにたいする<code class="literal">default-directory</code>がリモートかどうかを表示するために使用される。
</p></blockquote></div><pre class="synopsis"><a id="idm61075792" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-client</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、<code class="literal">emacsclient</code>フレームを識別するために使用される。
</p></blockquote></div><p>以下の3つの変数は、<code class="literal">mode-line-modes</code>内で使用されます:
</p><pre class="synopsis"><a id="idm61071696" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-name</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このバッファーローカル変数は、カレントバッファーのメジャーモードの“愛称(pretty
name)”を保持する。モード名がモードラインに表示されるように、それぞれのメジャーモードは、この変数をセットすべきである。値は文字列である必要はなく、モードライン構成内で有効な任意のデータ型(<a class="link" href="ch23s04.html#Mode-Line-Data" title="The Data Structure of the Mode Line">Mode
Line
Data</a>を参照)を使用できる。モードライン内でモード名を識別する文字列の計算には、<code class="literal">format-mode-line</code>を使用する(<a class="link" href="ch23s04.html#Emulating-Mode-Line" title="Emulating Mode Line Formatting">Emulating
Mode Line</a>を参照)。
</p></blockquote></div><pre class="synopsis"><a id="idm61067472" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">mode-line-process</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このバッファーローカル変数には、そのモードにおいて、サブプロセスとの通信にたいするプロセス状態のモードライン情報が含まれる。これはメジャーモード名の直後(間のスペースはない)に表示される。たとえば、<code class="filename">*shell*</code>バッファーでの値は<code class="literal">(":%s")</code>であり、これは‘<code class="literal">(Shell:run)</code>’のように、メジャーモードとともにその状態を表示する。通常、この変数は<code class="literal">nil</code>である。
</p></blockquote></div><pre class="synopsis"><a id="idm61062736" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">minor-mode-alist</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="Definition-of-minor_002dmode_002dalist"/><p>この変数は、マイナーモードがアクティブかをモードラインに示す方法を指定する要素をもつ、連想リスト(association
list)を保持する。<code class="literal">minor-mode-alist</code>の各要素は、2要素のリストであること:
</p><pre class="screen">(<em class="replaceable"><code>minor-mode-variable</code></em> <em class="replaceable"><code>mode-line-string</code></em>)
</pre><p>より一般的には、<em class="replaceable"><code>mode-line-string</code></em>は任意のモードライン構成であり得る。<em class="replaceable"><code>minor-mode-variable</code></em>の値が非<code class="literal">nil</code>の場合はモードラインに表示され、それ以外では表示されない。一緒に実行されないよう、これらの文字列はスペースで始まるべきである。慣例的に、特定のモードにたいする<em class="replaceable"><code>minor-mode-variable</code></em>は、そのマイナーモードがアクティブになった際には、非<code class="literal">nil</code>値にセットされる。
</p><p><code class="literal">minor-mode-alist</code>自体はバッファーローカルではない。このalist内で参照される各変数は、そのマイナーモードをバッファーごとに個別に有効にできる場合は、バッファーローカルであること。
</p></blockquote></div><pre class="synopsis"><a id="idm61054672" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">global-mode-string</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、モードライン内でマイナーモード<code class="literal">which-func-mode</code>がセットされている場合はその直後、セットされていなければ<code class="literal">mode-line-modes</code>の後に表示されるモードライン構成を保持する(デフォルト)。コマンド<code class="literal">display-time</code>は、時間とロードの情報を含む文字列を保持する変数<code class="literal">display-time-string</code>を参照する、<code class="literal">global-mode-string</code>をセットする。
</p><p>‘<code class="literal">%M</code>’構成は、<code class="literal">global-mode-string</code>の値を置き換えるが、この変数は<code class="literal">mode-line-format</code>からモードラインにincludeされるので、時代遅れである。
</p></blockquote></div><p>以下は、<code class="literal">mode-line-format</code>のデフォルト値の簡略化バージョンです。実際のデフォルト値には、追加のテキストプロパティ指定も含まれます。
</p><pre class="screen">("-"
 mode-line-mule-info
 mode-line-modified
 mode-line-frame-identification
 mode-line-buffer-identification
</pre><pre class="screen"> "   "
 mode-line-position
 (vc-mode vc-mode)
 "   "
</pre><pre class="screen"> mode-line-modes
 (which-func-mode ("" which-func-format "--"))
 (global-mode-string ("--" global-mode-string))
 "-%-")
</pre></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="_0025_002dConstructs"/><code class="literal">%</code>-Constructs in the Mode Line</h2></div></div></div><p>モードライン構成として使用される文字列は、さまざまな種類のデータを置き換えるために、<code class="literal">%</code>構成を使用できます。以下は、定義済みの<code class="literal">%</code>構成と意味のリストです。
</p><p>‘<code class="literal">%%</code>’以外の構成では、フィールドの最小幅を指定するために、‘<code class="literal">%</code>’の後に10進整数を追加できます。幅がそれより小さい場合、そのフィールドは最小幅にパディングされます。純粋に数値的な構成(‘<code class="literal">c</code>’、‘<code class="literal">i</code>’、‘<code class="literal">I</code>’、‘<code class="literal">l</code>’)は左側、それ以外は右側にスペースを追加してパディングされます。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">%b</code>
</span></dt><dd><p><code class="literal">buffer-name</code>関数により取得されるカレントバッファー名。<a class="link" href="ch27s03.html" title="Buffer Names">Buffer Names</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%c</code>
</span></dt><dd><p>ポイント位置のカレント列番号。
</p></dd><dt><span class="term"><code class="literal">%e</code>
</span></dt><dd><p>EmacsがLispオブジェクトにたいしてメモリー不足になりそうなときは、それを伝える簡略なメッセージを示す。それ以外の場合は空である。
</p></dd><dt><span class="term"><code class="literal">%f</code>
</span></dt><dd><p><code class="literal">buffer-file-name</code>関数により取得される、visitしているファイル名。<a class="link" href="ch27s04.html" title="Buffer File Name">Buffer File
Name</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%F</code>
</span></dt><dd><p>選択されたフレームのタイトル(ウィンドウシステム上のみ)、または名前。<a class="link" href="ch29s03.html#Basic-Parameters" title="Basic Parameters">Basic Parameters</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%i</code>
</span></dt><dd><p>カレントバッファーのアクセス可能な範囲のサイズ。基本的には<code class="literal">(- (point-max) (point-min))</code>。
</p></dd><dt><span class="term"><code class="literal">%I</code>
</span></dt><dd><p>‘<code class="literal">%i</code>’と同様だが、10^3は‘<code class="literal">k</code>’、10^6は‘<code class="literal">M</code>’、10^9は‘<code class="literal">G</code>’を使用して省略することにより、より読みやすい方法でサイズをプリントする。
</p></dd><dt><span class="term"><code class="literal">%l</code>
</span></dt><dd><p>ポイント位置のカレント行番号。そのバッファーのアクセス可能な範囲内でカウントされる。
</p></dd><dt><span class="term"><code class="literal">%n</code>
</span></dt><dd><p>ナローイングが有効なときは‘<code class="literal">Narrow</code>’、それ以外は何も表示しない(<a class="link" href="ch30s04.html" title="Narrowing">Narrowing</a>の<code class="literal">narrow-to-region</code>を参照されたい)。
</p></dd><dt><span class="term"><code class="literal">%p</code>
</span></dt><dd><p>ウィンドウの<span class="bold"><strong>最上部</strong></span>より上にあるバッファーテキストのパーセント表示、または‘<code class="literal">Top</code>’、‘<code class="literal">Bottom</code>’、‘<code class="literal">All</code>’のいずれか。デフォルトのモードライン構成は、これを3文字に切り詰めることに注意されたい。
</p></dd><dt><span class="term"><code class="literal">%P</code>
</span></dt><dd><p>ウィンドウの<span class="bold"><strong>最下部</strong></span>より上にあるバッファーテキスト(ウィンドウ内の可視なテキストと、最上部の上にあるテキスト)のパーセント表示、およびバッファーの最上部がスクリーン上で可視な場合は、それに加えて‘<code class="literal">Top</code>’。または‘<code class="literal">Bottom</code>’か‘<code class="literal">All</code>’。
</p></dd><dt><span class="term"><code class="literal">%s</code>
</span></dt><dd><p><code class="literal">process-status</code>により取得される、カレントバッファーに属するサブプロセスの状態。<a class="link" href="ch37s06.html" title="Process Information">Process
Information</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%z</code>
</span></dt><dd><p>キーボード、端末、およびバッファーコーディングシステムのニーモニック。
</p></dd><dt><span class="term"><code class="literal">%Z</code>
</span></dt><dd><p>‘<code class="literal">%z</code>’と同様だが、EOL形式(end-of-line format: 改行形式)を含む。
</p></dd><dt><span class="term"><code class="literal">%*</code>
</span></dt><dd><p>バッファーが読み取り専用(<code class="literal">buffer-read-only</code>を参照)の場合は‘<code class="literal">%</code>’、

変更されている場合(<code class="literal">buffer-modified-p</code>を参照)は‘<code class="literal">*</code>’、
 それ以外は‘<code class="literal">-</code>’。<a class="link" href="ch27s05.html" title="Buffer Modification">Buffer
Modification</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%+</code>
</span></dt><dd><p>バッファーが変更されている場合(<code class="literal">buffer-modified-p</code>を参照)は‘<code class="literal">*</code>’

バッファーが読み取り専用(<code class="literal">buffer-read-only</code>を参照)の場合は‘<code class="literal">%</code>’、

それ以外は‘<code class="literal">-</code>’。これは、読み取り専用バッファーの変更にたいしてのみ‘<code class="literal">%*</code>’と異なる。<a class="link" href="ch27s05.html" title="Buffer Modification">Buffer
Modification</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%&amp;</code>
</span></dt><dd><p>バッファーが変更されている場合は‘<code class="literal">*</code>’、それ以外は‘<code class="literal">-</code>’。
</p></dd><dt><span class="term"><code class="literal">%[</code>
</span></dt><dd><p>再帰編集レベルの深さを標示する(ミニバッファーレベルは勘定しない)。1つの編集レベルが‘<code class="literal">[</code>’。<a class="link" href="ch21s13.html" title="Recursive Editing">Recursive
Editing</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">%]</code>
</span></dt><dd><p>1つの編集レベルが‘<code class="literal">]</code>’(ミニバッファーレベルは勘定しない)。
</p></dd><dt><span class="term"><code class="literal">%-</code>
</span></dt><dd><p>モードラインの残りを充填するのに十分なダッシュ。
</p></dd><dt><span class="term"><code class="literal">%%</code>
</span></dt><dd><p>文字‘<code class="literal">%</code>’。<code class="literal">%</code>構成が許される文字列内に、リテラル‘<code class="literal">%</code>’を含めるには、この方法を使用する。
</p></dd></dl></div><p>以下の2つの<code class="literal">%</code>構成はまだサポートされていますが、同じ結果を変数<code class="literal">mode-name</code>と<code class="literal">global-mode-string</code>で取得できるので、これらは時代遅れです。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">%m</code>
</span></dt><dd><p><code class="literal">mode-name</code>の値。
</p></dd><dt><span class="term"><code class="literal">%M</code>
</span></dt><dd><p><code class="literal">global-mode-string</code>の値。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Properties-in-Mode"/>Properties in the Mode Line</h2></div></div></div><a id="idm65115728" class="indexterm"/><p>モードライン内では、特定のテキストプロパティが意味をもちます。<code class="literal">face</code>プロパティは、テキストの外見に影響します。<code class="literal">help-echo</code>プロパティはそのテキストのヘルプ文字列に関連し、<code class="literal">keymap</code>によりテキストをマウスに感応させることができます。
</p><p>モードライン内のテキストにたいしてテキストプロパティを指定するには、4つの方法があります:
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>モードラインデータ構造内に、テキストプロパティをもつ文字列を直接配する。
</p></li><li class="listitem"><p>‘<code class="literal">%12b</code>’のような、モードライン%構成に、テキストプロパティを配する。その場合、%構成を展開すると、同じテキストプロパティをもつことになる。
</p></li><li class="listitem"><p><em class="replaceable"><code>props</code></em>で指定されるテキストプロパティを<em class="replaceable"><code>elt</code></em>に与えるために、<code class="literal">(:propertize <em class="replaceable"><code>elt</code></em>
<em class="replaceable"><code>props</code></em>…)</code>構成を使用する。
</p></li><li class="listitem"><p><em class="replaceable"><code>form</code></em>がテキストプロパティをもつ文字列に評価されるように、モードラインデータ構造内に<code class="literal">:eval
<em class="replaceable"><code>form</code></em></code>を含むリストを使用する。
</p></li></ol></div><p>キーマップを指定するために、<code class="literal">keymap</code>プロパティを使用できます。このキーマップは、マウスクリックにたいしてのみ、実際の効果をもちます。モードライン内にポイントを移動させるのは不可能なので、文字キーやファンクションキーをこれにバインドしても、効果はありません。
</p><p>モードラインが、<code class="literal">risky-local-variable</code>が非<code class="literal">nil</code>であるようなプロパティをもつ変数を参照する場合、その変数の値により与える、または指定されるテキストプロパティは、すべて無視されます。これは、そのようなプロパティは呼び出される関数を指定するかもしれず、その関数はファイルローカル変数が由来かもしれないからです。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Header-Lines"/>Window Header Lines</h2></div></div></div><a id="idm65099088" class="indexterm"/><a id="idm65069648" class="indexterm"/><p>ウィンドウは、最下部にモードラインをもつことができるのと同じように、最上部に<em class="firstterm">ヘッダーライン(header
line)</em>をもつことができます。ヘッダーライン機能は、それが<code class="literal">header-line-format</code>により制御されることを除けば、モードラインと同じように機能します。
</p><pre class="synopsis"><a id="idm65067216" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">header-line-format</code></pre><div class="blockquote"><blockquote class="blockquote"><p>すべてのバッファーにたいしてローカルなこの変数は、そのバッファーを表示するバッファーにたいして、ヘッダーラインを表示する方法を指定する。この変数の値のフォーマットは、<code class="literal">mode-line-format</code>にたいするフォーマットと同じである(<a class="link" href="ch23s04.html#Mode-Line-Data" title="The Data Structure of the Mode Line">Mode
Line Data</a>を参照)。通常、この変数は<code class="literal">nil</code>なので、通常のバッファーはヘッダーラインをもたない。
</p></blockquote></div><pre class="synopsis"><a id="idm65062992" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">window-header-line-height</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>window</code></em>のヘッダーラインの高さを、ピクセルでリターンする。<em class="replaceable"><code>window</code></em>は生きたウィンドウでなければならず、デフォルトは選択されたウィンドウである。
</p></blockquote></div><p>高さが1行しかないウィンドウは、決してヘッダーラインを表示しません。また、高さが2行しかないウィンドウは、一度にモードラインとヘッダーラインを表示できません。そのようなウィンドウがモードラインをもつ場合、ヘッダーラインは表示されません。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Emulating-Mode-Line"/>Emulating Mode Line Formatting</h2></div></div></div><p>関数<code class="literal">format-mode-line</code>を使用して、特定のモードライン構成にもとづきモードライン、またはヘッダーラインに表示されるテキストを計算できます。
</p><pre class="synopsis"><a id="idm65043920" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">format-mode-line</code> <em class="replaceable"><code>format</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>face</code></em> <em class="replaceable"><code>window</code></em> <em class="replaceable"><code>buffer</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、あたかも<em class="replaceable"><code>window</code></em>にたいしてモードラインを生成するかのように、<em class="replaceable"><code>format</code></em>に応じてテキスト行をフォーマットするが、さらにそのテキストを文字列としてリターンする。引数<em class="replaceable"><code>window</code></em>のデフォルトは、選択されたウィンドウである。<em class="replaceable"><code>buffer</code></em>が非<code class="literal">nil</code>の場合、使用されるすべての情報は<em class="replaceable"><code>buffer</code></em>から取得される。デフォルトでは、<em class="replaceable"><code>window</code></em>のバッファーから取得される。
</p><p>文字列の値は通常、モードラインがもつであろうフェイス、キーマップ等に対応するテキストプロパティをもつ。<em class="replaceable"><code>format</code></em>により指定された<code class="literal">face</code>プロパティのないすべての文字は、<em class="replaceable"><code>face</code></em>により決定されるデフォルト値を取得する。<em class="replaceable"><code>face</code></em>が<code class="literal">t</code>の場合は、<em class="replaceable"><code>window</code></em>が選択されていれば<code class="literal">mode-line</code>、それ以外は<code class="literal">mode-line-inactive</code>であることを意味する。<em class="replaceable"><code>face</code></em>が<code class="literal">nil</code>、または省略された場合は、デフォルトのフェイスを意味する。<em class="replaceable"><code>face</code></em>が整数の場合、この関数はテキストプロパティをもたない値をリターンするだろう。
</p><p><em class="replaceable"><code>face</code></em>の値として、他の有効なフェイスを指定することもできる。指定された場合、それは<em class="replaceable"><code>format</code></em>でフェイスを指定されていない文字の<code class="literal">face</code>プロパティのフェイスを提供する。
</p><p><em class="replaceable"><code>face</code></em>として<code class="literal">mode-line</code>、<code class="literal">mode-line-inactive</code>、<code class="literal">header-line</code>を使用することにより、フォーマットされた文字列のリターンに加えて、対応するフェイスのカレント定義を使用して、実際にモードラインやヘッダーラインが再描画されるだろうということに注意されたい(他のフェイスでは、再描画は行われない)。
</p><p>たとえば、<code class="literal">(format-mode-line
header-line-format)</code>は選択されたウィンドウに表示されるテキスト(ヘッダーラインがない場合は<code class="literal">""</code>)をリターンするだろう。<code class="literal">(format-mode-line
header-line-format
'header-line)</code>は、各文字がヘッダーライン内でもつであろうフェイスをもつ、同じテキストをリターンし、加えてヘッダーラインの再描画も行う。
</p></blockquote></div></div></div></body></html>