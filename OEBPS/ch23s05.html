<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Imenu</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Imenu"/>Imenu</h1></div></div></div><a id="idm65024336" class="indexterm"/><p><em class="firstterm">Imenu</em>とは、バッファー内の定義やセクションをすべてリストするメニューをユーザー選択することにより、バッファー内の該当箇所に直接移動する機能です。Imenuは、定義(またはバッファーのその他の名前つき範囲)の名前とその定義のバッファー内での位置をリストする、バッファーインデックスを構築して、ユーザーがそれを選択すればポイントをおこに移動できるようにして機能します。メジャーモードは、<code class="literal">imenu-add-to-menubar</code>を使用して、メニューバーアイテムを追加することができます。
</p><pre class="synopsis"><a id="idm65022160" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">imenu-add-to-menubar</code> <em class="replaceable"><code>name</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>name</code></em>という名前のImenuを実行するためのローカルメニューバーを定義する。
</p></blockquote></div><p>Imenuを使用ためのユーザーレベルコマンドは、Emacsマニュアル内で説明されています(section “Imenu” in <em class="citetitle">the
Emacs
Manual</em>を参照)。このセクションでは、特定のメジャーモードにたいして、定義や名前つき範囲を見つける、Imenuメソッドのカスタマイズ方法を説明します。
</p><p>変数<code class="literal">imenu-generic-expression</code>をセットするのが通常の、そしてもっともシンプルな方法です:
</p><pre class="synopsis"><a id="idm65016912" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-generic-expression</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>の場合、それはImenuにたいして定義を探すための正規表現を指定するリストである。シンプルな<code class="literal">imenu-generic-expression</code>の要素は、以下のようになる:
</p><pre class="screen">(<em class="replaceable"><code>menu-title</code></em> <em class="replaceable"><code>regexp</code></em> <em class="replaceable"><code>index</code></em>)
</pre><p>ここで、<em class="replaceable"><code>menu-title</code></em>が非<code class="literal">nil</code>の場合、それはこの要素にたいするマッチが、バッファーインデックスのサブメニューとなることを告げる。<em class="replaceable"><code>menu-title</code></em>自体は、そのサブメニューにたいして名前を指定する。<em class="replaceable"><code>menu-title</code></em>が<code class="literal">nil</code>,の場合は、この要素にたいするマッチは、直接トップレベルのバッファーインデックスとなる。
</p><p>このリストの2つ目の要素<em class="replaceable"><code>regexp</code></em>は、正規表現である(<a class="link" href="ch34s03.html" title="Regular Expressions">Regular
Expressions</a>を参照)。これは、バッファー内でこれにマッチするものは定義、あるいはバッファーインデックス内に記載すべき何かであると判断される。3つ目の要素<em class="replaceable"><code>index</code></em>は、0以上の整数の場合は、<em class="replaceable"><code>regexp</code></em>内の部分式(subexpression)が定義名にマッチすることを示します。
</p><p>以下のような要素もある:
</p><pre class="screen">(<em class="replaceable"><code>menu-title</code></em> <em class="replaceable"><code>regexp</code></em> <em class="replaceable"><code>index</code></em> <em class="replaceable"><code>function</code></em> <em class="replaceable"><code>arguments</code></em>…)
</pre><p>この要素にたいする各マッチはインデックスアイテムを作成し、ユーザーによりそのインデックスアイテムが選択されたとき、アイテム名、バッファー位置、および<em class="replaceable"><code>arguments</code></em>から構成される引数で、<em class="replaceable"><code>function</code></em>を呼び出す。
</p><p>Emacs Lispモードにたいしては、<code class="literal">imenu-generic-expression</code>は以下のようになるだろう:
</p><pre class="screen">((nil "^\\s-*(def\\(un\\|subst\\|macro\\|advice\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2)
</pre><pre class="screen"> ("*Vars*" "^\\s-*(def\\(var\\|const\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2)
</pre><pre class="screen"> ("*Types*"
  "^\\s-*\
(def\\(type\\|struct\\|class\\|ine-condition\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2))
</pre><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div><pre class="synopsis"><a id="idm65000144" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-case-fold-search</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、<code class="literal">imenu-generic-expression</code>の値中の正規表現マッチが、大文字小文字を区別するかどうかを制御する。<code class="literal">t</code>,(デフォルト)の場合は、大文字小文字の違いを無視することを意味する。
</p><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div><pre class="synopsis"><a id="idm64983760" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-syntax-alist</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、<code class="literal">imenu-generic-expression</code>処理中に、カレントバッファーの構文テーブルをオーバーライドして使用する、構文テーブル変更用のalistである。このalistの各要素は、以下の形式をもつべきである:
</p><pre class="screen">(<em class="replaceable"><code>characters</code></em> . <em class="replaceable"><code>syntax-description</code></em>)
</pre><p>CARの<em class="replaceable"><code>characters</code></em>には、文字または文字列を指定できる。この要素は、その文字、または文字列が<em class="replaceable"><code>syntax-description</code></em>により指定される構文でありことを示し、<code class="literal">modify-syntax-entry</code>に渡される(<a class="link" href="ch35s03.html" title="Syntax Table Functions">Syntax
Table Functions</a>を参照)。
</p><p>典型的には、この機能は通常はシンボル構文(symbol syntax)をもつ文字にたいして単語構文(word
syntax)を与えるために使用され、それにより<code class="literal">imenu-generic-expression</code>が単純になり、マッチングのスピードも向上する。たとえば、Fortranモードは以下のようにこれを使用する:
</p><pre class="screen">(setq imenu-syntax-alist '(("_$" . "w")))
</pre><p><code class="literal">imenu-generic-expression</code>の正規表現は、‘<code class="literal">\\(\\sw\\|\\s_\\)+</code>’のかわりに、‘<code class="literal">\\sw+</code>’を使用できる。このテクニックは、モードの名前として許されるより短い、頭文字に名前を制限する必要があるときは、不便かもしれないことに注意されたい。
</p><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div><p>あるメジャーモードにたいしてImenuをカスタマイズする別の方法には、<code class="literal">imenu-prev-index-position-function</code>と<code class="literal">imenu-extract-index-name-function</code>があります:
</p><pre class="synopsis"><a id="idm64968016" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-prev-index-position-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>の場合、その値はポイント位置からバッファーを後方にスキャンして、バッファーインデックスに配すべき、次の“定義”を探すための関数であること。そして、ポイントより前に他の“定義”が見つからなければ、<code class="literal">nil</code>をリターンすべきである。見つかった場合は、“definition”を見つけた場所にポイントを残し、任意の非<code class="literal">nil</code>値をリターンすべきである。
</p><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div><pre class="synopsis"><a id="idm64963408" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-extract-index-name-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>の場合、その値はポイントが定義中にある(<code class="literal">imenu-prev-index-position-function</code>関数がポイントを残す場所)という想定の元、その定義の名前をリターンする関数であること。
</p><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div><p>メジャーモードにたいしてImenuをカスタマイズするための最後の方法は、変数<code class="literal">imenu-create-index-function</code>のセットです:
</p><pre class="synopsis"><a id="idm64958416" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">imenu-create-index-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、バッファーインデックスを作成するために使用する関数を指定する。この関数は、引数がをとらず、カレントバッファーにたいするインデックスalist(index
alist)をリターンすべきである。この関数は<code class="literal">save-excursion</code>内で呼び出されるので、どこにポイントを残しても違いはない。
</p><p>このインデックスalistは、3つのタイプの要素をもつことができる。以下は、シンプル要素(simple element)の例である:
</p><pre class="screen">(<em class="replaceable"><code>index-name</code></em> . <em class="replaceable"><code>index-position</code></em>)
</pre><p>シンプル要素の選択は、そのバッファー内の位置<em class="replaceable"><code>index-position</code></em>に移動する効果をもつ。スペシャル要素(special
element)は、以下のようなものである:
</p><pre class="screen">(<em class="replaceable"><code>index-name</code></em> <em class="replaceable"><code>index-position</code></em> <em class="replaceable"><code>function</code></em> <em class="replaceable"><code>arguments</code></em>…)
</pre><p>スペシャル要素の選択により、以下が処理される:
</p><pre class="screen">(funcall <em class="replaceable"><code>function</code></em>
         <em class="replaceable"><code>index-name</code></em> <em class="replaceable"><code>index-position</code></em> <em class="replaceable"><code>arguments</code></em>…)
</pre><p>ネストされたサブalist要素(nested sub-alist element)は、以下のようなものである:
</p><pre class="screen">(<em class="replaceable"><code>menu-title</code></em> . <em class="replaceable"><code>sub-alist</code></em>)
</pre><p>これは、<em class="replaceable"><code>sub-alist</code></em>により指定される、サブメニュー<em class="replaceable"><code>menu-title</code></em>を作成する。
</p><p><code class="literal">imenu-create-index-function</code>のデフォルト値は、<code class="literal">imenu-default-create-index-function</code>である。この関数は、インデックスalistを生成するために、<code class="literal">imenu-prev-index-position-function</code>の値と、<code class="literal">imenu-extract-index-name-function</code>の値を呼び出す。しかし、これら2つ変数のいずれかが<code class="literal">nil</code>の場合、デフォルト関数はかわりに<code class="literal">imenu-generic-expression</code>を使用する。
</p><p>この変数をセットすることにより、カレントバッファーにたいしてバッファーローカルになる。
</p></blockquote></div></div></body></html>