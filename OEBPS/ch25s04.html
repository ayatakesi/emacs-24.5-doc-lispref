<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Writing to Files</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Writing-to-Files"/>Writing to Files</h1></div></div></div><a id="idm63486544" class="indexterm"/><p>関数<code class="literal">append-to-file</code>および<code class="literal">write-region</code>を使用することにより、ディスク上のファイルに直接、バッファーのコンテンツ、またはバッファーの一部を書き込むことができます。visitされているファイルに書き込むために、これらの関数を使用しないでください。これにより、visitにたいするメカニズムが混乱するかもしれません。
</p><pre class="synopsis"><a id="idm63484112" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">append-to-file</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>filename</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファー内で、<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>によるリージョンのコンテンツを、ファイル<em class="replaceable"><code>filename</code></em>の終端に追加する。そのファイルが存在しない場合は作成する。この関数は<code class="literal">nil</code>をリターンする。
</p><p><em class="replaceable"><code>filename</code></em>に書込不可能なファイル、またはファイルを作成不可なディレクトリー内の存在しないファイルを指定した場合は、エラーがシグナルされる。
</p><p>Lispから呼び出した場合、この関数は以下と完全に等価である:
</p><pre class="screen">(write-region start end filename t)
</pre></blockquote></div><pre class="synopsis"><a id="idm63476944" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">write-region</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>append</code></em> <em class="replaceable"><code>visit</code></em> <em class="replaceable"><code>lockname</code></em> <em class="replaceable"><code>mustbenew</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファー内の<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>で区切られたリージョンを、<em class="replaceable"><code>filename</code></em>で指定されたファイルに書き込む。
</p><p><em class="replaceable"><code>start</code></em>が<code class="literal">nil</code>の場合、このコマンドはバッファーのコンテンツ全体(アクセス可能な範囲だけでは<span class="emphasis"><em>ない</em></span>)をファイルに書き込み、<em class="replaceable"><code>end</code></em>は無視する。
</p><p><em class="replaceable"><code>start</code></em>が文字列の場合、<code class="literal">write-region</code>はバッファーのテキストではなく、その文字列を追加する。その場合、<em class="replaceable"><code>end</code></em>は無視される。
</p><p><em class="replaceable"><code>append</code></em>が非<code class="literal">nil</code>の場合は、指定されたテキストが(もしあれば)既存のファイルコンテンツに追加される。<em class="replaceable"><code>append</code></em>が数字の場合、<code class="literal">write-region</code>はファイル開始位置からそのバイトオフセットをseekして、データをそこに書き込む。
</p><p><em class="replaceable"><code>mustbenew</code></em>が非<code class="literal">nil</code>の場合、<code class="literal">write-region</code>はもし<em class="replaceable"><code>filename</code></em>が既存ファイルの名前なら確認を求める。<em class="replaceable"><code>mustbenew</code></em>がシンボル<code class="literal">excl</code>なら、ファイルがすでに存在する場合は<code class="literal">write-region</code>は確認を求めるかわりに、エラー<code class="literal">file-already-exists</code>をシグナルする。
</p><p><em class="replaceable"><code>mustbenew</code></em>が<code class="literal">excl</code>のときは、存在するファイルのテストに特別なシステム機能を使用する。少なくともローカルディスク上のファイルにたいしては、Emacsがファイルを作成する前に、Emacsに通知せずに他のプログラムが同じ名前のファイルを作成することはありえない。
</p><p><em class="replaceable"><code>visit</code></em>が<code class="literal">t</code>の場合、Emacsはバッファーとファイルの関連付けを設定し、そのバッファーがそのファイルをvictimする。また、カレントバッファーにたいする最終ファイル変更日時に<em class="replaceable"><code>filename</code></em>をセットして、そのバッファーを未変更としてマークする。この機能は<code class="literal">save-buffer</code>により使用されるが、おそらくあなた自身が使用するべきではないだろう。
</p><p><em class="replaceable"><code>visit</code></em>が文字列の場合、それはvisitするファイルの名前を指定する。この方法を使えば、そのバッファーが別のファイルをvisitしていると記録しつつ、１つのファイル(<em class="replaceable"><code>filename</code></em>)にデータを書き込むことができる。引数<em class="replaceable"><code>visit</code></em>は、エコーエリアに使用される他に、ファイルのロックにも使用され、<em class="replaceable"><code>visit</code></em>が<code class="literal">buffer-file-name</code>に格納される。この機能は、<code class="literal">file-precious-flag</code>の実装に使用される。自分が何をしているか本当にわかっているのでなければ、これを使用してはならない。
</p><p>オプション引数<em class="replaceable"><code>lockname</code></em>が非<code class="literal">nil</code>の場合、それはロックとアンロックの目的に使用する、<em class="replaceable"><code>filename</code></em>および<em class="replaceable"><code>visit</code></em>をオーバーライドするファイル名を指定する。
</p><p>関数<code class="literal">write-region</code>は、書き込むデータを<code class="literal">buffer-file-format</code>により指定される、適切なファイルフォーマットに変換しするとともに、リスト<code class="literal">write-region-annotate-functions</code>内の関数の呼び出しも行う。<a class="link" href="ch25s12.html" title="File Format Conversion">Format
Conversion</a>を参照のこと。
</p><p>通常、<code class="literal">write-region</code>はエコーエリア内にメッセージ‘<code class="literal">Wrote
<em class="replaceable"><code>filename</code></em></code>’を表示する。<em class="replaceable"><code>visit</code></em>が<code class="literal">t</code>、<code class="literal">nil</code>、文字列のいずれでもない場合、このメッセージは抑制される。この機能は、内部的な目的のために、ユーザーが知る必要がないファイルを使用する場合に有用である。
</p></blockquote></div><pre class="synopsis"><a id="idm63441872" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">with-temp-file</code> <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>body</code></em><em class="replaceable"><code>…</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="Definition-of-with_002dtemp_002dfile"/><p><code class="literal">with-temp-file</code>マクロは、一時バッファー(temporary
buffer)をカレントバッファーとして<em class="replaceable"><code>body</code></em>フォームを評価して、最後にそのバッファーのコンテンツを<em class="replaceable"><code>file</code></em>に書き込む。これは終了時に一時バッファーをkillして、<code class="literal">with-temp-file</code>フォームの前にカレントだったバッファーをリストアする。その後、<em class="replaceable"><code>body</code></em>内の最後のフォームの値をリターンする。
</p><p><code class="literal">throw</code>やエラーによる異常なexit(abnormal exit)でも、カレントバッファーはリストアされる(<a class="link" href="ch11s05.html" title="Nonlocal Exits">Nonlocal
Exits</a>を参照)。
</p><p><a class="link" href="ch27s02.html#Definition-of-with_002dtemp_002dbuffer">The Current
Buffer</a>の<code class="literal">with-temp-buffer</code>も参照のこと。
</p></blockquote></div></div></body></html>