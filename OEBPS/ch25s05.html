<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>File Locks</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="File-Locks"/>File Locks</h1></div></div></div><a id="idm63420112" class="indexterm"/><a id="idm63419344" class="indexterm"/><p>2人のユーザーが同時に同じファイルを編集する際、おそらく彼らは互いに干渉しあうでしょう。Emacsは、ファイルが変更される際に<em class="firstterm">ファイルロック(file
lock)</em>を記録することにより、このような状況の発生を防ぎます。そして、Emacsは他のEmacsジョブにロックされているファイルをvisitしているバッファーへの変更の最初の試みを検知して、ユーザーに何を行うか尋ねます。このファイルロックの実態は、編集中のファイルと同じディレクトリーに格納される、特別な名前をもつシンボリックリンクです(シンボリックリンクをサポートしないファイルシステムでは、通常のファイルが使用される)。
</p><p>ファイルのアクセスにNFSを使用する際には、可能性は小さいものの、他のユーザーと同じファイルを“同時”にロックするかもしれません。これが発生した場合、2人のユーザーが同時にファイルを変更することが可能になりますが、それでもEmacsは2番目に保存するユーザーにたいして警告を発するでしょう。たファイルをvisitしているバッファーで、ディスク上でファイル変更の検知により、ある種の同時編集を捕捉できます。<a class="link" href="ch27s06.html" title="Buffer Modification Time">Modification
Time</a>を参照してください。
</p><pre class="synopsis"><a id="idm63416656" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">file-locked-p</code> <em class="replaceable"><code>filename</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、ファイル<em class="replaceable"><code>filename</code></em>がロックされていなければ<code class="literal">nil</code>をリターンする。このEmacsプロセスによりロックされている場合は<code class="literal">t</code>をリターンし、他のEmacsジョブによりロックされている場合はロックしたユーザーの名前をリターンする。
</p><pre class="screen">(file-locked-p "foo")
     ⇒ nil
</pre></blockquote></div><pre class="synopsis"><a id="idm63411536" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">lock-buffer</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>filename</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーが変更されている場合は、ファイル<em class="replaceable"><code>filename</code></em>をロックする。引数<em class="replaceable"><code>filename</code></em>のデフォルトは、カレントバッファーがvisitしているファイルである。カレントバッファーがファイルをvisitしていない、またはバッファーが変更されていない、またはシステムがロックをサポートしない場合は、何もしない。
</p></blockquote></div><pre class="synopsis"><a id="idm63407184" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">unlock-buffer</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーが変更されている場合は、バッファーによりvisitされているファイルをアンロックする。バッファーが変更されていない場合は、そのファイルはロックされてはならないので、この関数は何もしない。カレントバッファーがファイルをvisitしていない、またはシステムがロックをサポートしない場合、この関数は何もしない。
</p></blockquote></div><pre class="synopsis"><a id="idm63404368" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">create-lockfiles</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が<code class="literal">nil</code>の場合、Emacsはファイルをロックしない。
</p></blockquote></div><pre class="synopsis"><a id="idm63401168" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">ask-user-about-lock</code> <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>other-user</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、ユーザーが<em class="replaceable"><code>file</code></em>の変更を試みたが、それが名前<em class="replaceable"><code>other-user</code></em>のユーザーにロックされていたとき呼び出される。この関数のデフォルト定義は、何を行うかユーザーに尋ねる関数である。この関数がリターンする値は、Emacsが次に何を行うかを決定する:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>値<code class="literal">t</code>は、そのファイルのロックを奪うことを意味する。その場合、<em class="replaceable"><code>other-user</code></em>はロックを失い、このユーザーがファイルを編集することができる。
</p></li><li class="listitem"><p>値<code class="literal">nil</code>は、ロックを無視して、とにかくユーザーがファイルを編集できるようにすることを意味する。
</p></li><li class="listitem"><a id="idm63394384" class="indexterm"/><p>この関数は、かわりにエラー<code class="literal">file-locked</code>をシグナルする。この場合、ユーザーが行おうとしていた変更は行われない。
</p><p>このエラーにたいするエラーメッセージは、以下のようになる:
</p><pre class="screen">error→ File is locked: <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>other-user</code></em>
</pre><p>ここで、<code class="literal">file</code>はファイル名、<em class="replaceable"><code>other-user</code></em>はそのファイルのロックを所有するユーザーの名前である。
</p></li></ul></div><p>望むなら、他の方法で判定を行う独自のバージョンで、<code class="literal">ask-user-about-lock</code>関数を置き換えることができる。
</p></blockquote></div></div></body></html>