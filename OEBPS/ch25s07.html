<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Changing File Names and Attributes</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Changing-Files"/>Changing File Names and Attributes</h1></div></div></div><a id="idm67133648" class="indexterm"/><a id="idm67132880" class="indexterm"/><a id="idm67132112" class="indexterm"/><a id="idm67131344" class="indexterm"/><p>このセクションの関数は、ファイルのリネーム(rename:
改名)、コピー、削除(delete)、リンク、およびモード(パーミッション)のセットを行います。
</p><p><em class="replaceable"><code>newname</code></em>という引数をもつ関数では、<em class="replaceable"><code>newname</code></em>という名前のファイルが既に存在する場合の振る舞いは、引数<em class="replaceable"><code>ok-if-already-exists</code></em>の値に依存します。
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><em class="replaceable"><code>ok-if-already-exists</code></em>が<code class="literal">nil</code>の場合は、<code class="literal">file-already-exists</code>エラーがシグナルされる。
</p></li><li class="listitem"><p><em class="replaceable"><code>ok-if-already-exists</code></em>が数字の場合は、確認を求める。
</p></li><li class="listitem"><p><em class="replaceable"><code>ok-if-already-exists</code></em>が他の値の場合は、確認なしで古いファイルを置き換える。
</p></li></ul></div><p>以下の4つのコマンドはすべて、1つ目の引数にたいして親ディレクトリーの全階層のシンボリックリンクを再帰的にフォローしますが、その引数自体がシンボリックリンクの場合は、<code class="literal">copy-file</code>だけが(再帰的な)ターゲットを置き換えます。
</p><pre class="synopsis"><a id="idm67124176" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">add-name-to-file</code> <em class="replaceable"><code>oldname</code></em> <em class="replaceable"><code>newname</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>ok-if-already-exists</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm67120464" class="indexterm"/><a id="idm67119696" class="indexterm"/><p>この関数は、<em class="replaceable"><code>oldname</code></em>という名前のファイルに、<em class="replaceable"><code>newname</code></em>という名前を追加で与える。これは<em class="replaceable"><code>newname</code></em>という名前が、<em class="replaceable"><code>oldname</code></em>にたいする新たな“ハードリンク”になることを意味する。
</p><p>以下の例の最初の部分として、2つのファイル<code class="filename">foo</code>と<code class="filename">foo3</code>をリストする。
</p><pre class="screen">$ ls -li fo*
81908 -rw-rw-rw- 1 rms rms 29 Aug 18 20:32 foo
84302 -rw-rw-rw- 1 rms rms 24 Aug 18 20:31 foo3
</pre><p>ここで、<code class="literal">add-name-to-file</code>を呼び出してハードリンクを作成し、再度ファイルをリストする。このリストには、1つのファイルにたいして2つの名前<code class="filename">foo</code>と<code class="filename">foo2</code>が表示される。
</p><pre class="screen">(add-name-to-file "foo" "foo2")
     ⇒ nil
</pre><pre class="screen">
</pre><pre class="screen">$ ls -li fo*
81908 -rw-rw-rw- 2 rms rms 29 Aug 18 20:32 foo
81908 -rw-rw-rw- 2 rms rms 29 Aug 18 20:32 foo2
84302 -rw-rw-rw- 1 rms rms 24 Aug 18 20:31 foo3
</pre><p>最後に以下を評価する:
</p><pre class="screen">(add-name-to-file "foo" "foo3" t)
</pre><p>そして、ファイルを再度リストする。今度は1つのファイルにたいして3つの名前<code class="filename">foo</code>、<code class="filename">foo2</code>、<code class="filename">foo3</code>がある。<code class="filename">foo3</code>の古いコンテンツは失われた。
</p><pre class="screen">(add-name-to-file "foo1" "foo3")
     ⇒ nil
</pre><pre class="screen">
</pre><pre class="screen">$ ls -li fo*
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo2
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo3
</pre><p>この関数は、1つのファイルにたいして複数の名前をもつことが許されないオペレーティングシステムでは無意味である。いくつかのシステムでは、かわりにファイルをコピーすることにより複数の名前を実装している。
</p><p><a class="link" href="ch25s06.html#File-Attributes" title="File Attributes">File Attributes</a>の<code class="literal">file-nlinks</code>も参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm67093072" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">rename-file</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>newname</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>ok-if-already-exists</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドは、<em class="replaceable"><code>filename</code></em>を<em class="replaceable"><code>newname</code></em>にリネームする。
</p><p><em class="replaceable"><code>filename</code></em>が<em class="replaceable"><code>filename</code></em>とは別に追加の名前をもつ場合、それらは自身の名前をもち続ける。実際のところ、<code class="literal">add-name-to-file</code>で名前<em class="replaceable"><code>newname</code></em>を追加してから<em class="replaceable"><code>filename</code></em>を削除するのは、瞬間的な遷移状態を別とすると、リネームと同じ効果がある。
</p></blockquote></div><pre class="synopsis"><a id="idm67085520" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">copy-file</code> <em class="replaceable"><code>oldname</code></em> <em class="replaceable"><code>newname</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>ok-if-exists</code></em> <em class="replaceable"><code>time</code></em> <em class="replaceable"><code>preserve-uid-gid</code></em> <em class="replaceable"><code>preserve-extended-attributes</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドは、ファイル<em class="replaceable"><code>oldname</code></em>を<em class="replaceable"><code>newname</code></em>にコピーする。<em class="replaceable"><code>oldname</code></em>が存在しない場合は、エラーをシグナルする。<em class="replaceable"><code>newname</code></em>がディレクトリーの場合は、その最後の名前コンポーネントを保持するように、そのディレクトリーの中に<em class="replaceable"><code>oldname</code></em>をコピーする。
</p><p><em class="replaceable"><code>time</code></em>が非<code class="literal">nil</code>の場合、この関数は新たなファイルにたいして、古いファイルと同じ最終変更時刻を与える(これはいくつかの限られたオペレーティングシステムでのみ機能する)。時刻のセットでエラーが発生した場合、<code class="literal">copy-file</code>は<code class="literal">file-date-error</code>エラーをシグナルする。インタラクティブに呼び出された場合、プレフィックス引数は<em class="replaceable"><code>time</code></em>にたいして非<code class="literal">nil</code>値を指定する。
</p><p>引数<em class="replaceable"><code>preserve-uid-gid</code></em>が<code class="literal">nil</code>の場合は、新たなファイルのユーザーおよびグループの所有権の決定を、オペレーティングシステムに委ねる(通常はEmacsを実行中のユーザーである)。<em class="replaceable"><code>preserve-uid-gid</code></em>が非<code class="literal">nil</code>の場合は、そのファイルのユーザーとグループの所有権のコピーを試みる。これはいくつかのオペレーティングシステムで、かつそれを行うための正しいパーミッションをもつ場合のみ機能する。
</p><p>オプション引数<em class="replaceable"><code>preserve-permissions</code></em>が非<code class="literal">nil</code>の場合、この関数は<em class="replaceable"><code>oldname</code></em>のファイルモード(または“パーミッション”)、同様にACL(Access
Control List)とSELinuxコンテキストを<em class="replaceable"><code>newname</code></em>にコピーする。<a class="link" href="ch25s06.html" title="Information about Files">Information about
Files</a>を参照のこと。
</p><p>それ以外では、<em class="replaceable"><code>newname</code></em>が既存ファイルならファイルモードは変更されず、新たに作成された場合はデフォルトのファイルパーミッション(以下の<code class="literal">set-default-file-modes</code>を参照)によりマスクされる。どちらの場合も、ACLまたはSELinuxコンテキストはコピーされない。
</p></blockquote></div><pre class="synopsis"><a id="idm67068880" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">make-symbolic-link</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>newname</code></em>  <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>ok-if-exists</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm67065168" class="indexterm"/><a id="idm67064400" class="indexterm"/><p>このコマンドは、<em class="replaceable"><code>filename</code></em>にたいして<em class="replaceable"><code>newname</code></em>という名前のシンボリックリンクを作成する。これは、コマンド‘<code class="literal">ln
-s <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>newname</code></em></code>’と似ている。
</p><p>この関数は、シンボリックリンクをサポートしないシステムでは利用できない。
</p></blockquote></div><a id="idm67060944" class="indexterm"/><a id="idm67060176" class="indexterm"/><pre class="synopsis"><a id="idm67059152" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">delete-file</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>trash</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm67055824" class="indexterm"/><p>このコマンドは、ファイル<em class="replaceable"><code>filename</code></em>を削除する。ファイルが複数の名前をもつ場合は、他の名前で存在し続ける。<em class="replaceable"><code>filename</code></em>がシンボリックリンクの場合、<code class="literal">delete-file</code>はシンボリックリンクだけを削除して、(たとえこれが親ディレクトリーの全階層のシンボリックリンクをフォローするとしても)ターゲットは削除しない。
</p><p>ファイルが存在しない、または削除できない場合は、適切な種類の<code class="literal">file-error</code>エラーがシグナルされる(UnixおよびGNU/Linuxでは、ファイルのディレクトリーが書き込み可能ならファイルは削除可能である)。
</p><p>オプション引数<em class="replaceable"><code>trash</code></em>が非<code class="literal">nil</code>、かつ変数<code class="literal">delete-by-moving-to-trash</code>が非<code class="literal">nil</code>の場合、このコマンドはファイルを削除するかわりに、システムのTrash(ゴミ箱)にファイルを移動する。section “Miscellaneous File Operations” in <em class="citetitle">The GNU Emacs
Manual</em>を参照のこと。インタラクティブに呼び出された際は、プレフィックス引数がない場合<em class="replaceable"><code>trash</code></em>は<code class="literal">t</code>、それ以外は<code class="literal">nil</code>である。
</p><p><a class="link" href="ch25s10.html" title="Creating, Copying and Deleting Directories">Create/Delete Dirs</a>の<code class="literal">delete-directory</code>も参照のこと。
</p></blockquote></div><a id="idm67046992" class="indexterm"/><a id="idm67046224" class="indexterm"/><a id="idm67045456" class="indexterm"/><pre class="synopsis"><a id="idm67044432" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">set-file-modes</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>mode</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>filename</code></em>の<em class="firstterm">ファイルモード</em>(または<em class="firstterm">パーミッション</em>)を<em class="replaceable"><code>mode</code></em>にセットする。この関数は、<em class="replaceable"><code>filename</code></em>にたいして全階層でシンボリックリンクをフォローする。
</p><p>非インタラクティブに呼び出された場合、<em class="replaceable"><code>mode</code></em>は整数でなければならない。その整数の下位12ビットだけが使用される。ほとんどのシステムでは、意味があるのは下位9ビットだけである。<em class="replaceable"><code>mode</code></em>を入力刷る、Lisp構文を使用できる。たとえば、
</p><pre class="screen">(set-file-modes #o644)
</pre><p>これは、そのファイルが所有者により読み取りと書き込み、グループメンバーにより読み取り、その他のユーザーにより読み取り可能であることを指定する。モードビットの仕様の説明は、section “File
permissions” in <em class="citetitle">The GNU <code class="literal">Coreutils</code> Manual</em>を参照のこと。
</p><p>インタラクティブに呼び出された場合、<em class="replaceable"><code>mode</code></em>は<code class="literal">read-file-modes</code>(以下参照)を使用してミニバッファーから読み取られる。この場合、ユーザーは整数、またはパーミッションをシンボルで表現する文字列をタイプできる。
</p><p>ファイルのパーミッションをリターンする関数<code class="literal">file-modes</code>については、<a class="link" href="ch25s06.html#File-Attributes" title="File Attributes">File Attributes</a>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm67033296" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-default-file-modes</code> <em class="replaceable"><code>mode</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm67030736" class="indexterm"/><p>この関数は、EmacsおよびEmacsのサブプロセスが新たに作成するファイルに、デフォルトのパーミッションをセットする。Emacsにより作成されたすべてのファイルはこれらのパーミッション、およびそれらのサブセットとなるパーミッションをもつ(デフォルトファイルパーミッションが実行を許可しても、<code class="literal">write-region</code>は実行パーミッションを付与しないだろう)。UnixおよびGNU/Linuxでは、デフォルトのパーミッションは“umask”の値のビット単位の補数で与えられる。
</p><p>引数<em class="replaceable"><code>mode</code></em>は上記の<code class="literal">set-file-modes</code>と同様、パーミッションを指定する整数であること。下位9ビットだけに意味がある。
</p><p>デフォルトのファイルパーミッションは、既存ファイルの変更されたバージョンを保存する際は効果がない。ファイルの保存では、既存のパーミッションが保持される。
</p></blockquote></div><pre class="synopsis"><a id="idm67027024" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">default-file-modes</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、デフォルトのファイルモードを整数でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm67024208" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">read-file-modes</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>prompt</code></em> <em class="replaceable"><code>base-file</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、ミニバッファーからファイルモードビットのセットを読み取る。1つ目のオプション引数<em class="replaceable"><code>prompt</code></em>は非デフォルトのプロンプトを指定する。2つ目のオプション引数<em class="replaceable"><code>base-file</code></em>は、ユーザーが既存ファイルのパーミッションに相対的なモードビット指定をタイプした場合に、この関数がリターンするモードビッの元となる権限をもつファイルの名前を指定する。
</p><p>ユーザー入力が8進数で表される場合、この関数はその数字をリターンする。それが<code class="literal">"u=rwx"</code>のようなモードビットの完全なシンボル指定の場合、この関数は<code class="literal">file-modes-symbolic-to-number</code>を使用して、それを等価な数字に変換し、結果をリターンする。<code class="literal">"o+g"</code>のように相対的な指定の場合、その指定の元となるパーミッションは、<em class="replaceable"><code>base-file</code></em>のモードビットから取得される。<em class="replaceable"><code>base-file</code></em>が省略、または<code class="literal">nil</code>の場合、この関数は元となるモードビットとして<code class="literal">0</code>を使用する。完全指定および相対指定は、<code class="literal">"u+r,g+rx,o+r,g-w"</code>のように組み合わせることができる。ファイルモード指定の説明は、section “File
permissions” in <em class="citetitle">The GNU <code class="literal">Coreutils</code> Manual</em>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm67014224" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">file-modes-symbolic-to-number</code> <em class="replaceable"><code>modes</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>base-modes</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>modes</code></em>内のシンボルによるファイルモード指定を、等価な整数に変換する。シンボル指定が既存ファイルにもとづく場合は、オプション引数<em class="replaceable"><code>base-modes</code></em>からそのファイルのモードビットが取得される。その引数が省略、または<code class="literal">nil</code>の場合は、0(すべてのアクセスが許可されない)がデフォルトになる。
</p></blockquote></div><pre class="synopsis"><a id="idm67008976" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-file-times</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>time</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>filename</code></em>のアクセス時刻と変更時刻を<em class="replaceable"><code>time</code></em>にセットする。時刻が正しくセットされれば<code class="literal">t</code>、それ以外は<code class="literal">nil</code>がリターン値となる。<em class="replaceable"><code>time</code></em>のデフォルトはカレント時刻であり、<code class="literal">current-time</code>がリターンするフォーマットでなければならない(<a class="link" href="ch39s05.html" title="Time of Day">Time
of Day</a>を参照)。
</p></blockquote></div><pre class="synopsis"><a id="idm66989520" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-file-extended-attributes</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>attribute-alist</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<code class="literal">filename</code>にたいしてEmacsが認識する拡張ファイル属性をセットする。2つ目の引数<em class="replaceable"><code>attribute-alist</code></em>は、<code class="literal">file-extended-attributes</code>がリターンするalistと同じ形式であること。<a class="link" href="ch25s06.html#Extended-Attributes" title="Extended File Attributes">Extended
Attributes</a>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm66984016" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-file-selinux-context</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>context</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>filename</code></em>にたいするSELinuxセキュリティコンテキストに<em class="replaceable"><code>context</code></em>をセットする。<em class="replaceable"><code>context</code></em>引数は、各要素が文字列であるような<code class="literal">(<em class="replaceable"><code>user</code></em>
<em class="replaceable"><code>role</code></em> <em class="replaceable"><code>type</code></em> <em class="replaceable"><code>range</code></em>)</code>というリストであること。<a class="link" href="ch25s06.html#Extended-Attributes" title="Extended File Attributes">Extended
Attributes</a>を参照されたい。
</p><p>この関数は、<em class="replaceable"><code>filename</code></em>のSELinuxコンテキストのセットに成功した場合は<code class="literal">t</code>をリターンする。コンテキストがセットされなかった場合(SELinuxが無効、またはEmacsがSELinuxサポートなしでコンパイルされた場合等)は、<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm66970832" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-file-acl</code> <em class="replaceable"><code>filename</code></em> <em class="replaceable"><code>acl</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>filename</code></em>にたいするACLに<em class="replaceable"><code>acl</code></em>をセットする。<em class="replaceable"><code>acl</code></em>引数は、関数<code class="literal">file-acl</code>がリターンするのと同じ形式であること。<a class="link" href="ch25s06.html#Extended-Attributes" title="Extended File Attributes">Extended
Attributes</a>を参照されたい。
</p><p>この関数は<em class="replaceable"><code>filename</code></em>のACLのセットに成功したら<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をリターンする。
</p></blockquote></div></div></body></html>