<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Reverting</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Reverting"/>Reverting</h1></div></div></div><a id="idm65875792" class="indexterm"/><p>あるファイルにたいして大きな変更を行った後、気が変わって元に戻したくなった場合は、<code class="literal">revert-buffer</code>コマンドでそのファイルの以前のバージョンを読み込むことにより、それらの変更を取り消すことができます。詳細は、section “Reverting a Buffer” in <em class="citetitle">The GNU Emacs Manual</em>を参照してください。
</p><pre class="synopsis"><a id="idm65873360" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">revert-buffer</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>ignore-auto</code></em> <em class="replaceable"><code>noconfirm</code></em> <em class="replaceable"><code>preserve-modes</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドは、バージョンのテキストを、ディスク上のvisitされているファイルのテキストで置き換える。これにより、ファイルがvisit、または保存された以降に行ったすべての変更は、アンドゥ(undo:
取り消し)される。
</p><p>デフォルトでは、もっとも最近のauto-saveファイルのほうがvisitされているファイルより新しく、かつ引数<em class="replaceable"><code>ignore-auto</code></em>が<code class="literal">nil</code>の場合、<code class="literal">revert-buffer</code>はユーザーにたいしてかわりにauto-saveファイルを使用するかどうか確認を求める。このコマンドをinteractiveに呼び出したとき、プレフィックス数引数が指定されていなければ、<em class="replaceable"><code>ignore-auto</code></em>は<code class="literal">t</code>となる。つまり、interactive呼び出しは、デフォルトではauto-saveファイルのチェックを行わない。
</p><p><code class="literal">revert-buffer</code>は通常、バッファーを変更する前に確認を求める。しかし、引数<em class="replaceable"><code>noconfirm</code></em>が非<code class="literal">nil</code>の場合、<code class="literal">revert-buffer</code>は確認を求めない。
</p><p>このコマンドは通常、<code class="literal">normal-mode</code>を使用することにより、そのバッファーのメジャーモードとマイナーモードを再初期化する。しかし、<em class="replaceable"><code>preserve-modes</code></em>が非<code class="literal">nil</code>の場合、モードは変更されずに残る。
</p><p>リバート(revert:
戻す、復元する)は、<code class="literal">insert-file-contents</code>の置き換え機能を使用することにより、バッファー内のマーカー位置の保持を試みる。バッファーのコンテンツとファイルのコンテンツがリバート操作を行う前に等しい場合、リバートはすべてのマーカーを保持する。等しくない場合、リバートによりバッファーは変更される。この場合は、(もしあれば)バッファーの最初と最後にある未変更のテキスト内にあるマーカーは保持される。他のマーカーを保持しても、それらは正しくないだろう。
</p></blockquote></div><pre class="synopsis"><a id="idm65849168" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">revert-buffer-in-progress-p</code></pre><div class="blockquote"><blockquote class="blockquote"><p><code class="literal">revert-buffer</code>は処理を行っている間、この変数を非<code class="literal">nil</code>値にバインドする。
</p></blockquote></div><p>このセクションの残りの部分で説明する変数をセットすることにより、<code class="literal">revert-buffer</code>が処理を行う方法をカスタマイズできます。
</p><pre class="synopsis"><a id="idm65844688" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">revert-without-query</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、問い合わせなしでリバートされるべきファイルのリストを保持する。値は、正規表現のリスト。visitされているファイルの名前がこれらの正規表現のいずれかにマッチし、かつバッファーが未変更だがディスク上のファイルは変更されている場合、<code class="literal">revert-buffer</code>はユーザーに確認を求めることなく、ファイルをリバートする。
</p></blockquote></div><p>メジャーモードのいくつかは、以下の変数をローカルにバインドすることにより、<code class="literal">revert-buffer</code>をカスタマイズします:
</p><pre class="synopsis"><a id="idm65840592" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">revert-buffer-function</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="Definition-of-revert_002dbuffer_002dfunction"/><p>この変数の値は、そのバッファーをリバートするために使用する関数である。これはリバート処理を行うための、2つのオプション引数をとる関数であること。2つのオプション引数<em class="replaceable"><code>ignore-auto</code></em>と<em class="replaceable"><code>noconfirm</code></em>は、<code class="literal">revert-buffer</code>が受け取る引数である。
</p><p>Diredモードのような、編集されるテキストにファイルのコンテンツは含まれず、他の方式により再生成され得るモードは、この変数のバッファーローカル値に、コンテンツを再生成する特別な関数を与えることができる。
</p></blockquote></div><pre class="synopsis"><a id="idm65823696" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">revert-buffer-insert-file-contents-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、そのバッファーをリバートする際に、更新されたコンテンツの挿入に使用される関数を指定する。その関数は、2つの引数をとる。1つ目は使用するファイル名で、2つ目が<code class="literal">t</code>ならユーザーはauto-saveファイルの読み込みにたいして確認を求められる。
</p><p><code class="literal">revert-buffer-function</code>のかわりにこの変数をモードが変更する理由は、<code class="literal">revert-buffer</code>が行残りの処理(ユーザーへの確認、アンドゥリストのクリアー、適切なメジャーモードの決定、以下のフックの実行)にたいする重複や置き換えを避けるためである。
</p></blockquote></div><pre class="synopsis"><a id="idm65819216" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">before-revert-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、変更されたコンテンツを挿入する前に、デフォルトの<code class="literal">revert-buffer-function</code>により実行される。カスタマイズした<code class="literal">revert-buffer-function</code>は、このフックを実行するかどうか判らない。
</p></blockquote></div><pre class="synopsis"><a id="idm65815504" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">after-revert-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、変更されたコンテンツを挿入した後に、デフォルトの<code class="literal">revert-buffer-function</code>により実行される。カスタマイズした<code class="literal">revert-buffer-function</code>は、このフックを実行するかどうか判らない。
</p></blockquote></div><pre class="synopsis"><a id="idm65811536" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">buffer-stale-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、バッファーがリバートを要するかどうかをチェックするために呼び出される関数を指定する。デフォルト値は、修正時刻をチェックすることにより、ファイルをvisitするバッファーだけを処理する。ファイルをvisitしないバッファーには、カスタム関数が必要になる
(を参照)。
</p></blockquote></div></div></body></html>