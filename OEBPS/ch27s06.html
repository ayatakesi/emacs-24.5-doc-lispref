<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Buffer Modification Time</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Modification-Time"/>Buffer Modification Time</h1></div></div></div><a id="idm65518288" class="indexterm"/><a id="idm65517520" class="indexterm"/><p>あるファイルをvisitして、そのバッファー内で変更を行って、その一方ではディスク上でファイル自身が変更されたとします。この時点でバッファーを保存すると、ファイル内の変更は上書きされるでしょう。これが正に望んでいる動作のときもありますが、通常は有用な情報が失われてしまいます。したがって、Emacsはファイルを保存する前に、以下で説明する関数を使用して、ファイルの変更時刻をチェックします(ファイルの変更時刻を調べる方法は、<a class="link" href="ch25s06.html#File-Attributes" title="File Attributes">File
Attributes</a>を参照)。
</p><pre class="synopsis"><a id="idm65511504" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">verify-visited-file-modtime</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>buffer</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>buffer</code></em>(デフォルトはカレントバッファー)にvisitされているファイルにたいして記録されている変更時刻と、オペレーティングシステムにより記録された実際の変更時刻を比較する。これら2つの時刻は、Emacsがそのファイルをvisit、もしくは保存して以降、他のプロセスにより書き込みがされていなければ、等しくなるはずである。
</p><p>この関数は、実際の最終変更時刻と、Emacsが記録した変更時刻が同じなら<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をリターンする。そのバッファーが記録済みの最終変更時刻をもたない、すなわち<code class="literal">visited-file-modtime</code>が0をリターンするような場合も、<code class="literal">t</code>をリターンする。
</p><p>これは、たとえ<code class="literal">visited-file-modtime</code>が非0の値をリターンしたとしても、ファイルをvisitしていないバッファーにたいしては、常に<code class="literal">t</code>をリターンする。たとえば、diredバッファーにたいして、この関数は常に<code class="literal">t</code>をリターンする。また、存在せず、
以前に存在したこともなかったファイルをvisitするバッファーにたいして<code class="literal">t</code>をリターンするが、visitしているファイルが削除されたバッファーにたいしては<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm65502032" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">clear-visited-file-modtime</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーによりvisitされているファイルの最終変更時刻の記録をクリアーする。結果として、このバッファーにを次回の保存では、ファイルの変更時刻の食い違いは報告されなくなる。
</p><p>この関数は<code class="literal">set-visited-file-name</code>、および変更済みファイルの上書きを防ぐための通常テストを行わない例外的な箇所で呼び出される。
</p></blockquote></div><pre class="synopsis"><a id="idm65498320" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">visited-file-modtime</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーの記録された最終ファイル変更時刻を、<code class="literal">(<em class="replaceable"><code>high</code></em> <em class="replaceable"><code>low</code></em> <em class="replaceable"><code>microsec</code></em>
<em class="replaceable"><code>picosec</code></em>)</code>のような形式のリストでリターンする(これは、<code class="literal">file-attributes</code>が時刻値をリターンするために使用するフォーマットと同じである。<a class="link" href="ch25s06.html#File-Attributes" title="File Attributes">File
Attributes</a>を参照されたい)。
</p><p>バッファーが最終変更時刻の記録をもたない場合、この関数は0をリターンする。これが発生するのは、たとえばバッファーがファイルをvisitしていなかったり、<code class="literal">clear-visited-file-modtime</code>で最終変更時刻が明示的にクリアーされた場合である。しかし<code class="literal">visited-file-modtime</code>は、いくつかの非ファイルバッファーにたいするリストをリターンすることに注意。たとえば、ディレクトリーをリストするDiredバッファーでは、Diredが記録するそのディレクトリーの最終変更時刻がリターンされる。
</p><p>バッファーがファイルをvisitしていない場合、この関数は-1をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm65490640" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-visited-file-modtime</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>time</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バッファーがvisitしているファイルの最終変更時刻の記録を、<em class="replaceable"><code>time</code></em>が非<code class="literal">nil</code>、それ以外はvisitしているファイルの最終変更時刻により更新する。
</p><p><em class="replaceable"><code>time</code></em>が<code class="literal">nil</code>や0でない場合、それは<code class="literal">current-time</code>で使用される形式<code class="literal">(<em class="replaceable"><code>high</code></em>
<em class="replaceable"><code>low</code></em> <em class="replaceable"><code>microsec</code></em> <em class="replaceable"><code>picosec</code></em>)</code>というフォーマットであること(<a class="link" href="ch39s05.html" title="Time of Day">Time of
Day</a>を参照)。
</p><p>この関数は、バッファーが通常のようにファイルから読み取られたものでない場合や、ファイル自身が害のない既知の理由により変更されている場合に有用である。
</p></blockquote></div><pre class="synopsis"><a id="idm65481552" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">ask-user-about-supersession-threat</code> <em class="replaceable"><code>filename</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>これは、visitしているファイル<em class="replaceable"><code>filename</code></em>がバッファーのテキストより新しいときにバッファーの変更を試みた後、ユーザーに処理方法を尋ねるために使用する関数である。Emacsはディスク上のファイルの変更時刻が、バッファーを最後に保存した時刻より新しいかどうかで、これを検知する。これはおそらく、他のプログラムがそのファイルを変更したことを意味する。
</p><a id="idm65478224" class="indexterm"/><p>この関数が正常にリターンするかどうかは、ユーザーの答えに依存する。関数はバッファーの変更が処理された場合は正常にリターンし、バッファーの変更が許可されなかった場合は、データ<code class="literal">(<em class="replaceable"><code>filename</code></em>)</code>とともにエラー<code class="literal">file-supersession</code>をシグナルする。
</p><p>この関数は、適切なタイミングでEmacsにより自動的に呼び出される。これは、再定義することによりEmacsをカスタマイズ可能にするために存在する。標準的な定義は、ファイル<code class="filename">userlock.el</code>を参照されたい。
</p><p><a class="link" href="ch25s05.html" title="File Locks">File Locks</a>のファイルロックのメカニズムも参照のこと。
</p></blockquote></div></div></body></html>