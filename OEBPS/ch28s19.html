<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>The Window Start and End Positions</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Window-Start-and-End"/>The Window Start and End Positions</h1></div></div></div><a id="idm67672784" class="indexterm"/><a id="idm67672016" class="indexterm"/><p>ウィンドウはそれぞれ、バッファー位置を追跡するために、バッファー内で表示を開始すべき位置を指定するマーカーを保守しています。この位置は、そのウィンドウの<em class="firstterm">display-start(表示開始)</em>、または単に<em class="firstterm">start(開始)</em>と呼ばれます。この位置の後の文字が、ウィンドウの左上隅に表示される文字となります。これは通常はテキスト行の先頭になりますが、必須ではありません。
</p><p>ウィンドウやバッファーを切り替えた後、およびいくつかのケースにおいては、ウィンドウが行の途中で開始される場合は、Emacsがィンドウの開始を行の開始に調整します。これは、行中で無意味な位置のウィンドウ開始のまま、特定の操作が行われるのを防ぐためです。この機能は、Lispモードのコマンドを使用して実行することによりある種のLispコードをテストする場合は、それらのコマンドがこの再調整を誘発するために邪魔になるかもしれません。そのようなコードをテストするためには、それをコマンド内に記述して、何らかのキーにバインドしてください。
</p><pre class="synopsis"><a id="idm67665360" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">window-start</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm67662416" class="indexterm"/><p>この関数は、ウィンドウ<em class="replaceable"><code>window</code></em>の表示開始位置をリターンする。<em class="replaceable"><code>window</code></em>が<code class="literal">nil</code>なら、選択されたウィンドウが使用される。
</p><p>ウィンドウを作成したり、他のバッファーをウィンドウ内に表示する際、display-start位置は同じバッファーにたいしてもっとも最近に使用されたdisplay-start位置か、そのバッファーがそれをもたなければ<code class="literal">point-min</code>にセットされる。
</p><p>ポイントがスクリーン上に確実に現れるように、再表示はwindow-start位置を更新する(前の再表示以降にwindow-start位置を明示的に指定していない場合)。再表示以外に、window-start位置を自動的に変更するものはない。ポイントを移動した場合は、次の再表示後までポイントの移動に応じてwindow-startが変更されるのを期待してはならない。
</p></blockquote></div><a id="idm67658704" class="indexterm"/><pre class="synopsis"><a id="idm67657680" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">window-end</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>window</code></em> <em class="replaceable"><code>update</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>window</code></em>のバッファーの最後を表示する位置をリターンする。<em class="replaceable"><code>window</code></em>にたいするデフォルトは、選択されたウィンドウである。
</p><p>バッファーテキストの単なる変更やポイントの移動では、<code class="literal">window-end</code>がリターンする値は更新されない。この値は、Emacsが再表示を行い、それが妨害されることなく再表示が完了したときのみ更新される。
</p><p><em class="replaceable"><code>window</code></em>の最後の再表示が妨害されて完了しなかった場合、Emacsはそのウィンドウ内の表示のend位置を知らない。この場合、関数は<code class="literal">nil</code>をリターンする。
</p><p><em class="replaceable"><code>update</code></em>が非<code class="literal">nil</code>の場合、<code class="literal">window-end</code>は<code class="literal">window-start</code>のカレント値にもとづき、どこが表示のendかにたいして最新の値をリターンする。以前に保存された位置の値がまだ有効なら、<code class="literal">window-end</code>はその値をリターンする。それ以外は、バッファーのテキストをスキャンして、正しい値を計算する。
</p><p>たとえ<em class="replaceable"><code>update</code></em>が非<code class="literal">nil</code>でも、<code class="literal">window-end</code>はポイントが画面外に移動していても、実際の再表示が行うような表示のスクロールを試みない。これは、<code class="literal">window-start</code>の値を変更しない。これは実際には、スクロールが要求されない場合の表示されたテキストのendがどこかを報告する。
</p></blockquote></div><pre class="synopsis"><a id="idm67633616" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">set-window-start</code> <em class="replaceable"><code>window</code></em> <em class="replaceable"><code>position</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>noforce</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>window</code></em>のdisplay-start位置を、<em class="replaceable"><code>window</code></em>のバッファーの<em class="replaceable"><code>position</code></em>にセットする。リターン値は、<em class="replaceable"><code>position</code></em>である。
</p><p>表示ルーチンは、バッファーが表示されたときに、ポイント位置が可視になることを強要する。通常これらは、ポイントを可視にするために必要なときは常に、display-start位置を変更(つまりウィンドウをスクロール)する。しかし、この関数で<em class="replaceable"><code>noforce</code></em>に<code class="literal">nil</code>を使用してstart位置を指定した場合は、たとえポイントを画面外になるような場所に配したとしても、<em class="replaceable"><code>position</code></em>での表示開始を望んでいることを意味する。これによりポイントが画面外に配された場合、表示ルーチンはポイントをウィンドウ内の中央行の左マージンに移動する。
</p><p>たとえば、ポイントが1のときにウィンドウのstartを次行の開始37にセットした場合、ポイントはウィンドウの最上端の“上”になるだろう。表示ルーチンは、再表示が発生したときにポイントが1のままなら、ポイントを動かすことになる。以下に例を示す:
</p><pre class="screen">;; 以下は式<code class="literal">set-window-start</code>実行前
;;   ‘<code class="literal">foo</code>’の様子である
</pre><pre class="screen">
</pre><pre class="screen">---------- Buffer: foo ----------
★This is the contents of buffer foo.
2
3
4
5
6
---------- Buffer: foo ----------
</pre><pre class="screen">
</pre><pre class="screen">(set-window-start
 (selected-window)
 (save-excursion
   (goto-char 1)
   (forward-line 1)
   (point)))
⇒ 37
</pre><pre class="screen">
</pre><pre class="screen">;; 以下は式<code class="literal">set-window-start</code>実行後の
;;   ‘<code class="literal">foo</code>’の様子である
---------- Buffer: foo ----------
2
3
★4
5
6
---------- Buffer: foo ----------
</pre><p><em class="replaceable"><code>noforce</code></em>が非<code class="literal">nil</code>で、かつ次回の再表示でポイントが画面外に配される場合、再表示はポイントと協調して機能する位置となるような新たなwindow-startを計算するので、<em class="replaceable"><code>position</code></em>は使用されない。
</p></blockquote></div><pre class="synopsis"><a id="idm67614544" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">pos-visible-in-window-p</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>position</code></em> <em class="replaceable"><code>window</code></em> <em class="replaceable"><code>partially</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>window</code></em>内の<em class="replaceable"><code>position</code></em>が画面上カレントで可視のテキスト範囲内にある場合は、非<code class="literal">nil</code>をリターンし、<em class="replaceable"><code>position</code></em>が表示範囲のスクロール外にある場合は、<code class="literal">nil</code>をリターンする。<em class="replaceable"><code>partially</code></em>が<code class="literal">nil</code>なら、部分的に不明瞭な位置は可視とは判断されない。引数<em class="replaceable"><code>position</code></em>のデフォルトは、<em class="replaceable"><code>window</code></em>内のポイントのカレント位置で、<em class="replaceable"><code>window</code></em>のデフォルトは選択されたウィンドウである。<em class="replaceable"><code>position</code></em>が<code class="literal">t</code>なら、それは<em class="replaceable"><code>window</code></em>の最後に可視だった位置をチェックすることを意味する。
</p><p>この関数は、垂直スクロールだけを考慮する。
This function considers only vertical scrolling.
<em class="replaceable"><code>window</code></em>が水平にスクロールされたことだけの理由で<em class="replaceable"><code>position</code></em>が表示範囲外の場合は、いずれにせよ<code class="literal">pos-visible-in-window-p</code>は非<code class="literal">nil</code>をリターンする。<a class="link" href="ch28s22.html" title="Horizontal Scrolling">Horizontal
Scrolling</a>を参照のこと。
</p><p><em class="replaceable"><code>position</code></em>が可視で<em class="replaceable"><code>partially</code></em>が<code class="literal">nil</code>なら、<code class="literal">pos-visible-in-window-p</code>は<code class="literal">t</code>をリターンする。<em class="replaceable"><code>partially</code></em>が非<code class="literal">nil</code>で<em class="replaceable"><code>position</code></em>以降の文字が完全に可視の場合は、<code class="literal">(<em class="replaceable"><code>x</code></em>
<em class="replaceable"><code>y</code></em>)</code>という形式のリストをリターンする。ここで<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>は、ウィンドウの左上隅からの相対的なピクセル座標である。<em class="replaceable"><code>position</code></em>以降の文字が完全に可視ではない場合は、拡張された形式のリスト<code class="literal">(<em class="replaceable"><code>x</code></em>
<em class="replaceable"><code>y</code></em> <em class="replaceable"><code>rtop</code></em> <em class="replaceable"><code>rbot</code></em> <em class="replaceable"><code>rowh</code></em>
<em class="replaceable"><code>vpos</code></em>)</code>をリターンする。ここで<em class="replaceable"><code>rtop</code></em>と<em class="replaceable"><code>rbot</code></em>は<em class="replaceable"><code>position</code></em>でウィンドウ外となった上端と下端のピクセル数、<em class="replaceable"><code>rowh</code></em>はその行の可視な部分の高さ、<em class="replaceable"><code>vpos</code></em>はその行の垂直位置(0基準の行番号)を指定する。
</p><p>以下に例を示す:
</p><pre class="screen">;; ポイントが画面外ならrecenterする
(or (pos-visible-in-window-p
     (point) (selected-window))
    (recenter 0))
</pre></blockquote></div><pre class="synopsis"><a id="idm67589968" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">window-line-height</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>line</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>window</code></em>内のテキスト行<em class="replaceable"><code>line</code></em>の高さをリターンする。<em class="replaceable"><code>line</code></em>が<code class="literal">header-line</code>、<code class="literal">mode-line</code>、<code class="literal">window-line-height</code>のいずれかの場合は、そのウィンドウの対応する行についての情報をリターンする。それ以外では、<em class="replaceable"><code>line</code></em>は0から始まるテキスト行番号である。負数の場合は、そのウィンドウのendから数える。<em class="replaceable"><code>line</code></em>にたいするデフォルトは、<em class="replaceable"><code>window</code></em>内のカレント行、<em class="replaceable"><code>window</code></em>にたいするデフォルトは、選択されたウィンドウである。
</p><p>表示が最新でなければ、<code class="literal">window-line-height</code>は<code class="literal">nil</code>をリターンする。その場合は、関連する情報を入手するために、<code class="literal">pos-visible-in-window-p</code>を使用できる。
</p><p>指定された<em class="replaceable"><code>line</code></em>に対応する行がなければ、<code class="literal">window-line-height</code>は<code class="literal">nil</code>をリターンする。それ以外では、リスト<code class="literal">(<em class="replaceable"><code>height</code></em>
<em class="replaceable"><code>vpos</code></em> <em class="replaceable"><code>ypos</code></em>
<em class="replaceable"><code>offbot</code></em>)</code>をリターンする。ここで<em class="replaceable"><code>height</code></em>はその行の可視部分のピクセル高さ、<em class="replaceable"><code>vpos</code></em>と<em class="replaceable"><code>ypos</code></em>は最初のテキスト行上端からのその行への相対的な垂直位置の行数とピクセル数、<em class="replaceable"><code>offbot</code></em>はそのテキスト行下端のウィンドウ外のピクセル数である。(最初の)テキスト行上端にウィンドウ外のピクセルがある場合、<em class="replaceable"><code>ypos</code></em>は負となる。
</p></blockquote></div></div></body></html>