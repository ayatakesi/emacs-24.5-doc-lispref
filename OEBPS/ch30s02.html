<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Motion</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Motion"/>Motion</h1></div></div></div><a id="idm69565776" class="indexterm"/><p>モーション関数は、ポイントのカレント値、バッファーの先頭または終端、または選択されたウィンドウ端のいずれかより、相対的にポイントの値を変更します。<a class="link" href="ch30.html#Point" title="Point">Point</a>を参照してください。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Character-Motion"/>Motion by Characters</h2></div></div></div><p>以下の関数は、文字数にもとづいてポイントを移動します。 <code class="literal">goto-char</code>は基本的なプリミティブで、その他の関数はこれを使用しています。
</p><pre class="synopsis"><a id="idm69562064" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">goto-char</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファー内のポイントの値を<em class="replaceable"><code>position</code></em>にセットする。
</p><p>ナローイングが効力をもつ場合でも、<em class="replaceable"><code>position</code></em>は依然としてバッファー先頭から数えられるが、ポイントをアクセス可能な範囲外に移動することはできない。<em class="replaceable"><code>position</code></em>が範囲外の場合、<code class="literal">goto-char</code>はアクセス可能な範囲の先頭または終端にポイントを移動する。
</p><p>この関数がインタラクティブに呼び出された際は、<em class="replaceable"><code>position</code></em>の値は数プレフィクス引数、プレフィクス引数が与えられなかった場合はミニバッファーから値を読み取る。
</p><p><code class="literal">goto-char</code>は<em class="replaceable"><code>position</code></em>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm69554640" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">forward-char</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は前方、すなわちバッファーの終端方向にポイントを<em class="replaceable"><code>count</code></em>文字移動する(<em class="replaceable"><code>count</code></em>が負なら後方、すなわちバッファーの先頭方向にポイントを移動する)。<em class="replaceable"><code>count</code></em>が<code class="literal">nil</code>の場合のデフォルトは1。
</p><p>バッファー(ナローイングが効力をもつ場合はアクセス可能な範囲の境界)の先頭または終端を超えて移動を試みた場合はエラーシンボル<code class="literal">beginning-of-buffer</code>または<code class="literal">end-of-buffer</code>のエラーをシグナルする。
</p><p>インタラクティブな呼び出しでは、数プレフィクス引数が<em class="replaceable"><code>count</code></em>となる。
</p></blockquote></div><pre class="synopsis"><a id="idm69546704" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">backward-char</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>移動方向が逆であることを除き、これは<code class="literal">forward-char</code>と同様である。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Word-Motion"/>Motion by Words</h2></div></div></div><p>以下の関数は、与えられた文字が単語の一部なのかどうかを判断するための構文テーブルを使用して単語を解析します。<a class="link" href="ch35.html" title="Chapter 34. Syntax Tables">Syntax
Tables</a>を参照してください。
</p><pre class="synopsis"><a id="idm69540688" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">forward-word</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>count</code></em>の単語数分ポイントを前方に移動する。(<em class="replaceable"><code>count</code></em>が負なら後方に移動する)。<em class="replaceable"><code>count</code></em>が省略または<code class="literal">nil</code>の場合のデフォルトは1。
</p><p>“単語1つ移動”とは、単語構成文字を横断して、単語区切り文字に遭遇するまでポイントを移動することを意味する。しかし、この関数はバッファーのアクセス可能範囲の境界およびフィールド境界(<a class="link" href="ch32s19.html#Fields" title="Defining and Using Fields">Fields</a>を参照)を超えてポイントを移動できない。フィールド境界のもっとも一般的な例は、ミニバッファー内のプロンプト終端である。
</p><p>バッファー境界またはフィールド境界により途中で停止することなく単語<em class="replaceable"><code>count</code></em>個分の移動が可能なら、値は<code class="literal">t</code>となる。それ以外ではリターン値は<code class="literal">nil</code>で、ポイントはバッファー境界またはフィールド境界で停止する。
</p><p><code class="literal">inhibit-field-text-motion</code>が非<code class="literal">nil</code>なら、この関数はフィールド境界を無視する。
</p><p>インタラクティブに呼び出された場合、<em class="replaceable"><code>count</code></em>は数プレフィクス引数により指定される。
</p></blockquote></div><pre class="synopsis"><a id="idm69526608" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">backward-word</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、単語の前に遭遇するまで、前方ではなく後方に移動することを除き、<code class="literal">forward-word</code>と同様である。
</p></blockquote></div><pre class="synopsis"><a id="idm69522512" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">words-include-escapes</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、<code class="literal">forward-word</code>とそれを使用するすべての関数の挙動に影響する。これが非<code class="literal">nil</code>なら、構文クラス“エスケープ(escape)”および“クォート文字(character
quote)”内の文字は、単語の一部とみなされる。それ以外では、単語の一部とはみなされない。
</p></blockquote></div><pre class="synopsis"><a id="idm69514448" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">inhibit-field-text-motion</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>なら<code class="literal">forward-word</code>、<code class="literal">forward-sentence</code>、<code class="literal">forward-paragraph</code>を含む特定のモーション関数は、フィールド境界を無視する。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Buffer-End-Motion"/>Motion to an End of the Buffer</h2></div></div></div><a id="idm69508944" class="indexterm"/><p>バッファーの先頭にポイントを移動するには、以下のように記述します:
</p><pre class="screen">(goto-char (point-min))
</pre><p>同様に、バッファーの終端に移動するには、以下を使用します:
</p><pre class="screen">(goto-char (point-max))
</pre><p>以下の2つは、ユーザーがこれらを行うためのコマンドです。これらはマークをセットしてメッセージをエコーエリアに表示するため、Lispプログラム内で使用しないよう警告するために、ここに記述します。
</p><pre class="synopsis"><a id="idm69505744" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">beginning-of-buffer</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>n</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バッファー(ナローイングが効力をもつ場合はアクセス可能範囲の境界)の先頭にポイントを移動して、以前の位置にマークをセットする(Transient
Markモードの場合、マークがすでにアクティブならマークはセットしない)。
</p><p><em class="replaceable"><code>n</code></em>が非<code class="literal">nil</code>なら、バッファーのアクセス可能範囲の先頭から10分の<em class="replaceable"><code>n</code></em>の位置にポイントを置く。インタラクティブな呼び出しでは、<em class="replaceable"><code>n</code></em>は数プレフィクス引数が与えられればその値、それ以外でのデフォルトは<code class="literal">nil</code>である。
</p><p><span class="bold"><strong>警告:</strong></span> この関数をLispプログラム内で使用してはならない。
</p></blockquote></div><pre class="synopsis"><a id="idm69498960" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">end-of-buffer</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>n</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バッファー(ナローイングが効力をもつ場合はアクセス可能範囲の境界)の終端にポイントを移動して、以前の位置にマークをセットする(Transient
Markモードの場合、マークがすでにアクティブならマークはセットしない)。<em class="replaceable"><code>n</code></em>が非<code class="literal">nil</code>なら、バッファーのアクセス可能範囲の終端から10分の<em class="replaceable"><code>n</code></em>の位置にポイントを置く。
</p><p>インタラクティブな呼び出しでは、<em class="replaceable"><code>n</code></em>は数プレフィクス引数が与えられればその値、それ以外でのデフォルトは<code class="literal">nil</code>である。&lt;
</p><p><span class="bold"><strong>警告:</strong></span> この関数をLispプログラム内で使用してはならない。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Text-Lines"/>Motion by Text Lines</h2></div></div></div><a id="idm69491280" class="indexterm"/><p>テキスト行とは、改行で区切られたバッファーの範囲です。改行は前の行の一部とみなされます。最初のテキスト行はバッファー先頭で始まり、最後のテキスト行は最後の文字が改行かどうかは関係なくバッファー終端で終わります。バッファーからテキスト行への分割は、そのウィンドウの幅、表示の行継続、タブおよびその他の制御文字の表示方法に影響されません。
</p><pre class="synopsis"><a id="idm69489872" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">beginning-of-line</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレント行の先頭にポイントを移動する。引数<em class="replaceable"><code>count</code></em>が非<code class="literal">nil</code>または1以外なら、前方に<em class="replaceable"><code>count</code></em>−1行移動してから、その行の先頭に移動する。
</p><p>この関数は、別の行に移動する場合を除き、フィールド境界(<a class="link" href="ch32s19.html#Fields" title="Defining and Using Fields">Fields</a>を参照)を超えてポイントを移動しない。したがって、<em class="replaceable"><code>count</code></em>が<code class="literal">nil</code>または1で、かつポイントがフィールド境界で開始される場合は、ポイントを移動しない。フィールド境界を無視させるには、<code class="literal">inhibit-field-text-motion</code>を<code class="literal">t</code>にバインドするか、かわりに<code class="literal">forward-line</code>関数を使用する。たとえば、フィールド境界を無視することを除けば、<code class="literal">(forward-line
0)</code>は<code class="literal">(beginning-of-line)</code>と同じことを行う。
</p><p>この関数がバッファー(ナローイングが効力をもつ場合はアクセス可能範囲)の終端に到達した場合は、ポイントをその位置に置く。エラーはシグナルされない。
</p></blockquote></div><pre class="synopsis"><a id="idm69467984" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">line-beginning-position</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><code class="literal">(beginning-of-line <em class="replaceable"><code>count</code></em>)</code>が移動するであろう位置をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm69459536" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">end-of-line</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレント行の終端にポイントを移動する。引数<em class="replaceable"><code>count</code></em>が非<code class="literal">nil</code>または1以外なら、前方に<em class="replaceable"><code>count</code></em>−1行移動してから、その行の終端に移動する。
</p><p>この関数は、別の行に移動する場合を除き、フィールド境界(<a class="link" href="ch32s19.html#Fields" title="Defining and Using Fields">Fields</a>を参照)を超えてポイントを移動しない。したがって、<em class="replaceable"><code>count</code></em>が<code class="literal">nil</code>または1で、かつポイントがフィールド境界で開始される場合は、ポイントを移動しない。フィールド境界を無視させるには、<code class="literal">inhibit-field-text-motion</code>を<code class="literal">t</code>にバインドする。
</p><p>この関数がバッファー(ナローイングが効力をもつ場合はアクセス可能範囲)の終端に到達した場合は、ポイントをその位置に置く。エラーはシグナルされない。
</p></blockquote></div><pre class="synopsis"><a id="idm69451472" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">line-end-position</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><code class="literal">(end-of-line <em class="replaceable"><code>count</code></em>)</code>が移動するであろう位置をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm69447120" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">forward-line</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm69440080" class="indexterm"/><p>この関数は、前方に<em class="replaceable"><code>count</code></em>行移動して、その行の先頭にポイントを移動する。<em class="replaceable"><code>count</code></em>が負なら、後方に−<em class="replaceable"><code>count</code></em>行移動して、その行の先頭にポイントを移動する。<em class="replaceable"><code>count</code></em>が0の場合は、カレント行の先頭にポイントを移動する。<em class="replaceable"><code>count</code></em>が<code class="literal">nil</code>なら、それは1を意味する。
</p><p><code class="literal">forward-line</code>が指定された行数を移動する前にバッファー(またはアクセス可能範囲)の先頭か終端に遭遇した場合は、そこにポイントをセットする。エラーはシグナルされない。
</p><p><code class="literal">forward-line</code>は、<em class="replaceable"><code>count</code></em>と実際に移動した行数の差をリターンする。3行しかないバッファーの先頭から、5行したへの移動を試みた場合、ポイントは最終行の終端で停止し、値は2となるだろう。
</p><p>インタラクティブな呼び出しでは、数プレフィクス引数が<em class="replaceable"><code>count</code></em>となる。
</p></blockquote></div><pre class="synopsis"><a id="idm69433552" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">count-lines</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm69426512" class="indexterm"/><a id="Definition-of-count_002dlines"/><p>この関数は、カレントバッファー内の位置<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>の間の行数をリターンする。<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>が等しければ、リターン値は0になる。それ以外は、たとえ<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>が同一行にあっても、最小でも1をリターンする。これらの間にあるテキストは、それだけを孤立して考えたると、それが空でない限りは最小でも1行を含まなければならないからである。
</p></blockquote></div><pre class="synopsis"><a id="idm69422544" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">count-words</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm69419600" class="indexterm"/><p>この関数は、カレントバッファー内の位置<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>の間にある単語の数をリターンする。
</p><p>この関数は、インタラクティブに呼び出すこともできる。その場合はバッファー、またはリージョンがアクティブならリージョン内の行数、単語数、文字数を報告するメッセージをプリントする。
</p></blockquote></div><pre class="synopsis"><a id="idm69417040" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">line-number-at-pos</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>pos</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm69414096" class="indexterm"/><p>この関数は、カレントバッファー内のバッファー位置<em class="replaceable"><code>pos</code></em>に対応する行番号をリターンする。<em class="replaceable"><code>pos</code></em>が<code class="literal">nil</code>または省略された場合は、カレントのバッファー位置が使用される。
</p></blockquote></div><p><a class="link" href="ch32.html#Near-Point" title="Examining Text Near Point">Near
Point</a>の関数<code class="literal">bolp</code>と<code class="literal">eolp</code>も参照してください。これらの関数はポイントを移動しませんが、ポイントがすでに行頭または行末にあるかどうかをテストします。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Screen-Lines"/>Motion by Screen Lines</h2></div></div></div><a id="idm69408848" class="indexterm"/><p>前のセクションの行関数は、改行文字で区切られたテキスト行だけを数えました。対照的に、以下の関数はスクリーン行を数えます。スクリーン行は、スクリーン上でテキストが表示される方法にしたがって定義されます。あるテキスト行1行が、選択されたウィンドウの幅にフィット可能な程に十分短ければ、それはスクリーン行で1行になりますが、それ以外は複数のスクリーン行になり得ます。
</p><p>テキスト行が追加スクリーン行に継続されずに、そのスクリーンで切り詰められる(truncated)場合があります。そのような場合は、<code class="literal">vertical-motion</code>で<code class="literal">forward-line</code>のようにポイントを移動します。<a class="link" href="ch38s03.html" title="Truncation">Truncation</a>を参照してください。
</p><p>文字列が与えられた場合、その幅は、文字の外見を制御するフラグに依存するため、与えられたテキスト断片にたいして、たとえそれが選択されたウィンドウ上でさえも(幅、切り詰め有無、ディスプレイテーブルはウィンドウごとに異なり得るので)、そのテキストがあるバッファーに応じて、<code class="literal">vertical-motion</code>の挙動は異なります。<a class="link" href="ch38s21.html#Usual-Display" title="Usual Display Conventions">Usual
Display</a>を参照してください。
</p><p>以下の関数は、スクリーン行のブレーク位置を判断するためにテキストをスキャンするため、スキャンする長さに比例して時間を要します。
</p><pre class="synopsis"><a id="idm73532496" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">vertical-motion</code> <em class="replaceable"><code>count</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、ポイントのあるスクリーン行からスクリーン行で<em class="replaceable"><code>count</code></em>行下に移動して、そのスクリーン行の先頭にポイントを移動する。<em class="replaceable"><code>count</code></em>が負なら、かわりに上に移動する。
</p><p><em class="replaceable"><code>count</code></em>引数には、整数のかわりにコンスセル<code class="literal">(<em class="replaceable"><code>cols</code></em>
. <em class="replaceable"><code>lines</code></em>)</code>を指定できる。その場合、関数はスクリーン行で<em class="replaceable"><code>lines</code></em>行移動して、そのスクリーン行の視覚的な行頭(visual
start)から<em class="replaceable"><code>cols</code></em>列目にポイントを置く。<em class="replaceable"><code>cols</code></em>は、その行の<span class="emphasis"><em>視覚的(visual)</em></span>な開始から数えられることに注意。そのウィンドウが水平スクロール(<a class="link" href="ch28s22.html" title="Horizontal Scrolling">Horizontal
Scrolling</a>を参照)されている場合には、ポイントが置かれる列は、スクロールされたテキストの列数が加えられるだろう。
</p><p>リターン値は、ポイントが移動したスクリーン行の行数である。バッファーの先頭か終端に到達していたら、この値は絶対値では<em class="replaceable"><code>count</code></em>より小になるかもしれない。
</p><p>ウィンドウ<em class="replaceable"><code>window</code></em>引数幅、水平スクロール、ディスプレイテーブルのようなパラメーターの取得に使用される。しかし<code class="literal">vertical-motion</code>は、たとえ<em class="replaceable"><code>window</code></em>がカレントで他のバッファーを表示していたとしても常に、カレントバッファーにたいして処理を行う。
</p></blockquote></div><pre class="synopsis"><a id="idm73521360" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">count-screen-lines</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>beg</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>count-final-newline</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>beg</code></em>から<em class="replaceable"><code>end</code></em>のテキスト内のスクリーン行の行数をリターンする。スクリーン行数は行継続やディスプレイテーブル等により、実際の行数とは異なるかもしれない。<em class="replaceable"><code>beg</code></em>および<em class="replaceable"><code>end</code></em>が<code class="literal">nil</code>、または省略された場合のデフォルトは、そのバッファーのアクセス可能範囲の先頭と終端である。
</p><p>そのリージョンが改行で終わる場合、オプションの第3引数<em class="replaceable"><code>count-final-newline</code></em>が<code class="literal">nil</code>なら、それは無視される。
</p><p>オプションの第4引数<em class="replaceable"><code>window</code></em>は、幅や水平スクロール等のパラメーターを取得するウィンドウを指定する。デフォルトは、選択されたウィンドウのパラメーターを使用する。
</p><p><code class="literal">vertical-motion</code>と同様、<code class="literal">count-screen-lines</code>は<em class="replaceable"><code>window</code></em>内にどのバッファーが表示されていようと、常にカレントバッファーを使用する。これにより、バッファーが何らかのウィンドウにカレントで表示されているか否かにかかわらず、任意にバッファーにたいして<code class="literal">count-screen-lines</code>の使用が可能になる。
</p></blockquote></div><pre class="synopsis"><a id="idm73510352" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">move-to-window-line</code> <em class="replaceable"><code>count</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、選択されたウィンドウ内にカレントで表示されているテキストに応じてポイントを移動する。これは、ウィンドウ上端からスクリーン行で<em class="replaceable"><code>count</code></em>行目の先頭にポイントを移動する。<em class="replaceable"><code>count</code></em>が負なら、それはバッファー下端(バッファーが指定されたスクリーン位置の上で終わる場合はバッファーの最終行)から、−<em class="replaceable"><code>count</code></em>行目の位置を指定する。
</p><p><em class="replaceable"><code>count</code></em>が<code class="literal">nil</code>の場合、ポイントはウィンドウ中央の行の先頭に移動する。<em class="replaceable"><code>count</code></em>の絶対値がウィンドウサイズより大なら、ウィンドウが十分に高かったならそのスクリーン行は表示されていたであろう位置に、ポイントを移動する。これは、おそらく次回の再表示の際に、その箇所がスクリーン上になるようなスクロールを発生させるだろう。
</p><p>インタラクティブな呼び出しでは、数プレフィクス引数が<em class="replaceable"><code>count</code></em>となる。
</p><p>リターン値は、ウィンドウ上端行を0とする、ポイントが移動した先の行番号である。
</p></blockquote></div><pre class="synopsis"><a id="idm73503056" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">compute-motion</code> <em class="replaceable"><code>from</code></em> <em class="replaceable"><code>frompos</code></em> <em class="replaceable"><code>to</code></em> <em class="replaceable"><code>topos</code></em> <em class="replaceable"><code>width</code></em> <em class="replaceable"><code>offsets</code></em> <em class="replaceable"><code>window</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーをスキャンして、スクリーン位置を計算する。これは位置<em class="replaceable"><code>from</code></em>がスクリーン座標<em class="replaceable"><code>frompos</code></em>にあると仮定して、そこから位置<em class="replaceable"><code>to</code></em>または座標<em class="replaceable"><code>topos</code></em>のいずれか先に到達したほうまで、バッファーを前方にスキャンする。これはスキャン終了のバッファー位置と、スクリーン座標をリターンする。
</p><p>座標引数<em class="replaceable"><code>frompos</code></em>および<em class="replaceable"><code>topos</code></em>は、<code class="literal">(<em class="replaceable"><code>hpos</code></em>
. <em class="replaceable"><code>vpos</code></em>)</code>という形式のコンスセルである。
</p><p>引数<em class="replaceable"><code>width</code></em>は、テキストを表示するために利用可能な列数である。これは、継続行の処理に影響する。<code class="literal">nil</code>は、そのウィンドウ内で使用可能な実際のテキスト列数で、<code class="literal">(window-width
window)</code>がリターンする値と等しい。
</p><p>引数<em class="replaceable"><code>offsets</code></em>は<code class="literal">nil</code>、または<code class="literal">(<em class="replaceable"><code>hscroll</code></em>
.
<em class="replaceable"><code>tab-offset</code></em>)</code>という形式のコンスセルのいずれかである。ここで<em class="replaceable"><code>hscroll</code></em>は、左マージンのために表示されない列数であり、呼び出し側のほとんどは<code class="literal">window-hscroll</code>を呼び出すことにより、これを取得する。一方<em class="replaceable"><code>tab-offset</code></em>は、スクリーン上の列数と、バッファー内の列数の間のオフセットである。これは継続行において、前のスクリーン行の幅が<code class="literal">tab-width</code>の整数倍でないときは、非0になる可能性がある。非継続行では、これは常に0である。
</p><p>ウィンドウ<em class="replaceable"><code>window</code></em>の役割は、使用するディスプレイテーブルの指定することだけである。<code class="literal">compute-motion</code>は、<em class="replaceable"><code>window</code></em>内に表示されているのがどのバッファーであろうと、カレントバッファーを処理する。
</p><p>リターン値は、5つの要素をもつリストである:
</p><pre class="screen">(<em class="replaceable"><code>pos</code></em> <em class="replaceable"><code>hpos</code></em> <em class="replaceable"><code>vpos</code></em> <em class="replaceable"><code>prevhpos</code></em> <em class="replaceable"><code>contin</code></em>)
</pre><p>ここで、<em class="replaceable"><code>pos</code></em>はスキャンが停止したバッファー位置、<em class="replaceable"><code>vpos</code></em>は垂直スクリーン位置、<em class="replaceable"><code>hpos</code></em>は水平スクリーン位置である。
</p><p>結果<em class="replaceable"><code>prevhpos</code></em>は、<em class="replaceable"><code>pos</code></em>から1文字戻った水平位置である。結果<em class="replaceable"><code>contin</code></em>は、最後の行が前の文字の後(または中)から継続されていれば、<code class="literal">t</code>となる。
</p><p>たとえば、あるウィンドウのスクリーン行<em class="replaceable"><code>line</code></em>の列<em class="replaceable"><code>col</code></em>のバッファー位置を求めるには、そのウィンドウのdisplay-start(表示開始)位置を<em class="replaceable"><code>from</code></em>、そのウィンドウの左上隅の座標を<em class="replaceable"><code>frompos</code></em>として渡す。スキャンをそのバッファーのアクセス可能範囲の終端に制限するために、バッファーの<code class="literal">(point-max)</code>を<em class="replaceable"><code>to</code></em>に、<em class="replaceable"><code>line</code></em>と<em class="replaceable"><code>col</code></em>を<em class="replaceable"><code>topos</code></em>に渡す。以下は、これを行う関数である:
</p><pre class="screen">(defun coordinates-of-position (col line)
  (car (compute-motion (window-start)
                       '(0 . 0)
                       (point-max)
                       (cons col line)
                       (window-width)
                       (cons (window-hscroll) 0)
                       (selected-window))))
</pre><p>ミニバッファーにたいして<code class="literal">compute-motion</code>を使う際は、最初のスクリーン行の先頭の水平位置を取得するために、<code class="literal">minibuffer-prompt-width</code>を使用する必要がある。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="List-Motion"/>Moving over Balanced Expressions</h2></div></div></div><a id="idm73459920" class="indexterm"/><a id="idm73459152" class="indexterm"/><a id="idm73458384" class="indexterm"/><a id="idm73457616" class="indexterm"/><p>以下は、バランスの取れたカッコ式(balanced-parenthesis。これらの式を横断して移動することと関連して、Emacsでは<em class="firstterm">sexp(S式)</em>とも呼ばれる)と関連する、いくつかの関数です。これらの関数がさまざまな文字を処理する方法は、構文テーブル(syntax
table)が制御します。<a class="link" href="ch35.html" title="Chapter 34. Syntax Tables">Syntax
Tables</a>を参照してください。sexp、またはその一部にたいする低レベルのプリミティブについては、<a class="link" href="ch35s06.html" title="Parsing Expressions">Parsing
Expressions</a>を参照してください。ユーザーレベルのコマンドについては、section “Commands for
Editing with Parentheses” in <em class="citetitle">The GNU Emacs Manual</em>を参照してください。
</p><pre class="synopsis"><a id="idm73454288" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">forward-list</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バランスの取れたカッコのグループを、<em class="replaceable"><code>arg</code></em>(デフォルトは1)グループ前方に移動する(単語やクォート文字のペアーでクォートされた文字列は無視される)。
</p></blockquote></div><pre class="synopsis"><a id="idm73450320" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">backward-list</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バランスの取れたカッコのグループを、<em class="replaceable"><code>arg</code></em>(デフォルトは1)グループ後方に移動する(単語やクォート文字のペアーでクォートされた文字列は無視される)。
</p></blockquote></div><pre class="synopsis"><a id="idm73446352" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">up-list</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カッコを<em class="replaceable"><code>arg</code></em>(デフォルトは1)レベル外側前方に移動する。負の引数では後方に移動するが、同様に浅いレベルに移動する。
</p></blockquote></div><pre class="synopsis"><a id="idm73442384" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">down-list</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カッコを<em class="replaceable"><code>arg</code></em>(デフォルトは1)レベル内側前方に移動する。負の引数では後方に移動するが、同様に深いレベル(−<em class="replaceable"><code>arg</code></em>レベル)に移動する。
</p></blockquote></div><pre class="synopsis"><a id="idm73438032" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">forward-sexp</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バランスの取れた式(balanced
expressions)を、<em class="replaceable"><code>arg</code></em>(デフォルトは1)前方に移動する。バランスの取れた式にはカッコ等で区切られた式、および単語や文字列定数のようなものも含まれる。<a class="link" href="ch35s06.html" title="Parsing Expressions">Parsing
Expressions</a>を参照のこと。たとえば、
</p><pre class="screen">---------- Buffer: foo ----------
(concat★ "foo " (car x) y z)
---------- Buffer: foo ----------
</pre><pre class="screen">
</pre><pre class="screen">(forward-sexp 3)
     ⇒ nil

---------- Buffer: foo ----------
(concat "foo " (car x) y★ z)
---------- Buffer: foo ----------
</pre></blockquote></div><pre class="synopsis"><a id="idm73432272" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">backward-sexp</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、バランスの取れた式(balanced expressions)を、<em class="replaceable"><code>arg</code></em>(デフォルトは1)後方に移動する。
</p></blockquote></div><pre class="synopsis"><a id="idm73428304" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">beginning-of-defun</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、後方に<em class="replaceable"><code>arg</code></em>番目のdefunの先頭に移動する。<em class="replaceable"><code>arg</code></em>が負なら、実際には前方に移動するが、defunの終端ではなく先頭に移動することは変わらない。<em class="replaceable"><code>arg</code></em>のデフォルトは1。
</p></blockquote></div><pre class="synopsis"><a id="idm73423568" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">end-of-defun</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、前方に<em class="replaceable"><code>arg</code></em>番目のdefunの終端に移動する。<em class="replaceable"><code>arg</code></em>が負なら、実際には後方に移動するが、defunの先頭ではなく終端に移動することは変わらない。<em class="replaceable"><code>arg</code></em>のデフォルトは1。
</p></blockquote></div><pre class="synopsis"><a id="idm73418832" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">defun-prompt-regexp</code></pre><div class="blockquote"><blockquote class="blockquote"><p>非<code class="literal">nil</code>なら、このバッファーローカル変数はdefunの始まりとなる開きカッコの前に出現し得るテキストを指定する正規表現を保持する。つまりd、この正規表現にたいするマッチで始まり、その後に開きカッコ構文(open-parenthesis
syntax)が続くのがdefunである。
</p></blockquote></div><pre class="synopsis"><a id="idm73415632" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">open-paren-in-column-0-is-defun-start</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値が非<code class="literal">nil</code>なら、列0にある開きカッコはdefunの始まりとみなされる。<code class="literal">nil</code>の場合、列0の開きカッコは特別な意味をもたない。デフォルトは<code class="literal">t</code>。
</p></blockquote></div><pre class="synopsis"><a id="idm73411408" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">beginning-of-defun-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>非<code class="literal">nil</code>なら、この変数はdefunの開始を見つける関数を保持する。関数<code class="literal">beginning-of-defun</code>は、通常の手法を使うかわりに、その関数に自身のオプション引数を渡して、その関数を呼び出す。その引数が非<code class="literal">nil</code>なら、その関数はその回数分の関数呼び出しにより、<code class="literal">beginning-of-defun</code>が行うように後方に移動すること。
</p></blockquote></div><pre class="synopsis"><a id="idm73406672" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">end-of-defun-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>非<code class="literal">nil</code>なら、この変数はdefunの終端を見つける関数を保持する。関数<code class="literal">end-of-defun</code>は、通常の手法を使うかわりに、その関数を呼び出す。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Skipping-Characters"/>Skipping Characters</h2></div></div></div><a id="idm73402192" class="indexterm"/><p>以下の2つの関数は、指定された文字セットを超えてポイントを移動します。これらの関数は、たとえば空白文字をスキップするためによく使用されます。関連する関数については、<a class="link" href="ch35s05.html" title="Motion and Syntax">Motion
and Syntax</a>を参照してください。
</p><p>これらの関数は検索関数(<a class="link" href="ch34.html" title="Chapter 33. Searching and Matching">Searching and
Matching</a>を参照)が行うように、そのバッファーがマルチバイト(multibyte)ならマルチバイトに、ユニバイト(unibyte)ならユニバイトに、そのセットト文字列を変換します。
</p><pre class="synopsis"><a id="idm73399376" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">skip-chars-forward</code> <em class="replaceable"><code>character-set</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>limit</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、与えられた文字セットをスキップして、カレントバッファー内のポイント前方に移動する。これはポイントの後の文字を調べて、その文字が<em class="replaceable"><code>character-set</code></em>にマッチすればポイントを進める。そして、マッチしない文字に到達するまで、これを継続する。この関数は、超えて移動した文字数をリターンする。
</p><p>引数<em class="replaceable"><code>character-set</code></em>が、正規表現での‘<code class="literal">[…]</code>’内部と同様だが、‘<code class="literal">]</code>’で終端されず、‘<code class="literal">\</code>’が‘<code class="literal">^</code>’、‘<code class="literal">-</code>’、‘<code class="literal">\</code>’をクォートする点が異なる。つまり、<code class="literal">"a-zA-Z"</code>はすべての英字をスキップして最初の非英字の前で停止し、<code class="literal">"^a-zA-Z"</code>はすべての非英字をスキップして最初の英字の前で停止する。<a class="link" href="ch34s03.html" title="Regular Expressions">Regular
Expressions</a>を参照のこと。<code class="literal">"[:alnum:]"</code>のような文字クラスも使用できる。see <a class="link" href="ch34s03.html#Char-Classes" title="Character Classes">Char
Classes</a>を参照されたい。
</p><p><em class="replaceable"><code>limit</code></em>(数字かマーカー)が与えられた場合、それはポイントがスキップして到達できる、そのバッファー内の最大位置を指定する。ポイントは<em class="replaceable"><code>limit</code></em>、または<em class="replaceable"><code>limit</code></em>の前でストップするだろう。
</p><p>以下の例では、ポイントは最初‘<code class="literal">T</code>’の直前に置かれている。フォーム評価後、ポイントはその行の末尾(‘<code class="literal">hat</code>’の‘<code class="literal">t</code>’と改行の間)に置かれる。この関数は、すべての英字とスペースをスキップするが、改行はスキップしない。
</p><pre class="screen">---------- Buffer: foo ----------
I read "★The cat in the hat
comes back" twice.
---------- Buffer: foo ----------
</pre><pre class="screen">
</pre><pre class="screen">(skip-chars-forward "a-zA-Z ")
     ⇒ 18

---------- Buffer: foo ----------
I read "The cat in the hat★
comes back" twice.
---------- Buffer: foo ----------
</pre></blockquote></div><pre class="synopsis"><a id="idm73359440" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">skip-chars-backward</code> <em class="replaceable"><code>character-set</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>limit</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>limit</code></em>に至るまで<em class="replaceable"><code>character-set</code></em>にマッチする文字をスキップして、ポイントを後方に移動する。これは<code class="literal">skip-chars-forward</code>と同様だが、ポイントを移動する方向が異なる。
</p><p>リターン値は、移動した距離を示す。これは、0以上の整数である。
</p></blockquote></div></div></div></body></html>