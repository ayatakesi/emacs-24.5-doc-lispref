<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 30. Markers</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Markers"/>Chapter 30. Markers</h1></div></div></div><a id="idm73222736" class="indexterm"/><p><em class="firstterm">マーカー(marker)</em>とは、あるバッファー内で取り囲んでいるテキストにたいして相対的な位置を指定するために使用されるオブジェクトです。テキストが挿入または削除されると常に、マーカーは自動的にそのバッファーの先頭からのオフセットを自動的に変更して、自身の左右にある文字の間に留まります。
</p><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Overview-of-Markers"/>Overview of Markers</h1></div></div></div><p>マーカーは、バッファーとそのバッファー内の位置を指定します。マーカーは、位置を要求する関数内において、位置を表すために整数と同じようにして使用することができます。その場合、そのマーカーのバッファーは、通常は無視されます。この方法で使用されるマーカーは通常、その関数が処理するバッファー内の位置を指しますが、それは完全にプログラマーの責任です。位置についての完全な説明は、<a class="link" href="ch30.html" title="Chapter 29. Positions">Positions</a>を参照してください。
</p><p>マーカーはマーカー位置(marker position)、マーカーバッファー(marker buffer)、挿入タイプ(insertion
type)という3つの属性をもちます。マーカー位置は、そのバッファー内の位置としてのマーカーと、(その時点において)等しい整数です。しかし、マーカー位置はマーカー生存期間中に変化し得るものであり、頻繁に変化されます。バッファー内でのテキストの挿入や削除で、マーカーは再配置されます。マーカー前後の2文字以外の場所で挿入や削除がおこなわれても、マーカー位置はその2文字間に留まるというのが、このアイデアです。再配置により、マーカーと等価な整数は変更されます。
</p><a id="idm73219152" class="indexterm"/><p>マーカー位置周辺のテキストを削除することにより、そのマーカーは削除されたテキストの直前および直後にある文字の間に残されます。マーカー位置へのテキスト挿入では、マーカーは通常は新たなテキストの前か後のいずれかに置かれます。その挿入が<code class="literal">insert-before-markers</code>(<a class="link" href="ch32s04.html" title="Inserting Text">Insertion</a>を参照)で行われたものでなければ、どちらに置かれるかはマーカーの<em class="firstterm">挿入タイプ</em>(<a class="link" href="ch31s05.html" title="Marker Insertion Types">Marker
Insertion Types</a>を参照)に依存します。
</p><a id="idm73216080" class="indexterm"/><p>バッファーでの挿入と削除では、すべてのマーカーをチェックして、必要ならそれらを再配置しなければなりません。これは、多数のマーカーをもつバッファーでの処理を遅くします。それ以上マーカーが不必要なのが確信できる場合には、存在しない場所も指さないようにマーカーを設定することは、この理由によりよいアイデアといえるでしょう。それ以上アクセスされる可能性がないマーカーは、最終的には削除されます(<a class="link" href="apes03.html" title="Garbage Collection">Garbage
Collection</a>を参照)。
</p><a id="idm73214416" class="indexterm"/><p>マーカー位置にたいして算術演算を行うことは一般的なので、それらの演算子のほとんど(<code class="literal">+</code>や<code class="literal">-</code>を含む)が、引数としてマーカーに渡すことができます。そのような場合には、マーカーはカレント位置を意味します。
</p><p>以下ではマーカー渡す作成とセットを行い、ポイントをマーカーに移動しています:
</p><pre class="screen">;; 最初はどこも指さない新たなマーカーを作成:
(setq m1 (make-marker))
     ⇒ #&lt;marker in no buffer&gt;
</pre><pre class="screen">
</pre><pre class="screen">;; カレントバッファーの99と100番目の
;;   文字間を指すよう<code class="literal">m1</code>をセット:
(set-marker m1 100)
     ⇒ #&lt;marker at 100 in markers.texi&gt;
</pre><pre class="screen">
</pre><pre class="screen">;; ここでバッファー先頭に1文字挿入:
(goto-char (point-min))
     ⇒ 1
(insert "Q")
     ⇒ nil
</pre><pre class="screen">
</pre><pre class="screen">;; <code class="literal">m1</code>は適切に更新された
m1
     ⇒ #&lt;marker at 101 in markers.texi&gt;
</pre><pre class="screen">
</pre><pre class="screen">;; 同じ位置を指す2つのマーカーは
;;   <code class="literal">equal</code>だが<code class="literal">eq</code>に非ず
(setq m2 (copy-marker m1))
     ⇒ #&lt;marker at 101 in markers.texi&gt;
(eq m1 m2)
     ⇒ nil
(equal m1 m2)
     ⇒ t
</pre><pre class="screen">
</pre><pre class="screen">;; マーカー使用終了時、存在しない場所を指すようセット
(set-marker m1 nil)
     ⇒ #&lt;marker in no buffer&gt;
</pre></div></div></body></html>