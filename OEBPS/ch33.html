<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 32. Non-ASCII Characters</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Non_002dASCII-Characters"/>Chapter 32. Non-<acronym class="acronym">ASCII</acronym> Characters</h1></div></div></div><a id="idm74539344" class="indexterm"/><a id="idm74538576" class="indexterm"/><a id="idm74537808" class="indexterm"/><p>このチャプターは文字に関する特別な問題と、それらが文字列およびバッファーに格納される方法についてカバーします。
</p><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Text-Representations"/>Text Representations</h1></div></div></div><a id="idm74535376" class="indexterm"/><p>Emacsのバッファーおよび文字列は、既知のスクリプトで記述されたほとんどすべてのテキストをユーザーがタイプしたり表示できるよう、多種多様な言語の広大な文字レパートリーをサポートします。
</p><a id="idm74534224" class="indexterm"/><a id="idm74533456" class="indexterm"/><a id="idm74532688" class="indexterm"/><p>多種多様な文字およびスクリプトをサポートするために、Emacsは<em class="firstterm">Unicode標準(Unicode
Standard)</em>に厳密にしたがいます。Unicode標準は、すべての文字にたいしてそれぞれ、<em class="firstterm">コードポイント(codepoint)</em>と呼ばれる一意な番号を割り当てています。コードポイントの範囲はUnicode、またはUnicode<em class="firstterm">コード空間(codespace)</em>により定義され、範囲は<code class="literal">0..#x10FFFF</code>(16進表記、範囲両端を含む)です。Emacsはこれを、範囲<code class="literal">#x110000..#x3FFFFF</code>のコードポイント範囲に拡張します。この範囲はUnicodeとして統一されていない文字や、文字として解釈できない<em class="firstterm">8ビットrawバイト(raw
8-bit bytes)</em>を表すために使用します。したがって、Emacs内の文字コードポイントは、22ビットの整数になります。
</p><a id="idm74528848" class="indexterm"/><a id="idm74528080" class="indexterm"/><a id="idm74527312" class="indexterm"/><p>メモリー節約のため、Emacsはバッファーおよび文字列内のテキスト文字にたいするコードポイントである、22ビットの整数を固定長で保持しません。かわりに、Emacsは文字の内部表現として可変長を使用します。これは、そのコードポイントの値に応じて、各文字を5ビットから8ビットのバイトシーケンスとして格納するものです<a href="#ftn.idm74526288" class="footnote" id="idm74526288"><sup class="footnote">[15]</sup></a>。たとえばすべての<acronym class="acronym">ASCII</acronym>文字は1バイト、Latin-1文字は2バイトといった具合です。わたしたちはこれを、テキストの<em class="firstterm">マルチバイト(multibyte)</em>表現と呼んでいます。
</p><p>Emacs外部では、ISO-8859-1、GB-2312、Big-5等のような多種の異なるエンコーディングで文字を表すことができます。Emacsはバッファーまたは文字列へのテキスト読み込み時、およびディスク状のファイルへのテキスト書き込みや他プロセスへの引き渡し時に、これらの外部エンコーディングと、その内部表現の間で適切な変換を行います。
</p><p>Emacsがエンコード済みテキストや非テキストデータを、バッファーや文字列に保持、あるいは操作する必要がある場合も時折あります。たとえばEmacsがファイルをvisitする際、まずそのファイルのテキストをそのままバッファーに読み込み、その後にのみそれを内部表現に変換します。この変換前にバッファーに保持されてくださいのは、エンコード済みのテキストです。
</p><a id="idm74523600" class="indexterm"/><p>Emacsに関する限り、エンコードされたテキストは実際のテキストではなく、8ビットrawバイトです。エンコード済みテキストを保持するバッファーおよび文字列は、Emacsがそれらを個々のバイトシーケンスとしてアツカウことから、<em class="firstterm">ユニバイト(unibyte)</em>のバッファーまたは文字列と呼んでいます。Emacsは通常、ユニバイトのバッファーおよび文字列を、<code class="literal">\237</code>のような8進コードで表示します。エンコード済みテキストやバイナリー非テキストデータを処理する場合を除き、ユニバイトバッファーとユニバイト文字列は決して使用しないよう推奨します。
</p><p>バッファーにおいては、変数<code class="literal">enable-multibyte-characters</code>のバッファーローカルな値が、使用する表現を指定します。文字列での表現は、その文字列構築時に判断して、それを文字列内に記録します。
</p><pre class="synopsis"><a id="idm74520400" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">enable-multibyte-characters</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、カレントバッファーのテキスト表現を指定する。非<code class="literal">nil</code>ならバッファーはマルチバイトテキストを含み、それ以外ならエンコード済みユニバイトテキスト、またはバイナリー非テキストデータが含れる。
</p><p>この変数は直接セットできない。バッファーの表現を変更するには、かわりに関数<code class="literal">set-buffer-multibyte</code>を使用すること。
</p></blockquote></div><pre class="synopsis"><a id="idm74504016" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">position-bytes</code> <em class="replaceable"><code>position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>バッファー位置は文字単位で測られる。この関数は、カレントバッファー内のバッファー位置を、それに対応するバイト位置でリターンする。これはバッファー先頭を1として、バイト単位で増加方向に数えられる。<em class="replaceable"><code>position</code></em>が範囲外なら、値は<code class="literal">nil</code>になる。
</p></blockquote></div><pre class="synopsis"><a id="idm74499920" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">byte-to-position</code> <em class="replaceable"><code>byte-position</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>カレントバッファー内で、与えられた<em class="replaceable"><code>byte-position</code></em>に対応するバッファー位置を、文字単位でリターンする。<em class="replaceable"><code>byte-position</code></em>が範囲外なら、値は<code class="literal">nil</code>になる。マルチバイトバッファーでは、<em class="replaceable"><code>byte-position</code></em>の任意の値が文字境界上になく、1文字として表現されたマルチバイトシーケンス内にあるかもしれない。この場合、関数はその文字のマルチバイトシーケンスが<em class="replaceable"><code>byte-position</code></em>を含むようなバッファー位置をリターンする。他の言い方をすると、この値は同じ文字に属するすべてのバイト位置にたいして変化しない。
</p></blockquote></div><pre class="synopsis"><a id="idm74494672" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">multibyte-string-p</code> <em class="replaceable"><code>string</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>string</code></em>がマルチバイト文字列なら<code class="literal">t</code>、それ以外は<code class="literal">nil</code>をリターンする。この関数は、<em class="replaceable"><code>string</code></em>が文字列以外の場合にも、<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm74489296" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">string-bytes</code> <em class="replaceable"><code>string</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm74486736" class="indexterm"/><p>この関数は、<em class="replaceable"><code>string</code></em>内のバイトの数をリターンする。<em class="replaceable"><code>string</code></em>がマルチバイト文字列なら、これは<code class="literal">(length
<em class="replaceable"><code>string</code></em>)</code>より大きいかもしれない。
</p></blockquote></div><pre class="synopsis"><a id="idm74483664" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">unibyte-string</code> <em class="replaceable"><code>&amp;rest</code></em> <em class="replaceable"><code>bytes</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は引数<em class="replaceable"><code>bytes</code></em>をすべて結合して、その結果をユニバイト文字列で作成する。
</p></blockquote></div></div><div class="footnotes"><br/><hr/><div id="ftn.idm74526288" class="footnote"><p><a href="#idm74526288" class="para"><sup class="para">[15] </sup></a>この内部表現は、任意のUnicodeコードポイントを表すための、<em class="firstterm">UTF-8</em>と呼ばれるUnicode標準によるエンコーディングの1つにもとづきますが、8ビットrawバイトおよびUnicodeに統一されていない文字を使用する追加のコードポイントを表現するために、EmacsはUTF-8を拡張しています。</p></div></div></div></body></html>