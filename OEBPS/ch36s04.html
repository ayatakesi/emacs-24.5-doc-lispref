<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Looking Up and Expanding Abbreviations</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Abbrev-Expansion"/>Looking Up and Expanding Abbreviations</h1></div></div></div><a id="idm79746640" class="indexterm"/><a id="idm79745872" class="indexterm"/><a id="idm79745104" class="indexterm"/><p>abbrevは通常、<code class="literal">self-insert-command</code>を含む、特定のinteractiveなコマンドにより展開されます。このセクションでは、そのようなコマンドの記述に使用されるサブルーチン、並びに通信のために使用される変数について説明します。
</p><pre class="synopsis"><a id="idm79743184" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">abbrev-symbol</code> <em class="replaceable"><code>abbrev</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>table</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>abbrev</code></em>という名前のabbrevを表すシンボルをリターンする。そのabbrevが定義されていなければ、<code class="literal">nil</code>をリターンする。オプションの2つ目の引数<em class="replaceable"><code>table</code></em>は、それを照合するためのabbrevテーブルである。<em class="replaceable"><code>table</code></em>が<code class="literal">nil</code>なら、この関数はまずカレントバッファーのローカルabbrevテーブル、次にグローバルabbrevテーブルを試みる。
</p></blockquote></div><pre class="synopsis"><a id="idm79736912" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">abbrev-expansion</code> <em class="replaceable"><code>abbrev</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>table</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>abbrev</code></em>が展開されるであろう文字列(カレントバッファーにたいして使用されるabbrevテーブルで定義される文字列)をリターンする。これは<em class="replaceable"><code>abbrev</code></em>が有効なabbrevでなければ、<code class="literal">nil</code>をリターンする。オプション引数<em class="replaceable"><code>table</code></em>は<code class="literal">abbrev-symbol</code>の場合と同様、使用するabbrevテーブルを指定する。
</p></blockquote></div><pre class="synopsis"><a id="idm79730768" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">expand-abbrev</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドは、(もしあれば)ポイントの前のabbrevを展開する。ポイントがabbrevの後になければ、このコマンドは何もしない。展開を行うために、これは変数<code class="literal">abbrev-expand-function</code>の値となっている関数を引数なしで呼び出し、何であれその関数がリターンしたものをリターンする。
</p><p>デフォルトの展開関数は、展開を行ったらabbrevのシンボル、それ以外は<code class="literal">nil</code>をリターンする。そのabbrevシンボルが、<code class="literal">no-self-insert</code>プロパティが非<code class="literal">nil</code>のシンボルであるようなフック関数をもち、そのフック関数が値として<code class="literal">nil</code>をリターンした場合は、たとえ展開が行われたとしても、デフォルト展開関数は<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm79724496" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">abbrev-insert</code> <em class="replaceable"><code>abbrev</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<code class="literal">start</code>と<code class="literal">end</code>の間のテキストを置換することにより、<code class="literal">abbrev</code>のabbrev展開形を挿入する。<code class="literal">start</code>が省略された場合のデフォルトは、ポイントである。<code class="literal">name</code>が非<code class="literal">nil</code>なら、それはこのabbrevが見つかった名前(文字列)であること。これは展開形のcapitalizationを調整するかどうかを判断するために使用される。この関数は、abbrevの挿入に成功したら<code class="literal">abbrev</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm79716176" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">abbrev-prefix-mark</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>arg</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このコマンドは、ポイントのカレント位置を、abbrevの開始としてマークする。<code class="literal">expand-abbrev</code>の次回呼び出しでは、通常のように以前の単語ではなく、ここからポイント(その時点での位置)にあるテキストが展開するべきabbrevとして使用される。
</p><p>このコマンドはまず、<em class="replaceable"><code>arg</code></em>が<code class="literal">nil</code>なら、ポイントの前の任意のabbrevを展開する(インタラクティブな呼び出しでは、<em class="replaceable"><code>arg</code></em>はプレフィクス引数である)。それから、展開する次のabbrevの開始を示すために、ポイントの前にハイフンを挿入する。実際の展開では、ハイフンは削除される。
</p></blockquote></div><pre class="synopsis"><a id="idm79710416" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">abbrev-all-caps</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これが非<code class="literal">nil</code>にセットされているときは、すべて大文字で入力されたabbrevは、すべて大文字を使用して展開される。それ以外なら、すべて大文字で入力されたabbrevは、展開形の単語ごとにcapitalizeして展開される。
</p></blockquote></div><pre class="synopsis"><a id="idm79707216" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">abbrev-start-location</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、次にabbrevを展開する開始位置として<code class="literal">expand-abbrev</code>に使用される、バッファー位置である。値は<code class="literal">nil</code>も可能で、かわりにポイントの前の単語を使用することを意味する。<code class="literal">abbrev-start-location</code>は、<code class="literal">expand-abbrev</code>の呼び出しごとに、毎回<code class="literal">nil</code>にセットされる。この変数は、<code class="literal">abbrev-prefix-mark</code>によってもセットされる。
</p></blockquote></div><pre class="synopsis"><a id="idm79701456" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">abbrev-start-location-buffer</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、<code class="literal">abbrev-start-location</code>がセットされたバッファーである。他のバッファーでabbrev展開を試みることにより、<code class="literal">abbrev-start-location</code>はクリアーされる。この変数は、<code class="literal">abbrev-prefix-mark</code>によりセットされる。
</p></blockquote></div><pre class="synopsis"><a id="idm79697104" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">last-abbrev</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これは、直近のabbrev展開の<code class="literal">abbrev-symbol</code>である。これは、<code class="literal">unexpand-abbrev</code>コマンド(section “Expanding Abbrevs” in <em class="citetitle">The GNU Emacs
Manual</em>を参照)のために、<code class="literal">expand-abbrev</code>により残された情報である。
</p></blockquote></div><pre class="synopsis"><a id="idm79692496" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">last-abbrev-location</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これは、直近の.abbrev展開の場所である。これには、<code class="literal">unexpand-abbrev</code>コマンドのために<code class="literal">expand-abbrev</code>により残された情報が含まれる。
</p></blockquote></div><pre class="synopsis"><a id="idm79684688" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">last-abbrev-text</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これは直近のabbrev展開の正確な展開形を、(もしあれば)大文字小文字変換した後のテキストである。そのabbrevがすでに非展開されていれば、値は<code class="literal">nil</code>になる。これには<code class="literal">unexpand-abbrev</code>コマンドのために、<code class="literal">expand-abbrev</code>により残された情報が含まれる。
</p></blockquote></div><pre class="synopsis"><a id="idm79680464" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">abbrev-expand-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、展開を行うために<code class="literal">expand-abbrev</code>が引数なしで呼び出すであろう関数である。この関数では、展開を行う前後に行いたいことを行うことができる。展開が行われた場合は、そのabbrevシンボルをリターンすること。
</p></blockquote></div><p>以下のサンプルコードで、<code class="literal">abbrev-expand-function</code>のシンプルな使い方を示します。このサンプルでは、<code class="literal">foo-mode</code>が‘<code class="literal">#</code>’で始まる行がコメントであるような、特定のファイルを編集するためのモードであるとします。それらコメント行にたいしては、Textモードのabbrevの使用が望ましく、その他すべての行にたいしては、正規のローカルabbrevテーブル<code class="literal">foo-mode-abbrev-table</code>が適しています。<code class="literal">local-abbrev-table</code>と<code class="literal">text-mode-abbrev-table</code>の定義については、<a class="link" href="ch36s05.html" title="Standard Abbrev Tables">Standard
Abbrev Tables</a>を参照してください。<code class="literal">add-function</code>についての詳細は、<a class="link" href="ch13s10.html" title="Advising Emacs Lisp Functions">Advising
Functions</a>を参照してください。
</p><pre class="screen">(defun foo-mode-abbrev-expand-function (expand)
  (if (not (save-excursion (forward-line 0) (eq (char-after) ?#)))
      ;; 通常の展開を行う
      (funcall expand)
    ;; コメント内はtext-modeのabbrevを使用
    (let ((local-abbrev-table text-mode-abbrev-table))
      (funcall expand))))

(add-hook 'foo-mode-hook
          #'(lambda ()
              (add-function :around (local 'abbrev-expand-function)
                            #'foo-mode-abbrev-expand-function)))
</pre></div></body></html>