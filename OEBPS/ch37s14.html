<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Network Connections</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Network"/>Network Connections</h1></div></div></div><a id="idm78670928" class="indexterm"/><a id="idm78670160" class="indexterm"/><a id="idm78669392" class="indexterm"/><p>Emacs
Lispプログラムは、同一マシンまたは他のマシン上の別プロセスにたいして、ストリーム(TCP)およびデータグラム(UDP)のネットワーク接続(<a class="link" href="ch37s16.html" title="Datagrams">Datagrams</a>を参照)をオープンできます。ネットワーク接続はLispにより、サブプロセスと同様に処理され、プロセスオブジェクトとして表されます。しかし対話を行うそのプロセスは、Emacsの子プロセスではなく、プロセス<acronym class="acronym">ID</acronym>をもたず、それをkillしたりシグナルを送信することはできません。行うことができるのは、データの送信と受信だけです。<code class="literal">delete-process</code>は接続をクローズしますが、他端のプログラムをkillしません。そのプログラムは接続のクローズについて何を行うか、決定しなければなりません。
</p><p>ネットワークサーバーを作成することにより、Lispプログラムは接続をlistenできます。ネットワークサーバーもある種のプロセスオブジェクトとして表されますが、ネットワーク接続とは異なり、ネットワークサーバーがデータ自体を転送することは決してありません。接続リクエストを受信したときは、それにたいして作成した接続を表す、新たなネットワーク接続を作成します(そのネットワーク接続はサーバーから、プロセスplistを含む特定の情報を継承する)。その後、ネットワークサーバーは更なる接続リクエストのlistenに戻ります。
</p><p>ネットワーク接続およびサーバーは、キーワード/引数のペアーで構成される引数リストで<code class="literal">make-network-process</code>を呼び出すことにより作成されます。たとえば<code class="literal">:server
t</code>はサーバープロセス、<code class="literal">:type 'datagram</code>はデータグラム接続を作成します。詳細は<a class="link" href="ch37s17.html" title="Low-Level Network Access">Low-Level
Network</a>を参照してください。以下で説明する<code class="literal">open-network-stream</code>を使用することもできます。
</p><p>異なるプロセスのタイプを区別するために、<code class="literal">process-type</code>関数はネットワーク接続またはサーバーにたいしてはシンボル<code class="literal">network</code>、シリアルポート接続は<code class="literal">serial</code>、実際のサブプロセスにたいしては<code class="literal">real</code>をリターンします。
</p><p>ネットワーク接続にたいして、<code class="literal">process-status</code>関数は<code class="literal">open</code>、<code class="literal">closed</code>、<code class="literal">connect</code>、<code class="literal">failed</code>をリターンします。ネットワークサーバーにたいしては、状態は常に<code class="literal">listen</code>になります。実際のサブプロセスにたいしては、これらの値はリターンされません。<a class="link" href="ch37s06.html" title="Process Information">Process
Information</a>を参照してください。
</p><p><code class="literal">stop-process</code>と<code class="literal">continue-process</code>を呼び出すことにより、ネットワークプロセスの処理の停止と再開が可能です。サーバープロセスにたいする停止は、新たな接続の受け付けないことを意味します(サーバー再開時は5つまでの接続リクエストがキューされる。これがOSによる制限でなければこの制限は増やすことができる。<a class="link" href="ch37s17.html#Network-Processes" title="make-network-process">Network
Processes</a>の<code class="literal">make-network-process</code>の<code class="literal">:server</code>を参照されたい)。ネットワークストリーム接続にたいしては、停止は入力の処理を行わないことを意味します(到着するすべての入力は接続の再開まで待つ)。データグラム接続にたいしては、いくらかのパケットはキューされますが、入力は失われるかもしれません。ネットワーク接続またはサーバーが停止しているかどうかを判断するために、関数<code class="literal">process-command</code>を使用できます。これが非<code class="literal">nil</code>なら停止しています。
</p><a id="idm78640720" class="indexterm"/><a id="idm78639952" class="indexterm"/><a id="idm78639184" class="indexterm"/><a id="idm78638160" class="indexterm"/><p>ビルトインまたは外部のサポートを使用することにより、Emacsは暗号化されたネットワーク接続を作成できます。ビルトインのサポートはGnuTLSライブラリー(“TLS:
Transport Layer Security”)を使用します。<a class="ulink" href="http://www.gnu.org/software/gnutls/">the GnuTLS project
page</a>を参照してください。GnuTLSサポートつきでEmacsをコンパイルした場合は、関数<code class="literal">gnutls-available-p</code>が定義され、非<code class="literal">nil</code>をリターンします。詳細はsee section “Overview” in <em class="citetitle">The Emacs-GnuTLS
manual</em>を参照してください。外部のサポートの場合は、<code class="filename">starttls.el</code>ライブラリーを使用します。これはシステム上に<span class="command"><strong>gnutls-cli</strong></span>のようなヘルパーユーティリティーのインストールを必要とします。<code class="literal">open-network-stream</code>関数は、何であれ利用可能なサポートを使用して、暗号化接続作成の詳細を透過的に処理できます。
</p><pre class="synopsis"><a id="idm78604368" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">open-network-stream</code> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>buffer</code></em> <em class="replaceable"><code>host</code></em> <em class="replaceable"><code>service</code></em> <em class="replaceable"><code>&amp;rest</code></em> <em class="replaceable"><code>parameters</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、オプションで暗号つきでTCP接続をオープンして、その接続を表すプロセスオブジェクトをリターンする。
</p><p><em class="replaceable"><code>name</code></em>引数は、プロセスオブジェクトの名前を指定する。これは必要に応じて一意になるよう修正される。
</p><p><em class="replaceable"><code>buffer</code></em>引数は、その接続に関連付けるバッファーである。その接続からの出力は、その出力を処理する独自のフィルター関数を指定していなければ、<em class="replaceable"><code>buffer</code></em>が<code class="literal">nil</code>なら、その接続はバッファーに関連付けられない。
</p><p>引数<em class="replaceable"><code>host</code></em>と<em class="replaceable"><code>service</code></em>は、どこに接続するかを指定する。<em class="replaceable"><code>host</code></em>はホスト名(文字列)、<em class="replaceable"><code>service</code></em>は定義済みのネットワークサービス名(文字列)、またはポート番号(数字)である。
</p><p>残りの引数<em class="replaceable"><code>parameters</code></em>は、主に暗号化された接続に関連する、キーワード/引数のペアーである:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:nowait <em class="replaceable"><code>boolean</code></em></code>
</span></dt><dd><p>非<code class="literal">nil</code>なら非同期接続を試みる。
</p></dd><dt><span class="term"><code class="literal">:type <em class="replaceable"><code>type</code></em></code>
</span></dt><dd><p>接続のタイプ。オプションは以下のとおり:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">plain</code>
</span></dt><dd><p>通常の暗号化されていない接続。
</p></dd><dt><span class="term"><code class="literal">tls</code>
, </span><span class="term"><code class="literal">ssl</code>
</span></dt><dd><p><acronym class="acronym">TLS</acronym>(“Transport Layer Security”)接続。
</p></dd><dt><span class="term"><code class="literal">nil</code>
, </span><span class="term"><code class="literal">network</code>
</span></dt><dd><p>plain接続を開始して、パラメーター‘<code class="literal">:success</code>’および‘<code class="literal">:capability-command</code>’が与えられたら、<acronym class="acronym">STARTTLS</acronym>を通じて暗号化接続への更新を試みる。これが失敗したら、暗号化されていない接続のまま留まる。
</p></dd><dt><span class="term"><code class="literal">starttls</code>
</span></dt><dd><p><code class="literal">nil</code>と同様だが、<acronym class="acronym">STARTTLS</acronym>が失敗したらその接続を切断する。
</p></dd><dt><span class="term"><code class="literal">shell</code>
</span></dt><dd><p>shell接続。
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">:always-query-capabilities <em class="replaceable"><code>boolean</code></em></code>
</span></dt><dd><p>非<code class="literal">nil</code>なら、たとえ‘<code class="literal">plain</code>’な接続を行っているときでも、常にサーバーの能力を問い合わせる。
</p></dd><dt><span class="term"><code class="literal">:capability-command <em class="replaceable"><code>capability-command</code></em></code>
</span></dt><dd><p>ホストの能力を問い合わせるためのコマンド文字列。
</p></dd><dt><span class="term"><code class="literal">:end-of-command <em class="replaceable"><code>regexp</code></em></code>
, </span><span class="term"><code class="literal">:end-of-capability <em class="replaceable"><code>regexp</code></em></code>
</span></dt><dd><p>コマンドの終端、またはコマンド<em class="replaceable"><code>capability-command</code></em>の終端にマッチする正規表現。前者は後者のデフォルトである。
</p></dd><dt><span class="term"><code class="literal">:starttls-function <em class="replaceable"><code>function</code></em></code>
</span></dt><dd><p>単一の引数(<em class="replaceable"><code>capability-command</code></em>にたいする応答)をとり<code class="literal">nil</code>、またはサポートされていれば<acronym class="acronym">STARTTLS</acronym>をアクティブにするコマンドをリターンする関数。
</p></dd><dt><span class="term"><code class="literal">:success <em class="replaceable"><code>regexp</code></em></code>
</span></dt><dd><p>成功した<acronym class="acronym">STARTTLS</acronym>ネゴシェーションにマッチする正規表現。
</p></dd><dt><span class="term"><code class="literal">:use-starttls-if-possible <em class="replaceable"><code>boolean</code></em></code>
</span></dt><dd><p>非<code class="literal">nil</code>なら、たとえEmacsがビルトインの<acronym class="acronym">TLS</acronym>サポートをもっていなくても、日和見的(opportunistic)に<acronym class="acronym">STARTTLS</acronym>アップグレードを行う。
</p></dd><dt><span class="term"><code class="literal">:client-certificate <em class="replaceable"><code>list-or-t</code></em></code>
</span></dt><dd><p>証明書(certificate)のキーと、証明書のファイル自身を命名する<code class="literal">(<em class="replaceable"><code>key-file</code></em>
<em class="replaceable"><code>cert-file</code></em>)</code>という形式のリスト、またはこの情報にたいして<code class="literal">auth-source</code>を尋ねることを意味する<code class="literal">t</code>のいずれか(section “Overview” in <em class="citetitle">The Auth-Source
Manual</em>を参照)。<acronym class="acronym">TLS</acronym>または<acronym class="acronym">STARTTLS</acronym>にたいしてのみ使用される。
</p></dd><dt><span class="term"><code class="literal">:return-list <em class="replaceable"><code>cons-or-nil</code></em></code>
</span></dt><dd><p>この関数のリターン値。省略または<code class="literal">nil</code>なら、プロセスオブジェクトをリターンする。それ以外なら、<code class="literal">(<em class="replaceable"><code>process-object</code></em>
. <em class="replaceable"><code>plist</code></em>)</code>という形式のコンスセルをリターンする。ここで<em class="replaceable"><code>plist</code></em>は以下のキーワードである:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:greeting <em class="replaceable"><code>string-or-nil</code></em></code>
</span></dt><dd><p>非<code class="literal">nil</code>なら、ホストからリターンされたgreeting(挨拶)文字列。
</p></dd><dt><span class="term"><code class="literal">:capabilities <em class="replaceable"><code>string-or-nil</code></em></code>
</span></dt><dd><p>非<code class="literal">nil</code>なら、ホストの能力(capability)文字列。
</p></dd><dt><span class="term"><code class="literal">:type <em class="replaceable"><code>symbol</code></em></code>
</span></dt><dd><p>接続タイプで、‘<code class="literal">plain</code>’か‘<code class="literal">tls</code>’のいずれか。
</p></dd></dl></div></dd></dl></div></blockquote></div></div></body></html>