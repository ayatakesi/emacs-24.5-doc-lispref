<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Reporting Warnings</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Warnings"/>Reporting Warnings</h1></div></div></div><a id="idm81841872" class="indexterm"/><p><em class="firstterm">警告(warnings)</em>とは、プログラムがユーザーにたいして問題の可能性を知らせるが、実行は継続するための機能です。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Warning-Basics"/>Warning Basics</h2></div></div></div><a id="idm81839568" class="indexterm"/><p>すべての警告は、ユーザーに問題を説明するためのテキストのメッセージと、<em class="firstterm">重大レベル(severity
level)</em>をもっています。重大レベルはシンボルです。以下は可能性のある重大レベルとその意味を、重大度の降順でリストしたものです:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:emergency</code>
</span></dt><dd><p>直ちに対処しなければ、Emacs処理が間もなく深刻に害される問題。
</p></dd><dt><span class="term"><code class="literal">:error</code>
</span></dt><dd><p>本質的に悪いデータまたは状況のリポート。
</p></dd><dt><span class="term"><code class="literal">:warning</code>
</span></dt><dd><p>本質的に悪くはないが、可能性のある問題を励起する恐れのあるデータまたは状況のリポート。
</p></dd><dt><span class="term"><code class="literal">:debug</code>
</span></dt><dd><p>デバッグ中なら有用かもしれない情報のリポート。
</p></dd></dl></div><p>あなたのプログラムが無効な入力データに遭遇した際には、<code class="literal">error</code>呼び出しによるLispエラーのシグナルするか、または重大度<code class="literal">:error</code>の警告をリポートすることができます。Lispエラーのシグナルはもっとも簡単に行えることですが、それはプログラムが処理を継続できないことを意味します。間違ったデータでも処理を継続するための方法を実装するために、そのトラブルを受け取めたい場合には、その問題をユーザーに知らせるために、重大度<code class="literal">:error</code>の警告をリポートするのが正しい方法です。たとえばEmacs
Lispバイトコンパイラーはこの方法によりエラーを報告して、他の関数のコンパイルを継続できます(プログラムがLispエラーをシグナルして、それを<code class="literal">condition-case</code>でhandleしたなら、ユーザーがそのエラーを確認することはないだろう。これは警告としてリポートすることにより、ユーザーにメッセージを示すことができる)。
</p><a id="idm81829968" class="indexterm"/><p>クラス分けのために、それぞれの警告には<em class="firstterm">警告タイプ(warning
type)</em>があります。このタイプはシンボルのリストです。最初のシンボルは、そのプログラムのユーザーオプションとして使用する、カスタムグループであるべきです。たとえばバイトコンパイラーの警告は、警告タイプ<code class="literal">(bytecomp)</code>を使用します。もし望むなら、このリスト内で更にシンボルを使用することにより、警告をサブカテゴリー化することもできます。
</p><pre class="synopsis"><a id="idm81827664" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">display-warning</code> <em class="replaceable"><code>type</code></em> <em class="replaceable"><code>message</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>level</code></em> <em class="replaceable"><code>buffer-name</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数はメッセージとして<em class="replaceable"><code>message</code></em>、警告タイプとして<em class="replaceable"><code>type</code></em>を使用して、警告をリポートする。<em class="replaceable"><code>level</code></em>は重大レベルであること。デフォルトは<code class="literal">:warning</code>。
</p><p><em class="replaceable"><code>buffer-name</code></em>が非<code class="literal">nil</code>なら、それは警告をロギングするためのバッファー名を指定する。デフォルトは<code class="filename">*Warnings*</code>。
</p></blockquote></div><pre class="synopsis"><a id="idm81819600" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">lwarn</code> <em class="replaceable"><code>type</code></em> <em class="replaceable"><code>level</code></em> <em class="replaceable"><code>message</code></em> <em class="replaceable"><code>&amp;rest</code></em> <em class="replaceable"><code>args</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<code class="filename">*Warnings*</code>バッファー内のメッセージとして<code class="literal">(format <em class="replaceable"><code>message</code></em>
<em class="replaceable"><code>args</code></em>...)</code>の値を使用して、、警告をリポートする。他の点では、これは<code class="literal">display-warning</code>と同じである。
</p></blockquote></div><pre class="synopsis"><a id="idm81808464" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">warn</code> <em class="replaceable"><code>message</code></em> <em class="replaceable"><code>&amp;rest</code></em> <em class="replaceable"><code>args</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数はメッセージとして<code class="literal">(format <em class="replaceable"><code>message</code></em>
<em class="replaceable"><code>args</code></em>...)</code>の値、タイプとして<code class="literal">(emacs)</code>、重大レベルとして<code class="literal">:warning</code>を使用して、警告をリポートする。これは互換性のためだけに存在する。固有な警告タイプを指定するべきであり、この関数の使用は推奨しない。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Warning-Variables"/>Warning Variables</h2></div></div></div><a id="idm81789136" class="indexterm"/><p>プログラムは、このセクション内で説明する変数をバインドすることにより、警告が表示される方法をカスタマイズできます。
</p><pre class="synopsis"><a id="idm81787728" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">warning-levels</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このリストは、警告の重大レベルの意味と、重大度の順序を定義する。それぞれの要素は1つの重大レベルを定義し、それらは重大度の降順で配置される。
</p><p>各要素は<code class="literal">(<em class="replaceable"><code>level</code></em> <em class="replaceable"><code>string</code></em>
<em class="replaceable"><code>function</code></em>)</code>という形式をもち、<em class="replaceable"><code>level</code></em>はその要素が定義する重大レベルである。<em class="replaceable"><code>string</code></em>はそのレベルのテキストによる説明である。<em class="replaceable"><code>string</code></em>は警告タイプ情報の配置箇所の指定に‘<code class="literal">%s</code>’を使用するか、さもなくばその情報を含まぬよう‘<code class="literal">%s</code>’を省略できる。
</p><p>オプションの<em class="replaceable"><code>function</code></em>が非<code class="literal">nil</code>なら、これはユーザーの注目を得るために引数なしで呼び出される関数であること。
</p><p>通常は、この変数の値を変更するべきではない。
</p></blockquote></div><pre class="synopsis"><a id="idm81779024" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">warning-prefix-function</code></pre><div class="blockquote"><blockquote class="blockquote"><p>値が非<code class="literal">nil</code>なら、それは警告用にプレフィックスを生成する関数であること。プログラムは、この変数を適切な関数にバインドできる。<code class="literal">display-warning</code>はwarningsバッファーがカレントの状態でこの関数を呼び出し、関数はそのバッファーにテキストを挿入できる。そのテキストが、警告メッセージの先頭になる。
</p><p>この関数は重大レベル、および<code class="literal">warning-levels</code>内でのその重大レベルのエントリーという、2つの引数で呼び出される。これは、エントリーとして使用するためのリストをリターンするべきである(この値は<code class="literal">warning-levels</code>の実際のメンバーである必要はない)。この値を構築することにより、関数はその警告の重大レベルを変更したり、与えられた重大レベルにたいして異なる処理を指定することができる。
</p><p>この変数の値が<code class="literal">nil</code>なら、呼び出される関数は存在しない。
</p></blockquote></div><pre class="synopsis"><a id="idm81773008" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">warning-series</code></pre><div class="blockquote"><blockquote class="blockquote"><p>プログラムは、次の警告がシリーズの開始であることを告げるために、この変数を<code class="literal">t</code>にバインドできる。複数の警告がシリーズを形成するということは、それぞれの警告にたいしてポイントが維持されるよう移動して、最後の警告にポイントが表示されるのではなく、そのシリーズの最初の警告にポイントを残すことを意味する。このシリーズは、そのローカルバインドが非バインドされて、<code class="literal">warning-series</code>が再び<code class="literal">nil</code>になったときに終了する。
</p><p>この値は、関数定義をもつシンボルでもよい。これは、次の警告によりwarningsバッファーがカレントの状態で、引数なしでその関数が呼び出されることを除き、<code class="literal">t</code>と等価である。この関数は、その警告シリーズのヘッダーの役目をもつであろうテキストを挿入できる。
</p><p>あるシリーズが開始されると、その値はwarningsバッファー内でシリーズ開始となるバッファー位置を指すマーカーとなる。
</p><p>この変数の通常の値は<code class="literal">nil</code>で、これはそれぞれの警告を個別に処理することを意味する。
</p></blockquote></div><pre class="synopsis"><a id="idm81766608" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">warning-fill-prefix</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>なら、それは各警告テキストのフィルに使用する、フィルプレフィックスを指定する。
</p></blockquote></div><pre class="synopsis"><a id="idm81763280" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">warning-type-format</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、警告メッセージ内の警告タイプを表示するための、フォーマットを指定する。この方法でフォーマットされたタイプは、<code class="literal">warning-levels</code>内のエントリー内の文字列制御下にあるメッセージに含まれることになる。デフォルト値は<code class="literal">"
(%s)"</code>。これを<code class="literal">""</code>にバインドすると、警告タイプはまったく表示されなくなる。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Warning-Options"/>Warning Options</h2></div></div></div><a id="idm81758160" class="indexterm"/><p>以下の変数は、何が発生したときにLispプログラムが警告をリポートするかを、ユーザーが制御するために使用されます。
</p><pre class="synopsis"><a id="idm81756752" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">warning-minimum-level</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このユーザーオプションは、ユーザーにたいして即座に表示されるべき、最小の重大レベルを指定する。デフォルトは<code class="literal">:warning</code>で、これは<code class="literal">:debug</code>警告を除くすべての警告が即座に表示されることを意味する。
</p></blockquote></div><pre class="synopsis"><a id="idm81753040" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">warning-minimum-log-level</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このユーザーオプションは、warningsバッファー内にログされるべき、最小の重大レベルを指定する。デフォルトは<code class="literal">:warning</code>で、これは<code class="literal">:debug</code>警告を除くすべての警告がログされることを意味する。
</p></blockquote></div><pre class="synopsis"><a id="idm81749328" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">warning-suppress-types</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このリストは、ユーザーにたいしてどの警告タイプを即座に表示するべきではないかを指定する。このリスト内の各要素は、シンボルのリストであること。それの要素が警告タイプ内の最初の要素にマッチしたら、その警告は即座に表示されない。
</p></blockquote></div><pre class="synopsis"><a id="idm81746640" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">warning-suppress-log-types</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このリストは、ユーザーにたいしてどの警告タイプがwarningsバッファーにログされるべきではないかを指定する。このリスト内の各要素は、シンボルのリストであること。それの要素が警告タイプ内の最初の数要素にマッチしたら、その警告はログされない。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Delayed-Warnings"/>Delayed Warnings</h2></div></div></div><a id="idm81743184" class="indexterm"/><p>コマンド実行中には警告の表示を避けて、コマンドの終わりでのみ警告を表示したいことがあるかもしれません。これは、変数<code class="literal">delayed-warnings-list</code>により行うことができます。
</p><pre class="synopsis"><a id="idm81741264" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">delayed-warnings-list</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、カレントのコマンド完了後に表示される警告のリストである。各要素は以下のようなリストでなければならない:
</p><pre class="screen">(<em class="replaceable"><code>type</code></em> <em class="replaceable"><code>message</code></em> [<em class="replaceable"><code>level</code></em> [<em class="replaceable"><code>buffer-name</code></em>]])
</pre><p>これらは、は<code class="literal">display-warning</code>の引数リストと同じ形式、同じ意味である(<a class="link" href="ch38s05.html#Warning-Basics" title="Warning Basics">Warning
Basics</a>を参照)。<code class="literal">post-command-hook</code>(<a class="link" href="ch21.html#Command-Overview" title="Command Loop Overview">Command
Overview</a>を参照)の実行直後、Emacsのコマンドループはこの変数で指定されたすべての警告を表示してから、変数を<code class="literal">nil</code>にリセットする。
</p></blockquote></div><p>遅延警告メカニズムをよりカスタマイズする必要があるプログラムは、変数<code class="literal">delayed-warnings-hook</code>を変更することができます:
</p><pre class="synopsis"><a id="idm81732688" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">delayed-warnings-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>これは遅延警告を処理して表示するために、<code class="literal">post-command-hook</code>の後にEmacsコマンドループが実行する、ノーマルフックである。
</p><p>デフォルト値は、2つの関数からなるリストである:
</p><pre class="screen">(collapse-delayed-warnings display-delayed-warnings)
</pre><a id="idm81728848" class="indexterm"/><a id="idm81728080" class="indexterm"/><p>関数<code class="literal">collapse-delayed-warnings</code>は、<code class="literal">delayed-warnings-list</code>から重複するエントリーを削除する。関数<code class="literal">display-delayed-warnings</code>は、<code class="literal">delayed-warnings-list</code>内の各要素にたいして順次<code class="literal">display-warning</code>を呼び出してから、<code class="literal">delayed-warnings-list</code>を<code class="literal">nil</code>にセットする。
</p></blockquote></div></div></div></body></html>