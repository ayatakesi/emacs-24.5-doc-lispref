<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Overlays</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Overlays"/>Overlays</h1></div></div></div><a id="idm81510992" class="indexterm"/><p>プレゼンテーション機能として、バッファーのテキストのスクリーン上の見栄えを変更するために、<em class="firstterm">オーバーレイ(overlay)</em>を使用できます。オーバーレイとは、個々のバッファーに属するオブジェクトであり、指定された開始と終了をもっています。確認したりセットすることができるプロパティももっています。それらはオーバーレイをもつテキストの表示に影響を与えます。
</p><a id="idm81509200" class="indexterm"/><p>オーバーレイの視覚的効果は、対応するテキストプロパティと同様です(<a class="link" href="ch32s19.html" title="Text Properties">Text
Properties</a>を参照)。しかし実装が異なるため、オーバーレイは一般的にスケーラブルではありません(処理数に応じて、バッファー内のオーバーレイ数に比例した時間を要する)。バッファー内の多数の部分の視覚的外観に効果を及ぼす必要がある場合は、テキストプロパティの使用を推奨します。
</p><p>オーバーレイは、その開始と終了を記録するために、マーカーを使用します。したがってバッファーのテキスト編集では、すべてのオーバーレイがそのテキストに留まるように、開始と終了が調整されます。オーバーレイ作成時には、オーバーレイ先頭、同様に終端にテキストが挿入された場合に、それがオーバーレイの内側あるいは外側であるべきかを指定できます。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Managing-Overlays"/>Managing Overlays</h2></div></div></div><a id="idm81506256" class="indexterm"/><a id="idm81505488" class="indexterm"/><p>このセクションでは、オーバーレイの作成、削除、移動、およびそれらのコンテンツを調べる関数を説明します。オーバーレイはバッファーのコンテンツの一部ではないので、その変更はバッファーのundoリストに記録されません。
</p><pre class="synopsis"><a id="idm81504080" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlayp</code> <em class="replaceable"><code>object</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>object</code></em>がオーバーレイなら<code class="literal">t</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm81499984" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">make-overlay</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>buffer</code></em> <em class="replaceable"><code>front-advance</code></em> <em class="replaceable"><code>rear-advance</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>buffer</code></em>に属し、<em class="replaceable"><code>start</code></em>から<em class="replaceable"><code>end</code></em>の範囲のオーバーレイを作成してリターンする。<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>はいずれもバッファーの位置を指定しなければならず、整数またはマーカーを指定できる。<em class="replaceable"><code>buffer</code></em>が省略された場合、そのオーバーレイはカレントバッファーに作成される。
</p><p>引数<em class="replaceable"><code>front-advance</code></em>と<em class="replaceable"><code>rear-advance</code></em>はそれぞれ、オーバーレイの開始と終了にたいするマーカーの挿入タイプを指定する。<a class="link" href="ch31s05.html" title="Marker Insertion Types">Marker
Insertion
Types</a>を参照のこと。どちらも<code class="literal">nil</code>(デフォルト)なら、そのオーバーレイは先頭に挿入された任意のテキストを含むように拡張されるが、終端に挿入されたテキストにたいしては拡張されない。<em class="replaceable"><code>front-advance</code></em>が非<code class="literal">nil</code>なら、オーバーレイの先頭に挿入されたテキストは、オーバーレイから除外される。<em class="replaceable"><code>rear-advance</code></em>が非<code class="literal">nil</code>なら、オーバーレイの終端に挿入されたテキストは、オーバーレイに含まれる。
</p></blockquote></div><pre class="synopsis"><a id="idm81488208" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-start</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>overlay</code></em>が開始する位置を整数でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm81480528" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-end</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>overlay</code></em>が終了する位置を整数でリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm81476944" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-buffer</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>overlay</code></em>が所属するバッファーをリターンする。<em class="replaceable"><code>overlay</code></em>が削除されていれば<code class="literal">nil</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm81468368" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">delete-overlay</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>overlay</code></em>を削除する。そのオーバーレイはLispオブジェクトとして存在し続け、そのプロパティリストは変更されないが、バッファーへの所属と表示にたいするすべての効果は失う。
</p><p>削除済みオーバーレイが、永続的に非接続という訳ではない。<code class="literal">move-overlay</code>を呼び出すことにより、バッファー内の位置を与えることができる。
</p></blockquote></div><pre class="synopsis"><a id="idm81451600" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">move-overlay</code> <em class="replaceable"><code>overlay</code></em> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>buffer</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>overlay</code></em>を<em class="replaceable"><code>buffer</code></em>に移動して、その境界を<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>に配する。<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>の引数はいずれもバッファーの位置を指定しなければならず、整数またはマーカーを指定できる。
</p><p><em class="replaceable"><code>buffer</code></em>が省略された場合、<em class="replaceable"><code>overlay</code></em>はすでに関連付けられている同じバッファーに留まる。さらに<em class="replaceable"><code>overlay</code></em>が削除されていたら、それをカレントバッファーに所属させる。
</p><p>リターン値は<em class="replaceable"><code>overlay</code></em>。
</p><p>これはオーバーレイの両端位置を変更する、唯一有効な方法である。手作業でオーバーレイ内のマーカーの変更を試みてはならない。それにより他の重要なデータ構造の更新が失敗して、いくつかのオーバーレイが“失われる”可能性がある。
</p></blockquote></div><pre class="synopsis"><a id="idm81437904" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">remove-overlays</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>name</code></em> <em class="replaceable"><code>value</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、プロパティ<em class="replaceable"><code>name</code></em>が値<em class="replaceable"><code>value</code></em>をもつ、<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>の間のすべてのオーバーレイを削除する。これによりオーバーレイの両端位置が変更されたり、分割される可能がある。
</p><p><em class="replaceable"><code>name</code></em>が省略または<code class="literal">nil</code>なら、それは指定されたリージョン内のすべてのオーバーレイを削除することを意味する。<em class="replaceable"><code>start</code></em>および/または<em class="replaceable"><code>end</code></em>が省略または<code class="literal">nil</code>なら、それぞれバッファーの先頭と終端を意味する。したがって<code class="literal">(remove-overlays)</code>は、カレントバッファー内のすべてのオーバーレイを削除する。
</p></blockquote></div><pre class="synopsis"><a id="idm81428560" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">copy-overlay</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>overlay</code></em>のコピーをリターンする。このコピーは<em class="replaceable"><code>overlay</code></em>と同じ両端位置とプロパティをもつ。しかしオーバーレイの開始と終了にたいするマーカー挿入タイプは、デフォルト値にセットされる(<a class="link" href="ch31s05.html" title="Marker Insertion Types">Marker
Insertion Types</a>を参照)。
</p></blockquote></div><p>以下にいくつか例を示します:
</p><pre class="screen">;; オーバーレイの作成
(setq foo (make-overlay 1 10))
     ⇒ #&lt;overlay from 1 to 10 in display.texi&gt;
(overlay-start foo)
     ⇒ 1
(overlay-end foo)
     ⇒ 10
(overlay-buffer foo)
     ⇒ #&lt;buffer display.texi&gt;
;; 後でチェックできるようプロパティ付与
(overlay-put foo 'happy t)
     ⇒ t
;; プロパティが付与されたか検証
(overlay-get foo 'happy)
     ⇒ t
;; オーバーレイを移動
(move-overlay foo 5 20)
     ⇒ #&lt;overlay from 5 to 20 in display.texi&gt;
(overlay-start foo)
     ⇒ 5
(overlay-end foo)
     ⇒ 20
;; オーバーレイを削除
(delete-overlay foo)
     ⇒ nil
;; 削除されたか検証
foo
     ⇒ #&lt;overlay in no buffer&gt;
;; 削除済みオーバーレイは位置をもたない
(overlay-start foo)
     ⇒ nil
(overlay-end foo)
     ⇒ nil
(overlay-buffer foo)
     ⇒ nil
;; オーバーレイの削除取り消し
(move-overlay foo 1 20)
     ⇒ #&lt;overlay from 1 to 20 in display.texi&gt;
;; 結果の検証
(overlay-start foo)
     ⇒ 1
(overlay-end foo)
     ⇒ 20
(overlay-buffer foo)
     ⇒ #&lt;buffer display.texi&gt;
;; オーバーレイの移動と削除では、オーバーレイのプロパティは変更されない
(overlay-get foo 'happy)
     ⇒ t
</pre><p>Emacsはそれぞれのバッファーのオーバーレイを、任意の“中心位置(center
position)”で分割される、2つのリストに格納します。一方のリストはバッファーの中心位置から後方へ拡張され、もう一方は中心位置から前方へと拡張されます。中心位置は、バッファーの任意の位置をとることができます。
</p><pre class="synopsis"><a id="idm81422800" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-recenter</code> <em class="replaceable"><code>pos</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーのオーバーレイを、位置<em class="replaceable"><code>pos</code></em>の周辺に再センタリングする。これにより位置<em class="replaceable"><code>pos</code></em>近傍のオーバーレイの照合は高速になるが、<em class="replaceable"><code>pos</code></em>から離れた位置にたいしては低速になる。
</p></blockquote></div><p>バッファーを前方にスキャンしてオーバーレイを作成するループは、最初に<code class="literal">(overlay-recenter
(point-max))</code>を行うことにより高速になる可能性があります。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Overlay-Properties"/>Overlay Properties</h2></div></div></div><a id="idm81416784" class="indexterm"/><p>オーバーレイプロパティは、文字が表示される方法をどちらのソースからも取得できるという点において、テキストプロパティと似ています。しかしほとんどの観点で、両者は異なります。これらの比較は<a class="link" href="ch32s19.html" title="Text Properties">Text
Properties</a>を参照してください。
</p><p>テキストプロパティは、そのテキストの一部として考えることができます。オーバーレイとそのプロパティは、特にテキストの一部としてはみなされません。したがって、さまざまなバッファーや文字列の間でテキストをコピーすると、テキストプロパティは保持されますが、オーバーレイを保持しようとは試みません。バッファーのテキストプロパティの変更は、そのバッファーを変更済みとマークしますが、オーバーレイの移動やプロパティの変更は違います。テキストプロパティの変更とは異なり、オーバーレイプロパティの変更は、バッファーのundoリストに記録されません。
</p><p>複数のオーバーレイが同じ文字にたいしてプロパティ値を指定できるので、Emacsは各オーバーレイにたいして優先度の指定を促します。2つのオーバーレイが同じ値の優先度をもち、一方が他方にネストされている場合には、内側のオーバーレイが外側のオーバーレイより高い優先度をもちます。いずれのオーバーレイも他方をネストしない場合には、どちらのオーバーレイが優先されるかについて予測するべきではありません。
</p><p>以下の関数は、オーバーレイのプロパティの読み取りとセットを行います:
</p><pre class="synopsis"><a id="idm81413712" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-get</code> <em class="replaceable"><code>overlay</code></em> <em class="replaceable"><code>prop</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>overlay</code></em>内に記録されたプロパティ<em class="replaceable"><code>prop</code></em>の値をリターンする。そのプロパティにたいして<em class="replaceable"><code>overlay</code></em>が何も値を記録していないが、シンボルであるような<code class="literal">category</code>プロパティをもつ場合は、そのシンボルの<em class="replaceable"><code>prop</code></em>プロパティが使用される。それ以外なら値は<code class="literal">nil</code>。
</p></blockquote></div><pre class="synopsis"><a id="idm81407568" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-put</code> <em class="replaceable"><code>overlay</code></em> <em class="replaceable"><code>prop</code></em> <em class="replaceable"><code>value</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>overlay</code></em>内に記録されたプロパティ<em class="replaceable"><code>prop</code></em>の値に、<em class="replaceable"><code>value</code></em>をセットする。リターン値は<em class="replaceable"><code>value</code></em>。
</p></blockquote></div><pre class="synopsis"><a id="idm81381584" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlay-properties</code> <em class="replaceable"><code>overlay</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>これは、<em class="replaceable"><code>overlay</code></em>のプロパティリストのコピーをリターンする。
</p></blockquote></div><p>与えられた文字にたいしてテキストプロパティとオーバーレイプロパティの両方をチェックする関数<code class="literal">get-char-property</code>も参照してください。<a class="link" href="ch32s19.html#Examining-Properties" title="Examining Text Properties">Examining
Properties</a>を参照してください。
</p><p>多くのオーバーレイプロパティには特別な意味があります。以下はそれらのテーブルです:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">priority</code>
</span></dt><dd><a id="idm81375312" class="indexterm"/><p>このプロパティの値は、そのオーバーレイの優先度を決定する。優先度にたいして値を指定したければ、<code class="literal">nil</code>(か0)、または正の整数を使用すること。それ以外のすべての値にたいして、動作は未定義である。
</p><p>2つ以上のオーバーレイが同じ文字をカバーし、いずれもが同じプロパティを指定する場合には、優先度が重要になる。他より<code class="literal">priority</code>の値が大きいほうが他をオーバーライドする。<code class="literal">face</code>プロパティにたいしては、より高い優先度のオーバーレイの値は、他の値を完全にはオーバーライドしない。かわりにより低い優先度の<code class="literal">face</code>プロパティのface属性を、高い優先度のface属性がオーバーライドする。
</p><p>現在のところ、すべてのオーバーレイはテキストプロパティより優先される。
</p><p>Emacsは内部的なオーバーレイのいくつかにたいして、非数値の優先度を使用することがあるので、(自分が作成したオーバーレイでない場合は)オーバーレイ優先度の算術演算を試みないよう注意すること。オーバーレイを優先度順に配す必要があるなら、<code class="literal">overlays-at</code>の<em class="replaceable"><code>sorted</code></em>引数を使用すること。<a class="link" href="ch38s09.html#Finding-Overlays" title="Searching for Overlays">Finding
Overlays</a>を参照されたい。
</p></dd><dt><span class="term"><code class="literal">window</code>
</span></dt><dd><a id="idm81368656" class="indexterm"/><p><code class="literal">window</code>プロパティが非<code class="literal">nil</code>なら、そのオーバーレイはそのウィンドウだけに適用される。
</p></dd><dt><span class="term"><code class="literal">category</code>
</span></dt><dd><a id="idm81365712" class="indexterm"/><p>オーバーレイが<code class="literal">category</code>プロパティをもつなら、それをそのオーバーレイの<em class="firstterm">カテゴリー(category)</em>と呼ぶ。これはシンボルであること。そのシンボルのプロパティは、そのオーバーレイのプロパティにたいしてデフォルトの役割を果たす。
</p></dd><dt><span class="term"><code class="literal">face</code>
</span></dt><dd><a id="idm81362768" class="indexterm"/><p>このプロパティはテキストの外観を制御する(<a class="link" href="ch38s12.html" title="Faces">Faces</a>を参照)。プロパティの値は以下のいずれか:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>フェイス名(シンボルか文字列)。
</p></li><li class="listitem"><p>anonymousフェイス: <code class="literal">(<em class="replaceable"><code>keyword</code></em> <em class="replaceable"><code>value</code></em>
…)</code>という形式のプロパティリストで、<em class="replaceable"><code>keyword</code></em>はフェイス属性名、<em class="replaceable"><code>value</code></em>はその属性の値。
</p></li><li class="listitem"><p>フェイスのリスト。リストの要素はそれぞれフェイス名か、anonymousフェイスのいずれかであること。これはリストされた各フェイスの属性を集約するフェイスを指定する。このリスト内で先に出現するフェイスが、より高い優先度をもつ。
</p></li><li class="listitem"><p><code class="literal">(foreground-color . <em class="replaceable"><code>color-name</code></em>)</code>または<code class="literal">(background-color
. <em class="replaceable"><code>color-name</code></em>)</code>という形式のコンスセル。これは<code class="literal">(:foreground
<em class="replaceable"><code>color-name</code></em>)</code>や<code class="literal">(:background
<em class="replaceable"><code>color-name</code></em>)</code>と同様、フォアグラウンドとバックグラウンドのカラーを指定する。この形式は後方互換性のためだけにサポートされており、避けるべきである。
</p></li></ul></div></dd><dt><span class="term"><code class="literal">mouse-face</code>
</span></dt><dd><a id="idm81352528" class="indexterm"/><p>このプロパティは、マウスがオーバーレイ範囲内にあるとき、<code class="literal">face</code>のかわりに使用される。しかしEmacsは、このプロパティのテキストのサイズを変更する、すべてのフェイス属性(<code class="literal">:height</code>、<code class="literal">:weight</code>、<code class="literal">:slant</code>)を無視する。これらの属性は、ハイライトされていないテキストでは、常に同一である。
</p></dd><dt><span class="term"><code class="literal">display</code>
</span></dt><dd><a id="idm81348432" class="indexterm"/><p>このプロパティは、テキストが表示される方法を変更する、さまざまな機能をアクティブにする。たとえばこれは、テキストの外観を縦長(taller)や横長(shorter)にしたり、高く(higher)したり低く(lower)したり、イメージで置き換える。<a class="link" href="ch38s16.html" title="The display Property">Display
Property</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">help-echo</code>
</span></dt><dd><a id="idm81345872" class="indexterm"/><p>あるオーバーレイが<code class="literal">help-echo</code>プロパティをもつなら、そのオーバーレイ内のテキスト上にマウスを移動した際、Emacsはエコーエリアまたはツールチップウィンドウにヘルプ文字列を表示する。詳細は<a class="link" href="ch32s19.html#Text-help_002decho">Text
help-echo</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">field</code>
</span></dt><dd><a id="idm81342800" class="indexterm"/><p>同じ<code class="literal">field</code>プロパティをもつ連続する文字は、<span class="emphasis"><em>フィールド(field)</em></span>を形成する。<code class="literal">forward-word</code>や<code class="literal">beginning-of-line</code>を含むいくつかの移動関数は、フィールド境界で移動を停止する。<a class="link" href="ch32s19.html#Fields" title="Defining and Using Fields">Fields</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">modification-hooks</code>
</span></dt><dd><a id="idm81338064" class="indexterm"/><p>このプロパティの値は、オーバーレイ内の任意の文字の変更、またはオーバーレイの厳密に内側にテキストが挿入された場合に呼び出される、関数のリストである。
</p><p>このフックの関数は、各変更の前後両方で呼び出される。これらの関数が受け取った情報を保存し、呼び出し間で記録を比較すれば、バッファー内のテキストでどのような変更が行われたかを、正確に判断できる。
</p><p>変更前に呼び出された際、各関数はオーバーレイ、<code class="literal">nil</code>、変更されたテキスト範囲の開始と終了という、4つの引数を受け取る。
</p><p>変更後に呼び出された際、各関数はオーバーレイ、<code class="literal">t</code>、変更されたテキスト範囲の開始と終了、およびその範囲により置き換えられた変更前のテキスト長という、5つの引数を受け取る(変更前の長さは、挿入では0、削除では削除された文字数であり、変更後の先頭と終端が等しくなる)。
</p><p>これらの関数がバッファーを変更する場合は、これらのフックを呼び出す内部的メカニズムの混乱を避けるために、それを行う前後で<code class="literal">inhibit-modification-hooks</code>を<code class="literal">t</code>にバインドすること。
</p><p>テキストプロパティも<code class="literal">modification-hooks</code>プロパティをサポートするが、詳細は幾分か異なる(<a class="link" href="ch32s19.html#Special-Properties" title="Properties with Special Meanings">Special
Properties</a>を参照)。
</p></dd><dt><span class="term"><code class="literal">insert-in-front-hooks</code>
</span></dt><dd><a id="idm81318736" class="indexterm"/><p>このプロパティの値は、オーバーレイ先頭へのテキスト挿入前後に呼び出される、関数のリストである。呼び出し方は、<code class="literal">modification-hooks</code>の関数と同様。
</p></dd><dt><span class="term"><code class="literal">insert-behind-hooks</code>
</span></dt><dd><a id="idm81316176" class="indexterm"/><p>このプロパティの値は、オーバーレイ終端へのテキスト挿入前後に呼び出される、関数のリストである。呼び出し方は、<code class="literal">modification-hooks</code>の関数と同様。
</p></dd><dt><span class="term"><code class="literal">invisible</code>
</span></dt><dd><a id="idm81313616" class="indexterm"/><p><code class="literal">invisible</code>プロパティにより、オーバーレイ内のテキストを不可視似出来る。これはそのテキストが、スクリーン上に表示されないことを意味する。詳細は、See <a class="link" href="ch38s06.html" title="Invisible Text">Invisible
Text</a>を下さいのこと。
</p></dd><dt><span class="term"><code class="literal">intangible</code>
</span></dt><dd><a id="idm81310672" class="indexterm"/><p>オーバーレイの<code class="literal">intangible</code>プロパティは、正に<code class="literal">intangible</code>テキストプロパティと同様に機能する。詳細はSee <a class="link" href="ch32s19.html#Special-Properties" title="Properties with Special Meanings">Special
Properties</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">isearch-open-invisible</code>
</span></dt><dd><p>このプロパティは、インクリメンタル検索にたいして、最後のマッチがそのオーバーレイに重なる場合に、不可視なオーバーレイを永続的に可視にする方法を告げる。<a class="link" href="ch38s06.html" title="Invisible Text">Invisible
Text</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">isearch-open-invisible-temporary</code>
</span></dt><dd><p>このプロパティは、インクリメンタル検索にたいして、検索の間に、不可視なオーバーレイを一時的に可視にする方法を告げる。<a class="link" href="ch38s06.html" title="Invisible Text">Invisible
Text</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">before-string</code>
</span></dt><dd><a id="idm81303504" class="indexterm"/><p>このプロパティの値は、オーバーレイ先頭に表示するために追加する文字列である。この文字列は、いかなる意味においてもバッファー内には表れず、スクリーン上にのみ表れる。
</p></dd><dt><span class="term"><code class="literal">after-string</code>
</span></dt><dd><a id="idm81301456" class="indexterm"/><p>このプロパティの値は、オーバーレイ終端に表示するために追加する文字列である。この文字列は、いかなる意味においてもバッファー内には表れず、スクリーン上にのみ表れる。
</p></dd><dt><span class="term"><code class="literal">line-prefix</code>
</span></dt><dd><p>このプロパティは、表示時にそれぞれの非継続行の後に追加する、表示仕様(display
spec)を指定する。<a class="link" href="ch38s03.html" title="Truncation">Truncation</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">wrap-prefix</code>
</span></dt><dd><p>このプロパティは、表示時にそれぞれの継続行の前に追加する、表示仕様(display spec)を指定する。<a class="link" href="ch38s03.html" title="Truncation">Truncation</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">evaporate</code>
</span></dt><dd><a id="idm81295824" class="indexterm"/><p>このプロパティが非<code class="literal">nil</code>の場合は、そのオーバーレイが空(長さが0)になったら、自動的に削除される。空のオーバーレイにたいして非<code class="literal">nil</code>の<code class="literal">evaporate</code>プロパティを与えた場合は、即座に削除される。
</p></dd><dt><span class="term"><code class="literal">keymap</code>
</span></dt><dd><a id="idm81292240" class="indexterm"/><a id="idm81291472" class="indexterm"/><p>このプロパティがから<code class="literal">nil</code>なら、それはそのテキスト範囲にたいしてキーマップを指定する。このキーマップは、ポイントの後の文字がそのオーバーレイ内にあるときに使用され、他のほとんどのキーマップより優先される。<a class="link" href="ch22s07.html" title="Active Keymaps">Active
Keymaps</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">local-map</code>
</span></dt><dd><a id="idm81288400" class="indexterm"/><p><code class="literal">local-map</code>プロパティは<code class="literal">keymap</code>プロパティと同様だが、既存のキーマップに付け加えるのではなく、バッファーのローカルマップを置き換える点が異なる。これは、そのキーマップがマイナーモードキーマップより低い優先度をもつことも意味する。
</p></dd></dl></div><p><code class="literal">keymap</code>と<code class="literal">local-map</code>プロパティは、<code class="literal">before-string</code>、<code class="literal">after-string</code>、<code class="literal">display</code>プロパティにより表示された文字列には影響しません。これはポイントがその文字列上にない場合の、マウスクリックや、その文字列に関する他のマウスイベントにのみ関係があります。その文字列に特別なマウスイベントをバインドするには、そのイベントを<code class="literal">keymap</code>か<code class="literal">local-map</code>プロパティに割り当てます。<a class="link" href="ch32s19.html#Special-Properties" title="Properties with Special Meanings">Special
Properties</a>を参照してください。
</p></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Finding-Overlays"/>Searching for Overlays</h2></div></div></div><a id="idm81280976" class="indexterm"/><a id="idm81280208" class="indexterm"/><pre class="synopsis"><a id="idm81279184" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlays-at</code> <em class="replaceable"><code>pos</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>sorted</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファー内の位置<em class="replaceable"><code>pos</code></em>にある文字をカバーする、すべてオーバーレイのリストをリターンする。<em class="replaceable"><code>sorted</code></em>が非<code class="literal">nil</code>ならリストは優先度降順、それ以外なら特定の順にはソートされない。オーバーレイが<em class="replaceable"><code>pos</code></em>、またはそれより前から始まり、かつ<em class="replaceable"><code>pos</code></em>の後で終わる場合、位置<em class="replaceable"><code>pos</code></em>はオーバーレイに含まれる。
</p><p>使い方を説明するために、ポイント位置の文字にたいして、プロパティ<em class="replaceable"><code>prop</code></em>を指定するオーバーレイのリストをリターンするLisp関数である:
</p><pre class="screen">(defun find-overlays-specifying (prop)
  (let ((overlays (overlays-at (point)))
        found)
    (while overlays
      (let ((overlay (car overlays)))
        (if (overlay-get overlay prop)
            (setq found (cons overlay found))))
      (setq overlays (cdr overlays)))
    found))
</pre></blockquote></div><pre class="synopsis"><a id="idm81267280" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">overlays-in</code> <em class="replaceable"><code>beg</code></em> <em class="replaceable"><code>end</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>beg</code></em>から<em class="replaceable"><code>end</code></em>のリージョンと重複(overlap)する、オーバーレイのリストをリターンする。“重複”とは、少なくとも1つの文字がそのオーバーレイに含まれ、かつ指定されたリージョンにも含まれることを意味する。しかし、空のオーバーレイが<em class="replaceable"><code>beg</code></em>、厳密に言うと<em class="replaceable"><code>beg</code></em>と<em class="replaceable"><code>end</code></em>にある場合、または<em class="replaceable"><code>end</code></em>がバッファーの終端を示す場合は、その空のオーバーレイも結果に含まれる。
</p></blockquote></div><pre class="synopsis"><a id="idm81257296" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">next-overlay-change</code> <em class="replaceable"><code>pos</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>pos</code></em>の後にあるオーバーレイの、開始または終了となるバッファー位置をリターンする。それが存在しなければ<code class="literal">(point-max)</code>をリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm81253200" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">previous-overlay-change</code> <em class="replaceable"><code>pos</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>pos</code></em>の前にあるオーバーレイの、開始または終了となるバッファー位置をリターンする。それが存在しなければ<code class="literal">(point-min)</code>をリターンする。
</p></blockquote></div><p>以下に例として、プリミティブ関数<code class="literal">next-single-char-property-change</code>(<a class="link" href="ch32s19.html#Property-Search" title="Text Property Search Functions">Property
Search</a>を参照)の、単純化(かつ非効率的な)したバージョンを示します。これは位置<em class="replaceable"><code>pos</code></em>から前方へ、与えられたプロパティ<code class="literal">prop</code>にたいして、オーバーレイプロパティまたはテキストプロパティのいずれかの値が変化した、次の位置を検索します。
</p><pre class="screen">(defun next-single-char-property-change (position prop)
  (save-excursion
    (goto-char position)
    (let ((propval (get-char-property (point) prop)))
      (while (and (not (eobp))
                  (eq (get-char-property (point) prop) propval))
        (goto-char (min (next-overlay-change (point))
                        (next-single-property-change (point) prop)))))
    (point)))
</pre></div></div></body></html>