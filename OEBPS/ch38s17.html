<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Images</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Images"/>Images</h1></div></div></div><a id="idm83823696" class="indexterm"/><p>Emacsバッファー内にイメージを表示するためには、最初にイメージディスクリプタを作成して、それを表示されるテキストの<code class="literal">display</code>プロパティ(<a class="link" href="ch38s16.html" title="The display Property">Display
Property</a>を参照)内のディスプレイ指定子として使用しなければなりません。
</p><p>Emacsはグラフィカルな端末で実行時は、通常はイメージの表示が可能です。テキスト端末、イメージサポートを欠く特定のグラフ^ィカル端末、またはイメージサポートなしでコンパイルされたEmacsでは、イメージは表示できません。原則イメージが表示可能か判断するためには、関数<code class="literal">display-images-p</code>を使用できます(<a class="link" href="ch29s23.html" title="Display Feature Testing">Display
Feature Testing</a>を参照)。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Image-Formats"/>Image Formats</h2></div></div></div><a id="idm83819216" class="indexterm"/><a id="idm83818448" class="indexterm"/><p>Emacsは、いくつかの異なるフォーマットのイメージを表示できます。これらのイメージフォーマットのいくつかは、特定のサポートライブラリーがインストールされている場合のみサポートされます。いくつかのプラットフォームでは、Emacsはオンデマンドでサポートライブラリーをロードできます。そのような場合には、それらの動的ライブラリーにたいする既知の名前セットを変更するために、変数<code class="literal">dynamic-library-alist</code>を使用できます。<a class="link" href="ch39s20.html" title="Dynamically Loaded Libraries">Dynamic
Libraries</a>を参照してください。
</p><p>サポートされるイメージフォーマット(と要求されるサポートライブラリー)にはPBMとXBM(サポートライブラリーに依存せず常に利用可能)、XPM(<code class="literal">libXpm</code>)、GIF
(<code class="literal">libgif</code>または<code class="literal">libungif</code>)、PostScript(<code class="literal">gs</code>)、JPEG(<code class="literal">libjpeg</code>)、TIFF(<code class="literal">libtiff</code>)、PNG(<code class="literal">libpng</code>)、SVG
(<code class="literal">librsvg</code>)が含まれます。
</p><p>これらのイメージフォーマットはそれぞれ、<em class="firstterm">イメージタイプシンボル(image type
symbol)</em>に関連付けられます。上記のフォーマットにたいするシンボルは順に<code class="literal">pbm</code>、<code class="literal">xbm</code>、<code class="literal">xpm</code>、<code class="literal">gif</code>、<code class="literal">postscript</code>、<code class="literal">jpeg</code>、<code class="literal">tiff</code>、<code class="literal">png</code>、<code class="literal">svg</code>になります。
</p><p>さらにImageMagick(<code class="literal">libMagickWand</code>)のサポートつきでEmacsをビルドした場合には、EmacsはImageMagickが表示可能なイメージフォーマットを表示できます。<a class="link" href="ch38s17.html#ImageMagick-Images" title="ImageMagick Images">ImageMagick
Images</a>を参照してください。ImageMagickを通じて表示されるすべてのイメージは、タイプシンボル<code class="literal">imagemagick</code>をもちます。
</p><pre class="synopsis"><a id="idm83804112" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">image-types</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数はカレント構成で潜在的にサポートされるイメージフォーマットにたいする、タイプシンボルのリストを含む。
</p><p>“潜在的”とは、Emacsがそのイメージタイプを知っていることを意味しており、実際に使用可能である必要はない(たとえば動的ライブラリーが利用できないせいかもしれない)。どのイメージタイプが実際に利用できるか知るためには、<code class="literal">image-type-available-p</code>を使用すること。
</p></blockquote></div><pre class="synopsis"><a id="idm83800528" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-type-available-p</code> <em class="replaceable"><code>type</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、タイプ<em class="replaceable"><code>type</code></em>のイメージのロードおよび表示が可能なら非<code class="literal">nil</code>をリターンする。<em class="replaceable"><code>type</code></em>はイメージタイプシンボルであること。
</p><p>サポートライブラリーが静的にリンクされたイメージタイプにたいして、この関数は常に<code class="literal">t</code>をリターンする。サポートライブラリーが動的にロードされるイメージタイプにたいしては、そのライブラリーがロード可能なら<code class="literal">t</code>、それ以外なら<code class="literal">nil</code>をリターンする。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Image-Descriptors"/>Image Descriptors</h2></div></div></div><a id="idm83793232" class="indexterm"/><p><em class="firstterm">イメージディスクリプタ(image
descriptor)</em>とは、イメージにたいする基礎的なデータと、それを表示する方法を指定するリストです。これは通常、オーバーレイプロパティまたはテキストプロパティ<code class="literal">display</code>(<a class="link" href="ch38s16.html#Other-Display-Specs" title="Other Display Specifications">Other
Display Specs</a>を参照)の値を通じて使用されますが、バッファーにイメージを挿入する便利なヘルパー関数については、<a class="link" href="ch38s17.html#Showing-Images" title="Showing Images">Showing
Images</a>を参照してください。
</p><p>イメージディスクリプタはそれぞれ<code class="literal">(image
.
<em class="replaceable"><code>props</code></em>)</code>という形式をもちます。ここで<em class="replaceable"><code>props</code></em>はキーワードシンボルと値のペアーからなるプロパティリストで、少なくともそのイメージタイプを指定するペアー<code class="literal">:type
<em class="replaceable"><code>type</code></em></code>を含みます。
</p><p>以下は、すべてのイメージタイプにたいして意味のあるプロパティのリストです(以降のサブセクションで説明するように、特定のイメージタイプにたいしてのみ意味があるプロパティも存在する):
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:type <em class="replaceable"><code>type</code></em></code>
</span></dt><dd><p>イメージタイプ。
<a class="link" href="ch38s17.html#Image-Formats" title="Image Formats">Image Formats</a>を参照のこと。
すべてのイメージディスクリプタは。このプロパティを含まなければならない。
</p></dd><dt><span class="term"><code class="literal">:file <em class="replaceable"><code>file</code></em></code>
</span></dt><dd><p>これは、ファイル<em class="replaceable"><code>file</code></em>からイメージをロードすることを意味する。<em class="replaceable"><code>file</code></em>が絶対ファイル名でなければ、それは<code class="literal">data-directory</code>内で展開される。
</p></dd><dt><span class="term"><code class="literal">:data <em class="replaceable"><code>data</code></em></code>
</span></dt><dd><p>これは、rawイメージデータを指定する。すべてのイメージディスクリプタは、<code class="literal">:data</code>か<code class="literal">:file</code>のいずれかをもたなければならないが、両方もつことはできない。
</p><p>ほとんどのイメージタイプにたいして、<code class="literal">:data</code>プロパティの値はイメージデータを含む、文字列であること。いくつかのイメージタイプは、<code class="literal">:data</code>をサポートしない。それ以外のイメージタイプにたいしては、<code class="literal">:data</code>単独では不十分であり、<code class="literal">:data</code>とともに他のイメージプロパティを使用する必要がある。詳細は、以下のサブセクションを参照のこと。
</p></dd><dt><span class="term"><code class="literal">:margin <em class="replaceable"><code>margin</code></em></code>
</span></dt><dd><p>これは、そのイメージ周囲に余分なマージンとして、何ピクセル追加するかを指定する。値<em class="replaceable"><code>margin</code></em>は非負の数値、またはそのような数値のペアー<code class="literal">(<em class="replaceable"><code>x</code></em>
.
<em class="replaceable"><code>y</code></em>)</code>でなければならない。ペアーの場合、<em class="replaceable"><code>x</code></em>は水平方向に追加するピクセル数、<em class="replaceable"><code>y</code></em>は垂直方向に追加するピクセル数を指定する。<code class="literal">:margin</code>が指定されない場合のデフォルトは0。
</p></dd><dt><span class="term"><code class="literal">:ascent <em class="replaceable"><code>ascent</code></em></code>
</span></dt><dd><p>これは、イメージのアセント(ベースラインの上の部分)に使用する、そのイメージの高さの分量を指定する。値<em class="replaceable"><code>ascent</code></em>は、から100の数値、またはシンボル<code class="literal">center</code>でなければならない。
</p><p><em class="replaceable"><code>ascent</code></em>が数値なら、アセントに使用するイメージの高さのパーセンテージであること。
</p><p><em class="replaceable"><code>ascent</code></em>が<code class="literal">center</code>なら、そのイメージにたいしてテキストプロパティおよびオーバーレイプロパティにより指定される方法で、センターライン(そのイメージ位置にテキストを描画する際の垂直方向のセンターライン)の垂直方向中心にイメージが配置される。
</p><p>このプロパティが省略された場合のデフォルトは500。
</p></dd><dt><span class="term"><code class="literal">:relief <em class="replaceable"><code>relief</code></em></code>
</span></dt><dd><p>これは、イメージ注意にシャドー矩形を追加する。値<em class="replaceable"><code>relief</code></em>は、シャドーライン幅をピクセルで指定する。<em class="replaceable"><code>relief</code></em>が負ならボタンを押下した状態、それ以外はボタンを押下していない状態のイメージでシャドーを描画する。
</p></dd><dt><span class="term"><code class="literal">:conversion <em class="replaceable"><code>algorithm</code></em></code>
</span></dt><dd><p>これは、イメージを表示する前に適用するべき、変換アルゴリズムを指定する。値<em class="replaceable"><code>algorithm</code></em>は、どのアルゴリズムかを指定する。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">laplace</code>
, </span><span class="term"><code class="literal">emboss</code>
</span></dt><dd><p>カラーの大きい差異を強調して小さな差異を不鮮明にする、ラプラスエッジ検出アルゴリズム(Laplace edge detection
algorithm)を指定する。“無効”なボタンのイメージ表示に、これが役立つと考える人もいます。
</p></dd><dt><span class="term"><code class="literal">(edge-detection :matrix <em class="replaceable"><code>matrix</code></em> :color-adjust <em class="replaceable"><code>adjust</code></em>)</code>
</span></dt><dd><a id="idm83743824" class="indexterm"/><p>一般的なエッジ検出アルゴリズムを指定する。<em class="replaceable"><code>matrix</code></em>は数値からなる9要素のリスト、またはベクターでなければならない。変換されたイメージ内の位置<span class="mathphrase">x/y</span>にあるピクセルは、その位置周辺にある元のピクセルから計算される。<em class="replaceable"><code>matrix</code></em>は、<span class="mathphrase">x/y</span>に近接する各ピクセルにたいして、そのピクセルが変換先ピクセルに影響するファクター(factor:
要因)を指定する。以下のように、要素<span class="mathphrase">0</span>は<span class="mathphrase">x-1/y-1</span>にあるピクセルのファクター、要素<span class="mathphrase">1</span>は<span class="mathphrase">x/y-1</span>にあるピクセルにたいするファクター、...を指定する。
</p><div class="literallayout"><p>  (x-1/y-1  x/y-1  x+1/y-1<br/>
   x-1/y    x/y    x+1/y<br/>
   x-1/y+1  x/y+1  x+1/y+1)<br/>
</p></div><p>結果のピクセルは、周辺ピクセルのRGB値を合計したカラーを指定されたファクターで乗じ、その合計をファクター絶対値の合計で除した色強度から計算される。
</p><p>ラプラスエッジ検出は、現在のところは以下のマトリクス
</p><div class="literallayout"><p>  (1  0  0<br/>
   0  0  0<br/>
   0  0 -1)<br/>
</p></div><p>エンボスエッジ検出(Emboss edge-detection)は以下のマトリクスを使用する
</p><div class="literallayout"><p>  ( 2 -1  0<br/>
   -1  0  1<br/>
    0  1 -2)<br/>
</p></div></dd><dt><span class="term"><code class="literal">disabled</code>
</span></dt><dd><p>イメージが“無効(disabled)”に見えるよう変換することを指定する。
</p></dd></dl></div></dd><dt><span class="term"><code class="literal">:mask <em class="replaceable"><code>mask</code></em></code>
</span></dt><dd><p><em class="replaceable"><code>mask</code></em>が<code class="literal">heuristic</code>か<code class="literal">(heuristic
<em class="replaceable"><code>bg</code></em>)</code>なら、フレームのバックグラウンドがイメージ背後に見えるよう、そのイメージのクリッピングマスクを構築する。<em class="replaceable"><code>bg</code></em>が未指定または<code class="literal">t</code>なら、イメージ4隅に最頻するカラーをそのイメージのバックグラウンドカラーとみなしてバックグラウンドカラーを決定する。それ以外なら<em class="replaceable"><code>bg</code></em>は、そのイメージのバックグラウンドとみなすべきカラーを指定するリスト<code class="literal">(<em class="replaceable"><code>red</code></em>
<em class="replaceable"><code>green</code></em> <em class="replaceable"><code>blue</code></em>)</code>でなければならない。
</p><p><em class="replaceable"><code>mask</code></em>が<code class="literal">nil</code>なら、イメージがマスクをもつ場合はマスクを削除する。マスクを含むフォーマットのイメージは、<code class="literal">:mask
nil</code>を指定することにより削除される可能性がある。
</p></dd><dt><span class="term"><code class="literal">:pointer <em class="replaceable"><code>shape</code></em></code>
</span></dt><dd><p>これはマウスポインターがそのイメージ上にある際の、ポインターシェイプを指定する。利用可能なポインターシェイプについては、<a class="link" href="ch29s17.html" title="Pointer Shape">Pointer
Shape</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">:map <em class="replaceable"><code>map</code></em></code>
</span></dt><dd><a id="idm83723856" class="indexterm"/><p>これは、そのイメージに<em class="firstterm">ホットスポット(hot spots)</em>のイメージマップを関連付ける。
</p><p>イメージマップは、各要素が<code class="literal">(<em class="replaceable"><code>area</code></em> <em class="replaceable"><code>id</code></em>
<em class="replaceable"><code>plist</code></em>)</code>という形式をもつalistである。<em class="replaceable"><code>area</code></em>はにはrectangle(矩形)、circle(円)、またはpolygon(ポリゴン、多角形)のいずれかを指定する。
</p><p>rectangleは、矩形エリアの左上隅と右下隅のピクセル座標を指定するコンス<code class="literal">(rect . ((<em class="replaceable"><code>x0</code></em> . <em class="replaceable"><code>y0</code></em>)
. (<em class="replaceable"><code>x1</code></em> . <em class="replaceable"><code>y1</code></em>)))</code>である。
</p><p>circleは、円の中心と半径を指定するコンス<code class="literal">(circle . ((<em class="replaceable"><code>x0</code></em> . <em class="replaceable"><code>y0</code></em>)
. <em class="replaceable"><code>r</code></em>))</code>である。<em class="replaceable"><code>r</code></em>は整数または浮動小数点数。
</p><p>polygonは、各ペアーが多角形の1つの頂点を記述するコンス<code class="literal">(poly . [<em class="replaceable"><code>x0</code></em> <em class="replaceable"><code>y0</code></em> <em class="replaceable"><code>x1</code></em>
<em class="replaceable"><code>y1</code></em> ...])</code>である。
</p><p>マウスポインターがホットスポット上にある際は、そのホットスポットの<em class="replaceable"><code>plist</code></em>が参照される。これが<code class="literal">help-echo</code>プロパティを含むならそのホットスポットのツールチップを指定し、<code class="literal">pointer</code>プロパティを含む場合はマウスカーソルがホットスポット上にあるときのマウスカーソルのシェイプを指定する。利用可能なポインターシェイプについては、<a class="link" href="ch29s17.html" title="Pointer Shape">Pointer
Shape</a>を参照のこと。
</p><p>マウスポインターがホットスポット上にあるときにマウスをクリックしたときのイベントは、ホットスポットの<em class="replaceable"><code>id</code></em>とマウスイベントを組み合わせて構成される。たとえば、ホットスポットの<em class="replaceable"><code>id</code></em>が<code class="literal">area4</code>なら、<code class="literal">[area4
mouse-1]</code>となる。
</p></dd></dl></div><pre class="synopsis"><a id="idm83707600" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-mask-p</code> <em class="replaceable"><code>spec</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>frame</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、イメージ<em class="replaceable"><code>spec</code></em>がマスクビットマップをもつなら、<code class="literal">t</code>をリターンする。<em class="replaceable"><code>frame</code></em>はそのイメージが表示されるフレームである。<em class="replaceable"><code>frame</code></em>が<code class="literal">nil</code>または省略された場合は、選択されたフレームが使用される(<a class="link" href="ch29s09.html" title="Input Focus">Input
Focus</a>を参照)。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="XBM-Images"/>XBM Images</h2></div></div></div><a id="idm83700176" class="indexterm"/><p>XBMフォーマットを使用するには、イメージタイプとして<code class="literal">xbm</code>を指定します。このイメージフォーマットは外部ライブラリーを要求せず、このタイプのイメージは常にサポートされます。
</p><p><code class="literal">xbm</code>イメージタイプにたいして、追加のイメージプロパティがサポートされます:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:foreground <em class="replaceable"><code>foreground</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>foreground</code></em>はそのイメージのフォアグラウンドカラーを指定する文字列、またはデフォルトカラーを指定する<code class="literal">nil</code>であること。このカラーはXBM内の1の各ピクセルに使用される。デフォルトは、そのフレームのフォアグラウンドカラーである。
</p></dd><dt><span class="term"><code class="literal">:background <em class="replaceable"><code>background</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>background</code></em>はそのイメージのバックグラウンドカラーを指定する文字列、またはデフォルトカラーを指定する<code class="literal">nil</code>であること。このカラーはXBM内の0の各ピクセルに使用される。デフォルトは、そのフレームのバックグラウンドカラーである。
</p></dd></dl></div><p>外部ファイルのかわりに、Emacs内のデータを指定してXBMイメージを指定するには、以下の3つのプロパティを使用する:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:data <em class="replaceable"><code>data</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>data</code></em>は、そのイメージのコンテンツを指定する。<em class="replaceable"><code>data</code></em>として使用できる、3つのフォーマットが存在する:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>それぞれがイメージの1ラインを指定するような、文字列ベクターまたはboolベクター。<code class="literal">:height</code>と<code class="literal">:width</code>を指定する。
</p></li><li class="listitem"><p>文字列なら、XBMファイルが含むのと同じバイトシーケンスを含む。この場合は<code class="literal">:height</code>と<code class="literal">:width</code>を指定してはならない。これらを省略することが、そのデータがXBMファイルのフォーマットをもつことを示すからである。イメージの高さと幅は、ファイルのコンテンツにより指定される。
</p></li><li class="listitem"><p>イメージのビット(もしかしたら終端の使用されない余分なビットを含む)を含む文字列、またはboolベクター。少なくとも<em class="replaceable"><code>width</code></em> *
<code class="literal">height</code>ビットを含むこと。この場合は、その文字列がXBMファイル全体ではなく、単にビットだけを含むことを示すとともに、そのイメージのサイズを指定するために、<code class="literal">:height</code>と<code class="literal">:width</code>を指定しなければならない。
</p></li></ul></div></dd><dt><span class="term"><code class="literal">:width <em class="replaceable"><code>width</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>width</code></em>は、ピクセル単位でイメージの幅を指定する。
</p></dd><dt><span class="term"><code class="literal">:height <em class="replaceable"><code>height</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>height</code></em>は、ピクセル単位でイメージの高さを指定する。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="XPM-Images"/>XPM Images</h2></div></div></div><a id="idm83679312" class="indexterm"/><p>XPMフォーマットを使用するには、イメージタイプに<code class="literal">xpm</code>を指定します。<code class="literal">xpm</code>イメージタイプでは、追加のプロパティ<code class="literal">:color-symbols</code>にも意味があります。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:color-symbols <em class="replaceable"><code>symbols</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>symbols</code></em>は、要素が<code class="literal">(<em class="replaceable"><code>name</code></em>
.
<em class="replaceable"><code>color</code></em>)</code>という形式をもつようなalistであること。各要素において、<em class="replaceable"><code>name</code></em>はイメージファイル内に出現するカラー名、<em class="replaceable"><code>color</code></em>はそのカラー名の実際の表示に使用するカラーを指定する。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="PostScript-Images"/>PostScript Images</h2></div></div></div><a id="idm83671504" class="indexterm"/><p>あるイメージにたいしてPostScriptを使用するには、イメージタイプ<code class="literal">postscript</code>を指定します。これは、Ghostscriptがインストールされている場合のみ機能します。常に以下の3つのプロパティを使用しなければなりません:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:pt-width <em class="replaceable"><code>width</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>width</code></em>はポイント(1/72インチ)単位で測ったイメージの幅を指定する。<em class="replaceable"><code>width</code></em>は整数でなければならない。
</p></dd><dt><span class="term"><code class="literal">:pt-height <em class="replaceable"><code>height</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>height</code></em>はポイント(1/72インチ)単位で測ったイメージの高さを指定する。<em class="replaceable"><code>height</code></em>は整数でなければならない。
</p></dd><dt><span class="term"><code class="literal">:bounding-box <em class="replaceable"><code>box</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>box</code></em>は、4つの整数からなるリストかベクターでなければならない。これらの整数は、PostScriptファイルの‘<code class="literal">BoundingBox</code>’に類似した、PostScriptイメージのバウンディングボックスを指定する。
</p><pre class="screen">%%BoundingBox: 22 171 567 738
</pre></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="ImageMagick-Images"/>ImageMagick Images</h2></div></div></div><a id="idm83657040" class="indexterm"/><a id="idm83656272" class="indexterm"/><p>ImageMagickのサポートつきでEmacsをビルドした場合には、多くくのイメージフォーマットをロードするために、ImageMagickライブラリーを使用できます(section “File
Conveniences” in <em class="citetitle">The GNU Emacs
Manual</em>を参照)。ImageMagickを通じてロードしたイメージのイメージタイプシンボルは、基礎となる実際のイメージフォーマットとは無関係に、<code class="literal">imagemagick</code>になります。
</p><pre class="synopsis"><a id="idm83653968" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">imagemagick-types</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントのImageMagickインストールによりサポートされる、イメージファイル拡張子のリストをリターンする。リストの各要素は、<code class="filename">.bmp</code>イメージは<code class="literal">BMP</code>のように、イメージタイプにたいして内部的なImageMagick名を表すシンボルである。
</p></blockquote></div><pre class="synopsis"><a id="idm83650128" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">imagemagick-enabled-types</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、EmacsがImageMagickを使用してレンダリングを試みるかもしれない、ImageMagickイメージタイプのリストである。リストの各要素は、<code class="literal">imagemagick-types</code>がリターンするリスト内のシンボルのいずれか、または等価な文字列である。もしくは値<code class="literal">t</code>はImageMagickにたいして利用できるすべてのイメージタイプを有効にする。この変数の値とは関係なく、<code class="literal">imagemagick-types-inhibit</code>(以下参照)が優先される。
</p></blockquote></div><pre class="synopsis"><a id="idm83645776" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">imagemagick-types-inhibit</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、<code class="literal">imagemagick-enabled-types</code>の値とは無関係に、ImageMagickを使用して決してレンダリングされることのない、ImageMagickイメージタイプのリストである。値<code class="literal">t</code>は、ImageMagickを完全に無効にする。
</p></blockquote></div><pre class="synopsis"><a id="idm83642064" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">image-format-suffixes</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、イメージタイプをファイル名拡張子にマッピングするalistである。Emacsは、ImageMagickライブラリーにイメージのタイプに関するヒントを与えるために、この変数と<code class="literal">:format</code>イメージプロパティ(以下参照)を組み合わせて使用する。各要素は<code class="literal">(<em class="replaceable"><code>type</code></em>
<em class="replaceable"><code>extension</code></em>)</code>という形式をもち、<em class="replaceable"><code>type</code></em>はイメージのcontent-typeを指定するシンボル、<em class="replaceable"><code>extension</code></em>は関連付けられるファイル名拡張子を指定する文字列である。
</p></blockquote></div><p>ImageMagickによりロードされたイメージは、追加で以下のイメージディスクリプタプロパティをサポートします:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:background <em class="replaceable"><code>background</code></em></code>
</span></dt><dd><p><em class="replaceable"><code>background</code></em>が非<code class="literal">nil</code>なら、カラーを指定する文字列であること。これはイメージが透明度をサポートする場合に、そのイメージのバックグラウンドカラーとして使用される。値が<code class="literal">nil</code>の場合のデフォルトは、そのフレームのバックグラウンドカラー。
</p></dd><dt><span class="term"><code class="literal">:width <em class="replaceable"><code>width</code></em>, :height <em class="replaceable"><code>height</code></em></code>
</span></dt><dd><p>キーワード<code class="literal">:width</code>と<code class="literal">:height</code>は、イメージのスケーリングに使用される。いずれか一方のみが指定された場合には、アスペクト比を保つために、もう一方は算出される。両方が指定された場合には、アスペクト比は保たれないかもしれない。
</p></dd><dt><span class="term"><code class="literal">:max-width <em class="replaceable"><code>max-width</code></em>, :max-height <em class="replaceable"><code>max-height</code></em></code>
</span></dt><dd><p>キーワード<code class="literal">:max-width</code>と<code class="literal">:max-height</code>は、イメージのサイズがこれらの値を超過した場合のスケーリングに使用される。<code class="literal">:width</code>がセットされた場合には<code class="literal">max-width</code>より優先され、<code class="literal">:height</code>がセットされた場合には<code class="literal">max-height</code>より優先されるだろうが、それ以外ではこれらのキーワードを望むように混交できる。<code class="literal">:max-width</code>と<code class="literal">:max-height</code>は常に、アスペクト比を保つであろう。
</p></dd><dt><span class="term"><code class="literal">:format <em class="replaceable"><code>type</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>type</code></em>は、<code class="literal">image-format-suffixes</code>で見られるような、イメージのタイプを指定するシンボルであること。これはイメージが関連付けられたファイル名をもたない際に、そのイメージタイプを検出する助けとなるヒントをImageMagickに提供する。
</p></dd><dt><span class="term"><code class="literal">:rotation <em class="replaceable"><code>angle</code></em></code>
</span></dt><dd><p>回転角度を度数で指定する。
</p></dd><dt><span class="term"><code class="literal">:index <em class="replaceable"><code>frame</code></em></code>
</span></dt><dd><p><a class="link" href="ch38s17.html#Multi_002dFrame-Images" title="Multi-Frame Images">Multi-Frame Images</a>を参照のこと。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Other-Image-Types"/>Other Image Types</h2></div></div></div><a id="idm83605200" class="indexterm"/><p>PBMイメージには、イメージタイプ<code class="literal">pbm</code>を指定します。カラー、グレースケール、およびモノクロのイメージがサポートされます。モノクロのPBMイメージにたいしては、2つの追加イメージプロパティがサポートされます。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">:foreground <em class="replaceable"><code>foreground</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>foreground</code></em>は、そのイメージのフォアグラウンドカラーを指定する文字列、またはデフォルトカラーなら<code class="literal">nil</code>であること。このカラーは、そのPBM内の1であるようなピクセルすべてに使用される。デフォルトは、フレームのフォアグラウンドカラー。
</p></dd><dt><span class="term"><code class="literal">:background <em class="replaceable"><code>background</code></em></code>
</span></dt><dd><p>値<em class="replaceable"><code>background</code></em>は、そのイメージのバックグラウンドカラーを指定する文字列、またはデフォルトカラーなら<code class="literal">nil</code>であること。このカラーは、そのPBM内の0であるようなピクセルすべてに使用される。デフォルトは、フレームのバックグラウンドカラー。
</p></dd></dl></div><p>Emacsがサポート可能な、残りのイメージタイプは以下のとおり:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">GIF
</span></dt><dd><p>イメージタイプ<code class="literal">gif</code>。<code class="literal">:index</code>プロパティをサポートする。<a class="link" href="ch38s17.html#Multi_002dFrame-Images" title="Multi-Frame Images">Multi-Frame Images</a>を参照のこと。
</p></dd><dt><span class="term">JPEG
</span></dt><dd><p>イメージタイプ<code class="literal">jpeg</code>。
</p></dd><dt><span class="term">PNG
</span></dt><dd><p>イメージタイプ<code class="literal">png</code>。
</p></dd><dt><span class="term">SVG
</span></dt><dd><p>イメージタイプ<code class="literal">svg</code>。
</p></dd><dt><span class="term">TIFF
</span></dt><dd><p>イメージタイプ<code class="literal">tiff</code>。<code class="literal">:index</code>プロパティをサポートする。<a class="link" href="ch38s17.html#Multi_002dFrame-Images" title="Multi-Frame Images">Multi-Frame Images</a>を参照のこと。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Defining-Images"/>Defining Images</h2></div></div></div><a id="idm83583568" class="indexterm"/><p>関数<code class="literal">create-image</code>、<code class="literal">defimage</code>、<code class="literal">find-image</code>はイメージディスクリプタを作成するための便利な手段を提供します。
</p><pre class="synopsis"><a id="idm83580624" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">create-image</code> <em class="replaceable"><code>file-or-data</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>type</code></em> <em class="replaceable"><code>data-p</code></em> <em class="replaceable"><code>&amp;rest</code></em> <em class="replaceable"><code>props</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>file-or-data</code></em>内のデータを使用するイメージディスクリプタを作成してリターンする。<em class="replaceable"><code>file-or-data</code></em>はファイル名、またはイメージデータを含む文字列を指定できる。前者の場合<em class="replaceable"><code>data-p</code></em>は<code class="literal">nil</code>、後者なら非<code class="literal">nil</code>であること。
</p><p>オプション引数<em class="replaceable"><code>type</code></em>は、イメージタイプを指定するシンボルである。<em class="replaceable"><code>type</code></em>が省略または<code class="literal">nil</code>なら、<code class="literal">create-image</code>はファイル先頭の数バイト、またはファイル名からイメージタイプの判断を試みる。
</p><p>残りの引数<em class="replaceable"><code>props</code></em>は追加のイメージプロパティを指定する。たとえば、
</p><pre class="screen">(create-image "foo.xpm" 'xpm nil :heuristic-mask t)
</pre><p>このタイプのイメージがサポートされていなければ、この関数は<code class="literal">nil</code>、それ以外ならイメージディスクリプタをリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm83568464" class="indexterm"/><span class="category"><span class="bold"><strong>Macro</strong></span>:</span> <code class="function">defimage</code> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>specs</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>doc</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>このマクロは、イメージマクロとして<em class="replaceable"><code>symbol</code></em>を定義する。引数<em class="replaceable"><code>specs</code></em>は、そのイメージの表示方法を指定するリストである。3つ目の引数<em class="replaceable"><code>doc</code></em>は、オプションのドキュメント文字列である。
</p><p><em class="replaceable"><code>specs</code></em>内の各要素はプロパティリストの形式をもち、それぞれが少なくとも<code class="literal">:type</code>プロパティと、<code class="literal">:file</code>か<code class="literal">:data</code>いずれかのプロパティをもつべきである。<code class="literal">:type</code>の値はイメージタイプを指定するシンボル、<code class="literal">:file</code>の値はイメージをロードするファイル、<code class="literal">:data</code>の値は実際のイメージデータを含む文字列であること。以下は例である:
</p><pre class="screen">(defimage test-image
  ((:type xpm :file "~/test1.xpm")
   (:type xbm :file "~/test1.xbm")))
</pre><p><code class="literal">defimage</code>はそれが使用可能か、つまりそのタイプがサポートされているかとファイルが存在するかを確認するために、各要素を1つずつテストする。最初に使用可能な引数が、<em class="replaceable"><code>symbol</code></em>内に格納するイメージディスクリプタを作成するために使用される。
</p><p>機能する候補がなければ、<em class="replaceable"><code>symbol</code></em>は<code class="literal">nil</code>として定義される。
</p></blockquote></div><pre class="synopsis"><a id="idm83556304" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">find-image</code> <em class="replaceable"><code>specs</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、イメージ仕様<em class="replaceable"><code>specs</code></em>のリストの1つを満足するイメージを探す、便利な手段を提供する。
</p><p><em class="replaceable"><code>specs</code></em>内の各仕様は、イメージタイプに応じた内容のプロパティリストである。すべての仕様は少なくとも<code class="literal">:type
<em class="replaceable"><code>type</code></em></code>、および<code class="literal">:file <em class="replaceable"><code>file</code></em></code>か<code class="literal">:data
<em class="replaceable"><code>data</code></em></code>いずれかのプロパティを含まなければならない。ここで<em class="replaceable"><code>type</code></em>は<code class="literal">xbm</code>のようにイメージタイプを指定するシンボル、<em class="replaceable"><code>file</code></em>はイメージをロードするファイル、<em class="replaceable"><code>data</code></em>は実際のイメージデータを含む文字列である。このリスト内で<em class="replaceable"><code>type</code></em>がサポートされていて、かつ<em class="replaceable"><code>file</code></em>が存在する最初の仕様は、リターンされるイメージ仕様の構築に使用される。満足する仕様がなければ、<code class="literal">nil</code>がリターンされる。
</p><p>イメージは、<code class="literal">image-load-path</code>内で検索される。
</p></blockquote></div><pre class="synopsis"><a id="idm83545680" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">image-load-path</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、イメージファイルを検索する場所のリストである。要素が文字列、または値が文字列であるような変数シンボルなら、その文字列は検索を行うディレクトリーとされる。値がリストであるような変数シンボルの場合、それは検索を行うディレクトリーのリストとされる。
</p><p>デフォルトでは<code class="literal">data-directory</code>で指定されたディレクトリーのサブディレクトリー<code class="filename">images</code>、次に<code class="literal">data-directory</code>で指定されたディレクトリー、最後に<code class="literal">load-path</code>で指定されたディレクトリー内を検索する。サブディレクトリーは自動的には検索に含まれないので、イメージファイルをサブディレクトリー内に配置した場合は、サブディレクトリー名を明示的に与える必要がある。たとえば<code class="literal">data-directory</code>内でイメージ<code class="filename">images/foo/bar.xpm</code>を見つけるには、以下のようにそのイメージを指定すること:
</p><pre class="screen">(defimage foo-image '((:type xpm :file "foo/bar.xpm")))
</pre></blockquote></div><pre class="synopsis"><a id="idm83518544" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-load-path-for-library</code> <em class="replaceable"><code>library</code></em> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>path</code></em> <em class="replaceable"><code>no-error</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、Lispパッケージ<em class="replaceable"><code>library</code></em>により使用されるイメージにたいして、適切な検索パスをリターンする。
</p><p>この関数はまず<code class="literal">image-load-path</code>(<code class="filename"><code class="literal">data-directory</code>/images</code>を除外)を使用し、次に<code class="literal">load-path</code>の後に<em class="replaceable"><code>library</code></em>にとって適切なパス(ライブラリーファイル自身にたいする相対パス<code class="filename">../../etc/images</code>と<code class="filename">../etc/images</code>を含む)を補い、最後に<code class="filename"><code class="literal">data-directory</code>/images</code>から<em class="replaceable"><code>image</code></em>を検索する。
</p><p>その後にこの関数は、先頭に<em class="replaceable"><code>image</code></em>が見つかったディレクトリー、その後に<code class="literal">load-path</code>の値が続く、ディレクトリーのリストをリターンする。<em class="replaceable"><code>path</code></em>が与えられた場合は、それを<code class="literal">load-path</code>のかわりに使用する。
</p><p><em class="replaceable"><code>no-error</code></em>が非<code class="literal">nil</code>で、かつ適切なパスが見つからない場合に、エラーをシグナルしない。かわりに前記のディレクトリーリストをリターンするが、イメージのディレクトリーの箇所に<code class="literal">nil</code>が出現する点が異なる。
</p><p>以下は<code class="literal">image-load-path-for-library</code>の使用例である:
</p><pre class="screen">(defvar image-load-path) ; shush compiler
(let* ((load-path (image-load-path-for-library
                    "mh-e" "mh-logo.xpm"))
       (image-load-path (cons (car load-path)
                              image-load-path)))
  (mh-tool-bar-folder-buttons-init))
</pre></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Showing-Images"/>Showing Images</h2></div></div></div><a id="idm83490128" class="indexterm"/><p>自分で<code class="literal">display</code>プロパティをセットアップすることでイメージディスクリプタを使用できますが、このセクションの関数を使用するほうがより簡単です。
</p><pre class="synopsis"><a id="idm83475920" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">insert-image</code> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>string</code></em> <em class="replaceable"><code>area</code></em> <em class="replaceable"><code>slice</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファーのポイント位置に<em class="replaceable"><code>image</code></em>を挿入する。<em class="replaceable"><code>image</code></em>は、イメージディスクリプタであること。これは<code class="literal">create-image</code>によりリターンされた値、または<code class="literal">defimage</code>で定義されたシンボルの値かもしれない。引数<em class="replaceable"><code>string</code></em>は、イメージを保持するためにバッファー内に配すテキストを指定する。これが省略または<code class="literal">nil</code>なら、<code class="literal">insert-image</code>はデフォルトで<code class="literal">"
"</code>を使用する。
</p><p>引数<em class="replaceable"><code>area</code></em>は、マージン内にイメージを置くかどうかを指定する。これが<code class="literal">left-margin</code>なら左マージンにイメージが表示され、<code class="literal">right-margin</code>なら右マージンを指定する。<em class="replaceable"><code>area</code></em>が<code class="literal">nil</code>または省略された場合、イメージはバッファーのテキスト内のポイント位置に表示される。
</p><p>引数<em class="replaceable"><code>slice</code></em>は、挿入するイメージのスライスを指定する。<em class="replaceable"><code>slice</code></em>が<code class="literal">nil</code>または省略された場合は、そのイメージ全体が挿入される。それ以外では、<em class="replaceable"><code>slice</code></em>がリスト<code class="literal">(<em class="replaceable"><code>x</code></em>
<em class="replaceable"><code>y</code></em> <em class="replaceable"><code>width</code></em>
<em class="replaceable"><code>height</code></em>)</code>なら<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>は位置、<em class="replaceable"><code>width</code></em>と<em class="replaceable"><code>height</code></em>は挿入するイメージの領域を指定する。整数値はピクセル単位。0.0から1.0までの浮動小数点数は、イメージ全体の幅または高さにたいする割合を指定する。
</p><p>内部的には、この関数はバッファー内に<em class="replaceable"><code>string</code></em>を挿入して、<em class="replaceable"><code>image</code></em>を指定する<code class="literal">display</code>プロパティにそれを渡す。<a class="link" href="ch38s16.html" title="The display Property">Display
Property</a>を参照のこと。
</p></blockquote></div><a id="idm83456976" class="indexterm"/><a id="idm83456208" class="indexterm"/><pre class="synopsis"><a id="idm83455184" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">insert-sliced-image</code> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>string</code></em> <em class="replaceable"><code>area</code></em> <em class="replaceable"><code>rows</code></em> <em class="replaceable"><code>cols</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<code class="literal">insert-image</code>と同様、カレントバッファー内に<em class="replaceable"><code>image</code></em>を挿入するが、イメージを<em class="replaceable"><code>rows</code></em>✕<em class="replaceable"><code>cols</code></em>の同一サイズのスライスに分割する。
</p><p>イメージが“スライス”されて挿入されると、Emacsは各スライスを個別のイメージとして表示して、(巨大な)イメージを表示するバッファーのページングの際、イメージ全体を上下にジャンプするのではなく、より直感的な上下スクロールが可能になる。
</p></blockquote></div><pre class="synopsis"><a id="idm83443920" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">put-image</code> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>pos</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>string</code></em> <em class="replaceable"><code>area</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、カレントバッファー内の<em class="replaceable"><code>pos</code></em>の前に、イメージ<em class="replaceable"><code>image</code></em>を配置する。引数<em class="replaceable"><code>pos</code></em>は整数、またはマーカーであること。これは、イメージが表示されるべきバッファー位置を指定する。引数<em class="replaceable"><code>string</code></em>は、代替として表示されるべきデフォルトのイメージを保持するテキストであること。
</p><p>引数<em class="replaceable"><code>image</code></em>はイメージディスクリプタでなければならず、それは<code class="literal">create-image</code>がリターンされたか、あるいは<code class="literal">defimage</code>により格納されたイメージディスクリプタかもしれない。
</p><p>引数<em class="replaceable"><code>area</code></em>は、マージン内にイメージを置くかどうかを指定する。これが<code class="literal">left-margin</code>なら左マージンにイメージが表示され、<code class="literal">right-margin</code>なら右マージンを指定する。<em class="replaceable"><code>area</code></em>が<code class="literal">nil</code>または省略された場合、イメージはバッファーのテキスト内のポイント位置に表示される。
</p><p>内部的には、この関数はオーバーレイを作成して、値がそのイメージであるような<code class="literal">display</code>プロパティをもつテキストを含む、<code class="literal">before-string</code>プロパティをそのオーバーレイに与えている(なんと!)。
</p></blockquote></div><pre class="synopsis"><a id="idm83431504" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">remove-images</code> <em class="replaceable"><code>start</code></em> <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>buffer</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>buffer</code></em>の位置<em class="replaceable"><code>start</code></em>と<em class="replaceable"><code>end</code></em>の間のイメージを削除する。<em class="replaceable"><code>buffer</code></em>が省略または<code class="literal">nil</code>なら、カレントバッファーからイメージを削除する。
</p><p>これは<code class="literal">put-image</code>が行う方法で<em class="replaceable"><code>buffer</code></em>に配置されたイメージだけを削除し、<code class="literal">insert-image</code>や他の方法で挿入されたイメージは削除しない。
</p></blockquote></div><pre class="synopsis"><a id="idm83423312" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-size</code> <em class="replaceable"><code>spec</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>pixels</code></em> <em class="replaceable"><code>frame</code></em></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm83419600" class="indexterm"/><p>この関数は、ペアー<code class="literal">(<em class="replaceable"><code>width</code></em>
.
<em class="replaceable"><code>height</code></em>)</code>として、イメージのサイズをリターンする。<em class="replaceable"><code>spec</code></em>はイメージ仕様である。<em class="replaceable"><code>pixels</code></em>が非<code class="literal">nil</code>ならピクセル単位、それ以外ならcanonicalな文字単位(そのフレームのデフォルトフォントの幅/高さの割合)で量ったサイズをリターンする。<em class="replaceable"><code>frame</code></em>は、イメージが表示されるフレームである。<em class="replaceable"><code>frame</code></em>が<code class="literal">nil</code>または省略された場合は、選択されたフレームを使用する(<a class="link" href="ch29s09.html" title="Input Focus">Input
Focus</a>を参照)。
</p></blockquote></div><pre class="synopsis"><a id="idm83413712" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">max-image-size</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、Emacsがロードするイメージの最大サイズを定義するために使用される。Emacsはこの制限より大きいイメージのロード(と表示)を拒絶するだろう。
</p><p>値が整数なら、それはピクセル単位で量ったイメージの最大の高さと幅を、直接指定する。浮動小数点数なら、そのフレームの高さおよび幅にたいする比率として、イメージの最大の高さと幅を指定する。値が数値でなければ、イメージサイズにたいする明示的な制限は存在しない。
</p><p>この変数の目的は、意図せずEmacsに不当に大きなイメージがロードされるとを防ぐことである。これは、イメージの初回ロード時だけ効果がある。イメージが一度イメージキャッシュに置かれると、その後<code class="literal">max-image-size</code>の値が変更されても、そのイメージは常に表示可能である(<a class="link" href="ch38s17.html#Image-Cache" title="Image Cache">Image
Cache</a>を参照)。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Multi_002dFrame-Images"/>Multi-Frame Images</h2></div></div></div><a id="idm83408464" class="indexterm"/><a id="idm83407696" class="indexterm"/><a id="idm83406928" class="indexterm"/><a id="idm83406160" class="indexterm"/><p>複数のイメージを含むことができるイメージファイルがいくつかあります。わたしたちはこのような場合、イメージ内に複数の“フレーム”があると表現しています。現在のところ、EmacsはGIF、TIFF、およびDJVMのような特定のImageMagickフォーマットにたいして、複数フレームをサポートします。
</p><p>フレームは、複数の“ページ”を表現するため(通常は、たとえばマルチフレームTIFFの場合)、あるいはアニメーションを作成するため(通常はマルチフレームGIFファイルの場合)に使用できます。
</p><p>マルチフレームイメージは、表示されるフレームを指定する整数値(0から数える)が値であるような、プロパティ<code class="literal">:index</code>をもっています。
</p><pre class="synopsis"><a id="idm83403472" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-multi-frame-p</code> <em class="replaceable"><code>image</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>image</code></em>が2つ以上のフレームを含む場合は、非<code class="literal">nil</code>をリターンする。実際のリターン値はコンス<code class="literal">(<em class="replaceable"><code>nimages</code></em>
.
<em class="replaceable"><code>delay</code></em>)</code>で、<em class="replaceable"><code>nimages</code></em>はフレーム数、<em class="replaceable"><code>delay</code></em>はフレーム間の遅延秒数、イメージが遅延を指定しない場合は<code class="literal">nil</code>である。通常、アニメーションを意図されたイメージはフレームの遅延を指定し、複数ページとして扱われることを意図したイメージは指定しない。
</p></blockquote></div><pre class="synopsis"><a id="idm83396816" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-current-frame</code> <em class="replaceable"><code>image</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は<em class="replaceable"><code>image</code></em>にたいして、0から数えたカレントフレーム番号のインデックスをリターンする。
</p></blockquote></div><pre class="synopsis"><a id="idm83393232" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-show-frame</code> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>n</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>nocheck</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>image</code></em>をフレーム番号<em class="replaceable"><code>n</code></em>とスイッチする。<em class="replaceable"><code>nocheck</code></em>が<code class="literal">nil</code>なら、有効範囲外のフレーム番号を範囲終端に置き換える。<em class="replaceable"><code>image</code></em>が指定された番号のフレームを含まなければ、イメージは中貫きの四角(hollow
box)で表示される。
</p></blockquote></div><pre class="synopsis"><a id="idm83386832" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-animate</code> <em class="replaceable"><code>image</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>index</code></em> <em class="replaceable"><code>limit</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、<em class="replaceable"><code>image</code></em>をアニメーション表示する。オプションの整数<em class="replaceable"><code>index</code></em>は、開始するフレームを指定する(デフォルトは0)。オプション引数<em class="replaceable"><code>limit</code></em>は、アニメーションの長さを制御する。これが省略または<code class="literal">nil</code>なら、アニメーション回数は1回、<code class="literal">t</code>なら永久にループ表示する。数値なら、その秒数後にアニメーションは停止する。
</p></blockquote></div><a id="idm83380432" class="indexterm"/><a id="idm83379664" class="indexterm"/><p>アニメーションはタイマーにより処理されます。Emacsは最小のフレーム遅延を0.01秒(<code class="literal">image-minimum-frame-delay</code>)とすることに注意してください。そのイメージ自身が遅延を指定しなければ、Emacsは<code class="literal">image-default-frame-delay</code>を使用します。
</p><pre class="synopsis"><a id="idm83364816" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-animate-timer</code> <em class="replaceable"><code>image</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、もし存在すれば<em class="replaceable"><code>image</code></em>のアニメーションに責任をもつタイマーをリターンする。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Image-Cache"/>Image Cache</h2></div></div></div><a id="idm83360464" class="indexterm"/><p>Emacsはイメージをより効果的に再表示できるように、イメージをキャッシュします。Emacsがイメージを表示する際、既存のイメージ仕様が望む仕様と<code class="literal">equal</code>なイメージキャッシュを検索します。マッチが見つかったら、そのイメージはキャッシュから表示され、それ以外ではイメージは通常のようにロードされます。
</p><pre class="synopsis"><a id="idm83358544" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">image-flush</code> <em class="replaceable"><code>spec</code></em> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>frame</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、フレーム<em class="replaceable"><code>frame</code></em>のイメージキャッシュから、仕様<em class="replaceable"><code>spec</code></em>のイメージを削除する。イメージ仕様の比較には、<code class="literal">equal</code>を使用する。<em class="replaceable"><code>frame</code></em>が<code class="literal">nil</code>の場合のデフォルトは選択されたフレーム。<em class="replaceable"><code>frame</code></em>が<code class="literal">t</code>なら、そのイメージはすべての既存フレームでフラッシュされる。
</p><p>Emacsのカレント実装では、各グラフィカル端末はイメージキャッシュを処理して、それはその端末上のすべてのフレームにより共有される(<a class="link" href="ch29s02.html" title="Multiple Terminals">Multiple
Terminals</a>を参照)。つまりあるフレームでイメージをリフレッシュすると、同一端末上の他のすべてのフレームでもリフレッシュされる。
</p></blockquote></div><p><code class="literal">image-flush</code>の1つの用途は、Emacsにイメージファイルの変更を伝えることです。イメージ仕様が<code class="literal">:file</code>プロパティを含む場合、そのイメージの初回表示時にそのファイルコンテンツにもとづいて、イメージがキャッシュされます。たとえその後にファイルが変更されても、Emacsはそのイメージの古いバージョンを表示し続けます。<code class="literal">image-flush</code>を呼び出すことによりそのイメージはキャッシュからフラッシュされ、そのイメージの表示が次回必要になった際に、Emacsにファイルの再読み込みを強制します。
</p><p><code class="literal">image-flush</code>の他の用途は、メモリー節約です。Lispプログラムで<code class="literal">image-cache-eviction-delay</code>(以下参照)より遥かに短い期間に多数の一時イメージを作成する場合には、Emacsが自動的に行うことを待たずに、自身で使用されていないイメージのフラッシュを選択できます。
</p><pre class="synopsis"><a id="idm83347536" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">clear-image-cache</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>filter</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、イメージキャッシュ内に格納されたすべてのイメージを削除して、イメージキャッシュをクリアーする。<em class="replaceable"><code>filter</code></em>が省略または<code class="literal">nil</code>なら、選択されたフレームにたいしてキャッシュをクリアーする。<em class="replaceable"><code>filter</code></em>がフレームなら、そのフレームにたいしてキャッシュをクリアーする。<em class="replaceable"><code>filter</code></em>が<code class="literal">t</code>なら、すべてのイメージキャッシュをクリアーする。それ以外なら、<em class="replaceable"><code>filter</code></em>はファイル名として解釈され、すべてのイメージキャッシュからそのファイル名に関連付けられたすべてのイメージを削除する。
</p></blockquote></div><p>イメージキャッシュ内のイメージが指定された期間内に表示されなければ、Emacsはそれをキャッシュから削除して、割り当てられたメモリーを解放します。
</p><pre class="synopsis"><a id="idm83332816" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">image-cache-eviction-delay</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、表示されることなくイメージがキャッシュ内に残留できる秒数を指定する。あるイメージがこの秒数の間に表示されなければ、Emacsはそれをイメージキャッシュから削除する。
</p><p>ある状況下では、もしキャッシュ内のイメージ数が大きくなり過ぎた場合には、実際の立ち退き遅延(eviction delay)はこれより短くなり得る。
</p><p>値が<code class="literal">nil</code>なら、明示的にキャッシュをクリアーした場合を除き、Emacsはキャッシュからイメージを削除しない。このモードはデバッグ時に有用かもしれない。
</p></blockquote></div></div></div></body></html>