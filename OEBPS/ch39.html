<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 38. Operating System Interface</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="System-Interface"/>Chapter 38. Operating System Interface</h1></div></div></div><p>これはEmacsの開始と終了、オペレーティングシステム内の値へのアクセス、端末の入力と出力に関するチャプターです。
</p><p>関連する情報は<a class="link" href="ape.html#Building-Emacs" title="Building Emacs">Building
Emacs</a>を参照してください。端末とスクリーンに関連するオペレーティングシステムの状態に関する追加情報は、<a class="link" href="ch38.html" title="Chapter 37. Emacs Display">Display</a>を参照してください。
</p><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Starting-Up"/>Starting Up Emacs</h1></div></div></div><p>このセクションでは、Emacsが開始時に何を行うかと、それらのアクションのカスタマイズ方法を説明します。
</p><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Startup-Summary"/>Summary: Sequence of Actions at Startup</h2></div></div></div><a id="idm82495312" class="indexterm"/><a id="idm82494544" class="indexterm"/><a id="idm82493776" class="indexterm"/><p>Emacsは起動時に、以下の処理を行います(<code class="filename">startup.el</code>内の<code class="literal">normal-top-level</code>を参照):
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>このリストの各ディレクトリー内にある<code class="filename">subdirs.el</code>という名前のファイルを実行することにより、<code class="literal">load-path</code>にサブディレクトリーを追加する。通常このファイルは、そのディレクトリー内にあるサブディレクトリーをこのリストに追加して、順にそれらをスキャンする。通常、ファイル<code class="filename">subdirs.el</code>は、Emacsインストール時に自動的に作成される。
</p></li><li class="listitem"><p><code class="literal">load-path</code>のディレクトリー内で見つかった、すべての<code class="filename">leim-list.el</code>をロードする。このファイルは、入力メソッドの登録を意図している。この検索は、ユーザーが作成するかもしれない、個人的な<code class="filename">leim-list.el</code>すべてにたいしてのみ行われる。標準的なEmacsライブラリーを含むディレクトリーはスキップされる(これらは単一の<code class="filename">leim-list.el</code>だけに含まれるべきであり、Emacs実行形式にコンパイル済である)。
</p></li><li class="listitem"><a id="idm82482128" class="indexterm"/><p>変数<code class="literal">before-init-time</code>に、<code class="literal">current-time</code>の値をセットする(<a class="link" href="ch39s05.html" title="Time of Day">Time of
Day</a>を参照)。これは<code class="literal">after-init-time</code>に<code class="literal">nil</code>をセットすることにより、Emacs初期化時にLispプログラムへの合図も行う。
</p></li><li class="listitem"><p><code class="envar">LANG</code>のような環境変数がそれを要するなら、言語環境と端末のコーディングシステムをセットする。
</p></li><li class="listitem"><p>コマンドライン引数にたいして、いくつかの基本的なパースを行う。
</p></li><li class="listitem"><a id="idm82464464" class="indexterm"/><a id="idm82463696" class="indexterm"/><p>batchモードで実行されていなければ、変数<code class="literal">initial-window-system</code>が指定するウィンドウシステムを初期化する(<a class="link" href="ch38s23.html" title="Window Systems">initial-window-system</a>を参照)。サポートされる各ウィンドウシステムにたいする初期化関数は、<code class="literal">window-system-initialization-alist</code>により指定される。<code class="literal">initial-window-system</code>の値が<em class="replaceable"><code>windowsystem</code></em>なら、ファイル<code class="filename">term/<em class="replaceable"><code>windowsystem</code></em>-win.el</code>内で適切な初期化関数が定義されている。このファイルはビルド時に、Emacs実行可能形式にコンパイルされているべきである。
</p></li><li class="listitem"><p>ノーマルフック<code class="literal">before-init-hook</code>を実行する。
</p></li><li class="listitem"><p>それが適切なら、グラフィカルなフレームを作成する。これはオプション‘<code class="literal">--batch</code>’か‘<code class="literal">--daemon</code>’が指定されていたら行われない。
</p></li><li class="listitem"><p>初期フレームのフェイスを初期化して、必要ならメニューバーとツールバーをセットする。グフィカルなフレームがサポートされていたら、たとえカレントフレームがグラフィカルでなくても、後でグラフィカルなフレームが作成されるかもしれないので、ツールバーをセットアップする。
</p></li><li class="listitem"><p>リスト<code class="literal">custom-delayed-init-variables</code>内のメンバーを再初期化するために、<code class="literal">custom-reevaluate-setting</code>を使用する。これらのメンバーはデフォルト値が、ビルド時ではなく実行時のコンテキストに依存する、すべての事前ロード済ユーザーオプションである。<a class="link" href="ape.html#Building-Emacs" title="Building Emacs">custom-initialize-delay</a>を参照のこと。
</p></li><li class="listitem"><p>存在する場合はライブラリー<code class="filename">site-start</code>をロードする。これはオプション‘<code class="literal">-Q</code>’か‘<code class="literal">--no-site-file</code>’が指定された場合は行われない。
<a id="idm82447440" class="indexterm"/>
</p></li><li class="listitem"><p>ユーザーのinitファイルをロードする(<a class="link" href="ch39.html#Init-File" title="The Init File">Init
File</a>を参照)。これはオプション‘<code class="literal">-q</code>’、‘<code class="literal">-Q</code>’、または‘<code class="literal">--batch</code>’が指定されていたら行われない。‘<code class="literal">-u</code>’オプションが指定された場合、Emacsはかわりにそのユーザーのホームディレクトリー内でinitファイルを探す。
</p></li><li class="listitem"><p>存在する場合はライブラリー<code class="filename">default</code>をロードする。これは<code class="literal">inhibit-default-init</code>が非<code class="literal">nil</code>、あるいはオプション‘<code class="literal">-q</code>’、‘<code class="literal">-Q</code>’、または‘<code class="literal">--batch</code>’指定された場合は行われない。
<a id="idm82439760" class="indexterm"/>
</p></li><li class="listitem"><p>もしファイルが存在して、かつ読み込み可能なら、<code class="literal">abbrev-file-name</code>で指定されるファイルから、ユーザーのabbrevをロードする(<a class="link" href="ch36s03.html" title="Saving Abbrevs in Files">abbrev-file-name</a>を参照)。オプション‘<code class="literal">--batch</code>’が指定されていたら、これは行われない。
</p></li><li class="listitem"><p><code class="literal">package-enable-at-startup</code>が非<code class="literal">nil</code>なら、インストール済のオプションのEmacs
Lispパッケージすべてをアクティブにするために、関数<code class="literal">package-initialize</code>を呼び出す。<a class="link" href="ch40.html#Packaging-Basics" title="Packaging Basics">Packaging
Basics</a>を参照のこと。
</p></li><li class="listitem"><a id="idm82433872" class="indexterm"/><p>変数<code class="literal">after-init-time</code>に、<code class="literal">current-time</code>の値をセットする。この変数は事前に<code class="literal">nil</code>にセットされている。これをカレント時刻にセットすることが、初期化フェーズが終わったことの合図となり、かつ<code class="literal">before-init-time</code>と共に用いることにより、初期化に要した時間の計測手段を提供する。
</p></li><li class="listitem"><p>ノーマルフック<code class="literal">after-init-hook</code>を実行する。
</p></li><li class="listitem"><p>バッファー<code class="filename">*scratch*</code>が存在し、それがまだ(デフォルトであるべき)Fundamentalモードなら、<code class="literal">initial-major-mode</code>に応じたメジャーモードをセットする。
</p></li><li class="listitem"><p>テキスト端末で開始された場合は、その端末固有のLispライブラリー(<a class="link" href="ch39.html#Terminal_002dSpecific" title="Terminal-Specific Initialization">Terminal-Specific</a>を参照)をロードして、フック<code class="literal">tty-setup-hook</code>を実行する。これは<code class="literal">--batch</code>モード、または<code class="literal">term-file-prefix</code>が<code class="literal">nil</code>なら実行されない。
</p></li><li class="listitem"><p><code class="literal">inhibit-startup-echo-area-message</code>で抑制していなければ、エコーエリアに初期メッセージを表示する。
</p></li><li class="listitem"><p>これ以前に処理されていない、すべてのコマンドラインオプションを処理する。
</p></li><li class="listitem"><p>オプション<code class="literal">--batch</code>が指定されていたら、ここでexitする。
</p></li><li class="listitem"><p><code class="literal">initial-buffer-choice</code>が文字列なら、その名前のファイル(またはディレクトリー)をvisitする。それが関数なら引数なしでその関数を呼び出して、それがリターンしたバッファーを選択する。
<code class="filename">*scratch*</code>が存在し空ならば、そのバッファーに<code class="literal">initial-scratch-message</code>を挿入する。
</p></li><li class="listitem"><p><code class="literal">emacs-startup-hook</code>を実行する。
</p></li><li class="listitem"><p>initファイルの指定が何であれ、それに応じて選択されたフレームのパラメーターを変更する<code class="literal">frame-notice-user-settings</code>を呼び出す。
</p></li><li class="listitem"><p><code class="literal">window-setup-hook</code>を実行する。このフックと<code class="literal">emacs-startup-hook</code>の違いは、前述したフレームパラメーターの変更後にこれが実行される点だけである。
</p></li><li class="listitem"><a id="idm82385616" class="indexterm"/><p>copyleftとEmacsの基本的な使い方を含む特別なバッファーである、<em class="firstterm">スタートアップスクリーン(startup
screen)</em>ヲ表示する。これは<code class="literal">inhibit-startup-screen</code>か<code class="literal">initial-buffer-choice</code>が非<code class="literal">nil</code>、あるいはコマンドラインオプション‘<code class="literal">--no-splash</code>’か‘<code class="literal">-Q</code>’が指定されていたら行われない。
</p></li><li class="listitem"><p>オプション<code class="literal">--daemon</code>ガ指定されていたら、<code class="literal">server-start</code>を呼び出して、制御端末からデタッチする。section “Emacs
Server” in <em class="citetitle">The GNU Emacs Manual</em>を参照のこと。
</p></li><li class="listitem"><p>セッションマネージャーにより開始された場合には、以前のセッションのIDを引数として、<code class="literal">emacs-session-restore</code>を呼び出す。<a class="link" href="ch39s17.html" title="Session Management">Session
Management</a>を参照のこと。
</p></li></ol></div><p>以下のオプションは、スタートアップシーケンスの側面のいくつかに影響を与えます。
</p><pre class="synopsis"><a id="idm82375504" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">inhibit-startup-screen</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>なら、スタートアップスクリーンを抑制する。この場合、通常Emacsは<code class="filename">*scratch*</code>バッファーを表示する。しかし、以下の<code class="literal">initial-buffer-choice</code>を参照されたい。
</p><p>新しいユーザーがcopyleftやEmacsの基本的な使い方に関する情報を入手するのを防げるので、新しいユーザーのinitファイル内や、複数のユーザーぶ影響するような方法でこの変数をセットしてはならない
</p><a id="idm82371152" class="indexterm"/><a id="idm82370384" class="indexterm"/><p><code class="literal">inhibit-startup-message</code>と<code class="literal">inhibit-splash-screen</code>は、この変数にたいするエイリアスである。
</p></blockquote></div><pre class="synopsis"><a id="idm82368080" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">initial-buffer-choice</code></pre><div class="blockquote"><blockquote class="blockquote"><p>非<code class="literal">nil</code>なら、この変数はスタートアップ後にスタートアップスクリーンのかわりにEmacsが表示するファイルを指定する文字列であること。この変数が関数なら、Emacsはその関数を呼び出し、その関数はその後に表示するバッファーをリターンしなければならない。値が<code class="literal">t</code>なら、Emacsは<code class="filename">*scratch*</code>バッファーを表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm82363856" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">inhibit-startup-echo-area-message</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数はエコーエリアのスタートアップメッセージの表示を制御する。ユーザーのinitファイル内に以下の形式のテキストを追加することにより、エコーエリアのスタートアップメッセージを抑制できる:
</p><pre class="screen">(setq inhibit-startup-echo-area-message
      "<em class="replaceable"><code>your-login-name</code></em>")
</pre><p>Emacsはユーザーのinitファイル内の、上記のような式を明示的にチェックする。ユーザーのロフイン名は、Lispの文字列定数としてこの式内に記述されていなければならない。Customizeインターフェイスを使用することもできる。他の方法で同じ値に<code class="literal">inhibit-startup-echo-area-message</code>をセットしても、スタートアップメッセージは抑制されない。この方法により、望むならユーザー自身で簡単にメッセージを抑制できるが、単に自分用のiniファイルを別のユーザーにコピーしても、メッセージは抑制されないだろう。
</p></blockquote></div><pre class="synopsis"><a id="idm82359376" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">initial-scratch-message</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>なら、Emacsスタートアップ時に<code class="filename">*scratch*</code>バッファーに挿入する文字列であること。<code class="literal">nil</code>なら<code class="filename">*scratch*</code>バッファーは空になる。
</p></blockquote></div><p>以下のコマンドラインオプションは、スタートアップシーケンスのいくつかの側面に影響を与えます。section “Initial Options” in <em class="citetitle">The GNU Emacs Manual</em>を参照してください。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--no-splash</code>
</span></dt><dd><p>スプラッシュスクリーンを表示しない。
</p></dd><dt><span class="term"><code class="literal">--batch</code>
</span></dt><dd><p>対話的な端末なしで実行する。<a class="link" href="ch39s16.html" title="Batch Mode">Batch Mode</a>を参照のこと。
</p></dd><dt><span class="term"><code class="literal">--daemon</code>
</span></dt><dd><p>表示の初期化を何も行わず、単にバックグラウンドでサーバーを開始する。
</p></dd><dt><span class="term"><code class="literal">--no-init-file</code>
, </span><span class="term"><code class="literal">-q</code>
</span></dt><dd><p>initファイルと<code class="filename">default</code>ライブラリーをいずれもロードしない。
</p></dd><dt><span class="term"><code class="literal">--no-site-file</code>
</span></dt><dd><p><code class="filename">site-start</code>ライブラリーをロードしない。
</p></dd><dt><span class="term"><code class="literal">--quick</code>
, </span><span class="term"><code class="literal">-Q</code>
</span></dt><dd><p>‘<code class="literal">-q --no-site-file --no-splash</code>’と等価。
</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Init-File"/>The Init File</h2></div></div></div><a id="idm82329552" class="indexterm"/><a id="idm82328784" class="indexterm"/><a id="idm82327760" class="indexterm"/><p>Emacsの開始時は通常、ユーザーの<em class="firstterm">initファイル(init
file)</em>のロードを試みます。これはユーザーのホームディレクトリー内にある<code class="filename">.emacs</code>または<code class="filename">.emacs.el</code>という名前のファイル、あるいはホームディレクトリーの<code class="filename">.emacs.d</code>という名前のサブディレクトリー内にある<code class="filename">init.el</code>という名前のファイルのいずれかのファイルです。
</p><p>コマンドラインスイッチ‘<code class="literal">-q</code>’、‘<code class="literal">-Q</code>’、‘<code class="literal">-u</code>’はinitファイルを探すべきかと、どこで探すかを制御します。‘<code class="literal">-u
<em class="replaceable"><code>user</code></em></code>’はそのユーザーではなく<em class="replaceable"><code>user</code></em>のinitファイルのロードを指示しますが、‘<code class="literal">-q</code>’(‘<code class="literal">-Q</code>’のほうが強力)はinitファイルをロードしないことを指示します。section “Entering
Emacs” in <em class="citetitle">The GNU Emacs
Manual</em>を参照してください。いずれのオプションも指定されていなければ、ユーザーのホームディレクリーからinitファイルを探すために、Emacsは環境変数<code class="envar">LOGNAME</code>、<code class="envar">USER</code>(ほとんどのシステム)、または<code class="envar">USERNAME</code>(MSシステム)を使用します。この方法により、たとえsuしていたとしても、依然としてEmacsはそのユーザー自身のinitファイルをロードできるのです。これらの環境変数が存在していなくても、EmacsはユーザーIDからユーザーのホームディレクトリーを探します。
</p><a id="idm82314064" class="indexterm"/><p>インストールしたEmacsによっては<code class="filename">default.el</code>というLispライブラリーの、<em class="firstterm">デフォルトinitファイル(default
init file)</em>が存在するかもしれません。Emacsはライブラリーの標準検索パスからこのファイルを探します(<a class="link" href="ch16.html#How-Programs-Do-Loading" title="How Programs Do Loading">How Programs
Do
Loading</a>を参照)。Emacsディストリビューションには、このファイルはローカルなカスタマイズを意図しています。デフォルトinitファイルが存在する場合は、常にこのファイルがEmacs開始時にロードされます。しかしユーザー自身のinitファイルが存在する場合には、それが最初にロードされます。それにより<code class="literal">inhibit-default-init</code>が非<code class="literal">nil</code>値にセットされた場合、Emacsは後続する<code class="filename">default.el</code>ファイルのロードを行いません。batchモード、または‘<code class="literal">-q</code>’(または‘<code class="literal">-Q</code>’)を指定した場合、Emacsは個人的なinitファイルトでデフォルトinitファイのいずれもロードしません。
</p><p>サイトのカスタマイズのためのファイルは、<code class="filename">site-start.el</code>です。Emacsはユーザーのinitファイルの<span class="emphasis"><em>前</em></span>にこれをロードします。オプション‘<code class="literal">--no-site-file</code>’により、このファイルのロードを抑制できます。
</p><pre class="synopsis"><a id="idm82306768" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">site-run-file</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、ユーザーのinitファイルの前にロードする、サイト用カスタマイズファイルを指定する。通常の値は<code class="literal">"site-start"</code>。実際に効果があるようにこれを変更するには、Emacsのdump前に変更するのが唯一の方法となる。
</p></blockquote></div><p>一般的に必要とされる<code class="filename">.emacs</code>ファイルのカスタマイズ方法については、section “Init File
Examples” in <em class="citetitle">The GNU Emacs Manual</em>を参照のこと。
</p><pre class="synopsis"><a id="idm82302032" class="indexterm"/><span class="category"><span class="bold"><strong>User Option</strong></span>:</span> <code class="varname">inhibit-default-init</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数が非<code class="literal">nil</code>なら、Emacsがデフォルトの初期化ライブラリーファイルをロードするのを防ぐ。デフォルト値は<code class="literal">nil</code>。
</p></blockquote></div><pre class="synopsis"><a id="idm82298320" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">before-init-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、すべてのinitファイル(<code class="filename">site-start.el</code>、ユーザーのinitファイル、および<code class="filename">default.el</code>)のロード直前に1度実行される。(実際に効果があるようにこれを変更するには、Emacsのdump前に変更するのが唯一の方法となる。)
</p></blockquote></div><pre class="synopsis"><a id="idm82294608" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">after-init-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、すべてのinitファイル(<code class="filename">site-start.el</code>、ユーザーのinitファイル、および<code class="filename">default.el</code>)のロード直後、端末固有ライブラリーのロードとコマンドラインアクション引数の処理の前に1度実行される。
</p></blockquote></div><pre class="synopsis"><a id="idm82290896" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">emacs-startup-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、コマンドライン引数の処理直後に1度実行される。batchモードでは、Emacsはこのフックを実行しない。
</p></blockquote></div><pre class="synopsis"><a id="idm82288208" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">window-setup-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>このノーマルフックは、<code class="literal">emacs-startup-hook</code>と非常に似ている。このフックが若干遅れて、フレームパラメーターのセット後に実行されるのが唯一の違いである。<a class="link" href="ch39.html#Startup-Summary" title="Summary: Sequence of Actions at Startup">window-setup-hook</a>を参照のこと。
</p></blockquote></div><pre class="synopsis"><a id="idm82284496" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">user-init-file</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、ユーザーのinitファイルの絶対ファイル名を保持する。実際にロードされたinitファイルが<code class="filename">.emacs.elc</code>のようなコンパイル済なら、値はそれに対応するソースファイルを参照する。
</p></blockquote></div><pre class="synopsis"><a id="idm82269008" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">user-emacs-directory</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、<code class="filename">.emacs.d</code>ディレクトリーの名前を保持する。これは、MS-DOS以外のプラットフォームでは<code class="filename">~/.emacs.d</code>である。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Terminal_002dSpecific"/>Terminal-Specific Initialization</h2></div></div></div><a id="idm82264528" class="indexterm"/><p>端末タイプはそれぞれ、その端末のタイプでEmacsが実行時にロードする、独自のLispライブラリーをもつことができます。そのライブラリーの名前は、変数<code class="literal">term-file-prefix</code>の値と、端末タイプ(環境変数<code class="envar">TERM</code>により指定される)を結合することにより構築されます。<code class="literal">term-file-prefix</code>は通常は値<code class="literal">"term/"</code>をもち、これの変更は推奨しません。Emacsは通常の方法、つまり<code class="literal">load-path</code>のディレクトリーから‘<code class="literal">.elc</code>’と‘<code class="literal">.el</code>’の拡張子のファイルを検索することにより、このファイルを探します。
</p><a id="idm82259920" class="indexterm"/><p>端末固有ライブラリーの通常の役割は、特殊キーによりEmacsが認識可能なシーケンスを送信可能にすることです。TermcapとTerminfoのエントリーがその端末のすべてのファンクションキーを指定していなければ、<code class="literal">input-decode-map</code>へのセットや追加も必要になるかもしれません。<a class="link" href="ch39s12.html" title="Terminal Input">Terminal
Input</a>を参照してください。
</p><p>端末タイプにハイフンとアンダースコアーが含まれ、その端末名に等しい名前のライブラリーが見つからないときには、Emacsはその端末名から最後のハイフンまたはアンダースコアー以降を取り除いて再試行します。このプロセスはEmacsがマッチするライブラリーを見つかるか、その名前にハイフンとアンダースコアーが含まれなくなる(つまりその端末固有ファイルが存在しない)まで繰り返されます。たとえば端末名が‘<code class="literal">xterm-256color</code>’で<code class="filename">term/xterm-256color.el</code>というライブラリーが存在しない場合、Emacsは<code class="filename">term/xterm.el</code>のロードを試みます。必要なら、その端末タイプの完全な名称を見つかるために、端末ライブラリーは<code class="literal">(getenv
"TERM")</code>を評価することができます。
</p><p>initファイルで変数<code class="literal">term-file-prefix</code>を<code class="literal">nil</code>にセットすることにより、端末固有ライブラリーのロードを防ぐことができます。
</p><p><code class="literal">tty-setup-hook</code>を使用することにより、端末固有ライブラリーのいくつかのアクションのアレンジやオーバーライドもできます。これは新たなテキスト端末の初期化語にEmacsが実行するノーマルフックです。自身のライブラリーをもたない端末にたいする初期化を定義するために、このフックを使用することのできるでしょう。<a class="link" href="ch23.html#Hooks" title="Hooks">Hooks</a>を参照してください。
</p><pre class="synopsis"><a id="idm82252240" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">term-file-prefix</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm82250192" class="indexterm"/><p>この変数の値が非<code class="literal">nil</code>なら、Emacsは以下のように端末固有初期化ファイルをロードする:
</p><pre class="screen">(load (concat term-file-prefix (getenv "TERM")))
</pre><p>端末初期化ファイルのロードを望まない場合には、変数<code class="literal">term-file-prefix</code>に<code class="literal">nil</code>をセットできる。
</p><p>MS-DOSでは、Emacsは環境変数<code class="envar">TERM</code>に‘<code class="literal">internal</code>’をセットする。
</p></blockquote></div><pre class="synopsis"><a id="idm82228432" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">tty-setup-hook</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数は、新たなテキスト端末の初期化後にEmacsが実行するノーマルフックである。(これは非ウィンドウのモードでのEmacs開始時と<span class="command"><strong>emacsclient</strong></span>のTTY接続作成時に適用される。)
(適用可能なら)このフックはユーザーのinitファイル、および端末固有Lispファイルのロード後に実行されるので、そのファイルにより行われた定義を調整するために、このフックを使用できる。
</p><p>関連する機能については、<a class="link" href="ch39.html#Init-File" title="The Init File">window-setup-hook</a>を参照のこと。
</p></blockquote></div></div><div class="sect2"><div class="titlepage"><div><div><h2 class="title"><a id="Command_002dLine-Arguments"/>Command-Line Arguments</h2></div></div></div><a id="idm82223568" class="indexterm"/><p>Emacs開始時に種々のアクションをリクエストするために、コマンドライン引数を使用できます。Emacsを使う際は、ログイン後に1度だけ起動して、同一のEmacsセッション内ですべてを行うのが推奨される方法です(section “Entering
Emacs” in <em class="citetitle">The GNU Emacs
Manual</em>を参照)。この理由により、コマンドライン引数を頻繁に使うことはないかもしれません。それでもセッションスクリプトからEmacsを呼び出すときやEmacsのデバッグ時に、コマンドライン引数が有用になるかもしれません。このセクションでは、Emacsがコマンドライン引数を処理する方法を説明します。
</p><pre class="synopsis"><a id="idm82221776" class="indexterm"/><span class="category"><span class="bold"><strong>Function</strong></span>:</span> <code class="function">command-line</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、Emacsが呼び出された際のコマンドライン引数を解析、処理、そして(とりわけ)ユーザーのinitファイルをロードして、スタートアップメッセージを表示する。
</p></blockquote></div><pre class="synopsis"><a id="idm82218960" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">command-line-processed</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、1度コマンドラインが処理されると<code class="literal">t</code>になる。
</p><p><code class="literal">dump-emacs</code>(<a class="link" href="ape.html#Building-Emacs" title="Building Emacs">Building
Emacs</a>を参照)を呼び出すことによりEmacsを再dumpする場合は、新たにdumpされたEmacsに新たなコマンドライン引数を処理させるために、最初にこの変数に<code class="literal">nil</code>をセットしたいと思うかもしれない。
</p></blockquote></div><pre class="synopsis"><a id="idm82213968" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">command-switch-alist</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm82211920" class="indexterm"/><a id="idm82211152" class="indexterm"/><a id="idm82210384" class="indexterm"/><p>この変数は、ユーザー定義のコマンドライン引数とそれに関連付けられたハンドラー関数のalistである。デフォルトは空だが、望むなら要素を追加できる。
</p><p><em class="firstterm">コマンドラインオプション(command-line option)</em>ハ、以下の形式をもつコマンドライン上の引数である:
</p><pre class="screen">-<em class="replaceable"><code>option</code></em>
</pre><p><code class="literal">command-switch-alist</code>の要素は以下のようになる:
</p><pre class="screen">(<em class="replaceable"><code>option</code></em> . <em class="replaceable"><code>handler-function</code></em>)
</pre><p>CARの<em class="replaceable"><code>option</code></em>は文字列で、コマンドラインオプションの名前である(先頭のハイフンは含まない)。<em class="replaceable"><code>handler-function</code></em>は<em class="replaceable"><code>option</code></em>を処理するために呼び出され、単一の引数としてオプション名を受け取る。
</p><p>このオプションは、コマンドライン内で引数を併う場合がある。この場合、<em class="replaceable"><code>handler-function</code></em>は残りのコマンドライン引数すべてを、変数<code class="literal">command-line-args-left</code>(以下参照)で見い出すことができる(コマンドライン引数のリスト全体は<code class="literal">command-line-args</code>)。
</p><p>コマンドライン引数は、<code class="filename">startup.el</code>ファイル内の<code class="literal">command-line-1</code>により解析される。section “Command Line Arguments for Emacs Invocation” in <em class="citetitle">The GNU
Emacs Manual</em>も参照されたい。
</p></blockquote></div><pre class="synopsis"><a id="idm82200144" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">command-line-args</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、Emacsに渡されたコマンドライン引数のリストである。
</p></blockquote></div><pre class="synopsis"><a id="idm82197456" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">command-line-args-left</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm82195408" class="indexterm"/><p>この変数の値は、まだ処理されていないコマンドライン引数のリストである。
</p></blockquote></div><pre class="synopsis"><a id="idm82193488" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">command-line-functions</code></pre><div class="blockquote"><blockquote class="blockquote"><p>この変数の値は、認識されなかったコマンドライン引数を処理するための関数のリストである。次の引数が処理されてそれに特別な意味がないときは毎回、このリスト内の関数が非<code class="literal">nil</code>をリターンするまでリスト内の出現順に呼び出される。
</p><p>これらの関数は引数なしで呼び出される。関数は、その時点で一時的にバインドされている変数<code class="literal">argi</code>を通じて、検討中のコマンドラインにアクセスできる。残りの引数(カレントの引数含まず)は、変数<code class="literal">command-line-args-left</code>内にあえう。
</p><p>関数が<code class="literal">argi</code>内のその引数を認識して処理したときは、その引数を処理したと告げるために非<code class="literal">nil</code>をリターンすること。後続の引数のいくつかを処理したときは、<code class="literal">command-line-args-left</code>からそれらを削除してそれを示すことができる。
</p><p>これらの関数すべてが<code class="literal">nil</code>をリターンした場合、その引数はvisitすべきファイル名として扱われる。
</p></blockquote></div></div></div></div></body></html>