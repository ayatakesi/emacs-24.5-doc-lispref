<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Session Management</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Session-Management"/>Session Management</h1></div></div></div><a id="idm85376336" class="indexterm"/><p>Emacsはアプリケーションのサスペンドとリスタートに使用される、Xセッション管理プロトコル(X Session Management
Protocol)をサポートしています。Xウィンドウシステムでは、<em class="firstterm">セッションマネージャー(session
manager)</em>と呼ばれるプログラムが、実行中アプリケーション追跡の責を負います。Xサーバーのシャットダウン時、セッションマネージャーはアプリケーションに状態を保存するか尋ね、それらが応答するまでシャットダウンを遅延します。アプリケーションがそのシャットダウンをキャンセルすることもできます。
</p><p>セッションマネージャーがサスペンドされたセッションをリスタートする際には、これらのアプリケーションにたいして保存された状態をリロードするよう、個別に指示します。これはリストアする保存済みセッションが何かを指定する、特別なコマンドラインオプションを指定することにより行われます。これは、Emacsでは‘<code class="literal">--smid
<em class="replaceable"><code>session</code></em></code>’という引数です。
</p><pre class="synopsis"><a id="idm85344720" class="indexterm"/><span class="category"><span class="bold"><strong>Variable</strong></span>:</span> <code class="varname">emacs-save-session-functions</code></pre><div class="blockquote"><blockquote class="blockquote"><a id="idm85342672" class="indexterm"/><p>Emacsは、<code class="literal">emacs-save-session-functions</code>と呼ばれるフックを介して、状態の保存をサポートする。セッションマネージャーがウィンドウシステムのシャットダウンを告げた際に、Emacsはこのフックを実行する。これらの関数は、カレントバッファーを一時バッファーにセットされて、引数なしで呼び出されるそれぞれの関数は、このバッファーにLispコードを追加するために<code class="literal">insert</code>を使用できる。最後にEmacsは、<em class="firstterm">セッションファイル(session
file)</em>と呼ばれるファイル内にそのバッファーを保存する。
</p><a id="idm85340112" class="indexterm"/><p>その後セッションマネージャーがEmacsを再開する際、Emacsはセッションファイルを自動的にロードする(<a class="link" href="ch16.html" title="Chapter 15. Loading">Loading</a>を参照)。これはスタートアップ中に呼び出される、<code class="literal">emacs-session-restore</code>という名前の関数により処理される。<a class="link" href="ch39.html#Startup-Summary" title="Summary: Sequence of Actions at Startup">Startup
Summary</a>を参照のこと。
</p><p><code class="literal">emacs-save-session-functions</code>内の関数が非<code class="literal">nil</code>をリターンすると、Emacsはセッションマネージャーにシャットダウンのキャンセルを要求します。
</p></blockquote></div><p>以下は、セッションマネージャによりEmacsがリストアされる際に、単に<code class="filename">*scratch*</code>にテキストを挿入する例です。
</p><pre class="screen">(add-hook 'emacs-save-session-functions 'save-yourself-test)
</pre><pre class="screen">
</pre><pre class="screen">(defun save-yourself-test ()
  (insert "(save-current-buffer
  (switch-to-buffer \"*scratch*\")
  (insert \"I am restored\"))")
  nil)
</pre></div></body></html>