<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 39. Preparing Lisp code for distribution</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Packaging"/>Chapter 39. Preparing Lisp code for distribution</h1></div></div></div><a id="idm85135952" class="indexterm"/><a id="idm85135184" class="indexterm"/><p>Emacsは、Emacs
Lispコードをユーザーに配布するための、標準的な方法を提供します。<em class="firstterm">パッケージ(package)</em>は、ユーザーが簡単にダウンロード、インストール、アンインストール、および更新できるような方法でフォーマットおよび同梱された、1つ以上のファイルのコレクションです。
</p><p>以降のセクションではパッケージを作成する方法、およびそれを他の人がダウンロードできるように、<em class="firstterm">パッケージアーカイブ(package
archive)</em>に配置する方法を説明します。パッケージングシステムのユーザーレベル機能の説明は、section “Packages” in <em class="citetitle">The
GNU Emacs Manual</em>を参照してください。
</p><div class="sect1"><div class="titlepage"><div><div><h1 class="title"><a id="Packaging-Basics"/>Packaging Basics</h1></div></div></div><a id="idm85131600" class="indexterm"/><a id="idm85130832" class="indexterm"/><a id="idm85130064" class="indexterm"/><a id="idm85129296" class="indexterm"/><a id="idm85128528" class="indexterm"/><p>パッケージは<em class="firstterm">シンプルパケージ(simple package)</em>か<em class="firstterm">複数ファイルパッケージ(multi-file
package)</em>のいずれかです。シンプルパッケージは単一のEmacs
Lispファイル内に格納される一方、複数ファイルパッケージはtarファイル(複数のLispファイルとマニュアルのような非Lispファイルが含まれる可能性がある)に格納されます。
</p><p>通常の使い方では、シンプルパッケージと複数ファイルパッケージとの違いは、比較的重要ではありません。Package
Menuインターフェースでは、それらの間に差異はありません。しかし以降のセクションで説明するように、それらを作成する手順は異なります。
</p><p>パッケージ(シンプルか複数ファイル)はそれぞれ、特定の<em class="firstterm">属性(attributes)</em>をもっています:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name
</span></dt><dd><p>短い単語(たとえば‘<code class="literal">auctex</code>’)。これは通常、そのプログラム内でシンボルプレフィクスとしても仕様される(<a class="link" href="apd.html#Coding-Conventions" title="Emacs Lisp Coding Conventions">Coding
Conventions</a>を参照)。
</p></dd><dt><span class="term">Version
</span></dt><dd><p>関数<code class="literal">version-to-list</code>が理解できる形式のバージョン番号(たとえば‘<code class="literal">11.86</code>’)。パッケージの各リリースでは、バージョン番号のアップも行うこと。
</p></dd><dt><span class="term">Brief description
</span></dt><dd><p>そのパッケージがPackage Menuにリストされる際に、これが表示される。理想的には36文字以内で、単一行を占めるべきである。
</p></dd><dt><span class="term">Long description
</span></dt><dd><p>これは<strong class="userinput"><code>C-h
P</code></strong>(<code class="literal">describe-package</code>)により作成されたバッファーに表示され、これの後にそのパッケージの簡単な説明(brief
description)とインストール状態(installation
status)が続く。通常これは複数行に渡り、そのパッケージの能力と、インストール後に使用を開始するための方法を完全に記述すること。
</p></dd><dt><span class="term">Dependencies
</span></dt><dd><p>そのパッケージが依存する、他のパッケージ(恐らく最低のバージョン番号を含む)。このリストは空でもよく、その場合パッケージには依存パッケージがないことを意味する。それ以外なら、このパッケージをインストールすることにより、その依存パッケージも自動的にインストールされる。依存パッケージのいずれかが見つからなければ、そのパッケージをインストールすることはできない。
</p></dd></dl></div><a id="idm82881360" class="indexterm"/><p>コマンド<code class="literal">package-install-file</code>、またはPackage
Menuのいずれかを介したパッケージのインストールでは、<code class="literal">package-user-dir</code>に<code class="filename"><em class="replaceable"><code>name</code></em>-<em class="replaceable"><code>version</code></em></code>という名前のサブディレクトリーが作成される。ここで<em class="replaceable"><code>name</code></em>はパッケージ名、<em class="replaceable"><code>version</code></em>はバージョン番号である(たとえば<code class="filename">~/.emacs.d/elpa/auctex-11.86/</code>)。わたしたちはこれを、そのパッケージの<em class="firstterm">コンテンツディレクトリー(content
directory)</em>と呼んでいます。これは、Emacsがパッケージのコンテンツ(シンプルパッケージでは単一のLispファイル、または複数ファイルパッケージから抽出されたファイル)を配置する場所です。
</p><a id="idm85125072" class="indexterm"/><p>その後Emacsは、autoloadマジックコメント(<a class="link" href="ch16s05.html" title="Autoload">Autoload</a>を参照)にたいして、このコンテンツディレクトリー内のすべてのLispファイルを検索します。これらのautoload定義は、コンテンツディレクトリーの<code class="filename"><em class="replaceable"><code>name</code></em>-autoloads.el</code>という名前のファイルに保存されます。これらは通常、そのパッケージ内で定義された主要なユーザーコマンドのautoloadに使用されますが、<code class="literal">auto-mode-alist</code>への要素の追加(<a class="link" href="ch23s02.html#Auto-Major-Mode" title="How Emacs Chooses a Major Mode">Auto
Major
Mode</a>を参照)等、別のタスクを行うこともできます。パッケージは通常、その中で定義された関数と変数のすべてをautoload<span class="emphasis"><em>しない</em></span>ことに注意してください
—
通常はそのパッケージの使用を開始するために呼び出される一握りのコマンドだけがautoloadされます。それから、Emacsはそのパッケージ内のすべてのLispファイルをバイトコンパイルします。
</p><p>インストール後、インストールされたパッケージは<em class="firstterm">ロード済み(loaded)</em>になります。Emacsは<code class="literal">load-path</code>にコンテンツディレクトリーを追加して、<code class="filename"><em class="replaceable"><code>name</code></em>-autoloads.el</code>内のautoload定義を評価します。
</p><p>Emacsのスタートアップ時は常に、インストール済みパッケージをロードするために、自動的に関数<code class="literal">package-initialize</code>が呼び出されます。これはinitファイルと、(もしあれば)abbrevファイルのロード後、かつ<code class="literal">after-init-hook</code>の実行前に行われます(<a class="link" href="ch39.html#Startup-Summary" title="Summary: Sequence of Actions at Startup">Startup
Summary</a>を参照)。ユーザーオプション<code class="literal">package-enable-at-startup</code>が<code class="literal">nil</code>なら、自動的なパッケージのロードは無効です。
</p><pre class="synopsis"><a id="idm85103568" class="indexterm"/><span class="category"><span class="bold"><strong>Command</strong></span>:</span> <code class="function">package-initialize</code> <em class="replaceable"><code>&amp;optional</code></em> <em class="replaceable"><code>no-activate</code></em></pre><div class="blockquote"><blockquote class="blockquote"><p>この関数は、インストール済みパッケージとそれらがロード済みかを記録する、Emacsの内部レコードを初期化する。ユーザーオプション<code class="literal">package-load-list</code>は、どのパッケージをロードするかを指定する。デフォルトでは、すべてのインストール済みパッケージがロードされる。section “Package
Installation” in <em class="citetitle">The GNU Emacs Manual</em>を参照のこと。
</p><p>オプション引数<em class="replaceable"><code>no-activate</code></em>が非<code class="literal">nil</code>なら、インストール済みパッケージを実際にロードせずに、このレコードを更新する。これは内部でのみ使用される。
</p></blockquote></div></div></div></body></html>